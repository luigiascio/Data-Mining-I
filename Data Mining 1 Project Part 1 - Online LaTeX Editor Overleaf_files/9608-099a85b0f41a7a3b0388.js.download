(self.webpackChunkFrontend=self.webpackChunkFrontend||[]).push([[9608],{58756:(e,t,n)=>{const r=n(45461),o=n(10729),s=n(99568),i=n(97277),a=n(35078),c=n(10048),l=n(11485),h=n(33101),d=n(1651),u=n(43921),p=n(98695),g=n(79600),m=n(62293),f=n(97348),_=n(91822),w=n(87520),v=n(84140),b=n(85544),y=n(82927),x=n(90482),k=n(63821),E=n(27673),T=n(8010),j=n(41546),C=n(33755),I=n(64331),S=n(23531),L=n(45317),A=n(91810),O=n(22246),R=n(44838),M=n(2058),F=n(65591),{InsertOp:P,RemoveOp:D,RetainOp:N,ScanOp:X}=n(42991),$=n(26041),U=n(13376),V=n(61210),B=n(2085),W=n(18452),H=n(82174);t.AddCommentOperation=r,t.Author=o,t.AuthorList=s,t.Blob=i,t.Change=a,t.ChangeRequest=c,t.ChangeNote=l,t.Chunk=h,t.ChunkResponse=d,t.Comment=u,t.DeleteCommentOperation=p,t.File=g,t.FileMap=m,t.LazyStringFileData=H,t.History=f,t.Label=_,t.AddFileOperation=w,t.MoveFileOperation=v,t.SetCommentStateOperation=b,t.EditFileOperation=y,t.EditNoOperation=x,t.SetFileMetadataOperation=k,t.NoOperation=E,t.Operation=T,t.RestoreOrigin=j,t.RestoreFileOrigin=C,t.Origin=I,t.OtClient=S,t.TextOperation=L,t.EditOperation=A,t.safePathname=O,t.Snapshot=R,t.util=M,t.V2DocVersions=F,t.ScanOp=X,t.InsertOp=P,t.RetainOp=N,t.RemoveOp=D,t.TrackedChangeList=U,t.TrackedChange=$,t.Range=B,t.CommentList=W,t.TrackingProps=V},10729:(e,t,n)=>{"use strict";const r=n(64347).assert;class o{constructor(e,t,n){r.number(e,"bad id"),r.string(t,"bad email"),r.string(n,"bad name"),this.id=e,this.email=t,this.name=n}static fromRaw(e){return e?new o(e.id,e.email,e.name):null}toRaw(){return{id:this.id,email:this.email,name:this.name}}getId(){return this.id}getEmail(){return this.email}getName(){return this.name}}e.exports=o},99568:(e,t,n)=>{"use strict";const r=n(45250),o=n(64347),s=n(10729);e.exports={assertV1:function(e,t){const n=e.filter((function(e){return null!=e}));if(n.length>0){const e=o.integer(n[0])?o.assert.integer:r.partial(o.assert.instance,r,s);r.each(n,(function(n){e(n,t)}))}},assertV2:function(e,t){r.each(e,(function(e){o.assert.maybe.match(e,/^[0-9a-f]{24}$/,t)}))}}},97277:(e,t,n)=>{"use strict";var r;function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(66264);const s=n(64347).assert,i=n(37603),a=n(45317);class c{constructor(e,t,n){this.setHash(e),this.setByteLength(t),this.setStringLength(n)}static fromRaw(e){return e?new c(e.hash,e.byteLength,e.stringLength):null}toRaw(){return{hash:this.hash,byteLength:this.byteLength,stringLength:this.stringLength}}getHash(){return this.hash}setHash(e){s.maybe.match(e,c.HEX_HASH_RX,"bad hash"),this.hash=e}getByteLength(){return this.byteLength}setByteLength(e){s.maybe.integer(e,"bad byteLength"),this.byteLength=e}getStringLength(){return this.stringLength}setStringLength(e){s.maybe.integer(e,"bad stringLength"),this.stringLength=e}}r=c,o(c,"HEX_HASH_RX_STRING","^[0-9a-f]{40,40}$"),o(c,"HEX_HASH_RX",new RegExp(r.HEX_HASH_RX_STRING)),o(c,"MAX_EDITABLE_BYTE_LENGTH_BOUND",3*a.MAX_STRING_LENGTH),o(c,"NotFoundError",class NotFoundError extends i{constructor(e){super(`blob ${e} not found`,{hash:e}),this.hash=e}}),e.exports=c},35078:(e,t,n)=>{"use strict";var r;function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(66264);const s=n(45250),i=n(64347).assert,a=n(90953),c=n(99568),l=n(8010),h=n(64331),d=n(44838),u=n(62293),p=n(65591);class g{constructor(e,t,n,r,o,s,i){this.setOperations(e),this.setTimestamp(t),this.setAuthors(n||[]),this.setOrigin(r),this.setV2Authors(o||[]),this.setProjectVersion(s),this.setV2DocVersions(i)}toRaw(){const e={operations:this.operations.map((function(e){return e.toRaw()})),timestamp:this.timestamp.toISOString(),authors:this.authors};return this.v2Authors&&(e.v2Authors=this.v2Authors),this.origin&&(e.origin=this.origin.toRaw()),this.projectVersion&&(e.projectVersion=this.projectVersion),this.v2DocVersions&&(e.v2DocVersions=this.v2DocVersions.toRaw()),e}static fromRaw(e){if(!e)return null;let t;return i.array.of.object(e.operations,"bad raw.operations"),i.nonEmptyString(e.timestamp,"bad raw.timestamp"),e.authors&&(t=e.authors.map((e=>0===e?null:e))),new g(e.operations.map(l.fromRaw),new Date(e.timestamp),t,e.origin&&h.fromRaw(e.origin),e.v2Authors,e.projectVersion,e.v2DocVersions&&p.fromRaw(e.v2DocVersions))}getOperations(){return this.operations}setOperations(e){i.array.of.object(e,"Change: bad operations"),this.operations=e}getTimestamp(){return this.timestamp}setTimestamp(e){i.date(e,"Change: bad timestamp"),this.timestamp=e}getAuthors(){return this.authors}setAuthors(e){i.array(e,"Change: bad author ids array"),e.length>1&&i.maybe.emptyArray(this.v2Authors,"Change: cannot set v1 authors if v2 authors is set"),c.assertV1(e,"Change: bad author ids"),this.authors=e}getV2Authors(){return this.v2Authors}setV2Authors(e){i.array(e,"Change: bad v2 author ids array"),e.length>1&&i.maybe.emptyArray(this.authors,"Change: cannot set v2 authors if v1 authors is set"),c.assertV2(e,"Change: not a v2 author id"),this.v2Authors=e}getOrigin(){return this.origin}setOrigin(e){i.maybe.instance(e,h,"Change: bad origin"),this.origin=e}getProjectVersion(){return this.projectVersion}setProjectVersion(e){i.maybe.match(e,g.PROJECT_VERSION_RX,"Change: bad projectVersion"),this.projectVersion=e}getV2DocVersions(){return this.v2DocVersions}setV2DocVersions(e){i.maybe.instance(e,p,"Change: bad v2DocVersions"),this.v2DocVersions=e}findBlobHashes(e){for(const t of this.operations)t.findBlobHashes(e)}async loadFiles(e,t){for(const n of this.operations)await n.loadFiles(e,t)}pushOperation(e){return this.getOperations().push(e),this}applyTo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i.object(e,"bad snapshot");for(const n of this.operations)try{n.applyTo(e,t)}catch(e){if(!(e instanceof d.EditMissingFileError||e instanceof u.FileNotFoundError)||t.strict)throw e}this.projectVersion&&e.setProjectVersion(this.projectVersion),this.v2DocVersions&&e.updateV2DocVersions(this.v2DocVersions)}transformAfter(e){i.object(e,"bad other");const t=this.getOperations(),n=e.getOperations();for(let e=0;e<n.length;++e)for(let r=0;r<t.length;++r)t[r]=l.transform(t[r],n[e])[0]}clone(){return g.fromRaw(this.toRaw())}async store(e,t){i.maybe.number(t,"bad concurrency");const n=this.toRaw();n.authors=s.uniq(n.authors);const r=await a(this.operations,(t=>t.store(e)),{concurrency:t||1});return n.operations=r,n}canBeComposedWith(e){const t=this.getOperations(),n=e.getOperations();return!(t.length>1||n.length>1)&&t[0].canBeComposedWith(n[0])}}r=g,o(g,"PROJECT_VERSION_RX_STRING","^[0-9]+\\.[0-9]+$"),o(g,"PROJECT_VERSION_RX",new RegExp(r.PROJECT_VERSION_RX_STRING)),e.exports=g},11485:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(35078);class s{constructor(e,t){r.integer(e,"bad baseVersion"),r.maybe.instance(t,o,"bad change"),this.baseVersion=e,this.change=t}toRaw(){return{baseVersion:this.baseVersion,change:this.change.toRaw()}}toRawWithoutChange(){return{baseVersion:this.baseVersion}}static fromRaw(e){return r.integer(e.baseVersion,"bad raw.baseVersion"),r.maybe.object(e.change,"bad raw.changes"),new s(e.baseVersion,o.fromRaw(e.change))}getBaseVersion(){return this.baseVersion}getResultVersion(){return this.baseVersion+1}getChange(){return this.change}}e.exports=s},10048:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(99568),s=n(35078),i=n(8010);class a{constructor(e,t,n,s){r.integer(e,"bad baseVersion"),r.array.of.object(t,"bad operations"),r.maybe.boolean(n,"ChangeRequest: bad untransformable"),s=s||[],o.assertV1(s,"bad authors"),this.authors=s,this.baseVersion=e,this.operations=t,this.untransformable=n||!1}toRaw(){return{baseVersion:this.baseVersion,operations:this.operations.map((function(e){return e.toRaw()})),untransformable:this.untransformable,authors:this.authors}}static fromRaw(e){return r.array.of.object(e.operations,"bad raw.operations"),new a(e.baseVersion,e.operations.map(i.fromRaw),e.untransformable,e.authors)}getBaseVersion(){return this.baseVersion}isUntransformable(){return this.untransformable}makeChange(e){return new s(this.operations,e,this.authors)}}e.exports=a},33101:(e,t,n)=>{"use strict";function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(66264);const o=n(64347).assert,s=n(37603),i=n(97348);class NotFoundError extends s{constructor(e,t,n){super(t||`no chunks for project ${e}`,n||{projectId:e}),this.projectId=e}}class a{constructor(e,t){o.instance(e,i,"bad history"),o.integer(t,"bad startVersion"),this.history=e,this.startVersion=t}static fromRaw(e){return new a(i.fromRaw(e.history),e.startVersion)}toRaw(){return{history:this.history.toRaw(),startVersion:this.startVersion}}getHistory(){return this.history}getSnapshot(){return this.history.getSnapshot()}getChanges(){return this.history.getChanges()}pushChanges(e){this.history.pushChanges(e)}getEndVersion(){return this.startVersion+this.history.countChanges()}getEndTimestamp(){return this.history.countChanges()?this.history.getChanges().slice(-1)[0].getTimestamp():null}getStartVersion(){return this.startVersion}async loadFiles(e,t){await this.history.loadFiles(e,t)}}r(a,"ConflictingEndVersion",class extends s{constructor(e,t){super("client sent updates with end_version "+e+" but latest chunk has end_version "+t,{clientEndVersion:e,latestEndVersion:t}),this.clientEndVersion=e,this.latestEndVersion=t}}),r(a,"NotFoundError",NotFoundError),r(a,"VersionNotFoundError",class VersionNotFoundError extends NotFoundError{constructor(e,t){super(e,`chunk for ${e} v ${t} not found`,{projectId:e,version:t}),this.projectId=e,this.version=t}}),r(a,"BeforeTimestampNotFoundError",class BeforeTimestampNotFoundError extends NotFoundError{constructor(e,t){super(e,`chunk for ${e} timestamp ${t} not found`),this.projectId=e,this.timestamp=t}}),r(a,"NotPersistedError",class NotPersistedError extends NotFoundError{constructor(e){super(e,`chunk for ${e} not persisted yet`),this.projectId=e}}),e.exports=a},1651:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(33101);class s{constructor(e){r.instance(e,o),this.chunk=e}toRaw(){return{chunk:this.chunk.toRaw()}}static fromRaw(e){return e?new s(o.fromRaw(e.chunk)):null}getChunk(){return this.chunk}}e.exports=s},43921:(e,t,n)=>{function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(66264);const{RetainOp:o,InsertOp:s,RemoveOp:i}=n(42991),a=n(2085);class c{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r(this,"ranges",[]),r(this,"resolved",!1),this.id=e,this.resolved=n,this.ranges=this.mergeRanges(t)}applyInsert(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!1;const o=[];for(const s of this.ranges)if(e===s.end)n?(o.push(s.extendBy(t)),r=!0):o.push(s);else if(e===s.start)n?(o.push(s.extendBy(t)),r=!0):o.push(s.moveBy(t));else if(s.startIsAfter(e))o.push(s.moveBy(t));else if(s.containsCursor(e))if(n)o.push(s.extendBy(t)),r=!0;else{const[n,,r]=s.insertAt(e,t);o.push(new a(s.pos,n.length)),o.push(r)}else o.push(s);return n&&!r&&o.push(new a(e,t)),new c(this.id,o,this.resolved)}applyDelete(e){const t=[];for(const n of this.ranges)n.overlaps(e)?t.push(n.subtract(e)):n.startsAfter(e)?t.push(n.moveBy(-e.length)):t.push(n);return new c(this.id,t,this.resolved)}applyTextOperation(e,t){let n=this,r=0;for(const c of e.ops)c instanceof o?r+=c.length:c instanceof s?(n=n.applyInsert(r,c.insertion.length,c.commentIds?.includes(t)),r+=c.insertion.length):c instanceof i&&(n=n.applyDelete(new a(r,c.length)));return n}isEmpty(){return 0===this.ranges.length}toRaw(){const e={id:this.id,ranges:this.ranges.map((e=>e.toRaw()))};return this.resolved&&(e.resolved=!0),e}mergeRanges(e){const t=[],n=[...e].sort(((e,t)=>e.start-t.start));for(const e of n){if(e.isEmpty())continue;const n=t[t.length-1];if(n?.overlaps(e))throw new Error("Ranges cannot overlap");if(e.isEmpty())throw new Error("Comment range cannot be empty");n?.canMerge(e)?t[t.length-1]=n.merge(e):t.push(e)}return t}static fromRaw(e){return new c(e.id,e.ranges.map((e=>a.fromRaw(e))),e.resolved)}}e.exports=c},20593:(e,t,n)=>{const r=n(37603);class UnprocessableError extends r{}e.exports={UnprocessableError,ApplyError:class ApplyError extends UnprocessableError{constructor(e,t,n){super(e),this.operation=t,this.operand=n}},InvalidInsertionError:class InvalidInsertionError extends UnprocessableError{constructor(e,t){super("inserted text contains non BMP characters"),this.str=e,this.operation=t}},TooLongError:class TooLongError extends UnprocessableError{constructor(e,t){super("resulting string would be too long",{resultLength:t}),this.operation=e,this.resultLength=t}}}},79600:(e,t,n)=>{"use strict";function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(66264);const o=n(45250),s=n(64347).assert,i=n(37603),a=n(12628),c=n(59622),l=n(14679);class h{constructor(e,t){s.instance(e,a,"File: bad data"),this.data=e,this.metadata={},this.setMetadata(t||{})}static fromRaw(e){return e?new h(a.fromRaw(e),e.metadata):null}static fromHash(e,t,n){return new h(new c(e,t),n)}static fromString(e,t){return new h(new l(e),t)}static createHollow(e,t,n){return new h(a.createHollow(e,t),n)}static createLazyFromBlobs(e,t,n){return new h(a.createLazyFromBlobs(e,t),n)}toRaw(){const e=this.data.toRaw();return d(this.metadata,e),e}getHash(){return this.data.getHash()}getRangesHash(){return this.data.getRangesHash()}getContent(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.data.getContent(e)}isEditable(){return this.data.isEditable()}getByteLength(){return this.data.getByteLength()}getStringLength(){return this.data.getStringLength()}getMetadata(){return this.metadata}setMetadata(e){s.object(e,"File: bad metadata"),this.metadata=e}edit(e){if(!this.data.isEditable())throw new h.NotEditableError;this.data.edit(e)}getComments(){return this.data.getComments()}getTrackedChanges(){return this.data.getTrackedChanges()}clone(){return h.fromRaw(this.toRaw())}async load(e,t){const n=await this.data.load(e,t);return this.data=n,this}async store(e){const t=await this.data.store(e);return d(this.metadata,t),t}}function d(e,t){o.isEmpty(e)||(t.metadata=o.cloneDeep(e))}r(h,"EMPTY_FILE_HASH","e69de29bb2d1d6434b8b29ae775ad8c2e48c5391"),r(h,"NotEditableError",class NotEditableError extends i{constructor(){super("File is not editable")}}),e.exports=h},6203:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(97277),s=n(12628);class i extends s{constructor(e,t){super(),r.match(e,o.HEX_HASH_RX,"BinaryFileData: bad hash"),r.integer(t,"BinaryFileData: bad byteLength"),r.greaterOrEqual(t,0,"BinaryFileData: low byteLength"),this.hash=e,this.byteLength=t}static fromRaw(e){return new i(e.hash,e.byteLength)}toRaw(){return{hash:this.hash,byteLength:this.byteLength}}getHash(){return this.hash}isEditable(){return!1}getByteLength(){return this.byteLength}async toEager(){return this}async toLazy(){return this}async toHollow(){return s.createHollow(this.byteLength,null)}async store(){return{hash:this.hash}}}e.exports=i},93516:e=>{class t{constructor(){this.type="none"}equals(e){return e instanceof t}toRaw(){return{type:"none"}}}e.exports=t},18452:(e,t,n)=>{const r=n(43921);class o{constructor(e){this.comments=new Map(e.map((e=>[e.id,e])))}[Symbol.iterator](){return this.comments.values()}toArray(){return Array.from(this)}get length(){return this.comments.size}toRaw(){const e=[];for(const t of this.comments.values())e.push(t.toRaw());return e}getComment(e){return this.comments.get(e)}add(e){this.comments.set(e.id,e)}delete(e){return this.comments.delete(e)}static fromRaw(e){return new o(e.map(r.fromRaw))}applyInsert(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{commentIds:[]};t.commentIds||(t.commentIds=[]);for(const[n,r]of this.comments){const o=r.applyInsert(e.pos,e.length,t.commentIds.includes(n));this.comments.set(n,o)}}applyDelete(e){for(const[t,n]of this.comments){const r=n.applyDelete(e);this.comments.set(t,r)}}idsCoveringRange(e){return Array.from(this.comments.entries()).filter((t=>{let[,n]=t;return n.ranges.some((t=>t.contains(e)))})).map((e=>{let[t]=e;return t}))}}e.exports=o},59622:(e,t,n)=>{"use strict";n(66264);const r=n(64347).assert,o=n(97277),s=n(12628);class i extends s{constructor(e,t){super(),r.match(e,o.HEX_HASH_RX,"HashFileData: bad hash"),t&&r.match(t,o.HEX_HASH_RX,"HashFileData: bad ranges hash"),this.hash=e,this.rangesHash=t}static fromRaw(e){return new i(e.hash,e.rangesHash)}toRaw(){const e={hash:this.hash};return this.rangesHash&&(e.rangesHash=this.rangesHash),e}getHash(){return this.hash}getRangesHash(){return this.rangesHash}async toEager(e){const t=await this.toLazy(e);return await t.toEager(e)}async toLazy(e){const[t,n]=await Promise.all([e.getBlob(this.hash),this.rangesHash?e.getBlob(this.rangesHash):Promise.resolve(void 0)]);if(null===n)throw new Error("Failed to look up rangesHash in blobStore");if(!t)throw new Error("blob not found: "+this.hash);return s.createLazyFromBlobs(t,n)}async toHollow(e){const t=await e.getBlob(this.hash);if(!t)throw new Error("Failed to look up hash in blobStore");return s.createHollow(t.getByteLength(),t.getStringLength())}async store(){const e={hash:this.hash};return this.rangesHash&&(e.rangesHash=this.rangesHash),e}}e.exports=i},96837:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(12628);class s extends o{constructor(e){super(),r.integer(e,"HollowBinaryFileData: bad byteLength"),r.greaterOrEqual(e,0,"HollowBinaryFileData: low byteLength"),this.byteLength=e}static fromRaw(e){return new s(e.byteLength)}toRaw(){return{byteLength:this.byteLength}}getByteLength(){return this.byteLength}isEditable(){return!1}async toHollow(){return this}}e.exports=s},44285:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(12628);class s extends o{constructor(e){super(),r.integer(e,"HollowStringFileData: bad stringLength"),r.greaterOrEqual(e,0,"HollowStringFileData: low stringLength"),this.stringLength=e}static fromRaw(e){return new s(e.stringLength)}toRaw(){return{stringLength:this.stringLength}}getStringLength(){return this.stringLength}isEditable(){return!0}async toHollow(){return this}edit(e){this.stringLength=e.applyToLength(this.stringLength)}}e.exports=s},12628:(e,t,n)=>{"use strict";n(66264);const r=n(64347).assert,o=n(97277);e.exports=class{static fromRaw(e){if(Object.prototype.hasOwnProperty.call(e,"hash"))return Object.prototype.hasOwnProperty.call(e,"byteLength")?s.fromRaw(e):Object.prototype.hasOwnProperty.call(e,"stringLength")?l.fromRaw(e):i.fromRaw(e);if(Object.prototype.hasOwnProperty.call(e,"byteLength"))return a.fromRaw(e);if(Object.prototype.hasOwnProperty.call(e,"stringLength"))return c.fromRaw(e);if(Object.prototype.hasOwnProperty.call(e,"content"))return h.fromRaw(e);throw new Error("FileData: bad raw object "+JSON.stringify(e))}static createHollow(e,t){return null==t?new a(e):new c(t)}static createLazyFromBlobs(e,t){return r.instance(e,o,"FileData: bad blob"),null==e.getStringLength()?new s(e.getHash(),e.getByteLength()):new l(e.getHash(),t?.getHash(),e.getStringLength())}toRaw(){throw new Error("FileData: toRaw not implemented")}getHash(){return null}getRangesHash(){return null}getContent(){return null}isEditable(){return null}getByteLength(){return null}getStringLength(){return null}edit(e){throw new Error("edit not implemented for "+JSON.stringify(this))}async toEager(e){throw new Error("toEager not implemented for "+JSON.stringify(this))}async toLazy(e){throw new Error("toLazy not implemented for "+JSON.stringify(this))}async toHollow(e){throw new Error("toHollow not implemented for "+JSON.stringify(this))}async load(e,t){if("eager"===e)return await this.toEager(t);if("lazy"===e)return await this.toLazy(t);if("hollow"===e)return await this.toHollow(t);throw new Error("bad file data load kind: "+e)}async store(e){throw new Error("store not implemented for "+JSON.stringify(this))}getComments(){throw new Error("getComments not implemented for "+JSON.stringify(this))}getTrackedChanges(){throw new Error("getTrackedChanges not implemented for "+JSON.stringify(this))}};const s=n(6203),i=n(59622),a=n(96837),c=n(44285),l=n(82174),h=n(14679)},82174:(e,t,n)=>{"use strict";const r=n(45250),o=n(64347).assert,s=n(97277),i=n(12628),a=n(14679),c=n(91810),l=n(50614);class h extends i{constructor(e,t,n,r){super(),o.match(e,s.HEX_HASH_RX),t&&o.match(t,s.HEX_HASH_RX),o.greaterOrEqual(n,0),o.maybe.array.of.instance(r,c),this.hash=e,this.rangesHash=t,this.stringLength=n,this.operations=r||[]}static fromRaw(e){return new h(e.hash,e.rangesHash,e.stringLength,e.operations&&r.map(e.operations,l.fromJSON))}toRaw(){const e={hash:this.hash,stringLength:this.stringLength};return this.rangesHash&&(e.rangesHash=this.rangesHash),this.operations.length&&(e.operations=r.map(this.operations,(function(e){return e.toJSON()}))),e}getHash(){return this.operations.length?null:this.hash}getRangesHash(){return this.operations.length?null:this.rangesHash}isEditable(){return!0}getByteLength(){return this.stringLength}getStringLength(){return this.stringLength}getOperations(){return this.operations}async toEager(e){const[t,n]=await Promise.all([e.getString(this.hash),this.rangesHash?e.getObject(this.rangesHash):Promise.resolve(void 0)]),o=new a(t,n?.comments,n?.trackedChanges);return function(e,t){r.each(e,(e=>e.apply(t)))}(this.operations,o),o}async toLazy(){return this}async toHollow(){return i.createHollow(null,this.stringLength)}edit(e){this.stringLength=e.applyToLength(this.stringLength),this.operations.push(e)}async store(e){if(0===this.operations.length){const e={hash:this.hash};return this.rangesHash&&(e.rangesHash=this.rangesHash),e}const t=await this.toEager(e);return this.operations.length=0,await t.store(e)}}e.exports=h},14679:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(12628),s=n(18452),i=n(13376);class a extends o{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];super(),r.string(e),this.content=e,this.comments=s.fromRaw(t),this.trackedChanges=i.fromRaw(n)}static fromRaw(e){return new a(e.content,e.comments||[],e.trackedChanges||[])}toRaw(){const e={content:this.content};return this.comments.length&&(e.comments=this.comments.toRaw()),this.trackedChanges.length&&(e.trackedChanges=this.trackedChanges.toRaw()),e}isEditable(){return!0}getContent(){let e="",t=0;if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).filterTrackedDeletes)for(const n of this.trackedChanges.asSorted())"delete"===n.tracking.type&&(t<n.range.start&&(e+=this.content.slice(t,n.range.start)),t=n.range.end);return t<this.content.length&&(e+=this.content.slice(t)),e}getByteLength(){return Buffer.byteLength(this.content)}getStringLength(){return this.content.length}edit(e){e.apply(this)}getComments(){return this.comments}getTrackedChanges(){return this.trackedChanges}async toEager(){return this}async toHollow(){return o.createHollow(this.getByteLength(),this.getStringLength())}async store(e){const t=await e.putString(this.content);if(this.comments.comments.size||this.trackedChanges.length){const n={comments:this.getComments().toRaw(),trackedChanges:this.trackedChanges.toRaw()},r=await e.putObject(n);return{hash:t.getHash(),rangesHash:r.getHash()}}return{hash:t.getHash()}}}e.exports=a},26041:(e,t,n)=>{n(66264);const r=n(2085),o=n(61210);class s{constructor(e,t){this.range=e,this.tracking=t}static fromRaw(e){return new s(r.fromRaw(e.range),o.fromRaw(e.tracking))}toRaw(){return{range:this.range.toRaw(),tracking:this.tracking.toRaw()}}canMerge(e){return e instanceof s&&(this.tracking.type===e.tracking.type&&this.tracking.userId===e.tracking.userId&&this.range.touches(e.range)&&this.range.canMerge(e.range))}merge(e){if(!this.canMerge(e))throw new Error("Cannot merge tracked changes");return new s(this.range.merge(e.range),new o(this.tracking.type,this.tracking.userId,this.tracking.ts.getTime()>e.tracking.ts.getTime()?this.tracking.ts:e.tracking.ts))}}e.exports=s},13376:(e,t,n)=>{n(66264);const r=n(2085),o=n(26041),s=n(61210);class i{constructor(e){this._trackedChanges=e}static fromRaw(e){return new i(e.map(o.fromRaw))}toRaw(){return this._trackedChanges.map((e=>e.toRaw()))}get length(){return this._trackedChanges.length}asSorted(){return Array.from(this._trackedChanges)}inRange(e){return this._trackedChanges.filter((t=>e.contains(t.range)))}propsAtRange(e){return this._trackedChanges.find((t=>t.range.contains(e)))?.tracking}removeInRange(e){this._trackedChanges=this._trackedChanges.filter((t=>!e.contains(t.range)))}add(e){this._trackedChanges.push(e),this._mergeRanges()}_mergeRanges(){if(this._trackedChanges.length<2)return;this._trackedChanges.sort(((e,t)=>e.range.start-t.range.start));const e=[this._trackedChanges[0]];for(let t=1;t<this._trackedChanges.length;t++){const n=e[e.length-1],r=this._trackedChanges[t];if(n.range.overlaps(r.range))throw new Error("Ranges cannot overlap");if(r.range.isEmpty())throw new Error("Tracked changes range cannot be empty");n.canMerge(r)?e[e.length-1]=n.merge(r):e.push(r)}this._trackedChanges=e}applyInsert(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=[];for(const n of this._trackedChanges)if(n.range.startIsAfter(e)||e===n.range.start)s.push(new o(n.range.moveBy(t.length),n.tracking));else if(e===n.range.end)s.push(n);else if(n.range.containsCursor(e)){const[r,,i]=n.range.insertAt(e,t.length),a=new o(r,n.tracking);a.range.isEmpty()||s.push(a);const c=new o(i,n.tracking);c.range.isEmpty()||s.push(c)}else s.push(n);if(n.tracking){const i=new o(new r(e,t.length),n.tracking);s.push(i)}this._trackedChanges=s,this._mergeRanges()}applyDelete(e,t){const n=[];for(const s of this._trackedChanges){const i=new r(e,t);if(!i.contains(s.range))if(i.overlaps(s.range)){const e=s.range.subtract(i);e.isEmpty()||n.push(new o(e,s.tracking))}else s.range.startIsAfter(e)?n.push(new o(s.range.moveBy(-t),s.tracking)):n.push(s)}this._trackedChanges=n,this._mergeRanges()}applyRetain(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!n.tracking)return;const i=[],a=new r(e,t);for(const n of this._trackedChanges)if(a.contains(n.range));else if(a.overlaps(n.range))if(n.range.contains(a)){const[r,s]=n.range.splitAt(e);r.isEmpty()||i.push(new o(r,n.tracking)),!s.isEmpty()&&s.length>t&&i.push(new o(s.moveBy(t).shrinkBy(t),n.tracking))}else if(a.start<=n.range.start){const[,e]=n.range.splitAt(a.end);e.isEmpty()||i.push(new o(e,n.tracking))}else{const[t]=n.range.splitAt(e);t.isEmpty()||i.push(new o(t,n.tracking))}else i.push(n);if(n.tracking instanceof s){const e=new o(a,n.tracking);i.push(e)}this._trackedChanges=i,this._mergeRanges()}}e.exports=i},61210:e=>{class t{constructor(e,t,n){this.type=e,this.userId=t,this.ts=n}static fromRaw(e){return new t(e.type,e.userId,new Date(e.ts))}toRaw(){return{type:this.type,userId:this.userId,ts:this.ts.toISOString()}}equals(e){return e instanceof t&&(this.type===e.type&&this.userId===e.userId&&this.ts.getTime()===e.ts.getTime())}}e.exports=t},62293:(e,t,n)=>{"use strict";function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(66264);const o=n(45250),s=n(64347).assert,i=n(37603),a=n(90953),c=n(79600),l=n(22246);class PathnameError extends i{}class h{constructor(e){this.files=Object.create(null),o.assign(this.files,e),function(e){if(function(e){const t=o.keys(e);return o.uniqWith(t,d).length===t.length}(e))return;throw new h.NonUniquePathnameError(o.keys(e))}(this.files),function(e){const t=e.getPathnames();t.forEach(u);const n=[];for(let e=0;e<t.length;e++)n[e]=t[e]+"/";n.sort();for(let e=0;e<n.length-1;e++)if(n[e+1].startsWith(n[e])){const t=n[e+1].substr(0,-1);throw new h.PathnameConflictError(t)}}(this)}static fromRaw(e){return s.object(e,"bad raw files"),new h(o.mapValues(e,c.fromRaw))}toRaw(){return o.mapValues(this.files,(function(e){return e.toRaw()}))}addFile(e,t){u(e),s.object(t,"bad file"),p(this,e),m(this.files,e,t)}removeFile(e){u(e);const t=g(this.files,e);if(!t)throw new h.FileNotFoundError(e);delete this.files[t]}moveFile(e,t){if(e===t)return;if(""===t)return this.removeFile(e);u(e),u(t),p(this,t,e);const n=g(this.files,e);if(!n)throw new h.FileNotFoundError(e);const r=this.files[n];delete this.files[n],m(this.files,t,r)}countFiles(){return o.size(this.files)}getFile(e){const t=g(this.files,e);if(t)return this.files[t]}wouldConflict(e,t){u(e),s.maybe.string(t);const n=this.getPathnames(),r=e+"/";for(let o=0;o<n.length;o++){if(n[o].startsWith(r)&&!d(n[o],t))return!0;if(e.startsWith(n[o])&&e.length>n[o].length&&"/"===e[n[o].length]&&!d(n[o],t))return!0}return!1}getPathnames(){return o.keys(this.files)}map(e){return o.mapValues(this.files,e)}async mapAsync(e,t){s.maybe.number(t,"bad concurrency");const n=this.getPathnames(),r=await a(n,(t=>e(this.getFile(t),t,n)),{concurrency:t||1});return o.zipObject(n,r)}}function d(e,t){return e===t}function u(e){if(s.nonEmptyString(e,"bad pathname"),!l.isClean(e))throw new h.BadPathnameError(e)}function p(e,t,n){if(e.wouldConflict(t,n))throw new h.PathnameConflictError(t)}function g(e,t){if(t in e)return t}function m(e,t,n){const r=g(e,t);r&&delete e[r],e[t]=n}r(h,"PathnameError",PathnameError),r(h,"NonUniquePathnameError",class NonUniquePathnameError extends PathnameError{constructor(e){super("pathnames are not unique: "+e,{pathnames:e}),this.pathnames=e}}),r(h,"BadPathnameError",class BadPathnameError extends PathnameError{constructor(e){super(e+" is not a valid pathname",{pathname:e}),this.pathname=e}}),r(h,"PathnameConflictError",class PathnameConflictError extends PathnameError{constructor(e){super(`pathname '${e}' conflicts with another file`,{pathname:e}),this.pathname=e}}),r(h,"FileNotFoundError",class FileNotFoundError extends PathnameError{constructor(e){super(`file ${e} does not exist`,{pathname:e}),this.pathname=e}}),e.exports=h},97348:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(90953),s=n(35078),i=n(44838);class a{constructor(e,t){r.instance(e,i,"bad snapshot"),r.maybe.array.of.instance(t,s,"bad changes"),this.snapshot=e,this.changes=t||[]}static fromRaw(e){return new a(i.fromRaw(e.snapshot),e.changes.map(s.fromRaw))}toRaw(){return{snapshot:this.snapshot.toRaw(),changes:this.changes.map((function(e){return e.toRaw()}))}}getSnapshot(){return this.snapshot}getChanges(){return this.changes}countChanges(){return this.changes.length}pushChanges(e){this.changes.push.apply(this.changes,e)}findBlobHashes(e){this.snapshot.findBlobHashes(e),this.changes.forEach((function(t){t.findBlobHashes(e)}))}async loadFiles(e,t){await Promise.all([this.snapshot.loadFiles(e,t),async function(n){for(const r of n)await r.loadFiles(e,t)}(this.changes)])}async store(e,t){r.maybe.number(t,"bad concurrency");const[n,s]=await Promise.all([this.snapshot.store(e,t),o(this.changes,(async function(n){return await n.store(e,t)}),{concurrency:t||1})]);return{snapshot:n,changes:s}}}e.exports=a},91822:(e,t,n)=>{"use strict";const r=n(64347).assert;class o{constructor(e,t,n,o){r.string(e,"bad text"),r.maybe.integer(t,"bad author id"),r.date(n,"bad timestamp"),r.integer(o,"bad version"),this.text=e,this.authorId=t,this.timestamp=n,this.version=o}static fromRaw(e){return new o(e.text,e.authorId,new Date(e.timestamp),e.version)}toRaw(){return{text:this.text,authorId:this.authorId,timestamp:this.timestamp.toISOString(),version:this.version}}getText(){return this.text}getAuthorId(){return this.authorId}getTimestamp(){return this.timestamp}getVersion(){return this.version}}e.exports=o},45461:(e,t,n)=>{n(66264);const r=n(58756),o=n(43921),s=n(2085),i=n(91810);class a extends i{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super();for(const e of t)if(e.isEmpty())throw new Error("AddCommentOperation can't be built with empty ranges");this.commentId=e,this.ranges=t,this.resolved=n}toJSON(){const e={commentId:this.commentId,ranges:this.ranges.map((e=>e.toRaw()))};return this.resolved&&(e.resolved=!0),e}apply(e){e.comments.add(new o(this.commentId,this.ranges,this.resolved))}invert(e){const t=e.comments.getComment(this.commentId);return t?new r.AddCommentOperation(t.id,t.ranges.slice(),t.resolved):new r.DeleteCommentOperation(this.commentId)}canBeComposedWith(e){return e instanceof a&&this.commentId===e.commentId||e instanceof r.DeleteCommentOperation&&this.commentId===e.commentId||e instanceof r.SetCommentStateOperation&&this.commentId===e.commentId}compose(e){if(e instanceof r.DeleteCommentOperation&&e.commentId===this.commentId)return e;if(e instanceof a&&e.commentId===this.commentId)return e;if(e instanceof r.SetCommentStateOperation&&e.commentId===this.commentId)return new a(this.commentId,this.ranges,e.resolved);throw new Error(`Trying to compose AddCommentOperation with ${e?.constructor?.name}.`)}static fromJSON(e){return new a(e.commentId,e.ranges.map(s.fromRaw),e.resolved??!1)}}e.exports=a},87520:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(79600),s=n(8010);class i extends s{constructor(e,t){super(),r.string(e,"bad pathname"),r.object(t,"bad file"),this.pathname=e,this.file=t}getPathname(){return this.pathname}static fromRaw(e){return new i(e.pathname,o.fromRaw(e.file))}toRaw(){return{pathname:this.pathname,file:this.file.toRaw()}}getFile(){return this.file}findBlobHashes(e){const t=this.file.getHash();t&&e.add(t)}async loadFiles(e,t){return await this.file.load(e,t)}async store(e){const t=await this.file.store(e);return{pathname:this.pathname,file:t}}applyTo(e){e.addFile(this.pathname,this.file.clone())}}e.exports=i},98695:(e,t,n)=>{const r=n(58756),o=n(90482),s=n(91810);class i extends s{constructor(e){super(),this.commentId=e}toJSON(){return{deleteComment:this.commentId}}apply(e){e.comments.delete(this.commentId)}invert(e){const t=e.comments.getComment(this.commentId);return t?new r.AddCommentOperation(t.id,t.ranges.slice(),t.resolved):new o}static fromJSON(e){return new i(e.deleteComment)}}e.exports=i},82927:(e,t,n)=>{"use strict";const r=n(8010),o=n(50614);class s extends r{constructor(e,t){super(),this.pathname=e,this.operation=t}toRaw(){return{pathname:this.pathname,...this.operation.toJSON()}}static fromRaw(e){return new s(e.pathname,o.fromJSON(e))}getPathname(){return this.pathname}getOperation(){return this.operation}applyTo(e){e.editFile(this.pathname,this.operation)}canBeComposedWithForUndo(e){return this.canBeComposedWith(e)&&this.operation.canBeComposedWithForUndo(e.operation)}canBeComposedWith(e){return e instanceof s&&(this.getPathname()===e.getPathname()&&this.operation.canBeComposedWith(e.operation))}compose(e){return new s(this.pathname,this.operation.compose(e.operation))}}e.exports=s},90482:(e,t,n)=>{const r=n(91810);class o extends r{apply(e){}toJSON(){return{noOp:!0}}static fromJSON(){return new o}}e.exports=o},91810:(e,t,n)=>{n(66264);class r{constructor(){if(this.constructor===r)throw new Error("Cannot instantiate abstract class")}toJSON(){throw new Error("Abstract method not implemented")}apply(e){throw new Error("Abstract method not implemented")}applyToLength(e){return e}invert(e){throw new Error("Abstract method not implemented")}canBeComposedWith(e){return!1}canBeComposedWithForUndo(e){return!1}compose(e){throw new Error("Abstract method not implemented")}}e.exports=r},50614:(e,t,n)=>{n(66264);const r=n(98695),o=n(45461),s=n(45317),i=n(85544),a=n(90482);e.exports=class{static fromJSON(e){if(function(e){return null!==e&&"object"==typeof e&&"textOperation"in e}(e))return s.fromJSON(e);if(function(e){return null!==e&&"object"==typeof e&&"commentId"in e&&"ranges"in e&&Array.isArray(e.ranges)}(e))return o.fromJSON(e);if(function(e){return null!==e&&"object"==typeof e&&"deleteComment"in e}(e))return r.fromJSON(e);if(function(e){return null!==e&&"object"==typeof e&&"commentId"in e&&"resolved"in e&&"boolean"==typeof e.resolved}(e))return i.fromJSON(e);if(function(e){return null!==e&&"object"==typeof e&&"noOp"in e}(e))return a.fromJSON();throw new Error("Unsupported operation in EditOperationBuilder.fromJSON")}}},65734:(e,t,n)=>{n(66264);const r=n(58756),o=n(43921),s=n(90482),i=n(45317);function a(e,t,n){return(r,o)=>{if(r instanceof e&&o instanceof t)return n(r,o);if(o instanceof e&&r instanceof t){const[e,t]=n(o,r);return[t,e]}return!1}}function c(e,t){return[e,t]}e.exports=class{static transform(e,t){const{AddCommentOperation:n,DeleteCommentOperation:l,SetCommentStateOperation:h}=r;if(e instanceof s||t instanceof s)return[e,t];const d=[a(i,i,i.transform),a(i,l,c),a(i,h,c),a(i,n,((e,t)=>{const r=new o(t.commentId,t.ranges,t.resolved).applyTextOperation(e,t.commentId);return[e,new n(r.id,r.ranges,r.resolved)]})),a(n,n,((e,t)=>e.commentId===t.commentId?[new s,t]:[e,t])),a(n,l,((e,t)=>e.commentId===t.commentId?[new s,t]:[e,t])),a(n,h,((e,t)=>{if(e.commentId===t.commentId){return[new n(e.commentId,e.ranges,t.resolved),t]}return[e,t]})),a(l,l,((e,t)=>e.commentId===t.commentId?[new s,new s]:[e,t])),a(l,h,((e,t)=>e.commentId===t.commentId?[e,new s]:[e,t])),a(h,h,((e,t)=>{if(e.commentId!==t.commentId)return[e,t];if(e.resolved===t.resolved)return[new s,new s];const n=e.resolved&&t.resolved;return e.resolved===n?[e,new s]:[new s,t]}))];for(const n of d){const r=n(e,t);if(r)return r}throw new Error(`Transform not implemented for ${e.constructor.name}￮${t.constructor.name}`)}}},8010:(e,t,n)=>{"use strict";n(66264);const r=n(45250),o=n(64347).assert,s=n(65734);let i=null,a=null,c=null,l=null,h=null;class d{static fromRaw(e){if("file"in e)return a.fromRaw(e);if("textOperation"in e||"commentId"in e||"deleteComment"in e)return l.fromRaw(e);if("newPathname"in e)return new c(e.pathname,e.newPathname);if("metadata"in e)return new h(e.pathname,e.metadata);if(r.isEmpty(e))return new i;throw new Error("invalid raw operation "+JSON.stringify(e))}toRaw(){return{}}isNoOp(){return!1}findBlobHashes(e){}async loadFiles(e,t){}async store(e){return this.toRaw()}applyTo(e){o.object(e,"bad snapshot")}canBeComposedWithForUndo(e){return!1}canBeComposedWith(e){return!1}compose(e){throw new Error("not implemented")}static transform(e,t){if(e.isNoOp()||t.isNoOp())return[e,t];function n(n){return n(t,e).reverse()}const r=t instanceof a,o=t instanceof l,i=t instanceof c,w=t instanceof h;if(e instanceof a){if(r)return function(e,t){if(e.getPathname()===t.getPathname())return[d.NO_OP,t];return[e,t]}(e,t);if(i)return u(e,t);if(o)return p(e,t);if(w)return g(e,t);throw new Error("bad op b")}if(e instanceof c){if(r)return n(u);if(i)return function(e,t){const n=e.getPathname(),r=t.getPathname(),o=e.getNewPathname(),s=t.getNewPathname();if(n===r&&o===s)return[d.NO_OP,d.NO_OP];if(n===o&&r===s)return[d.NO_OP,d.NO_OP];if(n===o)return[d.NO_OP,t];if(r===s)return[e,d.NO_OP];if(n===s&&r===o)return[d.removeFile(n),d.removeFile(r)];if(n===r&&o!==s)return[d.NO_OP,d.moveFile(o,s)];if(o===s&&n!==r)return[d.removeFile(n),t];if(n===s&&o!==r)return[d.moveFile(s,o),d.moveFile(r,o)];if(o===r&&n!==s)return[d.moveFile(n,s),d.moveFile(o,s)];return[e,t]}(e,t);if(o)return m(e,t);if(w)return f(e,t);throw new Error("bad op b")}if(e instanceof l){if(r)return n(p);if(i)return n(m);if(o)return function(e,t){if(e.getPathname()===t.getPathname()){const n=s.transform(e.getOperation(),t.getOperation());return[d.editFile(e.getPathname(),n[0]),d.editFile(t.getPathname(),n[1])]}return[e,t]}(e,t);if(w)return _(e,t);throw new Error("bad op b")}if(e instanceof h){if(r)return n(g);if(i)return n(f);if(o)return n(_);if(w)return function(e,t){if(e.getPathname()===t.getPathname())return[d.NO_OP,t];return[e,t]}(e,t);throw new Error("bad op b")}throw new Error("bad op a")}static transformMultiple(e,t){for(let n=0;n<e.length;++n)for(let r=0;r<t.length;++r){const o=d.transform(e[n],t[r]);e[n]=o[0],t[r]=o[1]}}static addFile(e,t){return new a(e,t)}static editFile(e,t){return new l(e,t)}static moveFile(e,t){return new c(e,t)}static removeFile(e){return new c(e,"")}static setFileMetadata(e,t){return new h(e,t)}}function u(e,t){function n(){return new a(t.getNewPathname(),e.getFile().clone())}return e.getPathname()===t.getPathname()?t.isRemoveFile()?[e,d.NO_OP]:[n(),new c(e.getPathname(),t.getNewPathname())]:e.getPathname()===t.getNewPathname()?[n(),new c(t.getPathname(),"")]:[e,t]}function p(e,t){return e.getPathname()===t.getPathname()?[e,d.NO_OP]:[e,t]}function g(e,t){if(e.getPathname()===t.getPathname()){const n=e.getFile().clone();return n.setMetadata(t.getMetadata()),[new a(e.getPathname(),n),t]}return[e,t]}function m(e,t){return e.getPathname()===t.getPathname()?e.isRemoveFile()?[e,d.NO_OP]:[e,d.editFile(e.getNewPathname(),t.getOperation())]:e.getNewPathname()===t.getPathname()?[e,d.NO_OP]:[e,t]}function f(e,t){return e.getPathname()===t.getPathname()?[e,d.setFileMetadata(e.getNewPathname(),t.getMetadata())]:e.getNewPathname()===t.getPathname()?[e,d.NO_OP]:[e,t]}function _(e,t){return[e,t]}e.exports=d,i=n(27673),a=n(87520),c=n(84140),l=n(82927),h=n(63821),d.NO_OP=new i},84140:(e,t,n)=>{"use strict";const r=n(8010);e.exports=class extends r{constructor(e,t){super(),this.pathname=e,this.newPathname=t}toRaw(){return{pathname:this.pathname,newPathname:this.newPathname}}getPathname(){return this.pathname}getNewPathname(){return this.newPathname}isRemoveFile(){return""===this.getNewPathname()}applyTo(e){e.moveFile(this.getPathname(),this.getNewPathname())}}},27673:(e,t,n)=>{"use strict";const r=n(8010);e.exports=class extends r{isNoOp(){return!0}}},42991:(e,t,n)=>{n(66264);const{containsNonBmpChars:r}=n(2058),{ApplyError:o,InvalidInsertionError:s,UnprocessableError:i}=n(20593),a=n(93516),c=n(61210);class l{constructor(){if(this.constructor===l)throw new Error("Cannot instantiate abstract class")}applyToLength(e){throw new Error("abstract method")}toJSON(){throw new Error("abstract method")}static fromJSON(e){if(p(e))return d.fromJSON(e);if(g(e))return h.fromJSON(e);if(m(e))return u.fromJSON(e);throw new i(`Invalid ScanOp ${JSON.stringify(e)}`)}equals(e){return!1}canMergeWith(e){return!1}mergeWith(e){throw new Error("abstract method")}toString(){}}class h extends l{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(super(),"string"!=typeof e)throw new s("insertion must be a string");if(r(e))throw new s("insertion contains non-BMP characters");this.insertion=e,this.tracking=t,this.commentIds=n}static fromJSON(e){if("string"==typeof e)return new h(e);if("string"!=typeof e.i)throw new s("insert operation must have a string property");return new h(e.i,e.tracking&&c.fromRaw(e.tracking),e.commentIds)}applyToLength(e){return e.length+=this.insertion.length,e}equals(e){if(!(e instanceof h))return!1;if(this.insertion!==e.insertion)return!1;if(this.tracking){if(!this.tracking.equals(e.tracking))return!1}else if(e.tracking)return!1;return this.commentIds?this.commentIds.length===e.commentIds?.length&&this.commentIds.every((t=>e.commentIds?.includes(t))):!e.commentIds}canMergeWith(e){if(!(e instanceof h))return!1;if(this.tracking){if(!this.tracking.equals(e.tracking))return!1}else if(e.tracking)return!1;return this.commentIds?this.commentIds.length===e.commentIds?.length&&this.commentIds.every((t=>e.commentIds?.includes(t))):!e.commentIds}mergeWith(e){if(!this.canMergeWith(e))throw new Error("Cannot merge with incompatible operation");this.insertion+=e.insertion}toJSON(){if(!this.tracking&&!this.commentIds)return this.insertion;const e={i:this.insertion};return this.tracking&&(e.tracking=this.tracking.toRaw()),this.commentIds&&(e.commentIds=this.commentIds),e}toString(){return`insert '${this.insertion}'`}}class d extends l{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(super(),e<0)throw new Error("length must be non-negative");this.length=e,this.tracking=t}applyToLength(e){if(e.inputCursor+this.length>e.inputLength)throw new o("Operation can't retain more chars than are left in the string.",this.toJSON(),e.inputLength);return e.length+=this.length,e.inputCursor+=this.length,e}static fromJSON(e){if("number"==typeof e)return new d(e);if("number"!=typeof e.r)throw new Error("retain operation must have a number property");if(e.tracking){const t="none"===e.tracking.type?new a:c.fromRaw(e.tracking);return new d(e.r,t)}return new d(e.r)}equals(e){return e instanceof d&&(this.length===e.length&&(this.tracking?this.tracking.equals(e.tracking):!e.tracking))}canMergeWith(e){return e instanceof d&&(this.tracking?this.tracking.equals(e.tracking):!e.tracking)}mergeWith(e){if(!this.canMergeWith(e))throw new Error("Cannot merge with incompatible operation");this.length+=e.length}toJSON(){return this.tracking?{r:this.length,tracking:this.tracking.toRaw()}:this.length}toString(){return`retain ${this.length}`}}class u extends l{constructor(e){if(super(),e<0)throw new Error("length must be non-negative");this.length=e}applyToLength(e){return e.inputCursor+=this.length,e}static fromJSON(e){if("number"!=typeof e||e>0)throw new Error("delete operation must be a negative number");return new u(-e)}equals(e){return e instanceof u&&this.length===e.length}canMergeWith(e){return e instanceof u}mergeWith(e){if(!this.canMergeWith(e))throw new Error("Cannot merge with incompatible operation");this.length+=e.length}toJSON(){return-this.length}toString(){return`remove ${this.length}`}}function p(e){return"number"==typeof e&&e>0||"object"==typeof e&&"r"in e&&"number"==typeof e.r&&e.r>0}function g(e){return"string"==typeof e||"object"==typeof e&&"i"in e&&"string"==typeof e.i}function m(e){return"number"==typeof e&&e<0}e.exports={ScanOp:l,InsertOp:h,RetainOp:d,RemoveOp:u,isRetain:p,isInsert:g,isRemove:m}},85544:(e,t,n)=>{n(66264);const r=n(58756),o=n(43921),s=n(90482),i=n(91810);class a extends i{constructor(e,t){super(),this.commentId=e,this.resolved=t}toJSON(){return{resolved:this.resolved,commentId:this.commentId}}apply(e){const t=e.comments.getComment(this.commentId);if(t){const n=new o(t.id,t.ranges,this.resolved);e.comments.add(n)}}invert(e){const t=e.comments.getComment(this.commentId);return t?new a(this.commentId,t.resolved):new s}canBeComposedWith(e){return e instanceof a&&this.commentId===e.commentId||e instanceof r.DeleteCommentOperation&&this.commentId===e.commentId}compose(e){if(e instanceof a&&e.commentId===this.commentId)return e;if(e instanceof r.DeleteCommentOperation&&e.commentId===this.commentId)return e;throw new Error(`Trying to compose SetCommentStateOperation with ${e?.constructor?.name}.`)}static fromJSON(e){return new a(e.commentId,e.resolved)}}e.exports=a},63821:(e,t,n)=>{"use strict";const r=n(45250),o=n(64347).assert,s=n(8010);e.exports=class extends s{constructor(e,t){super(),o.string(e,"SetFileMetadataOperation: bad pathname"),o.object(t,"SetFileMetadataOperation: bad metadata"),this.pathname=e,this.metadata=t}toRaw(){return{pathname:this.pathname,metadata:r.cloneDeep(this.metadata)}}getPathname(){return this.pathname}getMetadata(){return this.metadata}applyTo(e){const t=e.getFile(this.pathname);t&&t.setMetadata(this.metadata)}}},45317:(e,t,n)=>{"use strict";var r;function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(66264),n(13263),n(40761),n(14164),n(745),n(8754),n(48057),n(61653);const s=n(2058).containsNonBmpChars,i=n(91810),{RetainOp:a,InsertOp:c,RemoveOp:l,isRetain:h,isInsert:d,isRemove:u}=n(42991),{UnprocessableError:p,ApplyError:g,InvalidInsertionError:m,TooLongError:f}=n(20593),_=n(2085),w=n(93516),v=n(61210);class b extends i{constructor(){super(),this.ops=[],this.baseLength=0,this.targetLength=0}equals(e){if(this.baseLength!==e.baseLength)return!1;if(this.targetLength!==e.targetLength)return!1;if(this.ops.length!==e.ops.length)return!1;for(let t=0;t<this.ops.length;t++)if(!this.ops[t].equals(e.ops[t]))return!1;return!0}retain(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0===e)return this;if(!h(e))throw new Error("retain expects an integer or a retain object");const n=a.fromJSON(e);if(n.tracking=t.tracking,0===n.length)return this;this.baseLength+=n.length,this.targetLength+=n.length;const r=this.ops[this.ops.length-1];return r?.canMergeWith(n)?r.mergeWith(n):this.ops.push(n),this}insert(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!d(e))throw new Error("insert expects a string or an insert object");const n=c.fromJSON(e);if(n.tracking=t.tracking,n.commentIds=t.commentIds,""===n.insertion)return this;this.targetLength+=n.insertion.length;const r=this.ops,o=this.ops[this.ops.length-1];if(o?.canMergeWith(n))o.mergeWith(n);else if(o instanceof l){const e=r[r.length-2];e?.canMergeWith(n)?e.mergeWith(n):(r[r.length]=r[r.length-1],r[r.length-2]=n)}else r.push(n);return this}remove(e){if("string"==typeof e&&(e=e.length),"number"!=typeof e)throw new Error("remove expects an integer or a string");if(0===e)return this;e>0&&(e=-e);const t=l.fromJSON(e);this.baseLength-=e;const n=this.ops[this.ops.length-1];return n?.canMergeWith(t)?n.mergeWith(t):this.ops.push(t),this}isNoop(){return 0===this.ops.length||1===this.ops.length&&this.ops[0]instanceof a}toString(){return this.ops.map((e=>e.toString())).join(", ")}toJSON(){return{textOperation:this.ops.map((e=>e.toJSON()))}}apply(e){const t=e.getContent(),n=this;if(s(t))throw new b.ApplyError("The string contains non BMP characters.",n,t);if(t.length!==n.baseLength)throw new b.ApplyError("The operation's base length must be equal to the string's length.",n,t);const r=this.ops;let o=0,i="";for(const n of r)if(n instanceof a){if(o+n.length>t.length)throw new g("Operation can't retain more chars than are left in the string.",n.toJSON(),t);e.trackedChanges.applyRetain(i.length,n.length,{tracking:n.tracking}),i+=t.slice(o,o+n.length),o+=n.length}else if(n instanceof c){if(s(n.insertion))throw new m(t,n.toJSON());e.trackedChanges.applyInsert(i.length,n.insertion,{tracking:n.tracking}),e.comments.applyInsert(new _(i.length,n.insertion.length),{commentIds:n.commentIds}),i+=n.insertion}else{if(!(n instanceof l))throw new p("Unknown ScanOp type during apply");e.trackedChanges.applyDelete(i.length,n.length),e.comments.applyDelete(new _(i.length,n.length)),o+=n.length}if(o!==t.length)throw new b.ApplyError("The operation didn't operate on the whole string.",n,t);if(i.length>b.MAX_STRING_LENGTH)throw new b.TooLongError(n,i.length);e.content=i}applyToLength(e){const t=this;if(e!==t.baseLength)throw new b.ApplyError("The operation's base length must be equal to the string's length.",t,e);const{length:n,inputCursor:r}=this.ops.reduce(((e,t)=>t.applyToLength(e)),{length:0,inputCursor:0,inputLength:e});if(r!==e)throw new b.ApplyError("The operation didn't operate on the whole string.",t,e);if(n>b.MAX_STRING_LENGTH)throw new b.TooLongError(t,n);return n}invert(e){const t=e.getContent();let n=0;const r=new b,o=this.ops;for(let s=0,i=o.length;s<i;s++){const i=o[s];if(i instanceof a){const t=n+i.length,o=e.trackedChanges.inRange(new _(n,i.length));let s;i.tracking&&(s=new w);for(const e of o)if(n<e.range.start&&(r.retain(e.range.start-n,{tracking:s}),n=e.range.start),e.range.end<n+i.length&&(r.retain(e.range.length,{tracking:e.tracking}),n=e.range.end),e.range.end!==n){const[t]=e.range.splitAt(n);r.retain(t.length,{tracking:e.tracking}),n=t.end}n<t&&(r.retain(t-n,{tracking:s}),n=t)}else if(i instanceof c)r.remove(i.insertion.length);else{if(!(i instanceof l))throw new p("unknown scanop during inversion");{const o=k(n,i.length,e.comments,e.trackedChanges);for(const e of o)r.insert(t.slice(n,n+e.length),{tracking:e.tracking,commentIds:e.commentIds}),n+=e.length}}}return r}canBeComposedWithForUndo(e){if(!(e instanceof b))return!1;if(this.isNoop()||e.isNoop())return!0;const t=x(this),n=x(e),r=y(this),o=y(e);return!(!r||!o)&&(r instanceof c&&o instanceof c?t+r.insertion.length===n:r instanceof l&&o instanceof l&&(n+o.length===t||t===n))}canBeComposedWith(e){return e instanceof b&&this.targetLength===e.baseLength}compose(e){if(!(e instanceof b))throw new Error(`Trying to compose TextOperation with ${e?.constructor?.name}.`);if(this.targetLength!==e.baseLength)throw new Error("The base length of the second operation has to be the target length of the first operation");const t=new b,n=this.ops,r=e.ops;let o=0,s=0,i=n[o++],h=r[s++];for(;void 0!==i||void 0!==h;)if(i instanceof l)t.remove(-i.length),i=n[o++];else if(h instanceof c)t.insert(h.insertion,{tracking:h.tracking,commentIds:h.commentIds}),h=r[s++];else{if(void 0===i)throw new Error("Cannot compose operations: first operation is too short.");if(void 0===h)throw new Error("Cannot compose operations: first operation is too long.");if(i instanceof a&&h instanceof a){const e=h.tracking??i.tracking;i.length>h.length?(t.retain(h.length,{tracking:e}),i=new a(i.length-h.length,i.tracking),h=r[s++]):i.length===h.length?(t.retain(i.length,{tracking:e}),i=n[o++],h=r[s++]):(t.retain(i.length,{tracking:e}),h=new a(h.length-i.length,h.tracking),i=n[o++])}else if(i instanceof c&&h instanceof l)i.insertion.length>h.length?(i=new c(i.insertion.slice(h.length),i.tracking,i.commentIds),h=r[s++]):i.insertion.length===h.length?(i=n[o++],h=r[s++]):(h=l.fromJSON(i.insertion.length-h.length),i=n[o++]);else if(i instanceof c&&h instanceof a){const e={commentIds:i.commentIds};h.tracking instanceof v?e.tracking=h.tracking:h.tracking instanceof w||(e.tracking=i.tracking),i.insertion.length>h.length?(t.insert(i.insertion.slice(0,h.length),e),i=new c(i.insertion.slice(h.length),i.tracking,i.commentIds),h=r[s++]):i.insertion.length===h.length?(t.insert(i.insertion,e),i=n[o++],h=r[s++]):(t.insert(i.insertion,e),h=new a(h.length-i.insertion.length,h.tracking),i=n[o++])}else{if(!(i instanceof a&&h instanceof l))throw new Error("This shouldn't happen: op1: "+JSON.stringify(i)+", op2: "+JSON.stringify(h));i.length>h.length?(t.remove(-h.length),i=new a(i.length-h.length,i.tracking),h=r[s++]):i.length===h.length?(t.remove(-h.length),i=n[o++],h=r[s++]):(t.remove(i.length),h=l.fromJSON(i.length-h.length),i=n[o++])}}return t}static transform(e,t){if(e.baseLength!==t.baseLength)throw new Error("Both operations have to have the same base length");const n=new b,r=new b,o=e.ops,s=t.ops;let i=0,h=0,d=o[i++],u=s[h++];for(;void 0!==d||void 0!==u;){if(d instanceof c){n.insert(d.insertion,{tracking:d.tracking,commentIds:d.commentIds}),r.retain(d.insertion.length),d=o[i++];continue}if(u instanceof c){n.retain(u.insertion.length),r.insert(u.insertion,{tracking:u.tracking,commentIds:u.commentIds}),u=s[h++];continue}if(void 0===d)throw new Error("Cannot compose operations: first operation is too short.");if(void 0===u)throw new Error("Cannot compose operations: first operation is too long.");let e;if(d instanceof a&&u instanceof a){let t,c;d.tracking?t=d.tracking:c=u.tracking,d.length>u.length?(e=u.length,d=new a(d.length-u.length,d.tracking),u=s[h++]):d.length===u.length?(e=u.length,d=o[i++],u=s[h++]):(e=d.length,u=new a(u.length-d.length,u.tracking),d=o[i++]),n.retain(e,{tracking:t}),r.retain(e,{tracking:c})}else if(d instanceof l&&u instanceof l)d.length>u.length?(d=l.fromJSON(u.length-d.length),u=s[h++]):d.length===u.length?(d=o[i++],u=s[h++]):(u=l.fromJSON(d.length-u.length),d=o[i++]);else if(d instanceof l&&u instanceof a)d.length>u.length?(e=u.length,d=l.fromJSON(u.length-d.length),u=s[h++]):d.length===u.length?(e=u.length,d=o[i++],u=s[h++]):(e=d.length,u=new a(u.length-d.length,u.tracking),d=o[i++]),n.remove(e);else{if(!(d instanceof a&&u instanceof l))throw new Error("The two operations aren't compatible");d.length>u.length?(e=u.length,d=new a(d.length-u.length,d.tracking),u=s[h++]):d.length===u.length?(e=d.length,d=o[i++],u=s[h++]):(e=d.length,u=l.fromJSON(d.length-u.length),d=o[i++]),r.remove(e)}}return[n,r]}}function y(e){const t=e.ops;switch(t.length){case 1:return t[0];case 2:return t[0]instanceof a?t[1]:t[1]instanceof a?t[0]:null;case 3:if(t[0]instanceof a&&t[2]instanceof a)return t[1]}return null}function x(e){return e.ops[0]instanceof a?e.ops[0].length:0}function k(e,t,n,r){const o=new Set,s=e,i=e+t;function a(e){e<s||e>i||o.add(e)}for(const e of n.comments.values())for(const t of e.ranges)a(t.end),a(t.start);for(const e of r.asSorted())a(e.range.start),a(e.range.end);a(s),a(i);const c=Array.from(o).sort(((e,t)=>e-t)),l=[];for(let e=1;e<c.length;e++){const t=c[e-1],o=c[e],s=new _(t,o-t),i=n.idsCoveringRange(s),a=r.propsAtRange(s);l.push({length:s.length,commentIds:i.length>0?i:void 0,tracking:a})}return l}r=b,o(b,"MAX_STRING_LENGTH",2*Math.pow(1024,2)),o(b,"UnprocessableError",p),o(b,"ApplyError",g),o(b,"InvalidInsertionError",m),o(b,"TooLongError",f),o(b,"fromJSON",(function(e){let{textOperation:t}=e;const n=new r;for(const e of t)if(h(e)){const t=a.fromJSON(e);n.retain(t.length,{tracking:t.tracking})}else if(d(e)){const t=c.fromJSON(e);n.insert(t.insertion,{commentIds:t.commentIds,tracking:t.tracking})}else{if(!u(e))throw new p("unknown operation: "+JSON.stringify(e));{const t=l.fromJSON(e);n.remove(-t.length)}}return n})),e.exports=b},64331:(e,t,n)=>{"use strict";const r=n(64347).assert;let o=null,s=null,i=null;class a{constructor(e){r.string(e,"Origin: bad kind"),this.kind=e}static fromRaw(e){return e?e.kind===o.KIND?o.fromRaw(e):e.kind===s.KIND?s.fromRaw(e):e.kind===i.KIND?i.fromRaw(e):new a(e.kind):null}toRaw(){return{kind:this.kind}}getKind(){return this.kind}}e.exports=a,o=n(41546),s=n(33755),i=n(49008)},33755:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(64331);class s extends o{constructor(e,t,n){r.integer(e,"RestoreFileOrigin: bad version"),r.string(t,"RestoreFileOrigin: bad path"),r.date(n,"RestoreFileOrigin: bad timestamp"),super(s.KIND),this.version=e,this.path=t,this.timestamp=n}static fromRaw(e){return new s(e.version,e.path,new Date(e.timestamp))}toRaw(){return{kind:s.KIND,version:this.version,path:this.path,timestamp:this.timestamp.toISOString()}}getVersion(){return this.version}getPath(){return this.path}getTimestamp(){return this.timestamp}}s.KIND="file-restore",e.exports=s},41546:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(64331);class s extends o{constructor(e,t){r.integer(e,"RestoreOrigin: bad version"),r.date(t,"RestoreOrigin: bad timestamp"),super(s.KIND),this.version=e,this.timestamp=t}static fromRaw(e){return new s(e.version,new Date(e.timestamp))}toRaw(){return{kind:s.KIND,version:this.version,timestamp:this.timestamp.toISOString()}}getVersion(){return this.version}getTimestamp(){return this.timestamp}}s.KIND="restore",e.exports=s},49008:(e,t,n)=>{"use strict";const r=n(64347).assert,o=n(64331);class s extends o{constructor(e,t){r.integer(e,"RestoreProjectOrigin: bad version"),r.date(t,"RestoreProjectOrigin: bad timestamp"),super(s.KIND),this.version=e,this.timestamp=t}static fromRaw(e){return new s(e.version,new Date(e.timestamp))}toRaw(){return{kind:s.KIND,version:this.version,timestamp:this.timestamp.toISOString()}}getVersion(){return this.version}getTimestamp(){return this.timestamp}}s.KIND="project-restore",e.exports=s},23531:(e,t,n)=>{"use strict";n(66264);const r=n(45250),o=n(11485),s=n(10048),i=n(33101),a=n(8010);e.exports=class{constructor(e,t,n,c){let l=null,h=0;const d=[];let u=null,p=[],g=[];const m=[];function f(){const e=new s(l,p);c.emit("change",e.toRaw()),h=3}function _(){if(null!==u&&l===u)return l+=1,u=null,function(){if(0===p.length)throw new Error("ack complete without outstanding change");if(3!==h)throw new Error("ack complete in state "+h);t.handleChangeAcknowledged(),function(){for(const e in m)Object.prototype.hasOwnProperty.call(m,e)&&(e>l||(m[e].forEach((function(e){e()})),delete m[e]))}(),g.length>0?(p=g,g=[],f()):(p=[],h=2)}(),void _();const e=r.remove(d,(function(e){return e.getBaseVersion()===l}));if(1===e.length)return function(e){if(g.length>0&&0===p.length)throw new Error("pending change without outstanding change");a.transformMultiple(p,e.getOperations()),a.transformMultiple(g,e.getOperations()),t.applyRemoteChange(e)}(e[0].getChange()),l+=1,void _();if(0!==e.length)throw new Error("multiple remote changes in client version "+l)}this.connect=function(){if(0!==h)throw new Error("connect in state "+h);h=1,c.emit("authenticate",{projectId:e,token:"letmein"})},this.getVersion=function(){return l},c.on("load",(function(e){switch(h){case 1:{const n=i.fromRaw(e),r=n.getSnapshot();r.applyAll(n.getChanges(),{strict:!0}),l=n.getEndVersion(),t.load(r).then((function(){h=2}));break}default:throw new Error("loaded in state "+h)}})),this.handleLocalOperation=function(e){switch(h){case 2:!function(e){p.push(e),f()}(e);break;case 3:!function(e){g.push(e)}(e);break;default:throw new Error("local operation in state "+h)}},this.waitForVersion=function(e){return m[e]||(m[e]=[]),new Promise((function(t,n){m[e].push(t)}))},c.on("ack",(function(e){switch(h){case 3:{const t=o.fromRaw(e);u=t.getBaseVersion(),_();break}default:throw new Error("ack in state "+h)}})),c.on("change",(function(e){switch(h){case 2:case 3:!function(e){const t=e.getBaseVersion();if(r.find(d,"baseVersion",t))throw new Error("multiple changes in version "+t);if(t===u)throw new Error("received change that was acked in "+u);d.push(e)}(o.fromRaw(e)),_();break;default:throw new Error("remote change in state "+h)}})),c.on("disconnect",(function(){h=0,console.log("disconnected")}))}}},2085:(e,t,n)=>{n(66264);const r=n(37603);class o{constructor(e,t){if(e<0||t<0)throw new r("Invalid range",{pos:e,length:t});this.pos=e,this.length=t}get start(){return this.pos}get end(){return this.pos+this.length}equals(e){return this.pos===e.pos&&this.length===e.length}startsAfter(e){return this.start>=e.end}startIsAfter(e){return this.start>e}isEmpty(){return 0===this.length}contains(e){return this.start<=e.start&&this.end>=e.end}containsCursor(e){return this.start<=e&&this.end>=e}overlaps(e){return this.start<e.end&&this.end>e.start}touches(e){return this.end===e.start||this.start===e.end}subtract(e){if(this.contains(e))return this.shrinkBy(e.length);if(e.contains(this))return new o(this.pos,0);if(e.overlaps(this)){if(e.start<this.start){const t=e.end-this.start;return new o(e.pos,this.length-t)}{const t=this.end-e.start;return new o(this.pos,this.length-t)}}return new o(this.pos,this.length)}canMerge(e){return this.overlaps(e)||this.touches(e)}merge(e){if(!this.canMerge(e))throw new Error("Ranges cannot be merged");const t=Math.min(this.pos,e.pos),n=Math.max(this.end,e.end);return new o(t,n-t)}moveBy(e){return new o(this.pos+e,this.length)}extendBy(e){return new o(this.pos,this.length+e)}shrinkBy(e){const t=this.length-e;if(t<0)throw new Error("Cannot shrink range by more than its length");return new o(this.pos,t)}insertAt(e,t){if(!this.containsCursor(e))throw new Error("The cursor must be contained in the range");const n=new o(this.pos,e-this.pos);return[n,new o(e,t),new o(e+t,this.length-n.length)]}toRaw(){return{pos:this.pos,length:this.length}}static fromRaw(e){return new o(e.pos,e.length)}splitAt(e){if(!this.containsCursor(e))throw new Error("The cursor must be contained in the range");const t=new o(this.pos,e-this.pos);return[t,new o(e,this.length-t.length)]}}e.exports=o},22246:(e,t,n)=>{"use strict";n(98304);const r=n(99942),o=/[/*\u0000-\u001F\u007F\u0080-\u009F\uD800-\uDFFF]/g,s=/(^\.$)|(^\.\.$)|(^\s+)|(\s+$)/g,i=/^(prototype|constructor|toString|toLocaleString|valueOf|hasOwnProperty|isPrototypeOf|propertyIsEnumerable|__defineGetter__|__lookupGetter__|__defineSetter__|__lookupSetter__|__proto__)$/;function a(e){return e=(e=e.replace(o,"_")).replace(s,(function(e){return new Array(e.length+1).join("_")}))}t.clean=function(e){return 0===(e=(e=(e=(e=(e=(e=(e=r.normalize(e)).replace(/\\/g,"/")).replace(/\/+/g,"/")).replace(/^(\/.*)$/,"_$1")).replace(/^(.+)\/$/,"$1")).replace(/^ *(.*)$/,"$1")).replace(/^(.*[^ ]) *$/,"$1")).length&&(e="_"),e=(e=e.split("/").map(a).join("/")).replace(i,"@$1")},t.isClean=function(e){return t.clean(e)===e&&e.length<=1024&&e.length>0}},44838:(e,t,n)=>{"use strict";var r;function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(66264);const s=n(64347).assert,i=n(37603),a=n(62293),c=n(65591);class l{static fromRaw(e){return s.object(e.files,"bad raw.files"),new l(a.fromRaw(e.files),e.projectVersion,c.fromRaw(e.v2DocVersions))}toRaw(){const e={files:this.fileMap.toRaw()};return this.projectVersion&&(e.projectVersion=this.projectVersion),this.v2DocVersions&&(e.v2DocVersions=this.v2DocVersions.toRaw()),e}constructor(e,t,n){s.maybe.instance(e,a,"bad fileMap"),this.fileMap=e||new a({}),this.projectVersion=t,this.v2DocVersions=n}getProjectVersion(){return this.projectVersion}setProjectVersion(e){s.maybe.match(e,l.PROJECT_VERSION_RX,"Snapshot: bad projectVersion"),this.projectVersion=e}getV2DocVersions(){return this.v2DocVersions}setV2DocVersions(e){s.maybe.instance(e,c,"Snapshot: bad v2DocVersions"),this.v2DocVersions=e}updateV2DocVersions(e){e.applyTo(this)}getFileMap(){return this.fileMap}getFilePathnames(){return this.fileMap.getPathnames()}getFile(e){return this.fileMap.getFile(e)}addFile(e,t){this.fileMap.addFile(e,t)}moveFile(e,t){this.fileMap.moveFile(e,t),this.v2DocVersions&&this.v2DocVersions.moveFile(e,t)}countFiles(){return this.fileMap.countFiles()}editFile(e,t){const n=this.fileMap.getFile(e);if(!n)throw new l.EditMissingFileError(`can't find file for editing: ${e}`);n.edit(t)}applyAll(e,t){for(const n of e)n.applyTo(this,t)}findBlobHashes(e){this.fileMap.map((function(t){const n=t.getHash(),r=t.getRangesHash();n&&e.add(n),r&&e.add(r)}))}async loadFiles(e,t){return await this.fileMap.mapAsync((function(n){return n.load(e,t)}),50)}async store(e,t){s.maybe.number(t,"bad concurrency");const n=this.projectVersion,r=this.v2DocVersions?this.v2DocVersions.toRaw():void 0;return{files:await this.fileMap.mapAsync((function(t){return t.store(e)}),t),projectVersion:n,v2DocVersions:r}}clone(){return l.fromRaw(this.toRaw())}}r=l,o(l,"PROJECT_VERSION_RX_STRING","^[0-9]+\\.[0-9]+$"),o(l,"PROJECT_VERSION_RX",new RegExp(r.PROJECT_VERSION_RX_STRING)),o(l,"EditMissingFileError",class EditMissingFileError extends i{}),e.exports=l},2058:(e,t)=>{"use strict";t.containsNonBmpChars=function(e){return/[\uD800-\uDBFF]/.test(e)}},65591:(e,t,n)=>{"use strict";const r=n(45250);class o{constructor(e){this.data=e||{}}static fromRaw(e){if(e)return new o(e)}toRaw(){if(!this.data)return null;return r.clone(this.data)}clone(){return o.fromRaw(this.toRaw())}applyTo(e){r.size(this.data)&&(e.v2DocVersions?r.assign(e.v2DocVersions.data,this.data):e.v2DocVersions=this.clone())}moveFile(e,t){for(const[n,r]of Object.entries(this.data))if(r.pathname===e){""===t?delete this.data[n]:r.pathname=t;break}}}e.exports=o},73208:(e,t,n)=>{n(66264),n(13263),n(40761),n(14164),n(745),n(8754),n(48057),n(61653);class r{constructor(e,t){null==e&&(e=[]),this.changes=e,null==t&&(t=[]),this.comments=t,this.track_changes=!1,this.id_seed=r.generateIdSeed(),this.id_increment=0,this._dirtyState={comment:{moved:{},removed:{},added:{}},change:{moved:{},removed:{},added:{}}}}getIdSeed(){return this.id_seed}setIdSeed(e){this.id_seed=e,this.id_increment=0}static generateIdSeed(){const e=Math.floor(32767*Math.random()).toString(16),t=Math.floor(16777216*Math.random()).toString(16),n=Math.floor((new Date).valueOf()/1e3).toString(16);return"00000000".substr(0,8-n.length)+n+"000000".substr(0,6-t.length)+t+"0000".substr(0,4-e.length)+e}static generateId(){return this.generateIdSeed()+"000001"}newId(){this.id_increment++;const e=this.id_increment.toString(16);return this.id_seed+"000000".substr(0,6-e.length)+e}getComment(e){let t=null;for(const n of this.comments)if(n.id===e){t=n;break}return t}removeCommentId(e){const t=this.getComment(e);null!=t&&(this.comments=this.comments.filter((t=>t.id!==e)),this._markAsDirty(t,"comment","removed"))}moveCommentId(e,t,n){for(const r of this.comments)r.id===e&&(r.op.p=t,r.op.c=n,this._markAsDirty(r,"comment","moved"))}getChange(e){let t=null;for(const n of this.changes)if(n.id===e){t=n;break}return t}getChanges(e){const t=new Set(e);return this.changes.filter((e=>t.has(e.id)))}removeChangeId(e){const t=this.getChange(e);null!=t&&this._removeChange(t)}removeChangeIds(e){if(null==e||0===e.length)return;const t=new Set(e),n=[];for(const e of this.changes)t.has(e.id)?this._markAsDirty(e,"change","removed"):n.push(e);this.changes=n}validate(e){let t;for(const n of this.changes)if(null!=n.op.i&&(t=e.slice(n.op.p,n.op.p+n.op.i.length),t!==n.op.i))throw new Error("insertion does not match text in document");for(const n of this.comments)if(t=e.slice(n.op.p,n.op.p+n.op.c.length),t!==n.op.c)throw new Error("comment does not match text in document")}applyOp(e,t){if(null==t&&(t={}),null==t.ts&&(t.ts=new Date),null!=e.i)this.applyInsertToChanges(e,t),this.applyInsertToComments(e);else if(null!=e.d)this.applyDeleteToChanges(e,t),this.applyDeleteToComments(e);else{if(null==e.c)throw new Error("unknown op type");this.addComment(e,t)}}applyOps(e,t){null==t&&(t={});for(const n of e)this.applyOp(n,t)}addComment(e,t){if(null!=this.getComment(e.t))this.moveCommentId(e.t,e.p,e.c);else{let n;this.comments.push(n={id:e.t||this.newId(),op:{c:e.c,p:e.p,t:e.t},metadata:t}),this._markAsDirty(n,"comment","added")}}applyInsertToComments(e){for(const t of this.comments)if(e.p<=t.op.p)t.op.p+=e.i.length,this._markAsDirty(t,"comment","moved");else if(e.p<t.op.p+t.op.c.length){const n=e.p-t.op.p;t.op.c=t.op.c.slice(0,+(n-1)+1||void 0)+e.i+t.op.c.slice(n),this._markAsDirty(t,"comment","moved")}}applyDeleteToComments(e){const t=e.p,n=e.d.length,r=e.p+n;for(const o of this.comments){const s=o.op.p,i=o.op.p+o.op.c.length,a=i-s;if(r<=s)o.op.p-=n,this._markAsDirty(o,"comment","moved");else if(t>=i);else{let n,c;c=t<=s?"":o.op.c.slice(0,t-s),n=r>=i?"":o.op.c.slice(r-s);const l=o.op.c.slice(c.length,a-n.length),h=Math.max(0,s-t);if(l!==e.d.slice(h).slice(0,l.length))throw new Error("deleted content does not match comment content");o.op.p=Math.min(s,t),o.op.c=c+n,this._markAsDirty(o,"comment","moved")}}}applyInsertToChanges(e,t){let n;const r=e.p,o=e.i.length,s=e.p+o,i=!!e.u;let a=!1,c=null;const l=[],h=[],d=[];for(let u=0;u<this.changes.length;u++){n=this.changes[u];const p=n.op.p;if(null!=n.op.d)r<p?(n.op.p+=o,l.push(n)):r===p&&(i&&n.op.d.length>=e.i.length&&n.op.d.slice(0,e.i.length)===e.i?(n.op.d=n.op.d.slice(e.i.length),n.op.p+=e.i.length,""===n.op.d?h.push(n):l.push(n),a=!0):(n.op.p+=o,l.push(n)));else if(null!=n.op.i){let h;const g=p+n.op.i.length,m=r>=p&&r<=g,f=t.user_id===n.metadata.user_id,_=this.changes[u+1],w=null!=_&&null!=_.op.d&&e.p===g&&_.op.p===e.p,v=i&&w&&_.op.d.slice(0,e.i.length)===e.i,b=null!=c&&null!=c.op.d&&c.op.p===s;if(this.track_changes&&m&&!b&&!a&&!v&&f)h=r-p,n.op.i=n.op.i.slice(0,h)+e.i+n.op.i.slice(h),n.metadata.ts=t.ts,a=!0,l.push(n);else if(r<=p)n.op.p+=o,l.push(n);else if((!f||!this.track_changes)&&p<r&&r<g){h=r-p;const e=n.op.i.slice(0,h),t=n.op.i.slice(h);n.op.i=e,l.push(n);const s={op:{i:t,p:p+h+o},metadata:{}};for(const e in n.metadata){const t=n.metadata[e];s.metadata[e]=t}d.push(s)}}c=n}for({op:e,metadata:t}of(this.track_changes&&!a&&this._addOp(e,t),d))this._addOp(e,t);for(n of h)this._removeChange(n);for(n of l)this._markAsDirty(n,"change","moved")}applyDeleteToChanges(e,t){const n=e.p,r=e.d.length,o=e.p+r,s=[];let i=[];const a=[];for(const t of this.changes){let c;if(null!=t.op.i){c=t.op.p;const l=c+t.op.i.length;if(o<=c)t.op.p-=r,i.push(t);else if(n>=l);else{let r,h,d,u;n>=c?(h="",u=t.op.i.slice(0,n-c)):(h=e.d.slice(0,c-n),u=""),o<=l?(r="",d=t.op.i.slice(o-c)):(r=e.d.slice(l-n),d="");const p=u+d;p.length>0?(t.op.i=p,t.op.p=Math.min(c,n),i.push(t)):s.push(t);const g=e.d.length-h.length-r.length,m=h.length,f={d:e.d.slice(m,m+g),p:m};f.d.length>0&&a.push(f)}}else if(null!=t.op.d)if(c=t.op.p,o<c||!this.track_changes&&o===c)t.op.p-=r,i.push(t);else if(n<=c&&c<=o)if(this.track_changes){const e=c-n;a.push({i:t.op.d,p:e}),s.push(t)}else t.op.p=n,i.push(t)}e={p:e.p,d:this._applyOpModifications(e.d,a)};for(const n of s)e.d.length>0&&null!=n.op.d&&e.p<=n.op.p&&n.op.p<=e.p+e.d.length?(n.op.p=e.p,n.op.d=e.d,n.metadata=t,i.push(n),e.d=""):this._removeChange(n);if(this.track_changes&&e.d.length>0)this._addOp(e,t);else{const e=this._scanAndMergeAdjacentUpdates();i=i.concat(e.movedChanges);for(const t of e.removeChanges)this._removeChange(t),i=i.filter((e=>e!==t))}for(const e of i)this._markAsDirty(e,"change","moved")}_addOp(e,t){const n={id:this.newId(),op:this._clone(e),metadata:this._clone(t)};this.changes.push(n),this.changes.sort((function(e,t){const n=e.op.p-t.op.p;return 0!==n?n:null!=e.op.i&&null!=t.op.d?1:null!=e.op.d&&null!=t.op.i?-1:0})),this._markAsDirty(n,"change","added")}_removeChange(e){this.changes=this.changes.filter((t=>t.id!==e.id)),this._markAsDirty(e,"change","removed")}_applyOpModifications(e,t){t.sort((function(e,t){const n=t.p-e.p;return 0!==n?n:null!=e.i&&null!=t.d?1:null!=e.d&&null!=t.i?-1:0}));for(const n of t)if(null!=n.i)e=e.slice(0,n.p)+n.i+e.slice(n.p);else if(null!=n.d){if(e.slice(n.p,n.p+n.d.length)!==n.d)throw new Error("deletion does not match text in document");e=e.slice(0,n.p)+e.slice(n.p+n.d.length)}return e}_scanAndMergeAdjacentUpdates(){let e=null;const t=[],n=[];for(const r of this.changes)if(null!=e?.op.i&&null!=r.op.i){const o=e.op.p+e.op.i.length,s=e.metadata.user_id,i=r.op.p,a=r.metadata.user_id;o===i&&s===a&&(t.push(r),e.op.i+=r.op.i,n.push(e))}else null!=e?.op.d&&null!=r.op.d&&e?.op.p===r.op.p?(e.op.d+=r.op.d,t.push(r),n.push(e)):e=r;return{movedChanges:n,removeChanges:t}}resetDirtyState(){this._dirtyState={comment:{moved:{},removed:{},added:{}},change:{moved:{},removed:{},added:{}}}}getDirtyState(){return this._dirtyState}getTrackedDeletesLength(){let e=0;for(const t of this.changes)null!=t.op.d&&(e+=t.op.d.length);return e}_markAsDirty(e,t,n){this._dirtyState[t][n][e.id]=e}_clone(e){const t={};for(const n in e){const r=e[n];t[n]=r}return t}}e.exports=r},99806:(e,t,n)=>{"use strict";n.d(t,{k_:()=>x,vd:()=>k});n(16280),n(48408),n(14603),n(47566),n(98721);var r=n(14041),o=n(33829),s=n(85960),i=n(66666),a=n(37858);n(13609);const c=3e5;function l(e,t,n){if(n.includes(t.id))return{messages:e,uniqueMessageIds:n};(n=n.slice(0)).push(t.id);const r=e[e.length-1];return{messages:e=r&&t&&t.user&&t.user.id&&t.user.id===r.user.id&&t.timestamp-r.timestamp<c?e.slice(0,e.length-1).concat({...r,id:t.id,timestamp:t.timestamp,contents:r.contents.concat(t.content)}):e.slice(0).concat({id:t.id,user:t.user,timestamp:t.timestamp,contents:[t.content]}),uniqueMessageIds:n}}function h(e,t,n){const r=e.slice(0);return n=n.slice(0),t.slice(0).reverse().forEach((e=>{if(n.includes(e.id))return;n.push(e.id);const t=r[0];t&&e&&e.user&&e.user.id===t.user.id&&t.timestamp-e.timestamp<c?(t.id=e.id,t.timestamp=e.timestamp,t.contents=[e.content].concat(t.contents)):r.unshift({id:e.id,user:e.user,timestamp:e.timestamp,contents:[e.content]})})),{messages:r,uniqueMessageIds:n}}var d=n(30741),u=n(56447),p=n(67353),g=n(64932),m=n(60961),f=n(31085);const _=()=>(0,o.A)();let w=1;function v(e,t){switch(t.type){case"INITIAL_FETCH_MESSAGES":return{...e,status:"pending",initialMessagesLoaded:!0};case"FETCH_MESSAGES":return{...e,status:"pending"};case"FETCH_MESSAGES_SUCCESS":return{...e,status:"idle",...h(e.messages,t.messages,e.uniqueMessageIds),lastTimestamp:t.messages[0]?t.messages[0].timestamp:null,atEnd:t.messages.length<50};case"SEND_MESSAGE":return{...e,...l(e.messages,{id:""+w++,user:t.user,content:t.content,timestamp:Date.now()},e.uniqueMessageIds)};case"RECEIVE_MESSAGE":return{...e,...l(e.messages,t.message,e.uniqueMessageIds),unreadMessageCount:e.unreadMessageCount+1};case"MARK_MESSAGES_AS_READ":return{...e,unreadMessageCount:0};case"CLEAR":return{...b};case"ERROR":return{...e,status:"error",error:t.error};default:throw new Error("Unknown action")}}const b={status:"idle",messages:[],initialMessagesLoaded:!1,lastTimestamp:null,atEnd:!1,unreadMessageCount:0,error:null,uniqueMessageIds:[]},y=(0,r.createContext)(void 0),x=e=>{let{children:t}=e;const n=(0,g.A)("ol-chatEnabled"),o=(0,r.useRef)();void 0===o.current&&(o.current=_());const c=(0,s.ur)(),{_id:l}=(0,i.O)(),{chatIsOpen:h}=(0,u.LV)(),{hasFocus:w,flashTitle:x,stopFlashingTitle:k}=(0,d.A)(),[E,T]=(0,r.useReducer)(v,b),{loadInitialMessages:j,loadMoreMessages:C,reset:I}=(0,r.useMemo)((()=>{function e(){if(E.atEnd)return;const e={limit:String(50)};E.lastTimestamp&&(e.before=String(E.lastTimestamp));const t=new URLSearchParams(e),n=`/project/${l}/messages?${t.toString()}`;(0,a.hm)(n).then((function(){T({type:"FETCH_MESSAGES_SUCCESS",messages:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reverse()})})).catch((e=>{T({type:"ERROR",error:e})}))}return{loadInitialMessages:function(){n?E.initialMessagesLoaded||(T({type:"INITIAL_FETCH_MESSAGES"}),e()):m.$.warn("chat is disabled, won't load initial messages")},loadMoreMessages:function(){n?(T({type:"FETCH_MESSAGES"}),e()):m.$.warn("chat is disabled, won't load messages")},reset:function(){n?(T({type:"CLEAR"}),e()):m.$.warn("chat is disabled, won't reset chat")}}}),[n,l,E.atEnd,E.initialMessagesLoaded,E.lastTimestamp]),S=(0,r.useCallback)((e=>{if(!n)return void m.$.warn("chat is disabled, won't send message");if(!e)return;T({type:"SEND_MESSAGE",user:c,content:e});const t=`/project/${l}/messages`;(0,a.TB)(t,{body:{content:e,client_id:o.current}}).catch((e=>{T({type:"ERROR",error:e})}))}),[n,l,c]),L=(0,r.useCallback)((()=>{n?T({type:"MARK_MESSAGES_AS_READ"}):m.$.warn("chat is disabled, won't mark messages as read")}),[n]),{socket:A}=(0,p.nK)();(0,r.useEffect)((()=>{if(n&&A)return A.on("new-chat-message",e),()=>{A&&A.removeListener("new-chat-message",e)};function e(e){e.clientId!==o.current&&T({type:"RECEIVE_MESSAGE",message:e})}}),[n,A]),(0,r.useEffect)((()=>{w&&(k(),h&&L()),!w&&E.unreadMessageCount>0&&x("New Message")}),[w,h,E.unreadMessageCount,x,k,L]);const O=(0,r.useMemo)((()=>({status:E.status,messages:E.messages,initialMessagesLoaded:E.initialMessagesLoaded,atEnd:E.atEnd,unreadMessageCount:E.unreadMessageCount,loadInitialMessages:j,loadMoreMessages:C,reset:I,sendMessage:S,markMessagesAsRead:L,error:E.error})),[j,C,L,I,S,E.atEnd,E.error,E.initialMessagesLoaded,E.messages,E.status,E.unreadMessageCount]);return(0,f.jsx)(y.Provider,{value:O,children:t})};function k(){const e=(0,r.useContext)(y);if(!e)throw new Error("useChatContext is only available inside ChatProvider");return e}},41416:(e,t,n)=>{"use strict";n.d(t,{Gn:()=>b,l$:()=>y});n(16280);var r=n(14041),o=n(14936),s=n(10646),i=n(14901),a=n(66666);function c(){const[e,t]=(0,o.A)("project"),{_id:n}=(0,a.O)();return async(r,o)=>{if(e){if(e[r]!==o){await(0,i.Y)(n,{[r]:o});const s="rootDocId"===r?"rootDoc_id":r;t({...e,[s]:o})}}}}var l=n(60961);function h(){const[e]=(0,o.A)("project"),t=c(),n=(0,r.useCallback)((e=>{t("compiler",e).catch(l.$.error)}),[t]),a=(0,r.useCallback)((e=>{t("imageName",e).catch(l.$.error)}),[t]),{setRootDocId:h,rootDocId:d}=function(){const[e]=(0,o.A)("project.rootDoc_id"),{permissionsLevel:t}=(0,s.mi)(),n=c(),i=(0,r.useCallback)((async r=>{if(void 0!==e&&"readOnly"!==t)try{await n("rootDocId",r)}catch(e){}}),[t,e,n]);return{rootDocId:e,setRootDocId:i}}(),u=function(){const[e,t]=(0,o.A)("project.spellCheckLanguage"),n=c();return(0,r.useCallback)((r=>{null!=e&&r!==e&&(t(r),n("spellCheckLanguage",r),(0,i.u)("spellCheckLanguage",r))}),[t,e,n])}();return{compiler:e?.compiler,setCompiler:n,imageName:e?.imageName,setImageName:a,rootDocId:d,setRootDocId:h,spellCheckLanguage:e?.spellCheckLanguage,setSpellCheckLanguage:u}}var d=n(66020),u=n(45250),p=n.n(u),g=n(64932),m=n(10009);function f(){const e=function(){const{userSettings:e,setUserSettings:t}=(0,d.dk)();return(n,r)=>{e[n]!==r&&(t({...e,[n]:r}),(0,i.u)(n,r))}}(),{userSettings:t}=(0,d.dk)(),{overallTheme:n,autoComplete:s,autoPairDelimiters:a,syntaxValidation:c,editorTheme:l,mode:h,fontSize:u,fontFamily:f,lineHeight:_,pdfViewer:w,mathPreview:v}=t,b=function(){const[e,t]=(0,r.useState)(null),[n,s]=(0,o.A)("ui.loadingStyleSheet"),{userSettings:a,setUserSettings:c}=(0,d.dk)(),{overallTheme:l}=a,h=(0,r.useCallback)((e=>{c((t=>({...t,overallTheme:e})))}),[c]),u=(0,m.yU)();return(0,r.useEffect)((()=>{const e="light-"===l?"light":"default";document.body.dataset.theme=e}),[l]),(0,r.useEffect)((()=>{if(u)return;const t=document.querySelector("head"),r=document.getElementById("main-stylesheet"),o=document.createElement("link");o.setAttribute("rel","stylesheet"),o.setAttribute("id","main-stylesheet"),o.setAttribute("href",e?.path??"");const i=()=>{s(!1),t&&r&&t.removeChild(r)};return n&&(o.addEventListener("load",i,{once:!0}),t?.appendChild(o)),()=>{o.removeEventListener("load",i)}}),[n,s,u,e?.path]),(0,r.useCallback)((e=>{if(l!==e){const n=p().find((0,g.A)("ol-overallThemes"),(t=>t.val===e));n&&(u||s(!0),t(n),h(e),(0,i.u)("overallTheme",e))}}),[l,s,u,h])}(),y=(0,r.useCallback)((t=>{e("autoComplete",t)}),[e]),x=(0,r.useCallback)((t=>{e("autoPairDelimiters",t)}),[e]),k=(0,r.useCallback)((t=>{e("syntaxValidation",t)}),[e]),E=(0,r.useCallback)((t=>{e("editorTheme",t)}),[e]),T=(0,r.useCallback)((t=>{e("mode",t)}),[e]),j=(0,r.useCallback)((t=>{e("fontSize",t)}),[e]),C=(0,r.useCallback)((t=>{e("fontFamily",t)}),[e]),I=(0,r.useCallback)((t=>{e("lineHeight",t)}),[e]),S=(0,r.useCallback)((t=>{e("pdfViewer",t)}),[e]),L=(0,r.useCallback)((t=>{e("mathPreview",t)}),[e]);return{autoComplete:s,setAutoComplete:y,autoPairDelimiters:a,setAutoPairDelimiters:x,syntaxValidation:c,setSyntaxValidation:k,editorTheme:l,setEditorTheme:E,overallTheme:n,setOverallTheme:b,mode:h,setMode:T,fontSize:u,setFontSize:j,fontFamily:f,setFontFamily:C,lineHeight:_,setLineHeight:I,pdfViewer:w,setPdfViewer:S,mathPreview:v,setMathPreview:L}}var _=n(67353);var w=n(31085);const v=(0,r.createContext)(void 0),b=e=>{let{children:t}=e;const{compiler:n,setCompiler:s,imageName:i,setImageName:a,rootDocId:c,setRootDocId:l,spellCheckLanguage:d,setSpellCheckLanguage:u}=h(),{autoComplete:p,setAutoComplete:g,autoPairDelimiters:m,setAutoPairDelimiters:b,syntaxValidation:y,setSyntaxValidation:x,editorTheme:k,setEditorTheme:E,overallTheme:T,setOverallTheme:j,mode:C,setMode:I,fontSize:S,setFontSize:L,fontFamily:A,setFontFamily:O,lineHeight:R,setLineHeight:M,pdfViewer:F,setPdfViewer:P,mathPreview:D,setMathPreview:N}=f();!function(){const e=(0,_.nK)(),[t,n]=(0,o.A)("project"),s=(0,r.useCallback)((e=>{t&&n({...t,compiler:e})}),[t,n]),i=(0,r.useCallback)((e=>{t&&n({...t,imageName:e})}),[t,n]),a=(0,r.useCallback)((e=>{t&&n({...t,spellCheckLanguage:e})}),[t,n]);(0,r.useEffect)((()=>{if(t&&e?.socket)return e.socket.on("compilerUpdated",s),e.socket.on("imageNameUpdated",i),e.socket.on("spellCheckLanguageUpdated",a),()=>{e.socket.removeListener("compilerUpdated",s),e.socket.removeListener("imageNameUpdated",i),e.socket.removeListener("spellCheckLanguageUpdated",a)}}),[e?.socket,t,s,i,a])}();const X=(0,r.useMemo)((()=>({compiler:n,setCompiler:s,imageName:i,setImageName:a,rootDocId:c,setRootDocId:l,spellCheckLanguage:d,setSpellCheckLanguage:u,autoComplete:p,setAutoComplete:g,autoPairDelimiters:m,setAutoPairDelimiters:b,syntaxValidation:y,setSyntaxValidation:x,editorTheme:k,setEditorTheme:E,overallTheme:T,setOverallTheme:j,mode:C,setMode:I,fontSize:S,setFontSize:L,fontFamily:A,setFontFamily:O,lineHeight:R,setLineHeight:M,pdfViewer:F,setPdfViewer:P,mathPreview:D,setMathPreview:N})),[n,s,i,a,c,l,d,u,p,g,m,b,y,x,k,E,T,j,C,I,S,L,A,O,R,M,F,P,D,N]);return(0,w.jsx)(v.Provider,{value:X,children:t})};function y(){const e=(0,r.useContext)(v);if(!e)throw new Error("useProjectSettingsContext is only available inside ProjectSettingsProvider");return e}},14901:(e,t,n)=>{"use strict";n.d(t,{Y:()=>a,u:()=>i});var r=n(5964),o=n(37858),s=n(60961);function i(e,t){(0,r._)("setting-changed",{changedSetting:e,changedSettingVal:t}),(0,o.TB)("/user/settings",{body:{[e]:t}}).catch(s.$.error)}const a=async(e,t)=>{await(0,o.TB)(`/project/${e}/settings`,{body:{...t}})}},89997:(e,t,n)=>{"use strict";n.d(t,{m8:()=>d,rL:()=>h});n(16280);var r=n(14041),o=n(71573),s=n(64932),i=n(35287),a=n(65982),c=n(31085);const l=(0,r.createContext)(void 0),h=e=>{let{children:t}=e;const{fileTreeData:n}=(0,o.Q)(),{fileTreeFromHistory:h}=(0,a.P4)(),d=(0,s.A)("ol-project_id"),u=(0,r.useCallback)((e=>(0,i.$X)(n,e)),[n]),p=(0,r.useCallback)((e=>(0,i.Xk)(n,e)),[n]),g=(0,r.useCallback)((e=>(0,i.bJ)(n,d,e,h)),[n,d,h]),m=(0,r.useCallback)((e=>(0,i.pD)(n,e)),[n]),f=(0,r.useMemo)((()=>({pathInFolder:u,findEntityByPath:p,previewByPath:g,dirname:m})),[u,p,g,m]);return(0,c.jsx)(l.Provider,{value:f,children:t})};function d(){const e=(0,r.useContext)(l);if(!e)throw new Error("useFileTreePathContext is only available inside FileTreePathProvider");return e}},79550:(e,t,n)=>{"use strict";n.d(t,{b_:()=>c,jr:()=>i,k3:()=>s,lE:()=>l});n(43375),n(39225),n(13972),n(99209),n(25714),n(17561),n(66197);var r=n(37603),o=n.n(r);function s(e,t){const n=l(e,t);if(n)return n;throw new(o())("Entity not found in tree",{entityId:t})}function i(e,t){const n=new Set;return t.forEach((t=>{n.add(s(e,t))})),n}function a(e){const t=new Set([e._id]);for(const n in e.folders){a(e.folders[n]).forEach((e=>{t.add(e)}))}return t}function c(e){const t=new Set;return e.forEach((e=>{a(e).forEach((e=>{t.add(e)}))})),t}function l(e,t,n){n||(n=[e._id]);for(const r in e.docs){const o=e.docs[r];if(o._id===t)return{entity:o,type:"doc",parent:e.docs,parentFolderId:e._id,path:n,index:r}}for(const r in e.fileRefs){const o=e.fileRefs[r];if(o._id===t)return{entity:o,type:"fileRef",parent:e.fileRefs,parentFolderId:e._id,path:n,index:r}}for(const r in e.folders){const o=e.folders[r];if(o._id===t)return{entity:o,type:"folder",parent:e.folders,parentFolderId:e._id,path:n,index:r};const s=l(o,t,n.concat(o._id));if(s)return s}return null}},35287:(e,t,n)=>{"use strict";function r(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const o=e.docs.find((e=>e._id===t))||e.fileRefs.find((e=>e._id===t));if(o)return n.concat([o]);for(const o of e.folders){if(o._id===t)return n.concat([o]);{const e=r(o,t,n.concat([o]));if(null!==e)return e}}return null}function o(e,t){return r(e,t)?.map((e=>e.name)).join("/")||null}function s(e,t){if(""===t)return{entity:e,type:"folder"};const n=t.split("/"),r=n.shift(),o=n.join("/");if("."===r)return s(e,o);const i=e.docs.find((e=>e.name===r));if(i)return{entity:i,type:"doc"};const a=e.fileRefs.find((e=>e.name===r));if(a)return{entity:a,type:"fileRef"};for(const t of e.folders)if(t.name===r)return""===o?{entity:t,type:"folder"}:s(t,o);return null}function i(e,t,n,r){for(const o of["",".png",".jpg",".jpeg",".pdf",".PNG",".JPG",".JPEG",".PDF"]){const i=s(e,n+o);if("fileRef"===i?.type){const{name:e,_id:n,hash:o}=i.entity;return{url:r?`/project/${t}/blob/${o}`:`/project/${t}/file/${n}`,extension:e.slice(e.lastIndexOf(".")+1)}}}return null}function a(e,t){const n=o(e,t);return n?.split("/").slice(0,-1).join("/")||null}n.d(t,{$X:()=>o,Xk:()=>s,bJ:()=>i,pD:()=>a})},3218:(e,t,n)=>{"use strict";function r(e){if(!e)return 0;const t=Math.ceil((e-performance.now())/1e3);return t>0?t:0}n.d(t,{C:()=>r})},12391:(e,t,n)=>{"use strict";n.d(t,{Sg:()=>k,FX:()=>E});n(16280);var r=n(14041),o=(n(3296),n(27208),n(48408),n(14603),n(47566),n(98721),n(60961));class s{static connect(e,t){return new s}constructor(e){this._socket=e}}const i=["connect","disconnect","emit","on","removeListener"];for(const e of i)s.prototype[e]=function(){this._socket[e].apply(this._socket,arguments)};class a extends s{static connect(){return new a}constructor(e){super(e),this.socket={get connected(){return!1},get sessionid(){},get transport(){return{}},connect(){},disconnect(e){}}}connect(){}disconnect(e){}emit(){}on(){}removeListener(){}}class c extends s{static connect(e,t){return new c(io.connect(e,t))}constructor(e){super(e),this.socket=this._socket.socket}}class l extends s{static connect(e,t){return t.forceNew=t["force new connection"],t.path="/"+t.resource,t.reconnection=t.reconnect,t.timeout=t["connect timeout"],new l(e,t)}static get EVENT_MAP(){const e=["connect_error","connect_timeout","error"];return new Map([["connect_failed",e],["error",e]])}_on(e,t){this._events.has(e)?this._events.get(e).push(t):this._events.set(e,[t]),this._socket.on(e,t)}on(e,t){if(l.EVENT_MAP.has(e))for(const n of l.EVENT_MAP.get(e))this._on(n,t);else this._on(e,t)}_removeListener(e,t){if(this._events.has(e)){const n=this._events.get(e),r=n.indexOf(t);-1!==r&&n.splice(r,1)}this._socket.removeListener(e,t)}removeListener(e,t){if(l.EVENT_MAP.has(e))for(const n of l.EVENT_MAP.get(e))this._removeListener(n,t);else this._removeListener(e,t)}static createNewSocket(e,t){return io.Manager(e,t).socket("/",t)}_replaceSocketWithNewInstance(){const e=this._socket,t=l.createNewSocket(this._url,this._options);this._events.forEach(((n,r)=>{for(const o of n)e.removeListener(r,o),t.on(r,o)})),e.connected&&e.disconnect(),this._socket=t}connect(){this._replaceSocketWithNewInstance()}constructor(e,t){super(l.createNewSocket(e,t)),this._url=e,this._options=t,this._events=new Map;const n=this;function r(){return n._socket.io&&n._socket.io.engine||{}}this.socket={get connected(){return n._socket.connected},get sessionid(){return n._socket.id?n._socket.id:r().id},get transport(){return r().transport},connect(){n._replaceSocketWithNewInstance()},disconnect:e=>n._socket.disconnect(e)}}}let h;"undefined"!=typeof io&&io?"string"==typeof io.version&&"0"===io.version.slice(0,1)?(o.$.log("[socket.io] Shim: detected v0"),h=c):(o.$.log("[socket.io] Shim: detected v2"),h=l):(o.$.log("[socket.io] Shim: socket.io is not loaded, returning noop"),h=a);const d={SocketShimNoop:a,SocketShimV0:c,SocketShimV2:l,current:h,connect:h.connect,stub:()=>new a};var u=n(64932);function p(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const g=36e5,m=864e5,f={readyState:WebSocket.CLOSED,forceDisconnected:!1,inactiveDisconnect:!1,lastConnectionAttempt:0,reconnectAt:null,forcedDisconnectDelay:0,error:""};class _ extends CustomEvent{}class w extends EventTarget{constructor(){super(),p(this,"state",f),p(this,"connectionAttempt",null),p(this,"gracefullyReconnectUntil",0),p(this,"protocolVersion",-1),p(this,"reconnectCountdownInterval",0),p(this,"userIsLeavingPage",!1),this.lastUserActivity=performance.now(),this.idleDisconnectInterval=window.setInterval((()=>{this.disconnectIfIdleSince(m)}),g),window.addEventListener("online",(()=>this.onOnline())),window.addEventListener("beforeunload",(()=>{this.userIsLeavingPage=!0}));const e=new URL((0,u.A)("ol-wsUrl")||"/socket.io",window.origin),t=d.connect(e.origin,{resource:e.pathname.slice(1),"auto connect":!1,"connect timeout":3e4,"force new connection":!0,query:new URLSearchParams({projectId:(0,u.A)("ol-project_id")}).toString(),reconnect:!1});if(this.socket=t,"object"!=typeof window.io)return this.switchToWsFallbackIfPossible(),o.$.error("Socket.io javascript not loaded. Please check that the real-time service is running and accessible."),void this.changeState({...this.state,error:"io-not-loaded"});t.on("disconnect",(()=>this.onDisconnect())),t.on("error",(()=>this.onConnectError())),t.on("connect_failed",(()=>this.onConnectError())),t.on("joinProjectResponse",(e=>this.onJoinProjectResponse(e))),t.on("connectionRejected",(e=>this.onConnectionRejected(e))),t.on("reconnectGracefully",(()=>this.onReconnectGracefully())),t.on("forceDisconnect",((e,t)=>this.onForceDisconnect(t))),this.tryReconnect()}close(e){this.onForceDisconnect(0,e)}tryReconnectNow(){this.tryReconnectWithBackoff(1e3)}registerUserActivity(){this.lastUserActivity=performance.now(),this.userIsLeavingPage=!1,this.ensureIsConnected()}changeState(e){const t=this.state;this.state=e,o.$.log("[ConnectionManager] changed state",{previousState:t,state:e}),this.dispatchEvent(new _("statechange",{detail:{state:e,previousState:t}}))}switchToWsFallbackIfPossible(){const e=new URLSearchParams(window.location.search);return!(!(0,u.A)("ol-wsUrl")||"fallback"===e.get("ws"))&&(e.set("ws","fallback"),window.location.search=e.toString(),!0)}onOnline(){this.state.inactiveDisconnect||this.ensureIsConnected()}onConnectionRejected(e){switch(e?.message){case"retry":this.startAutoReconnectCountdown(0);break;case"rate-limit hit when joining project":this.changeState({...this.state,error:"rate-limited"});break;case"not authorized":case"invalid session":this.changeState({...this.state,error:"not-logged-in",forceDisconnected:!0});break;case"project not found":this.changeState({...this.state,error:"project-deleted",forceDisconnected:!0});break;default:this.changeState({...this.state,error:"unable-to-join"})}}onConnectError(){null!==this.connectionAttempt&&(this.connectionAttempt++<5?setTimeout((()=>{this.canReconnect()&&this.socket.socket.connect()}),this.connectionAttempt*(1+Math.random())*1e3):this.switchToWsFallbackIfPossible()||(this.disconnect(),this.changeState({...this.state,error:"unable-to-connect"})))}onDisconnect(){this.connectionAttempt=null,this.changeState({...this.state,readyState:WebSocket.CLOSED}),this.disconnectIfIdleSince(m)||("rate-limited"===this.state.error?this.tryReconnectWithBackoff(15e3):this.startAutoReconnectCountdown(0))}onForceDisconnect(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"maintenance";clearInterval(this.idleDisconnectInterval),clearTimeout(this.reconnectCountdownInterval),window.removeEventListener("online",this.onOnline),window.setTimeout((()=>this.disconnect()),1e3*e),this.changeState({...this.state,forceDisconnected:!0,forcedDisconnectDelay:e,error:t})}onJoinProjectResponse(e){let{protocolVersion:t,publicId:n}=e;-1===this.protocolVersion||this.protocolVersion===t?(this.protocolVersion=t,this.socket.publicId=n,this.connectionAttempt=null,this.changeState({...this.state,readyState:WebSocket.OPEN,error:"",reconnectAt:null})):this.onForceDisconnect(0,"protocol-changed")}onReconnectGracefully(){this.disconnectIfIdleSince(648e5)||this.gracefullyReconnectUntil||(this.gracefullyReconnectUntil=performance.now()+45e3,this.tryReconnectGracefully())}canReconnect(){return this.state.readyState!==WebSocket.OPEN&&!this.state.forceDisconnected}isReconnectingSoon(e){return!!this.state.reconnectAt&&this.state.reconnectAt-performance.now()<=e}hasReconnectedRecently(e){return performance.now()-this.state.lastConnectionAttempt<e}isUserInactiveSince(e){return performance.now()-this.lastUserActivity>e}disconnectIfIdleSince(e){if(!this.isUserInactiveSince(e))return!1;const t=this.state.readyState===WebSocket.CLOSED;return this.changeState({...this.state,readyState:WebSocket.CLOSED,inactiveDisconnect:!0}),t||this.socket.disconnect(),!0}disconnect(){this.changeState({...this.state,readyState:WebSocket.CLOSED}),this.socket.disconnect()}ensureIsConnected(){this.state.readyState!==WebSocket.OPEN&&this.tryReconnectWithBackoff("rate-limited"===this.state.error?15e3:5e3)}startAutoReconnectCountdown(e){if(this.userIsLeavingPage)return;if(!this.canReconnect())return;let t;t=this.isUserInactiveSince(12e4)?60+Math.floor(2*Math.random()*60):3+Math.floor(7*Math.random());const n=e+1e3*t;this.isReconnectingSoon(n)||(this.changeState({...this.state,reconnectAt:performance.now()+n}),clearTimeout(this.reconnectCountdownInterval),this.reconnectCountdownInterval=window.setTimeout((()=>{this.isReconnectingSoon(0)&&this.tryReconnect()}),n))}tryReconnect(){this.gracefullyReconnectUntil=0,this.changeState({...this.state,reconnectAt:null}),this.canReconnect()&&(this.connectionAttempt=0,this.changeState({...this.state,readyState:WebSocket.CONNECTING,error:"",inactiveDisconnect:!1,lastConnectionAttempt:performance.now()}),this.addReconnectListeners(),this.socket.socket.connect())}addReconnectListeners(){const e=()=>{n(),this.startAutoReconnectCountdown(0)},t=()=>{n()},n=()=>{this.socket.removeListener("error",e),this.socket.removeListener("connect",t)};this.socket.on("error",e),this.socket.on("connect",t)}tryReconnectGracefully(){this.state.readyState!==WebSocket.CLOSED&&this.gracefullyReconnectUntil&&(this.gracefullyReconnectUntil<performance.now()||this.isUserInactiveSince(5e3)?(this.disconnect(),this.tryReconnect()):setTimeout((()=>{this.tryReconnectGracefully()}),5e3))}tryReconnectWithBackoff(e){this.hasReconnectedRecently(e)?this.startAutoReconnectCountdown(e):this.tryReconnect()}}var v=n(3218),b=n(89753),y=n(31085);const x=(0,r.createContext)(void 0),k=e=>{let{children:t}=e;const n=(0,b.z)(),[o]=(0,r.useState)((()=>new w)),[s,i]=(0,r.useState)(o.state);(0,r.useEffect)((()=>{const e=e=>{i(e.detail.state)};return o.addEventListener("statechange",e),()=>{o.removeEventListener("statechange",e)}}),[o]);const a=s.readyState===WebSocket.OPEN,c=s.readyState===WebSocket.CONNECTING&&performance.now()-s.lastConnectionAttempt>1e3,l=(0,r.useCallback)((()=>(0,v.C)(s.reconnectAt)),[s.reconnectAt]),h=(0,r.useCallback)((()=>o.tryReconnectNow()),[o]),d=(0,r.useCallback)((()=>o.registerUserActivity()),[o]),u=(0,r.useCallback)((()=>{o.disconnect()}),[o]);(0,r.useEffect)((()=>{if(s.forceDisconnected){const e=window.setTimeout((()=>n.reload()),1e3*s.forcedDisconnectDelay);return()=>{window.clearTimeout(e)}}}),[s.forceDisconnected,s.forcedDisconnectDelay,n]);const p=(0,r.useMemo)((()=>({socket:o.socket,connectionState:s,isConnected:a,isStillReconnecting:c,secondsUntilReconnect:l,tryReconnectNow:h,registerUserActivity:d,disconnect:u})),[o.socket,s,a,c,d,l,h,u]);return(0,y.jsx)(x.Provider,{value:p,children:t})};function E(){const e=(0,r.useContext)(x);if(!e)throw new Error("useConnectionContext is only available inside ConnectionProvider");return e}},77135:(e,t,n)=>{"use strict";n.d(t,{al:()=>U,TS:()=>V});n(16280);var r=n(14041),o=n(5964),s=n(14936),i=n(67353),a=n(73208),c=n.n(a);class l{constructor(){this.events={}}on(e,t){let n;this.events||(this.events={}),[e,n]=Array.from(e.split(".")),this.events[e]||(this.events[e]=[]),this.events[e].push({callback:t,namespace:n})}off(e,t){if(this.events||(this.events={}),e){let n;[e,n]=e.split("."),this.events[e]||(this.events[e]=[]),t?this.events[e]=this.events[e].filter((e=>e.callback!==t)):n?this.events[e]=this.events[e].filter((e=>e.namespace!==n)):delete this.events[e]}else this.events={}}trigger(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.events||(this.events={}),this.events[e]&&this.events[e].forEach((e=>e.callback(...n)))}emit(){this.trigger(...arguments)}}var h=n(18860),d=n(60961);function u(e){return decodeURIComponent(escape(e))}function p(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const g="ShareJsDoc";class m{constructor(e){p(this,"lastReport",null),p(this,"queue",[]),this.onTimeoutHandler=e}getMetaPreferLocal(){for(const e of this.queue)if(e.scope===g)return e;return this.queue.pop()}onTimeout(e){this.queue.push(e),setTimeout((()=>{if(!this.queue.length)return;const e=this.getMetaPreferLocal();this.queue.length=0;const t=Date.now();null!==this.lastReport&&t-this.lastReport<6e4||(this.lastReport=t,this.onTimeoutHandler(e))}))}}class f{constructor(e){let{parent:t,onTimeoutHandler:n}=e;if(p(this,"lastAck",null),this.scope=t?g:"global",this.timeout=6e4,this.parent=t,t)this.reporter=t.reporter;else{if(!n)throw new Error("No parent or onTimeoutHandler");this.reporter=new m(n)}this.lastAck=null,this.lastUnackedEdit=null}onAck(){this.lastAck=performance.now(),this.parent&&this.parent.onAck()}onEdit(){const e=performance.now();this.lastAck>this.lastUnackedEdit&&(this.lastUnackedEdit=null),this.lastUnackedEdit||(this.lastUnackedEdit=e);const t=e-this.lastUnackedEdit;if(t>this.timeout){const n=Date.now()-e,r={scope:this.scope,delay:t,lastAck:this.lastAck?n+this.lastAck:0,lastUnackedEdit:n+this.lastUnackedEdit};this.log("timedOut",r),this.reporter.onTimeout(r)}}attachToEditor(e){this.log("attach to editor");const t=(e,t)=>{"remote"!==t.origin&&(t.removed||t.inserted)&&this.onEdit()};return e.on("change",t),()=>{this.log("detach from editor"),e.off("change",t)}}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];d.$.log(`[EditorWatchdogManager] ${this.scope}:`,...t)}}var _=n(64932);function w(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class v extends l{constructor(e,t,n,r,o,s,i){var a;super(),a=this,w(this,"track_changes",!1),w(this,"track_changes_id_seeds",null),w(this,"lastAcked",null),w(this,"queuedMessageTimer",null),w(this,"queuedMessages",[]),w(this,"detachEditorWatchdogManager",null),w(this,"_timeoutTimer",null),this.doc_id=e,this.socket=r,this.globalEditorWatchdogManager=o,this.eventEmitter=s,this.eventLog=i,this.type="text";const c=t.map((e=>u(e))).join("\n");this.connection={send:e=>(this.startInflightOpTimeout(e),this.track_changes&&this.track_changes_id_seeds&&(null==e.meta&&(e.meta={}),e.meta.tc=this.track_changes_id_seeds.inflight),this.socket.emit("applyOtUpdate",this.doc_id,e,(e=>{null!=e&&this.handleError(e)}))),state:"ok",id:this.socket.publicId},this._doc=new h.J(this.connection,this.doc_id,{type:this.type}),this._doc.setFlushDelay(2e3),this._doc.on("change",(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.trigger("change",...t)})),this.editorWatchdogManager=new f({parent:o}),this._doc.on("acknowledge",(()=>(this.lastAcked=new Date,this.editorWatchdogManager.onAck(),this.trigger("acknowledge")))),this._doc.on("remoteop",(function(){a._doc.setFlushDelay(500);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.trigger("remoteop",...t)})),this._doc.on("flipped_pending_to_inflight",(()=>this.trigger("flipped_pending_to_inflight"))),this._doc.on("saved",(()=>this.trigger("saved"))),this._doc.on("error",(e=>this.handleError(e))),this.bindToDocChanges(this._doc),this.processUpdateFromServer({open:!0,v:n,snapshot:c}),this.removeCarriageReturnCharFromShareJsDoc()}removeCarriageReturnCharFromShareJsDoc(){const e=this._doc;if(-1===e.snapshot.indexOf("\r"))return;let t;for(this.eventLog.pushEvent("remove-carriage-return-char",{doc_id:this.doc_id});-1!==(t=e.snapshot.indexOf("\r"));)d.$.log("[ShareJsDoc] remove-carriage-return-char",t),e.del(t,1)}submitOp(e){this._doc.submitOp(e)}isAheadOfExpectedVersion(e){return this._doc.version>0&&e.v>this._doc.version}pushOntoQueue(e){d.$.log(`[processUpdate] push onto queue ${e.v}`),this.queuedMessageTimer||(this.queuedMessageTimer=window.setTimeout((()=>{d.$.log(`[processUpdate] queue timeout fired for ${e.v}`),this.processUpdateFromServer(e)}),5e3)),this.queuedMessages.push(e),this.queuedMessages.sort((function(e,t){return e.v-t.v}))}clearQueue(){this.queuedMessages=[]}processQueue(){if(this.queuedMessages.length>0){const e=this.queuedMessages[0].v;if(e>this._doc.version);else{d.$.log(`[processUpdate] taken from queue ${e}`);const t=this.queuedMessages.shift();t&&this.processUpdateFromServerInOrder(t),0===this.queuedMessages.length&&this.queuedMessageTimer&&(d.$.log("[processUpdate] queue is empty, cleared timeout"),window.clearTimeout(this.queuedMessageTimer),this.queuedMessageTimer=null)}}}processUpdateFromServerInOrder(e){if(this.isAheadOfExpectedVersion(e))return void this.pushOntoQueue(e);const t=this.processUpdateFromServer(e);t instanceof Error&&"Invalid version from server"===t.message?this.clearQueue():this.processQueue()}processUpdateFromServer(e){try{this._doc._onMessage(e)}catch(e){return d.$.log(e),this.handleError(e),e}if("external"===e.meta?.type)return this.trigger("externalUpdate",e)}catchUp(e){return e.map((e=>(e.v=this._doc.version,e.doc=this.doc_id,this.processUpdateFromServer(e))))}getSnapshot(){return this._doc.snapshot}getVersion(){return this._doc.version}getTimeSinceLastServerActivity(){return Math.floor(performance.now()-this._doc.lastServerActivity)}getType(){return this.type}clearInflightAndPendingOps(){return this.clearFatalTimeoutTimer(),this._doc.inflightOp=null,this._doc.inflightCallbacks=[],this._doc.pendingOp=null,this._doc.pendingCallbacks=[]}flushPendingOps(){return this._doc.flush()}updateConnectionState(e){return d.$.log(`[updateConnectionState] Setting state to ${e}`),this.connection.state=e,this.connection.id=this.socket.publicId,this._doc.autoOpen=!1,this._doc._connectionStateChanged(e),this.lastAcked=null}hasBufferedOps(){return null!=this._doc.inflightOp||null!=this._doc.pendingOp}getInflightOp(){return this._doc.inflightOp}getPendingOp(){return this._doc.pendingOp}getRecentAck(){return null!==this.lastAcked&&Date.now()-this.lastAcked.getTime()<4e3}attachEditorWatchdogManager(e){this.detachEditorWatchdogManager=this.editorWatchdogManager.attachToEditor(e)}attachToEditor(e,t){this.attachEditorWatchdogManager(e),t()}maybeDetachEditorWatchdogManager(){this.detachEditorWatchdogManager&&(this.detachEditorWatchdogManager(),this.detachEditorWatchdogManager=null)}attachToCM6(e){this.attachToEditor(e,(()=>{e.attachShareJs(this._doc,(0,_.A)("ol-maxDocLength"))}))}detachFromCM6(){this.maybeDetachEditorWatchdogManager(),this._doc.detach_cm6&&this._doc.detach_cm6()}startInflightOpTimeout(e){this.startFatalTimeoutTimer(e);const t=()=>{if(d.$.log("[inflightOpTimeout] Trying op again"),null!=this._doc.inflightOp){if(e.dupIfSource=[this.connection.id,...Array.from(this._doc.inflightSubmittedIds)],"ok"===this.connection.state)return d.$.log("[inflightOpTimeout] Sending"),this.connection.send(e);d.$.log("[inflightOpTimeout] Not connected, retrying in 0.5s"),window.setTimeout(t,500)}},n=window.setTimeout(t,5e3);return this._doc.inflightCallbacks.push((()=>{this.clearFatalTimeoutTimer(),window.clearTimeout(n)}))}startFatalTimeoutTimer(e){if(null==this._timeoutTimer)return this._timeoutTimer=window.setTimeout((()=>(this.clearFatalTimeoutTimer(),this.trigger("op:timeout",e))),3e4)}clearFatalTimeoutTimer(){if(null!=this._timeoutTimer)return clearTimeout(this._timeoutTimer),this._timeoutTimer=null}handleError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.trigger("error",e,t)}bindToDocChanges(e){const{submitOp:t}=e;e.submitOp=(n,r)=>(function(){const e=(0,_.A)("ol-project_id");(0,o.v4)("document-first-change",{projectId:e,isSmallDevice:o.mP})}(),this.trigger("op:sent",n),e.pendingCallbacks.push((()=>this.trigger("op:acknowledged",n))),t.call(e,n,r));const{flush:n}=e;e.flush=()=>(this.trigger("flush",e.inflightOp,e.pendingOp,e.version),n.call(e))}}var b=n(72607);function y(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(e){return e.reduce(((e,t)=>e+function(e){return(0,b.Tb)(e)?e.i.length:(0,b.XQ)(e)?e.d.length:0}(t)),0)}class k extends l{constructor(e,t,n,r,o,s){super(),y(this,"wantToBeJoined",!1),y(this,"chaosMonkeyTimer",null),y(this,"track_changes_as",null),y(this,"joinCallbacks",[]),y(this,"leaveCallbacks",[]),y(this,"joined",!1),y(this,"docName",""),y(this,"checkConsistency",(e=>{window.setTimeout((()=>{const t=e?.getValue(),n=this.doc?.getSnapshot();if(t!==n)return this.onError(new Error("Editor text does not match server text"),{},t)}),0)})),y(this,"onUpdateAppliedHandler",(e=>this.onUpdateApplied(e))),y(this,"onErrorHandler",((e,t)=>{t.doc_id===this.doc_id&&this.onError(e,t)})),y(this,"onDisconnectHandler",(()=>this.onDisconnect())),y(this,"onReconnect",(()=>{d.$.log("[onReconnect] reconnected (joined project)"),this.eventLog.pushEvent("reconnected:afterJoinProject"),this.connected=!0,(this.wantToBeJoined||this.doc?.hasBufferedOps())&&(d.$.log(`[onReconnect] Rejoining (wantToBeJoined: ${this.wantToBeJoined} OR hasBufferedOps: ${this.doc?.hasBufferedOps()})`),this.joinDoc((e=>{e?this.onError(e):(this.doc?.updateConnectionState("ok"),this.doc?.flushPendingOps(),this.callJoinCallbacks())})))})),this.doc_id=e,this.socket=t,this.globalEditorWatchdogManager=n,this.ideEventEmitter=r,this.eventLog=o,this.detachDoc=s,this.connected=this.socket.socket.connected,this.bindToEditorEvents(),this.bindToSocketEvents()}attachToCM6(e){this.cm6=e,this.doc&&this.doc.attachToCM6(this.cm6),this.cm6.on("change",this.checkConsistency)}detachFromCM6(){this.doc&&this.doc.detachFromCM6(),this.cm6&&this.cm6.off("change",this.checkConsistency),delete this.cm6,this.clearChaosMonkey(),this.doc&&this.ideEventEmitter.emit("document:closed",this.doc)}submitOp(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.doc?.submitOp(t)}getSnapshot(){return this.doc?.getSnapshot()}getType(){return this.doc?.getType()}getInflightOp(){return this.doc?.getInflightOp()}getPendingOp(){return this.doc?.getPendingOp()}getRecentAck(){return this.doc?.getRecentAck()}hasBufferedOps(){return this.doc?.hasBufferedOps()}setTrackingChanges(e){this.doc&&(this.doc.track_changes=e)}getTrackingChanges(){return!!this.doc?.track_changes}setTrackChangesIdSeeds(e){this.doc&&(this.doc.track_changes_id_seeds=e)}bindToSocketEvents(){return this.socket.on("otUpdateApplied",this.onUpdateAppliedHandler),this.socket.on("otUpdateError",this.onErrorHandler),this.socket.on("disconnect",this.onDisconnectHandler)}unBindFromSocketEvents(){return this.socket.removeListener("otUpdateApplied",this.onUpdateAppliedHandler),this.socket.removeListener("otUpdateError",this.onErrorHandler),this.socket.removeListener("disconnect",this.onDisconnectHandler)}bindToEditorEvents(){this.ideEventEmitter.on("project:joined",this.onReconnect)}unBindFromEditorEvents(){this.ideEventEmitter.off("project:joined",this.onReconnect)}leaveAndCleanUp(e){return this.leave((t=>{this.cleanUp(),e&&e(t)}))}leaveAndCleanUpPromise(){return new Promise(((e,t)=>{this.leaveAndCleanUp((n=>{n?t(n):e()}))}))}join(e){this.wantToBeJoined=!0,this.cancelLeave(),this.connected?this.joinDoc(e):e&&this.joinCallbacks.push(e)}leave(e){this.flush(),this.wantToBeJoined=!1,this.cancelJoin(),this.doc?.hasBufferedOps()?(d.$.log("[leave] Doc has buffered ops, pushing callback for later"),e&&this.leaveCallbacks.push(e)):this.connected?(d.$.log("[leave] Leaving now"),this.leaveDoc(e)):(d.$.log("[leave] Not connected, returning now"),e?.())}flush(){return this.doc?.flushPendingOps()}chaosMonkey(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"a";const n=t;let r=null,o=0;const s=()=>{null!=r&&r.length||(r=n.slice()+" "+new Date+"\n",e+=Math.random()>.1?1:-2,e<0&&(e=0),o=0),t=r[0],r=r.slice(1),this.cm6&&this.cm6.view.dispatch({changes:{from:Math.min(o,this.cm6.view.state.doc.length),insert:t}}),o+=1,this.chaosMonkeyTimer=window.setTimeout(s,100+(Math.random()<.1?1e3:0))};s()}clearChaosMonkey(){const e=this.chaosMonkeyTimer;e&&(this.chaosMonkeyTimer=null,window.clearTimeout(e))}pollSavedStatus(){let e;const t=this.getInflightOp(),n=this.getPendingOp(),r=this.getRecentAck(),o=n?x(n):0;return null==t&&null==n?(e=!0,d.$.log("[pollSavedStatus] no inflight or pending ops")):t&&t===this.oldInflightOp?(e=!1,d.$.log("[pollSavedStatus] inflight op is same as before")):null!=n&&r&&o<64?(e=!0,d.$.log("[pollSavedStatus] pending op (small with recent ack) assume ok",n,o)):(e=!1,d.$.log(`[pollSavedStatus] assuming not saved (inflightOp?: ${null!=t}, pendingOp?: ${null!=n})`)),this.oldInflightOp=t,e}cancelLeave(){this.leaveCallbacks=[]}cancelJoin(){this.joinCallbacks=[]}onUpdateApplied(e){if(this.eventLog.pushEvent("received-update",{doc_id:this.doc_id,remote_doc_id:e?.doc,wantToBeJoined:this.wantToBeJoined,update:e,hasDoc:!!this.doc}),e?.doc===this.doc_id&&null!=this.doc&&(this.eventLog.pushEvent("received-update:processing",{update:e}),this.doc.processUpdateFromServerInOrder(e),!this.wantToBeJoined))return this.leave()}onDisconnect(){return d.$.log("[onDisconnect] disconnecting"),this.connected=!1,this.joined=!1,null!=this.doc?this.doc.updateConnectionState("disconnected"):void 0}callJoinCallbacks(){for(const e of this.joinCallbacks)e();this.joinCallbacks=[]}joinDoc(e){if(this.doc)return this.eventLog.pushEvent("joinDoc:existing",{doc_id:this.doc_id,version:this.doc.getVersion()}),this.socket.emit("joinDoc",this.doc_id,this.doc.getVersion(),{encodeRanges:!0,age:this.doc.getTimeSinceLastServerActivity()},((t,n,r,o,s)=>{t?e?.(t):(this.joined=!0,this.doc?.catchUp(o),this.decodeRanges(s),this.catchUpRanges(s?.changes,s?.comments),e?.())}));this.eventLog.pushEvent("joinDoc:new",{doc_id:this.doc_id}),this.socket.emit("joinDoc",this.doc_id,{encodeRanges:!0},((t,n,r,o,s)=>{t?e?.(t):(this.joined=!0,this.eventLog.pushEvent("joinDoc:inited",{doc_id:this.doc_id,version:r}),this.doc=new v(this.doc_id,n,r,this.socket,this.globalEditorWatchdogManager,this.ideEventEmitter,this.eventLog),this.decodeRanges(s),this.ranges=new(c())(s?.changes,s?.comments),this.bindToShareJsDocEvents(),e?.())}))}decodeRanges(e){try{if(e.changes)for(const t of e.changes)(0,b.Tb)(t.op)&&(t.op.i=u(t.op.i)),(0,b.XQ)(t.op)&&(t.op.d=u(t.op.d));return e.comments?e.comments.map((e=>null!=e.op.c?e.op.c=u(e.op.c):void 0)):[]}catch(e){d.$.error(e)}}leaveDoc(e){this.eventLog.pushEvent("leaveDoc",{doc_id:this.doc_id}),d.$.log("[leaveDoc] Sending leaveDoc request"),this.socket.emit("leaveDoc",this.doc_id,(t=>{if(t)e?.(t);else{this.joined=!1;for(const e of this.leaveCallbacks)d.$.log("[_leaveDoc] Calling buffered callback",e),e(t);this.leaveCallbacks=[],e?.()}}))}cleanUp(){this.hasBufferedOps()?d.$.log(`[cleanUp] Document (${this.doc_id}) has buffered ops, refusing to remove from openDocs`):(this.detachDoc(this.doc_id,this),this.unBindFromEditorEvents(),this.unBindFromSocketEvents())}bindToShareJsDocEvents(){var e=this;if(!this.doc)return;this.doc.on("error",((e,t)=>this.onError(e,t))),this.doc.on("externalUpdate",(e=>(this.eventLog.pushEvent("externalUpdate",{doc_id:this.doc_id}),this.trigger("externalUpdate",e)))),this.doc.on("remoteop",(function(){e.eventLog.pushEvent("remoteop",{doc_id:e.doc_id});for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.trigger("remoteop",...n)})),this.doc.on("op:sent",(e=>(this.eventLog.pushEvent("op:sent",{doc_id:this.doc_id,op:e}),this.trigger("op:sent")))),this.doc.on("op:acknowledged",(e=>(this.eventLog.pushEvent("op:acknowledged",{doc_id:this.doc_id,op:e}),this.ideEventEmitter.emit("ide:opAcknowledged",{doc_id:this.doc_id,op:e}),this.trigger("op:acknowledged")))),this.doc.on("op:timeout",(e=>(this.eventLog.pushEvent("op:timeout",{doc_id:this.doc_id,op:e}),this.trigger("op:timeout"),this.onError(new Error("op timed out"))))),this.doc.on("flush",((e,t,n)=>this.eventLog.pushEvent("flush",{doc_id:this.doc_id,inflightOp:e,pendingOp:t,v:n})));let t,n=null;this.doc.on("change",((e,t,r)=>{this.applyOpsToRanges(e,r),n&&window.clearTimeout(n),n=window.setTimeout((()=>{window.dispatchEvent(new CustomEvent("doc:changed",{detail:{id:this.doc_id}})),this.ideEventEmitter.emit("doc:changed",{doc_id:this.doc_id})}),50)})),this.doc.on("flipped_pending_to_inflight",(()=>this.trigger("flipped_pending_to_inflight"))),this.doc.on("saved",(()=>{t&&window.clearTimeout(t),t=window.setTimeout((()=>{window.dispatchEvent(new CustomEvent("doc:saved",{detail:{id:this.doc_id}})),this.ideEventEmitter.emit("doc:saved",{doc_id:this.doc_id})}),50)}))}onError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;t.doc_id=this.doc_id,d.$.log("ShareJS error",e,t),"no project_id found on client"!==e.message?(this.doc&&this.doc.clearInflightAndPendingOps(),this.trigger("error",e,t,n),this.cleanUp()):d.$.log("ignoring error, will wait to join project")}applyOpsToRanges(e,t){let n,r=null;const o=null!=t;o&&t?.meta.tc?(n=this.ranges.getIdSeed(),this.ranges.setIdSeed(t.meta.tc),r=t.meta.user_id):o||null==this.track_changes_as||(r=this.track_changes_as),this.ranges.track_changes=null!=r;for(const t of this.filterOps(e))this.ranges.applyOp(t,{user_id:r});return null!=n&&this.ranges.setIdSeed(n),o?window.setTimeout((()=>this.emit("ranges:dirty"))):this.emit("ranges:dirty")}catchUpRanges(e,t){null==e&&(e=[]),null==t&&(t=[]),this.emit("ranges:clear"),this.ranges.changes=e,this.ranges.comments=t,this.ranges.track_changes=this.doc?.track_changes??!1;for(const e of this.filterOps(this.doc?.getInflightOp()||[]))this.ranges.setIdSeed(this.doc?.track_changes_id_seeds?.inflight),this.ranges.applyOp(e,{user_id:this.track_changes_as});for(const e of this.filterOps(this.doc?.getPendingOp()||[]))this.ranges.setIdSeed(this.doc?.track_changes_id_seeds?.pending),this.ranges.applyOp(e,{user_id:this.track_changes_as});return this.emit("ranges:redraw")}filterOps(e){return(0,_.A)("ol-isRestrictedTokenMember")?e.filter((e=>!(0,b.H8)(e))):e}}function E(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class T{constructor(e,t,n,r){E(this,"openDocs",new Map),this.socket=e,this.globalEditorWatchdogManager=t,this.events=n,this.eventLog=r}getDocument(e){return this.openDocs.has(e)&&(d.$.log(`[getDocument] Cleaning up existing document instance for ${e}`),this.openDocs.get(e)?.cleanUp()),this.openDocs.has(e)?d.$.log(`[getDocument] Returning existing document instance for ${e}`):(d.$.log(`[getDocument] Creating new document instance for ${e}`),this.createDoc(e)),this.openDocs.get(e)}createDoc(e){const t=new k(e,this.socket,this.globalEditorWatchdogManager,this.events,this.eventLog,this.detachDoc.bind(this));this.openDocs.set(e,t)}detachDoc(e,t){this.openDocs.get(e)===t?(d.$.log(`[detach] Removing document with ID (${e}) from openDocs`),this.openDocs.delete(e)):d.$.log(`[_cleanUp] New instance of (${e}) created. Not removing`)}hasUnsavedChanges(){for(const e of this.openDocs.values())if(e.hasBufferedOps())return!0;return!1}flushAll(){for(const e of this.openDocs.values())e.flush()}unsavedDocIds(){const e=[];for(const[t,n]of this.openDocs)n.pollSavedStatus()||e.push(t);return e}}var j=n(98125),C=n(12391),I=n(56447),S=n(71573),L=n(41479),A=n(37766),O=n(67603),R=n(97434),M=n(83566),F=n(89139),P=n(90254);const D=(e,t)=>{const n=(0,r.useRef)(null),o=(0,r.useRef)(null),s=(0,r.useRef)({});(0,r.useEffect)((()=>{n.current=t}),[t]),(0,r.useEffect)((()=>{o.current=e}),[e]);const i=(0,r.useMemo)((()=>async()=>await async function(e,t,n){if(d.$.debug("tryGetDiffSize"),!t)return d.$.debug("tryGetDiffSize: missing projectId"),null;if(!e)return d.$.debug("tryGetDiffSize: missing currentContents"),null;if(!n)return d.$.debug("tryGetDiffSize: missing docId"),null;try{const r=await fetch(`/Project/${t}/doc/${n}/download`,{signal:AbortSignal.timeout(5e3)}),o=await r.text(),s=(0,P.JJ)(o,e);let i=0;for(const e of s)(e.added||e.removed)&&(i+=e.value.length);return i}catch{return d.$.debug("tryGetDiffSize: fetch failed"),null}}(n.current?.getSnapshot(),o.current,n.current?.doc_id)),[]);return{createDebugDiff:i,debugTimers:s}};var N=n(10646),X=n(31085);const $=(0,r.createContext)(void 0),U=e=>{let{children:t}=e;const{t:n}=(0,R.Bd)(),a=(0,i.nK)(),{projectId:c}=(0,j.yn)(),{reportError:l,eventEmitter:h,eventLog:u}=(0,j.yn)(),{setOutOfSync:p}=(0,N.mi)(),{socket:g,disconnect:m,connectionState:_}=(0,C.FX)(),{view:w,setView:v}=(0,I.LV)(),{showGenericMessageModal:b,genericModalVisible:y,showOutOfSyncModal:x}=(0,O.T)(),[k,E]=(0,s.A)("editor.showSymbolPalette"),[P]=(0,s.A)("editor.showVisual"),[U,V]=(0,s.A)("editor.sharejs_doc"),[B,W]=(0,s.A)("editor.open_doc_id"),[,H]=(0,s.A)("editor.open_doc_name"),[,z]=(0,s.A)("editor.opening"),[,J]=(0,s.A)("editor.error_state"),[,q]=(0,s.A)("editor.trackChanges"),[K,G]=(0,s.A)("editor.wantTrackChanges"),Y=(0,r.useRef)(K);(0,r.useEffect)((()=>{Y.current=K}),[K]);const Q=(0,A.A)("editor:gotoLine"),{fileTreeData:Z}=(0,S.Q)(),[ee,te]=(0,r.useState)(!1),{createDebugDiff:ne,debugTimers:re}=D(c,U),[oe]=(0,r.useState)((()=>new f({onTimeoutHandler:e=>{let t=null;ne().then((e=>{t=e})).finally((()=>{(0,o._)("losing-edits",{...e,diffSize:t,timers:re.current}),l("losing-edits",{...e,diffSize:t,timers:re.current})}))}}))),[se,ie]=(0,r.useState)(null),[ae,ce]=(0,r.useState)(!1);(0,r.useEffect)((()=>{y||ce(!1)}),[y]);const[le]=(0,r.useState)((()=>new T(g,oe,h,u))),he=`doc.open_id.${c}`;(0,r.useEffect)((()=>{B&&M.A.setItem(he,B)}),[B,he]);const de=(0,r.useRef)(0);(0,r.useEffect)((()=>{a.scopeStore.set("editor.toggleSymbolPalette",(()=>{E((e=>{const t=!e;return(0,o._)(t?"symbol-palette-show":"symbol-palette-hide"),t}))}))}),[a.scopeStore,E]);const ue=(0,r.useCallback)((()=>U?P?"cm6-rich-text":"cm6":null),[U,P]),pe=(0,r.useCallback)((()=>U?.getSnapshot()??null),[U]),ge=(0,r.useCallback)((()=>B),[B]),me=(0,r.useCallback)((()=>te(!0)),[]),fe=(0,r.useCallback)((()=>te(!1)),[]),_e=(0,r.useCallback)((e=>{Q(e.gotoLine,e.gotoColumn??0,e.syncToPdf??!1)}),[Q]),we=(0,r.useCallback)(((e,t)=>{t.on("error",((n,r,o)=>{ie({doc:e,document:t,error:n,meta:r,editorContent:o})}))}),[]),ve=(0,r.useCallback)(((e,t)=>{we(e,t),t.on("externalUpdate",(e=>{ee||"external"===e.meta.type&&"git-bridge"===e.meta.source||"file-restore"!==e.meta.origin?.kind&&"project-restore"!==e.meta.origin?.kind&&b(n("document_updated_externally"),n("document_updated_externally_detail"))}))}),[we,ee,b,n]),be=(0,r.useRef)(null),ye=(0,r.useCallback)((e=>{if(!e)return;be.current&&(window.clearTimeout(be.current),be.current=null);const t=Y.current,n=e.getTrackingChanges();if(t===n)return void q(t);const r=()=>{null==e.getInflightOp()&&null==e.getPendingOp()?(e.setTrackingChanges(t),q(t)):be.current=window.setTimeout(r,100)};r()}),[q]),xe=(0,r.useCallback)((e=>new Promise(((t,n)=>{d.$.log("[doOpenNewDocument] Opening...");const r=le.getDocument(e._id);if(!r)return d.$.error(`No open document with ID '${e._id}' found`),void n(new Error("no open document found"));const o=++de.current;r.join((s=>{if(s)return d.$.log(`[doOpenNewDocument] error joining doc ${e._id}`,s),void n(s);de.current!==o&&(d.$.log(`[doOpenNewDocument] editorOpenDocEpoch mismatch ${de.current} vs ${o}`),r.leaveAndCleanUp(),n(new Error("another document was loaded"))),ve(e,r),t(r)}))}))),[ve,le]),ke=(0,r.useCallback)((async e=>{const t=U?.doc_id,n=U?.hasBufferedOps();if(U&&t!==e._id||n){d.$.log("[openNewDocument] Leaving existing open doc..."),(e=>{e.off()})(U),we(e,U);const n=++de.current;try{await U.leaveAndCleanUpPromise()}catch(e){throw d.$.log(`[openNewDocument] error leaving doc ${t}`,e),e}if(de.current!==n)throw d.$.log(`[openNewDocument] editorOpenDocEpoch mismatch ${de.current} vs ${n}`),new Error("another document was loaded")}return xe(e)}),[we,xe,U]),Ee=(0,r.useRef)(B);(0,r.useEffect)((()=>{Ee.current=B}),[B]);const Te=(0,r.useCallback)((async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};d.$.log(`[openDoc] Opening ${e._id}`),"editor"===w&&h.emit("store-doc-position"),t.keepCurrentView||v("editor");const r=n=>{window.dispatchEvent(new CustomEvent("doc:after-opened",{detail:{isNewDoc:n,docId:e._id}})),!function(e){return"number"==typeof e.gotoLine}(t)?function(e){return"number"==typeof e.gotoOffset}(t)&&window.setTimeout((()=>{h.emit("editor:gotoOffset",t.gotoOffset)})):(window.setTimeout((()=>_e(t))),n&&window.addEventListener("editor:scroll-position-restored",(()=>_e(t)),{once:!0}))};if(e._id!==Ee.current||t.forceReopen){Ee.current=e._id,W(e._id),H(e.name),z(!0);try{const t=await ke(e);ye(t),h.emit("doc:opened"),z(!1),V(t),r(!0)}catch(t){if("another document was loaded"===t?.message)return void d.$.log(`[openDoc] another document was loaded while ${e._id} was loading`);d.$.error("Error opening document",t),b(n("error_opening_document"),n("error_opening_document_detail"))}}else r(!1)}),[h,_e,ke,V,W,H,z,v,b,ye,n,w]),je=(0,r.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=(0,L.p)(Z,e);n&&Te(n,t)}),[Z,Te]),Ce=(0,r.useCallback)((e=>{const t=M.A.getItem(he)||e;t&&je(t)}),[he,je]);(0,r.useEffect)((()=>{if(se){const{doc:e,document:t,error:r,meta:o}=se;let{editorContent:s}=se;const i="string"==typeof r?r:r?.message??"";if(ie(null),i.includes("maxDocLength")){Te(e,{forceReopen:!0});const r=null!=t.ranges&&t.ranges.changes.some((e=>"d"in e.op))?`${n("document_too_long_detail")} ${n("document_too_long_tracked_deletes")}`:n("document_too_long_detail");b(n("document_too_long"),r),ce(!0)}else if(/too many comments or tracked changes/.test(i))b(n("too_many_comments_or_tracked_changes"),n("too_many_comments_or_tracked_changes_detail"));else if(!ae)return t.off("error"),s="string"==typeof s?s:t.doc?._doc.snapshot,t.doc&&t.doc.clearInflightAndPendingOps(),t.leaveAndCleanUp(),m(),l(r,o),J(!0),p(!0),void x(s||"");const a=()=>{Te(e,{forceReopen:!0})};return h.once("project:joined",a),()=>{h.off("project:joined",a)}}}),[m,se,ae,h,Te,l,J,b,x,p,n]),(0,F.A)("editor:insert-symbol",(()=>{(0,o._)("symbol-palette-insert")})),(0,F.A)("flush-changes",(()=>{le.flushAll()})),(0,F.A)("blur",(()=>{le.flushAll()})),(0,r.useEffect)((()=>{_.forceDisconnected&&le.flushAll()}),[_.forceDisconnected,le]);const Ie=(0,r.useRef)(K);(0,r.useEffect)((()=>{K!==Ie.current&&(Ie.current=K,ye(U))}),[U,ye,K]);const Se=(0,r.useMemo)((()=>({getEditorType:ue,showSymbolPalette:k,currentDocument:U,currentDocumentId:B,getCurrentDocValue:pe,getCurrentDocId:ge,startIgnoringExternalUpdates:me,stopIgnoringExternalUpdates:fe,openDocId:je,openDoc:Te,openDocs:le,openInitialDoc:Ce,jumpToLine:_e,wantTrackChanges:K,setWantTrackChanges:G,debugTimers:re})),[ue,k,U,B,pe,ge,me,fe,je,Te,le,Ce,_e,K,G,re]);return a.editorManager=Se,(0,X.jsx)($.Provider,{value:Se,children:t})};function V(){const e=(0,r.useContext)($);if(!e)throw new Error("useEditorManagerContext is only available inside EditorManagerProvider");return e}},99115:(e,t,n)=>{"use strict";n.d(t,{Q:()=>f,r:()=>_});n(16280);var r=n(14041),o=n(66666),s=n(98125),i=n(77135),a=n(71573),c=n(79550);var l=n(14936),h=n(60961),d=n(39891),u=n(5964),p=n(89139),g=n(31085);const m=(0,r.createContext)(void 0),f=e=>{let{children:t}=e;const{rootDocId:n,owner:f}=(0,o.O)(),{eventEmitter:_,projectJoined:w}=(0,s.yn)(),{openDocId:v,currentDocumentId:b,openInitialDoc:y}=(0,i.TS)(),{selectEntity:x}=function(){const{fileTreeData:e,selectedEntities:t}=(0,a.Q)();return{selectEntity:(0,r.useCallback)((n=>{1===t.length&&t[0].entity._id===n||(0,c.lE)(e,n)&&window.dispatchEvent(new CustomEvent("editor.openDoc",{detail:n}))}),[e,t])}}(),[,k]=(0,l.A)("openFile"),[E,T]=(0,r.useState)(null),[j,C]=(0,r.useState)(0),[I,S]=(0,r.useState)(!1),L=(0,r.useCallback)((()=>{S(!0)}),[]),A=(0,r.useCallback)((e=>{if(h.$.log("File tree selection changed",e),C(e.length),1!==e.length)return void T(null);const[t]=e;if("folder"===t.type)return;T(t),"doc"===t.type&&I&&(v(t.entity._id,{keepCurrentView:!0}),t.entity.name.endsWith(".bib")&&(0,u._)("open-bib-file",{projectOwner:f._id,isSampleFile:"sample.bib"===t.entity.name,linkedFileProvider:null}));const n="fileRef"===t.type?(0,d.D)(t.entity):null;k(n),n&&(t?.entity?.name?.endsWith(".bib")&&(0,u._)("open-bib-file",{projectOwner:f._id,isSampleFile:!1,linkedFileProvider:t.entity.linkedFileData?.provider}),window.dispatchEvent(new CustomEvent("file-view:file-opened")))}),[I,k,v,f]),O=(0,r.useCallback)((e=>{_.emit("entity:deleted",e),e.entity._id===b&&v(n)}),[_,b,v,n]);(0,p.A)("doc:after-opened",(0,r.useCallback)((e=>{x(e.detail.docId)}),[x]));const R=(0,r.useRef)(!1);(0,r.useEffect)((()=>{n&&I&&w&&!R.current&&(R.current=!0,y(n))}),[I,y,w,n]);const M=(0,r.useMemo)((()=>({selectedEntityCount:j,openEntity:E,handleFileTreeInit:L,handleFileTreeSelect:A,handleFileTreeDelete:O})),[O,L,A,E,j]);return(0,g.jsx)(m.Provider,{value:M,children:t})},_=()=>{const e=(0,r.useContext)(m);if(!e)throw new Error("useFileTreeOpenContext is only available inside FileTreeOpenProvider");return e}},98125:(e,t,n)=>{"use strict";n.d(t,{HA:()=>L,yn:()=>A});n(16280);var r=n(14041),o=(n(43375),n(39225),n(13972),n(99209),n(25714),n(17561),n(66197),n(45250)),s=n.n(o),i=n(83566),a=n(60961);function c(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const l=Symbol("not found");function h(e){return null!==e&&"object"==typeof e&&!("length"in e&&"number"==typeof e.length&&e.length>0)}function d(e){const t=[];let n,r=e;for(;-1!==(n=r.lastIndexOf("."));)r=r.slice(0,n),t.push(r);return t}class u{constructor(){c(this,"items",new Map),c(this,"persisters",new Map),c(this,"watcherUpdates",new Map),c(this,"watcherUpdateTimer",null),c(this,"allowedNonExistentPaths",[])}nonExistentPathAllowed(e){return this.allowedNonExistentPaths.some((t=>t.path===e||t.deep&&e.startsWith(t.path+".")))}findInAncestors(e){for(const t of d(e)){const n=this.items.get(t);if(n&&"value"in n&&h(n.value)){const r=e.slice(t.length+1),o=s().get(n.value,r);if(o!==l)return{value:o,watchers:[]}}}return{watchers:[]}}getItem(e){const t=this.items.get(e)||this.findInAncestors(e);if(!("value"in t)){if(this.nonExistentPathAllowed(e))return a.$.log(`No value found for key '${e}'. This is allowed because the path is in allowedNonExistentPaths`),{value:void 0};throw new Error(`No value found for key '${e}'`)}return t}reassembleObjectValue(e,t){const n={...t},r=e+".";for(const[e,t]of this.items.entries())if(e.startsWith(r)){const o=e.slice(r.length);-1===o.indexOf(".")&&"value"in t&&(n[o]=t.value)}return n}flushUpdates(){this.watcherUpdateTimer&&(window.clearTimeout(this.watcherUpdateTimer),this.watcherUpdateTimer=null);const e=[...this.watcherUpdates.values()];this.watcherUpdates=new Map;for(const{value:t,watchers:n}of e)for(const e of n)e.removed||e.callback.call(null,t)}scheduleWatcherUpdate(e,t,n){const r={value:t,path:e,watchers:[...n]};this.watcherUpdates.set(e,r),this.watcherUpdateTimer||(this.watcherUpdateTimer=window.setTimeout((()=>{this.watcherUpdateTimer=null,this.flushUpdates()}),0))}get(e){return this.getItem(e).value}setValue(e,t){a.$.log("setValue",e,t);let n=this.items.get(e);if(void 0===n)n={value:t,watchers:[]},this.items.set(e,n);else if("value"in n){if(n.value===t)return;n.value=t}else n={...n,value:t},this.items.set(e,n);this.scheduleWatcherUpdate(e,t,n.watchers);const r=this.persisters.get(e);r&&i.A.setItem(r.localStorageKey,r.toPersisted?.(t)||t)}setValueAndDescendants(e,t){if(this.setValue(e,t),h(t)){const n=e+".";for(const[e,r]of this.items.entries())if(e.startsWith(n)){const o=s().get(t,e.slice(n.length),l);o===l||"value"in r&&o===r.value||this.setValue(e,o)}const r=[],o=new Set(Object.keys(t));for(const e of this.items.keys())if(e.startsWith(n)){const t=e.slice(n.length).split(".",1)[0];o.has(t)||r.push(e)}for(const e of r)this.items.delete(e)}}set(e,t){this.setValueAndDescendants(e,t);for(const t of d(e)){const e=this.items.get(t);e&&"value"in e&&(e.value=this.reassembleObjectValue(t,e.value),this.scheduleWatcherUpdate(t,e.value,e.watchers))}}watch(e,t){let n=this.items.get(e);n||(n=this.findInAncestors(e),this.items.set(e,n));const r=n.watchers,o={removed:!1,callback:t};if(n.watchers.push(o),"value"in n){const{watchers:t}=this.watcherUpdates.get(e)??{watchers:[]};this.scheduleWatcherUpdate(e,n.value,[...t,o])}return()=>{o.removed=!0,s().pull(r,o)}}persisted(e,t,n,r){const o=i.A.getItem(n);let s=t;null!==o&&(s=r?r.fromPersisted(o):o),this.set(e,s),this.persisters.set(e,{localStorageKey:n,toPersisted:r?.toPersisted})}allowNonExistentPath(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.allowedNonExistentPaths.push({path:e,deep:t})}dump(){const e=[];for(const[t,n]of this.items.entries())e.push({path:t,value:"value"in n?n.value:"[not set]",watcherCount:n.watchers.length});return e}}var p=n(64932);const g=`ui.reviewPanelOpen.${(0,p.A)("ol-project_id")}`;var m=n(58528);var f=n(67353);class _ extends EventTarget{emit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.dispatchEvent(new CustomEvent(e,{detail:n}))}on(e,t){this.addEventListener(e,t)}once(e,t){this.addEventListener(e,t,{once:!0})}off(e,t){this.removeEventListener(e,t)}}function w(){return new _}var v=n(12391);function b(e,t){e.set("state.loading",!1),e.set("project.name",null),e.set("editor",{showSymbolPalette:!1,toggleSymbolPalette:()=>{},sharejs_doc:null,open_doc_id:null,open_doc_name:null,opening:!0,trackChanges:!1,wantTrackChanges:!1,newSourceEditor:!0,error_state:!1}),e.persisted("editor.showVisual","never"===(0,p.A)("ol-usedLatex")||function(e){const t=`editor.mode.${e}`,n=i.A.getItem(t);n&&i.A.removeItem(t);return"rich-text"===n}(t),"editor.lastUsedMode",{toPersisted:e=>e?"visual":"code",fromPersisted:e=>"visual"===e}),e.persisted("editor.codeEditorOpened",function(){const e=(0,p.A)("ol-user").signUpDate;if("string"==typeof e&&new Date(e)<new Date("2024-08-02"))return!0;return!1}(),"editor.codeEditorOpened"),e.watch("editor.showVisual",(t=>{!0!==e.get("editor.codeEditorOpened")&&!1===t&&e.set("editor.codeEditorOpened",!0)}))}var y=n(37858);function x(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class k{constructor(){var e=this;x(this,"recentEvents",[]),x(this,"pushEvent",(function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(a.$.log("event",t,n),e.recentEvents.push({type:t,meta:n,date:new Date}),e.recentEvents.length>100)return e.recentEvents.shift()}))}}var E=n(52036);class T{constructor(e){this.eventEmitter=e}emit(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];this.eventEmitter.dispatchEvent(new CustomEvent(e,{detail:r}))}on(e,t){const n=e=>{t({},...e.detail)};return this.eventEmitter.addEventListener(e,n),()=>{this.eventEmitter.removeEventListener(e,n)}}}var j=n(31085);const C=new Date,I=(0,r.createContext)(void 0);function S(e){const t=new u;var n;return(n=t).set("settings",{}),n.set("sync_tex_error",!1),b(t,e),function(e){e.set("ui.view","editor"),e.set("openFile",null),e.persisted("ui.chatOpen",!1,"ui.chatOpen"),e.persisted("ui.reviewPanelOpen",!1,g),e.set("ui.leftMenuShown",!1),e.set("ui.miniReviewPanelVisible",!1),e.set("ui.pdfLayout","sideBySide"),e.set("ui.loadingStyleSheet",!1)}(t),function(e){e.allowNonExistentPath("project",!0),e.set("permissionsLevel","readOnly"),e.set("permissions",{read:!0,write:!1,admin:!1,comment:!0})}(t),function(e){e.allowNonExistentPath("pdf",!0)}(t),(0,E.Oy)(t),function(e){e.set("loadingThreads",!0),e.set("users",{}),e.set("addNewComment",(()=>{})),e.set("usingNewReviewPanel",(0,m.g9)("review-panel-redesign"))}(t),t.allowNonExistentPath("hasLintingError"),t.allowNonExistentPath("loadingThreads"),t}const L=e=>{let{children:t}=e;const n=(0,p.A)("ol-project_id"),[o]=(0,r.useState)((()=>S(n))),[s]=(0,r.useState)(w),[i]=(0,r.useState)((()=>new T(s))),[a]=(0,r.useState)((()=>new k)),[c,l]=(0,r.useState)(!1),h=(0,p.A)("ol-ExposedSettings")?.sentryRelease??null,[d,u]=(0,r.useState)(!1),{socket:g}=(0,v.FX)(),m=(0,r.useCallback)(((e,t)=>{const r={...t,user_id:(0,p.A)("ol-user_id"),project_id:n,client_id:g.socket?.sessionid,transport:g.socket?.transport?.name,client_now:new Date,release:h,client_load:C},o={};if("object"==typeof e)for(const t of Object.getOwnPropertyNames(e))o[t]=e[t];else"string"==typeof e&&(o.message=e);return(0,y.TB)("/error/client",{body:{error:o,meta:r}})}),[g.socket,h,n]);(0,r.useEffect)((()=>{function e(e){let{project:t,permissionsLevel:n}=e;o.set("project",{rootDoc_id:null,...t}),o.set("permissionsLevel",n),o.flushUpdates(),s.emit("project:joined",{project:t,permissionsLevel:n}),u(!0)}function t(e){o.set("project.mainBibliographyDoc_id",e)}return g.on("joinProjectResponse",e),g.on("mainBibliographyDocUpdated",t),()=>{g.removeListener("joinProjectResponse",e),g.removeListener("mainBibliographyDocUpdated",t)}}),[g,s,o]);const _=(0,r.useMemo)((()=>({_id:(0,p.A)("ol-project_id"),$scope:{$on:()=>{},$watch:()=>{},$applyAsync:()=>{},user:{},project:{_id:(0,p.A)("ol-project_id"),name:(0,p.A)("ol-projectName"),rootDocId:"",members:[],invites:[],features:{collaborators:0,compileGroup:"standard",trackChangesVisible:!1,references:!1,mendeley:!1,zotero:!1},publicAccessLevel:"",owner:{_id:"",email:""}},state:{loading:!1},permissionsLevel:"readOnly",editor:{sharejs_doc:null,showSymbolPalette:!1,toggleSymbolPalette:()=>{}},ui:{view:"pdf",chatOpen:!1,reviewPanelOpen:!1,leftMenuShown:!1,pdfLayout:"flat"},pdf:{uncompiled:!0,logEntryAnnotations:{}},settings:{syntaxValidation:!1,pdfViewer:"pdfjs"},hasLintingError:!1},editorManager:{openDoc:()=>{},getCurrentDocId:()=>{}},socket:g,reportError:m})),[g,m]),b=(0,r.useMemo)((()=>({eventEmitter:s,eventLog:a,startedFreeTrial:c,setStartedFreeTrial:l,projectId:n,reportError:m,projectJoined:d})),[s,a,n,d,m,c]);return(0,j.jsx)(I.Provider,{value:b,children:(0,j.jsx)(f.Qi,{ide:_,scopeStore:o,scopeEventEmitter:i,children:t})})};function A(){const e=(0,r.useContext)(I);if(!e)throw new Error("useIdeReactContext is only available inside IdeReactProvider");return e}},13877:(e,t,n)=>{"use strict";n.d(t,{Xj:()=>_,yi:()=>w});n(16280),n(43375),n(39225),n(13972),n(99209),n(25714),n(17561),n(66197);var r=n(14041),o=n(98125),s=n(12391),i=n(77135),a=n(37858),c=n(52036),l=n(10646),h=n(6599),d=n(89139),u=n(67603),p=n(58516),g=n(97434),m=n(31085);const f=(0,r.createContext)(void 0),_=e=>{let{children:t}=e;const{t:n}=(0,g.Bd)(),{eventEmitter:_,projectId:w}=(0,o.yn)(),{socket:v}=(0,s.FX)(),{onlineUsersCount:b}=(0,c.E1)(),{permissionsLevel:y}=(0,l.mi)(),x=(0,p.Tg)(),{currentDocument:k}=(0,i.TS)(),{showGenericMessageModal:E}=(0,u.T)(),[T,j]=(0,r.useState)({}),C=(0,r.useRef)(new Map);(0,r.useEffect)((()=>{const e=e=>{let{detail:[t]}=e;"doc"===t.type&&j((e=>(delete e[t.entity._id],{...e})))};return _.on("entity:deleted",e),()=>{_.off("entity:deleted",e)}}),[_]),(0,r.useEffect)((()=>{window.dispatchEvent(new CustomEvent("project:metadata",{detail:T}))}),[T]);const I=(0,r.useCallback)((e=>{const{docId:t,meta:n}=e;null!=t&&null!=n&&j((e=>({...e,[t]:n})))}),[]),S=(0,r.useCallback)((()=>{(0,a.hm)(`/project/${w}/metadata`).then((e=>{const{projectMeta:t}=e;t&&j(t)}))}),[w]),L=(0,r.useCallback)((e=>{const t=b>0;(0,a.TB)(`/project/${w}/doc/${e}/metadata`,{body:{broadcast:t}}).then((e=>{!t&&e&&I(e)}))}),[I,b,w]),A=(0,r.useCallback)((e=>{if("readOnly"===y)return;const t=C.current.get(e);null!=t&&(window.clearTimeout(t),C.current.delete(e)),C.current.set(e,window.setTimeout((()=>{L(e),C.current.delete(e)}),2e3))}),[L,y]),O=(0,r.useCallback)((e=>{I(e)}),[I]);(0,h.A)(v,"broadcastDocMeta",O);const R=(0,r.useCallback)((()=>{k&&A(k.doc_id)}),[k,A]);(0,d.A)("editor:metadata-outdated",R);const M=(0,r.useRef)(x);(0,r.useEffect)((()=>{M.current=x}),[x]),(0,r.useEffect)((()=>{const e=e=>{let{detail:[{project:t}]}=e;t.deletedByExternalDataSource&&E(n("project_renamed_or_deleted"),n("project_renamed_or_deleted_detail")),window.setTimeout((()=>{M.current.write&&S()}),200)};return _.once("project:joined",e),()=>{_.off("project:joined",e)}}),[_,S,E,n]);const F=(0,r.useMemo)((()=>{const e=Object.values(T);return{commands:e.flatMap((e=>Object.values(e.packages).flat())),labels:new Set(e.flatMap((e=>e.labels))),packageNames:new Set(e.flatMap((e=>e.packageNames)))}}),[T]);return(0,m.jsx)(f.Provider,{value:F,children:t})};function w(){const e=(0,r.useContext)(f);if(!e)throw new Error("useMetadataContext is only available inside MetadataProvider");return e}},67603:(e,t,n)=>{"use strict";n.d(t,{B:()=>g,T:()=>m});n(16280);var r=n(14041),o=n(97434),s=n(28812),i=n(71627),a=n(31085);function c(e){let{title:t,message:n,...r}=e;const{t:c}=(0,o.Bd)();return(0,a.jsxs)(s.Ay,{...r,children:[(0,a.jsx)(s.IK,{closeButton:!0,children:(0,a.jsx)(s.rA,{children:t})}),(0,a.jsx)(s.$8,{className:"modal-body-share",children:n}),(0,a.jsx)(s.E9,{children:(0,a.jsx)(i.A,{variant:"secondary",onClick:()=>r.onHide(),children:c("ok")})})]})}const l=(0,r.memo)(c);var h=n(89753);function d(e){let{editorContent:t,show:n,onHide:c}=e;const{t:l}=(0,o.Bd)(),d=(0,h.z)(),[u,p]=(0,r.useState)(!1),g=(t.match(/\n/g)?.length||0)+1;function m(){c(),d.reload()}return(0,a.jsxs)(s.Ay,{show:n,onHide:m,className:"out-of-sync-modal",backdrop:!1,keyboard:!1,children:[(0,a.jsx)(s.IK,{closeButton:!0,children:(0,a.jsx)(s.rA,{children:l("out_of_sync")})}),(0,a.jsx)(s.$8,{className:"modal-body-share",children:(0,a.jsx)(o.x6,{i18nKey:"out_of_sync_detail",components:[(0,a.jsx)("br",{}),(0,a.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:"/learn/Kb/Editor_out_of_sync_problems"})]})}),(0,a.jsxs)(s.$8,{children:[(0,a.jsx)(i.A,{variant:"secondary",onClick:()=>p((e=>!e)),children:l(u?"hide_local_file_contents":"show_local_file_contents")}),u?(0,a.jsx)("div",{className:"text-preview",children:(0,a.jsx)("textarea",{className:"scroll-container",readOnly:!0,rows:g,value:t})}):null]}),(0,a.jsx)(s.E9,{children:(0,a.jsx)(i.A,{variant:"secondary",onClick:m,children:l("reload_editor")})})]})}const u=(0,r.memo)(d),p=(0,r.createContext)(void 0),g=e=>{let{children:t}=e;const[n,o]=(0,r.useState)(!1),[s,i]=(0,r.useState)({title:"",message:""}),[c,h]=(0,r.useState)(!1),[d,g]=(0,r.useState)({editorContent:""}),m=(0,r.useCallback)((()=>{o(!1)}),[]),f=(0,r.useCallback)(((e,t)=>{i({title:e,message:t}),o(!0)}),[]),_=(0,r.useCallback)((()=>{h(!1)}),[]),w=(0,r.useCallback)((e=>{g({editorContent:e}),h(!0)}),[]),v=(0,r.useMemo)((()=>({showGenericMessageModal:f,genericModalVisible:n,showOutOfSyncModal:w})),[f,n,w]);return(0,a.jsxs)(p.Provider,{value:v,children:[t,(0,a.jsx)(l,{show:n,onHide:m,...s}),(0,a.jsx)(u,{...d,show:c,onHide:_})]})};function m(){const e=(0,r.useContext)(p);if(!e)throw new Error("useModalsContext is only available inside ModalsContextProvider");return e}},52036:(e,t,n)=>{"use strict";n.d(t,{E1:()=>_,Oy:()=>g,VH:()=>f});n(16280);var r=n(14041),o=n(98125),s=n(12391),i=n(14936),a=n(94833),c=n(45250),l=n(71573),h=n(41479),d=n(6599),u=n(60961),p=n(31085);function g(e){e.set("onlineUsers",{}),e.set("onlineUserCursorHighlights",{}),e.set("onlineUsersArray",[]),e.set("onlineUsersCount",0)}const m=(0,r.createContext)(void 0),f=e=>{let{children:t}=e;const{eventEmitter:n}=(0,o.yn)(),{socket:g}=(0,s.FX)(),[f]=(0,i.A)("editor.open_doc_id"),{fileTreeData:_}=(0,l.Q)(),[w,v]=(0,i.A)("onlineUsers"),[b,y]=(0,i.A)("onlineUserCursorHighlights"),[x,k]=(0,i.A)("onlineUsersArray"),[E,T]=(0,i.A)("onlineUsersCount"),[j,C]=(0,r.useState)(null),[I,S]=(0,r.useState)(500),L=(0,r.useCallback)((e=>{const t={},n=[],r={};for(const[o,s]of Object.entries(e)){const e={...s},i=s.doc_id;i&&(e.doc=(0,h.p)(_,i)),null!==s.name&&0!==s.name.trim().length||(e.name=s.email?s.email.trim():"Anonymous"),e.initial=s.name?.[0],e.initial&&" "!==e.initial||(e.initial="?"),n.push(e),t[o]=e,null!=i&&null!=s.row&&null!=s.column&&(r[i]||(r[i]=[]),r[i].push({label:s.name,cursor:{row:s.row,column:s.column},hue:a.A.getHueForUserId(s.user_id)}))}return{onlineUsers:t,onlineUsersArray:n,onlineUserCursorHighlights:r,cursorUpdateInterval:n.length>0?500:3e5}}),[_]),A=(0,r.useCallback)((e=>{const t=L(e);v(t.onlineUsers),k(t.onlineUsersArray),T(t.onlineUsersArray.length),y(t.onlineUserCursorHighlights),S(t.cursorUpdateInterval)}),[L,y,v,k,T]);(0,r.useEffect)((()=>{const e=()=>{g.emit("clientTracking.getConnectedUsers",((e,t)=>{if(e)return void u.$.error(e);const n={};for(const e of t)e.client_id!==g.publicId&&(n[e.client_id]={id:e.client_id,user_id:e.user_id,email:e.email,name:`${e.first_name} ${e.last_name}`,doc_id:e.cursorData?.doc_id,row:e.cursorData?.row,column:e.cursorData?.column});A(n)}))};return n.on("project:joined",e),()=>{n.off("project:joined",e)}}),[n,A,v,g]),(0,r.useEffect)((()=>{const e=e=>{let{detail:[t]}=e;t&&C(t)};return n.on("cursor:editor:update",e),()=>{n.off("cursor:editor:update",e)}}),[I,n]),(0,r.useEffect)((()=>{const e=window.setTimeout((()=>{g.emit("clientTracking.updatePosition",{row:j?.row,column:j?.column,doc_id:f})}),I);return()=>{window.clearTimeout(e)}}),[j,I,f,g]);const O=(0,r.useCallback)((e=>{e.id!==g.publicId&&A({...w,[e.id]:e})}),[w,A,g.publicId]);(0,d.A)(g,"clientTracking.clientUpdated",O);const R=(0,r.useCallback)((e=>{A((0,c.omit)(w,e))}),[w,A]);(0,d.A)(g,"clientTracking.clientDisconnected",R);const M=(0,r.useMemo)((()=>({onlineUsers:w,onlineUsersArray:x,onlineUserCursorHighlights:b,onlineUsersCount:E})),[w,x,b,E]);return(0,p.jsx)(m.Provider,{value:M,children:t})};function _(){const e=(0,r.useContext)(m);if(!e)throw new Error("useOnlineUsersContext is only available inside OnlineUsersProvider");return e}},54830:(e,t,n)=>{"use strict";n.d(t,{X:()=>g,i:()=>p});n(16280);var r=n(14041),o=n(37766),s=n(89139),i=n(5964),a=n(14936),c=n(82671),l=n(83566),h=n(66666),d=n(31085);const u=(0,r.createContext)(void 0),p=e=>{let{children:t}=e;const[n,p]=(0,r.useState)(void 0),[g,f]=(0,r.useState)(-1),[_,w]=(0,r.useState)(!1),[v,b]=(0,r.useState)(!1),[y,x]=(0,r.useState)(!1),k=(0,o.A)("editor:gotoLine",!0);(0,s.A)("file-view:file-opened",(0,r.useCallback)((e=>{w(!0)}),[])),(0,s.A)("scroll:editor:update",(0,r.useCallback)((e=>{y?x(!1):f(e.detail+1)}),[y])),(0,s.A)("cursor:editor:update",(0,r.useCallback)((e=>{v?b(!1):f(e.detail.row+1)}),[v])),(0,s.A)("doc:after-opened",(0,r.useCallback)((e=>{e.detail.isNewDoc&&b(!0),w(!1),x(!0)}),[]));const E=(0,r.useCallback)(((e,t)=>{x(!0),k(e,0,t),i._("outline-jump-to-line")}),[k]),T=(0,r.useMemo)((()=>m(n?.items,g)),[n,g]),[j]=(0,a.A)("editor.open_doc_name"),C=(0,r.useMemo)((()=>!!j&&(0,c.A)(j)),[j]),{_id:I}=(0,h.O)(),S=`file_outline.expanded.${I}`,[L,A]=(0,r.useState)((()=>!1!==l.A.getItem(S))),O=C&&!_,R=(0,r.useCallback)((()=>{O&&(l.A.setItem(S,!L),i._(L?"outline-collapse":"outline-expand"),A(!L))}),[O,L,S]),M=(0,r.useMemo)((()=>({flatOutline:n,setFlatOutline:p,highlightedLine:T,jumpToLine:E,canShowOutline:O,outlineExpanded:L,toggleOutlineExpanded:R})),[n,T,E,O,L,R]);return(0,d.jsx)(u.Provider,{value:M,children:t})},g=()=>{const e=(0,r.useContext)(u);if(!e)throw new Error("useOutlineProvider is only available inside OutlineProvider");return e},m=(e,t)=>{if(!e)return-1;let n=-1;for(const r of e){if(r.line>t)return n;n=r.line}return n}},58516:(e,t,n)=>{"use strict";n.d(t,{Tg:()=>m,wy:()=>g});n(16280);var r=n(14041),o=n(12391),s=n(10646),i=n(64932),a=n(14936),c=n(5805),l=n(31085);const h=(0,r.createContext)(void 0),d={readOnly:{read:!0,write:!1,admin:!1,comment:!0},readAndWrite:{read:!0,write:!0,admin:!1,comment:!0},owner:{read:!0,write:!0,admin:!0,comment:!0}},u={readOnly:{...d.readOnly,comment:!1},readAndWrite:{...d.readAndWrite,comment:!1},owner:{...d.owner,comment:!1}},p={readOnly:{...d.readOnly,comment:!1},readAndWrite:d.readAndWrite,owner:d.owner},g=e=>{let{children:t}=e;const[n,g]=(0,a.A)("permissions"),{connectionState:m}=(0,o.FX)(),{permissionsLevel:f}=(0,s.mi)(),_=(0,c.A)(),w=(0,i.A)("ol-anonymous");return(0,r.useEffect)((()=>{let e;e=_?p:w?u:d,g(e[f])}),[w,f,g,_]),(0,r.useEffect)((()=>{m.forceDisconnected&&g((e=>({...e,write:!1})))}),[m.forceDisconnected,g]),(0,l.jsx)(h.Provider,{value:n,children:t})};function m(){const e=(0,r.useContext)(h);if(!e)throw new Error("usePermissionsContext is only available inside PermissionsProvider");return e}},10228:(e,t,n)=>{"use strict";n.d(t,{F:()=>I});var r=n(12391),o=n(98125),s=n(56447),i=n(93588),a=n(66666),c=n(41416),l=n(10646),h=n(85960),d=n(77135),u=n(71573),p=n(8164),g=n(99806),m=n(71110),f=n(52036),_=n(13877),w=n(94012),v=n(17112),b=n(67603),y=n(89997),x=n(66020),k=n(58516),E=n(99115),T=n(54830),j=n(65982),C=n(31085);const I=e=>{let{children:t}=e;return(0,C.jsx)(v.M6,{children:(0,C.jsx)(b.B,{children:(0,C.jsx)(r.Sg,{children:(0,C.jsx)(o.HA,{children:(0,C.jsx)(h.vu,{children:(0,C.jsx)(x.wI,{children:(0,C.jsx)(a.N,{children:(0,C.jsx)(j.yg,{children:(0,C.jsx)(u._,{children:(0,C.jsx)(y.rL,{children:(0,C.jsx)(w.iH,{children:(0,C.jsx)(i.lt,{children:(0,C.jsx)(l.zz,{children:(0,C.jsx)(k.wy,{children:(0,C.jsx)(c.Gn,{children:(0,C.jsx)(s.UY,{children:(0,C.jsx)(d.al,{children:(0,C.jsx)(m.eS,{children:(0,C.jsx)(p.oG,{children:(0,C.jsx)(g.k_,{children:(0,C.jsx)(E.Q,{children:(0,C.jsx)(f.VH,{children:(0,C.jsx)(_.Xj,{children:(0,C.jsx)(T.i,{children:t})})})})})})})})})})})})})})})})})})})})})})})})}},94012:(e,t,n)=>{"use strict";n.d(t,{B4:()=>g,iH:()=>p});n(16280),n(43375),n(39225),n(13972),n(99209),n(25714),n(17561),n(66197);var r=n(5804),o=n(14041),s=n(98125),i=n(12391),a=n(37858),c=n(71573),l=n(41479),h=n(60961),d=n(31085);const u=(0,o.createContext)(void 0),p=e=>{let{children:t}=e;const{fileTreeData:n}=(0,c.Q)(),{eventEmitter:p,projectId:g}=(0,s.yn)(),{socket:m}=(0,i.FX)(),[f,_]=(0,o.useState)(new Set),[w,v]=(0,o.useState)({}),b=(0,o.useCallback)((e=>{(0,a.TB)(`/project/${g}/references/indexAll`,{body:{shouldBroadcast:e}}).then((e=>{_(new Set(e.keys))})).catch((e=>{h.$.error(e)}))}),[g]),y=(0,o.useCallback)(((e,t)=>{const n=e.doc_id,o=e._doc.snapshot,s=Date.now(),i=(0,r.V)("blob "+o.length+"\0"+o),a=w[n];a&&a.timestamp>s-216e5&&a.hash===i||(b(t),v((e=>({...e,[n]:{hash:i,timestamp:s}}))))}),[w,b]);(0,o.useEffect)((()=>{const e=e=>{let{detail:[t]}=e;t.doc_id&&(0,l.p)(n,t.doc_id)?.name?.endsWith(".bib")&&y(t,!0)};return p.on("document:closed",e),()=>{p.off("document:closed",e)}}),[p,n,y]),(0,o.useEffect)((()=>{const e=()=>{m.on("references:keys:updated",((e,t)=>{_((n=>t?new Set(e):new Set([...n,...e])))})),b(!1)};return p.once("project:joined",e),()=>{p.off("project:joined",e)}}),[p,b,m]);const x=(0,o.useMemo)((()=>({referenceKeys:f,indexAllReferences:b})),[b,f]);return(0,d.jsx)(u.Provider,{value:x,children:t})};function g(){const e=(0,o.useContext)(u);if(!e)throw new Error("useReferencesContext is only available inside ReferencesProvider");return e}},65982:(e,t,n)=>{"use strict";n.d(t,{CH:()=>c,P4:()=>u,yg:()=>d});n(16280);var r=n(22743),o=n(14041),s=n(66666),i=n(60961),a=n(31085);const c={SnapshotUpdater:class{constructor(e){this.projectId=e}refresh(){throw new Error("not implemented")}abort(){throw new Error("not implemented")}},buildFileTree(e){throw new Error("not implemented")},createFolder(e,t){throw new Error("not implemented")}},{SnapshotUpdater:l}=r||c,h=(0,o.createContext)(void 0),d=e=>{let{children:t}=e;const{_id:n}=(0,s.O)(),[r,c]=(0,o.useState)(""),[d]=(0,o.useState)((()=>new l(n))),[u,p]=(0,o.useState)(),[g,m]=(0,o.useState)(-1),[f,_]=(0,o.useState)(!1);(0,o.useEffect)((()=>{if(!f)return;let e,t=!1;const n=()=>{c("loading"),d.refresh().then((e=>{let{snapshot:t,snapshotVersion:n}=e;p(t),m(n),c("")})).catch((e=>{i.$.error(e),c("error")})).finally((()=>{t||(e=window.setTimeout(n,3e4))}))};return n(),()=>{t=!0,d.abort(),clearInterval(e)}}),[n,f,d]);const w=(0,o.useMemo)((()=>({snapshot:u,snapshotVersion:g,snapshotLoadingState:r,fileTreeFromHistory:f,setFileTreeFromHistory:_})),[u,g,r,f,_]);return(0,a.jsx)(h.Provider,{value:w,children:t})};function u(){const e=(0,o.useContext)(h);if(!e)throw new Error("useSnapshotContext is only available within SnapshotProvider");return e}},6599:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var r=n(14041);function o(e,t,n){(0,r.useEffect)((()=>(e.on(t,n),()=>{e.removeListener(t,n)})),[t,n,e])}},39891:(e,t,n)=>{"use strict";function r(e){const t=e.linkedFileData?.importedAt??e.created;return{_id:e._id,name:e.name,id:e._id,type:"file",selected:!0,linkedFileData:e.linkedFileData,created:t?new Date(t):new Date,hash:e.hash}}function o(e){const t=r(e);return{...t,created:t.created.toISOString()}}n.d(t,{D:()=>r,g:()=>o})},41479:(e,t,n)=>{"use strict";n.d(t,{p:()=>o});var r=n(79550);function o(e,t){const n=(0,r.lE)(e,t);return n&&"doc"===n.type?n.entity:null}},40802:(e,t,n)=>{"use strict";n.d(t,{Xq:()=>D,Yu:()=>X,c9:()=>N});var r=n(56447),o=(n(25440),n(48408),n(14603),n(47566),n(98721),n(53373)),s=n.n(o),i=n(14041),a=n(39067),c=n.n(a),l=n(67353),h=n(66666),d=n(37858),u=n(8164),p=n(14936),g=n(89135),m=n(97434),f=n(69475),_=n(52155),w=n(37939),v=n(94234),b=n(83566),y=n(71573),x=n(91542),k=n(5964),E=n(60961),T=n(89997),j=n(93075),C=n(71627),I=n(67993),S=n(96713),L=n(237),A=n(10009),O=n(31085);function R(e){let{position:t,syncToCode:n,syncToCodeInFlight:r,isDetachLayout:o}=e;const{t:i}=(0,m.Bd)(),a=o?"bottom":"right",c=s()("synctex-control",{"detach-synctex-control":!!o});let l=null;r?l=(0,O.jsx)(I.A,{bs3:(0,O.jsx)(g.A,{type:"refresh",spin:!0,className:"synctex-spin-icon"}),bs5:(0,O.jsx)(L.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"})}):o||(l=(0,O.jsx)(I.A,{bs3:(0,O.jsx)(g.A,{type:"arrow-left",className:"synctex-control-icon"}),bs5:(0,O.jsx)(S.A,{type:"arrow_left_alt",className:"synctex-control-icon"})}));return(0,O.jsx)(j.A,{id:"sync-to-code",description:i("go_to_pdf_location_in_code"),overlayProps:{placement:a},children:(0,O.jsxs)(C.A,{variant:"secondary",size:"sm",onClick:()=>{k._("jump-to-location",{direction:"pdf-location-in-code",method:"arrow"}),n(t,72)},disabled:r,className:c,"aria-label":i("go_to_pdf_location_in_code"),bs3Props:{bsSize:"xs"},children:[l,o?(0,O.jsxs)("span",{children:[" ",i("show_in_code")]}):""]})})}function M(e){let{cursorPosition:t,syncToPdf:n,syncToPdfInFlight:r,isDetachLayout:o,hasSingleSelectedDoc:i}=e;const{t:a}=(0,m.Bd)(),c=o?"bottom":"right",l=s()("synctex-control",(0,A.q$)({bs3:"toolbar-btn-secondary"}),{"detach-synctex-control":!!o});let h=null;return r?h=(0,O.jsx)(I.A,{bs3:(0,O.jsx)(g.A,{type:"refresh",spin:!0,className:"synctex-spin-icon"}),bs5:(0,O.jsx)(L.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"})}):o||(h=(0,O.jsx)(I.A,{bs3:(0,O.jsx)(g.A,{type:"arrow-right",className:"synctex-control-icon"}),bs5:(0,O.jsx)(S.A,{type:"arrow_right_alt",className:"synctex-control-icon"})})),(0,O.jsx)(j.A,{id:"sync-to-pdf",description:a("go_to_code_location_in_pdf"),overlayProps:{placement:c},children:(0,O.jsxs)(C.A,{variant:"secondary",size:"sm",onClick:()=>n(t),disabled:r||!t||!i,className:l,"aria-label":a("go_to_code_location_in_pdf"),bs3Props:{bsSize:"xs"},children:[h,o?(0,O.jsxs)("span",{children:[" ",a("show_in_pdf")]}):""]})})}function F(){const e=(0,l.nK)(),{_id:t,rootDocId:n}=(0,h.O)(),{detachRole:o}=(0,r.LV)(),{clsiServerId:s,pdfUrl:a,pdfViewer:c,position:g,setShowLogs:m,setHighlights:j}=(0,u.Rf)(),{selectedEntities:C}=(0,y.Q)(),{findEntityByPath:I,dirname:S,pathInFolder:L}=(0,T.m8)(),[A,F]=(0,i.useState)((()=>{const t=b.A.getItem(`doc.position.${e.editorManager.getCurrentDocId()}`);return t?t.cursorPosition:null})),P=(0,f.A)(),{signal:D}=(0,_.A)();(0,i.useEffect)((()=>{const e=e=>F(e.detail);return window.addEventListener("cursor:editor:update",e),()=>window.removeEventListener("cursor:editor:update",e)}),[e]);const[N,X]=(0,i.useState)(!1),[$,U]=(0,w.A)("sync-to-code-inflight",!1,"detacher","detached"),[,V]=(0,p.A)("sync_tex_error"),B=(0,i.useCallback)((()=>{const t=e.editorManager.getCurrentDocId();let r=L(t);const o=S(n);return o&&(r=r.replace(RegExp(`^${o}`),`${o}/.`)),r}),[S,e.editorManager,L,n]),W=(0,i.useCallback)(((t,n)=>{if(t){const r=I(t)?.entity;if(!r)return void E.$.warn(`Document with path ${t} not found`);e.editorManager.openDocId(r._id,{gotoLine:n})}else V(!0),window.setTimeout((()=>{P.current&&V(!1)}),4e3)}),[I,e.editorManager,P,V]),H=(0,i.useCallback)((e=>{X(!0),s&&(e+=`&clsiserverid=${s}`),(0,d.hm)(`/project/${t}/sync/code?${e}`,{signal:D}).then((e=>{m(!1),j(e.pdf)})).catch(E.$.error).finally((()=>{P.current&&X(!1)}))}),[s,P,t,m,j,X,D]),z=(0,i.useCallback)((e=>{const t=new URLSearchParams({file:B(),line:e.row+1,column:e.column}).toString();k._("jump-to-location",{direction:"code-location-in-pdf",method:"arrow"}),H(t)}),[B,H]),J=(0,i.useRef)(A);(0,i.useEffect)((()=>{J.current=A}),[A]);const q=(0,i.useCallback)((()=>{z(J.current)}),[z]);(0,x.A)("cursor:editor:syncToPdf",q);const K=(0,i.useCallback)((function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;U(!0);const r=e.offset.left;let o=0;e.pageSize?.height?o+=e.pageSize.height-e.offset.top:o+=e.offset.top,o+=n;const i=new URLSearchParams({page:e.page+1,h:r.toFixed(2),v:o.toFixed(2)});s&&i.set("clsiserverid",s),(0,d.hm)(`/project/${t}/sync/pdf?${i}`,{signal:D}).then((e=>{const[{file:t,line:n}]=e.code;W(t,n)})).catch(E.$.error).finally((()=>{P.current&&U(!1)}))}),[s,t,D,P,U,W]),G=(0,v.A)("sync-to-code",K,"detached","detacher");(0,i.useEffect)((()=>{const e=e=>G(e.detail);return window.addEventListener("synctex:sync-to-position",e),()=>{window.removeEventListener("synctex:sync-to-position",e)}}),[G]);const[Y,Q]=(0,w.A)("has-single-selected-doc",!1,"detacher","detached");return(0,i.useEffect)((()=>{1===C.length&&"doc"===C[0].type?Q(!0):Q(!1)}),[C,Q]),g&&a&&"native"!==c?"detacher"===o?(0,O.jsx)(O.Fragment,{children:(0,O.jsx)(M,{cursorPosition:A,syncToPdf:z,syncToPdfInFlight:N,isDetachLayout:!0,hasSingleSelectedDoc:Y})}):"detached"===o?(0,O.jsx)(O.Fragment,{children:(0,O.jsx)(R,{position:g,syncToCode:G,syncToCodeInFlight:$,isDetachLayout:!0})}):(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(M,{cursorPosition:A,syncToPdf:z,syncToPdfInFlight:N,hasSingleSelectedDoc:Y}),(0,O.jsx)(R,{position:g,syncToCode:G,syncToCodeInFlight:$})]}):null}const P=(0,i.memo)(F);function D(){const{detachRole:e}=(0,r.LV)();return e?null:(0,O.jsx)(P,{})}function N(){const{detachRole:e,detachIsLinked:t}=(0,r.LV)();return"detacher"===e&&t?(0,O.jsx)(P,{}):null}function X(){const{detachRole:e,detachIsLinked:t}=(0,r.LV)();return"detached"===e&&t?(0,O.jsx)(P,{}):null}R.propTypes={isDetachLayout:c().bool,position:c().object.isRequired,syncToCode:c().func.isRequired,syncToCodeInFlight:c().bool.isRequired},M.propTypes={cursorPosition:c().object,isDetachLayout:c().bool,syncToPdf:c().func.isRequired,syncToPdfInFlight:c().bool.isRequired,hasSingleSelectedDoc:c().bool.isRequired}},11796:(e,t,n)=>{"use strict";n.d(t,{A:()=>l});var r=n(39067),o=n.n(r),s=n(97434),i=n(45330),a=n(31085);function c(e){let{type:t}=e;const{t:n}=(0,s.Bd)(),r=(0,a.jsx)(s.x6,{i18nKey:"try_recompile_project_or_troubleshoot",components:[(0,a.jsx)("a",{href:"/learn/how-to/Resolving_access%2C_loading%2C_and_display_problems",target:"_blank"},"troubleshooting-link")]});switch(t){case"pdf":return(0,a.jsxs)(i.j,{children:[(0,a.jsx)("p",{children:n("pdf_viewer_error")}),(0,a.jsx)("p",{children:r})]});case"logs":return(0,a.jsxs)(i.j,{children:[(0,a.jsx)("p",{children:n("log_viewer_error")}),(0,a.jsx)("p",{children:r})]});default:return(0,a.jsxs)(i.j,{children:[(0,a.jsx)("p",{children:n("pdf_preview_error")}),(0,a.jsx)("p",{children:r})]})}}c.propTypes={type:o().oneOf(["preview","pdf","logs"]).isRequired};const l=c},63815:(e,t,n)=>{"use strict";n.d(t,{J:()=>i,K:()=>a});n(16280);var r=n(14041),o=n(31085);const s=(0,r.createContext)(void 0),i=()=>{const e=(0,r.useContext)(s);if(!e)throw new Error("usePdfPreviewContext is only avalable inside PdfPreviewProvider");return e},a=e=>{let{children:t}=e;const[n,i]=(0,r.useState)(!1),a=(0,r.useMemo)((()=>({loadingError:n,setLoadingError:i})),[n]);return(0,o.jsx)(s.Provider,{value:a,children:t})}},76966:(e,t,n)=>{"use strict";n.d(t,{A:()=>xt});var r={};n.r(r),n.d(r,{default:()=>p});var o={};n.r(o),n.d(o,{default:()=>L});var s={};n.r(s),n.d(s,{default:()=>ve});var i=n(14041),a=n(71627),c=n(79953),l=n(97434),h=n(83566),d=n(31085);const u=()=>{const{t:e}=(0,l.Bd)(),[t,n]=(0,i.useState)(!1),r=()=>{h.A.setItem("has_dismissed_ai_errors_feedback",!0),n(!0)},o=h.A.getItem("has_dismissed_ai_errors_feedback")||t,s=h.A.getItem("ai_error_assistant_usage");if(!(!o&&s>=5))return null;const u=(0,d.jsx)(a.A,{variant:"secondary",href:"https://docs.google.com/forms/d/e/1FAIpQLSdo3QEilLyOAGS5-6n9IiO39P6pOQrPZrii6irULWJc22V4hw/viewform",target:"blank",onClick:r,children:e("give_feedback")}),p=(0,d.jsx)("div",{children:e("fill_in_our_quick_survey")});return(0,d.jsx)("div",{className:"mx-3 hidden-xs-container",children:(0,d.jsx)(c.A,{type:"info",action:u,isDismissible:!0,title:e("what_do_you_think_of_the_ai_error_assistant"),content:p,onDismiss:r})})},p=(0,i.memo)(u);var g=n(53373),m=n.n(g),f=n(39067),_=n.n(f);const w=function(e,t,n){const r=(0,i.useRef)(),o=(0,i.useCallback)((()=>{r.current=new ResizeObserver((function(e){n(e[0])}))}),[n]);(0,i.useLayoutEffect)((()=>{if("ResizeObserver"in window){const t=e&&e.current;return t&&o(e.current),r.current&&t&&r.current.observe(t),()=>{t&&function(e){r.current.unobserve(e)}(t)}}}),[e,t,o])};var v=n(93075),b=n(89135),y=n(67993),x=n(96713);function k(e){let{sourceLocation:t,level:n,headerTitle:r,headerIcon:o,logType:s,showSourceLocationLink:c=!0,showCloseButton:h=!1,onSourceLocationClick:u,onClose:p}=e;const{t:g}=(0,l.Bd)(),f=(0,i.useRef)(),[_,k]=(0,i.useState)(!1);w(f,_,(function(e){const t=e.target,n=t.scrollWidth>t.clientWidth;k(n)}));const E=t?t.file:null,T=t?t.line:null,j=m()("log-entry-header",{"log-entry-header-error":"error"===n,"log-entry-header-warning":"warning"===n,"log-entry-header-info":"info"===n,"log-entry-header-typesetting":"typesetting"===n,"log-entry-header-raw":"raw"===n,"log-entry-header-success":"success"===n}),C=m()("log-entry-header-link",{"log-entry-header-link-error":"error"===n,"log-entry-header-link-warning":"warning"===n,"log-entry-header-link-typesetting":"typesetting"===n,"log-entry-header-link-raw":"raw"===n,"log-entry-header-link-info":"info"===n,"log-entry-header-link-success":"success"===n}),I=g("navigate_log_source",{location:E+(T?`, ${T}`:"")});const S=c&&E?`${E}${T?`, ${T}`:""}`:null,L=S?(0,d.jsxs)(a.A,{variant:"ghost",className:C,"aria-label":I,onClick:u,children:[(0,d.jsx)(y.A,{bs3:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(b.A,{type:"chain"})," "]}),bs5:(0,d.jsx)(x.A,{type:"link"})}),(0,d.jsx)("span",{ref:f,className:"log-entry-header-link-location",children:`‪${S}‬`})]}):null,A=s?`${s} ${r}`:r;return(0,d.jsxs)("header",{className:j,children:[o?(0,d.jsx)("div",{className:"log-entry-header-icon-container",children:o}):null,(0,d.jsx)("h3",{className:"log-entry-header-title",children:A}),_&&S?(0,d.jsx)(v.A,{id:S,description:S,overlayProps:{placement:"left"},tooltipProps:{className:"log-location-tooltip"},children:L}):L,h?(0,d.jsx)(a.A,{variant:"link",className:"btn-inline-link log-entry-header-link","aria-label":g("dismiss_error_popup"),onClick:p,children:(0,d.jsx)("span",{"aria-hidden":"true",children:"×"})}):null]})}k.propTypes={sourceLocation:_().shape({file:_().string,line:_().any,column:_().any}),level:_().string.isRequired,headerTitle:_().oneOfType([_().string,_().node]),headerIcon:_().element,logType:_().string,showSourceLocationLink:_().bool,showCloseButton:_().bool,onSourceLocationClick:_().func,onClose:_().func};const E=k;var T=n(64932),j=n(14936);const C=(0,i.lazy)((()=>Promise.all([n.e(3173),n.e(982)]).then(n.bind(n,44102)))),I={raw:!1,warning:!0,error:!0,typesetting:!1},S=e=>{let{index:t,logEntry:n}=e;const[r]=(0,j.A)("editor.view");return r&&(0,T.A)("ol-showAiErrorAssistant")&&n.level&&I[n.level]&&n.raw?(0,d.jsx)(i.Suspense,{fallback:null,children:(0,d.jsx)(C,{index:t,logEntry:n,view:r})}):null},L=(0,i.memo)(S);var A=n(68273);function O(e){let{rawContent:t,collapsedSize:n=0}=e;const[r,o]=(0,i.useState)(!1),[s,c]=(0,i.useState)(!0),{elementRef:h}=(0,A.w)((0,i.useCallback)((e=>{0!==e.scrollHeight&&c(e.scrollHeight>n)}),[n])),{t:u}=(0,l.Bd)();return(0,d.jsxs)("div",{className:"log-entry-content-raw-container",children:[(0,d.jsx)("div",{className:"expand-collapse-container",style:{height:r||!s?"auto":n},children:(0,d.jsx)("pre",{className:"log-entry-content-raw",ref:h,children:t.trim()})}),s&&(0,d.jsx)("div",{className:m()("log-entry-content-button-container",{"log-entry-content-button-container-collapsed":!r}),children:(0,d.jsx)(a.A,{variant:"secondary",size:"sm",bs3Props:{bsSize:"xsmall",className:"log-entry-btn-expand-collapse"},onClick:()=>o((e=>!e)),children:r?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(b.A,{type:"angle-up"})," ",u("collapse")]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(b.A,{type:"angle-down"})," ",u("expand")]})})})]})}O.propTypes={rawContent:_().string.isRequired,collapsedSize:_().number};const R=[{import:o,path:"/overleaf/services/web/modules/ai/frontend/js/components/ai-error-assistant"}];function M(e){let{rawContent:t,formattedContent:n,extraInfoURL:r,index:o,logEntry:s}=e;const{t:i}=(0,l.Bd)();return(0,d.jsxs)("div",{className:"log-entry-content",children:[n&&(0,d.jsx)("div",{className:"log-entry-formatted-content",children:n}),r&&(0,d.jsx)("div",{className:"log-entry-content-link",children:(0,d.jsx)("a",{href:r,target:"_blank",rel:"noopener",children:i("log_hint_extra_info")})}),s&&R.map((e=>{let{import:{default:t},path:n}=e;return(0,d.jsx)(t,{index:o,logEntry:s},n)})),t&&(0,d.jsx)(O,{rawContent:t,collapsedSize:150})]})}M.propTypes={rawContent:_().string,formattedContent:_().node,extraInfoURL:_().string,index:_().number,logEntry:_().any};var F=n(71606);function P(e){let{url:t,children:n}=e;return(0,T.A)("ol-wikiEnabled")?(0,d.jsx)("a",{href:t,target:"_blank",rel:"noopener",children:n}):(0,d.jsx)(d.Fragment,{children:n})}P.propTypes={url:_().string.isRequired,children:_().node.isRequired};const D={hint_misplaced_alignment_tab_character:{extraInfoURL:"https://www.overleaf.com/learn/Errors/Misplaced_alignment_tab_character_%26",formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["You have placed an alignment tab character '&' in the wrong place. If you want to align something, you must write it inside an align environment such as \\begin","{align}"," … \\end","{align}",", \\begin","{tabular}"," … \\end","{tabular}",", etc. If you want to write an ampersand '&' in text, you must write \\& instead."]})},hint_extra_alignment_tab_has_been_changed:{extraInfoURL:"https://www.overleaf.com/learn/Errors/Extra_alignment_tab_has_been_changed_to_%5Ccr",formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["You have written too many alignment tabs in a table, causing one of them to be turned into a line break. Make sure you have specified the correct number of columns in your"," ",(0,d.jsx)(P,{url:"https://www.overleaf.com/learn/Tables",children:"table"}),"."]})},hint_display_math_should_end_with:{extraInfoURL:"https://www.overleaf.com/learn/Errors/Display_math_should_end_with_$$",formattedContent:()=>(0,d.jsx)(d.Fragment,{children:"You have forgotten a $ sign at the end of 'display math' mode. When writing in display math mode, you must always math write inside $$ … $$. Check that the number of $s match around each math expression."})},hint_missing_inserted:{extraInfoURL:"https://www.overleaf.com/learn/Errors/Missing_$_inserted",formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("p",{children:"You need to enclose all mathematical expressions and symbols with special markers. These special markers create a ‘math mode’."}),(0,d.jsxs)("p",{children:["Use ",(0,d.jsx)("code",{children:"$...$"})," for inline math mode, and ",(0,d.jsx)("code",{children:"\\[...\\]"}),"or one of the mathematical environments (e.g. equation) for display math mode."]}),(0,d.jsxs)("p",{children:["This applies to symbols such as subscripts ( ",(0,d.jsx)("code",{children:"_"})," ), integrals ( ",(0,d.jsx)("code",{children:"\\int"})," ), Greek letters ( ",(0,d.jsx)("code",{children:"\\alpha"}),","," ",(0,d.jsx)("code",{children:"\\beta"}),", ",(0,d.jsx)("code",{children:"\\delta"})," ) and modifiers"," ",(0,d.jsx)("code",{children:"(\\vec{x}"}),", ",(0,d.jsxs)("code",{children:["\\tilde{x}",")"]}),"."]})]})},hint_reference_undefined:{extraInfoURL:"https://www.overleaf.com/learn/Errors/There_were_undefined_references",formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["You have referenced something which has not yet been labelled. If you have labelled it already, make sure that what is written inside \\ref","{...}"," is the same as what is written inside \\label","{...}","."]})},hint_there_were_undefined_references:{extraInfoURL:"https://www.overleaf.com/learn/Errors/There_were_undefined_references",formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["You have referenced something which has not yet been labelled. If you have labelled it already, make sure that what is written inside \\ref","{...}"," is the same as what is written inside \\label","{...}","."]})},hint_citation_on_page_undefined_on_input_line:{extraInfoURL:"https://www.overleaf.com/learn/Errors/Citation_XXX_on_page_XXX_undefined_on_input_line_XXX",formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["You have cited something which is not included in your bibliography. Make sure that the citation (\\cite","{...}",") has a corresponding key in your bibliography, and that both are spelled the same way."]})},hint_label_multiply_defined_labels:{extraInfoURL:"https://www.overleaf.com/learn/Errors/There_were_multiply-defined_labels",formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["You have used the same label more than once. Check that each \\label","{...}"," labels only one item."]})},hint_float_specifier_changed:{extraInfoURL:"https://www.overleaf.com/learn/Errors/%60!h%27_float_specifier_changed_to_%60!ht%27",formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["The float specifier 'h' is too strict of a demand for LaTeX to place your float in a nice way here. Try relaxing it by using 'ht', or even 'htbp' if necessary. If you want to try keep the float here anyway, check out the"," ",(0,d.jsx)(P,{url:"https://www.overleaf.com/learn/Positioning_of_Figures",children:"float package"}),"."]})},hint_no_positions_in_optional_float_specifier:{extraInfoURL:"https://www.overleaf.com/learn/Errors/No_positions_in_optional_float_specifier",formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["You have forgotten to include a float specifier, which tells LaTeX where to position your figure. To fix this, either insert a float specifier inside the square brackets (e.g. \\begin","{figure}","[h]), or remove the square brackets (e.g. \\begin","{figure}","). Find out more about float specifiers"," ",(0,d.jsx)(P,{url:"https://www.overleaf.com/learn/Positioning_of_Figures",children:"here"}),"."]})},hint_undefined_control_sequence:{formattedContent:e=>{if(e?.length&&F.H.has(e[0])){const t=e[0],n=F.H.get(t);return(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)("p",{children:["We think you’ve got a missing package! The ",(0,d.jsx)("code",{children:t})," ","command won't work unless you include",(0,d.jsx)("code",{children:n.command})," in your"," ",(0,d.jsx)(P,{url:"https://www.overleaf.com/learn/latex/Learn_LaTeX_in_30_minutes#The_preamble_of_a_document",children:"document preamble"}),"."," ",(0,d.jsx)(P,{url:"https://www.overleaf.com/learn/latex/Learn_LaTeX_in_30_minutes#Finding_and_using_LaTeX_packages",children:"Learn more about packages"}),"."]})})}return(0,d.jsxs)(d.Fragment,{children:["The compiler is having trouble understanding a command you have used. Check that the command is spelled correctly. If the command is part of a package, make sure you have included the package in your preamble using ",(0,d.jsx)("code",{children:"\\usepackage"}),"{...}",".",(0,d.jsx)("div",{className:"log-entry-content-link",children:(0,d.jsx)("a",{href:"https://www.overleaf.com/learn/Errors/Undefined_control_sequence",target:"_blank",rel:"noopener",children:"Learn more"})})]})}},hint_undefined_environment:{formattedContent:e=>{if(e?.length&&F.P.has(e[0])){const t=e[0],n=F.P.get(t);return(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)("p",{children:["We think you’ve got a missing package! The"," ",(0,d.jsx)("code",{children:t})," environment won't work unless you include ",(0,d.jsx)("code",{children:n.command})," in your"," ",(0,d.jsx)(P,{url:"https://www.overleaf.com/learn/latex/Learn_LaTeX_in_30_minutes#The_preamble_of_a_document",children:"document preamble"}),"."," ",(0,d.jsx)(P,{url:"https://www.overleaf.com/learn/latex/Learn_LaTeX_in_30_minutes#Finding_and_using_LaTeX_packages",children:"Learn more about packages"}),"."]})})}return(0,d.jsxs)(d.Fragment,{children:["You have created an environment (using \\begin","{…}"," and \\end","{…}"," commands) which is not recognized. Make sure you have included the required package for that environment in your preamble, and that the environment is spelled correctly.",(0,d.jsx)("div",{className:"log-entry-content-link",children:(0,d.jsx)("a",{href:"https://www.overleaf.com/learn/Errors%2FLaTeX%20Error%3A%20Environment%20XXX%20undefined",target:"_blank",rel:"noopener",children:"Learn more"})})]})}},hint_file_not_found:{extraInfoURL:"https://www.overleaf.com/learn/Errors/File_XXX_not_found_on_input_line_XXX",formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["The compiler cannot find the file you want to include. Make sure that you have"," ",(0,d.jsx)(P,{url:"https://www.overleaf.com/learn/how-to/Including_images_on_Overleaf",children:"uploaded the file"})," ","and"," ",(0,d.jsx)(P,{url:"https://www.overleaf.com/learn/Errors/File_XXX_not_found_on_input_line_XXX.",children:"specified the file location correctly"}),"."]})},hint_unknown_graphics_extension:{extraInfoURL:"https://www.overleaf.com/learn/Errors/LaTeX_Error:_Unknown_graphics_extension:_.XXX",formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["The compiler does not recognise the file type of one of your images. Make sure you are using a"," ",(0,d.jsx)(P,{url:"https://www.overleaf.com/learn/Errors/LaTeX_Error:_Unknown_graphics_extension:_.gif.",children:"supported image format"})," ","for your choice of compiler, and check that there are no periods (.) in the name of your image."]})},hint_unknown_float_option_h:{extraInfoURL:"https://www.overleaf.com/learn/Errors/LaTeX_Error:_Unknown_float_option_%60H%27",formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["The compiler isn't recognizing the float option 'H'. Include \\usepackage","{float}"," in your preamble to fix this."]})},hint_unknown_float_option_q:{extraInfoURL:"https://www.overleaf.com/learn/Errors/LaTeX_Error:_Unknown_float_option_%60q%27",formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["You have used a float specifier which the compiler does not understand. You can learn more about the different float options available for placing figures"," ",(0,d.jsx)(P,{url:"https://www.overleaf.com/learn/Positioning_of_Figures",children:"here"})," ","."]})},hint_math_allowed_only_in_math_mode:{extraInfoURL:"https://www.overleaf.com/learn/Errors/LaTeX_Error:_%5Cmathrm_allowed_only_in_math_mode",formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["You have used a font command which is only available in math mode. To use this command, you must be in maths mode (E.g. $ … $ or \\begin","{math}"," … \\end","{math}","). If you want to use it outside of math mode, use the text version instead: \\textrm, \\textit, etc."]})},hint_mismatched_environment:{formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["You have used \\begin","{...}"," without a corresponding \\end","{...}","."]})},hint_mismatched_brackets:{formattedContent:()=>(0,d.jsx)(d.Fragment,{children:"You have used an open bracket without a corresponding close bracket."})},hint_can_be_used_only_in_preamble:{extraInfoURL:"https://www.overleaf.com/learn/Errors/LaTeX_Error:_Can_be_used_only_in_preamble",formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["You have used a command in the main body of your document which should be used in the preamble. Make sure that \\documentclass[…]","{…}"," and all \\usepackage","{…}"," commands are written before \\begin","{document}","."]})},hint_missing_right_inserted:{extraInfoURL:"https://www.overleaf.com/learn/Errors/Missing_%5Cright_insertede",formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["You have started an expression with a \\left command, but have not included a corresponding \\right command. Make sure that your \\left and \\right commands balance everywhere, or else try using \\Biggl and \\Biggr commands instead as shown"," ",(0,d.jsx)(P,{url:"https://www.overleaf.com/learn/Errors/Missing_%5Cright_inserted",children:"here"}),"."]})},hint_double_superscript:{extraInfoURL:"https://www.overleaf.com/learn/Errors/Double_superscript",formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["You have written a double superscript incorrectly as a^b^c, or else you have written a prime with a superscript. Remember to include ","{and}"," ","when using multiple superscripts. Try a^","{b ^ c}"," instead."]})},hint_double_subscript:{extraInfoURL:"https://www.overleaf.com/learn/Errors/Double_subscript",formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["You have written a double subscript incorrectly as a_b_c. Remember to include ","{and}"," when using multiple subscripts. Try a_","{b_c}"," instead."]})},hint_no_author_given:{extraInfoURL:"https://www.overleaf.com/learn/Errors/No_%5Cauthor_given",formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["You have used the \\maketitle command, but have not specified any \\author. To fix this, include an author in your preamble using the \\author","{…}"," command."]})},hint_somethings_wrong_perhaps_a_missing_item:{extraInfoURL:"https://www.overleaf.com/learn/Errors/LaTeX_Error:_Something%27s_wrong--perhaps_a_missing_%5Citem",formattedContent:()=>(0,d.jsx)(d.Fragment,{children:"There are no entries found in a list you have created. Make sure you label list entries using the \\item command, and that you have not used a list inside a table."})},hint_misplaced_noalign:{extraInfoURL:"https://www.overleaf.com/learn/Errors/Misplaced_%5Cnoalign",formattedContent:()=>(0,d.jsx)(d.Fragment,{children:"You have used a \\hline command in the wrong place, probably outside a table. If the \\hline command is written inside a table, try including \\\\ before it."})},hint_no_line_here_to_end:{extraInfoURL:"https://www.overleaf.com/learn/Errors/LaTeX_Error:_There%27s_no_line_here_to_end",formattedContent:()=>(0,d.jsx)(d.Fragment,{children:"You have used a \\\\ or \\newline command where LaTeX was not expecting one. Make sure that you only use line breaks after blocks of text, and be careful using linebreaks inside lists and other environments."})},hint_verb_ended_by_end_of_line:{extraInfoURL:"https://www.overleaf.com/learn/Errors/LaTeX_Error:_%5Cverb_ended_by_end_of_line",formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["You have used a \\verb command incorrectly. Try replacling the \\verb command with \\begin","{verbatim}","…\\end","{verbatim}",".\\"]})},hint_illegal_unit_of_measure_pt_inserted:{extraInfoURL:"https://www.overleaf.com/learn/Errors%2FIllegal%20unit%20of%20measure%20(pt%20inserted)",formattedContent:()=>(0,d.jsx)(d.Fragment,{children:"You have written a length, but have not specified the appropriate units (pt, mm, cm etc.). If you have not written a length, check that you have not witten a linebreak \\\\ followed by square brackets […] anywhere."})},hint_extra_right:{extraInfoURL:"https://www.overleaf.com/learn/Errors/Extra_%5Cright",formattedContent:()=>(0,d.jsx)(d.Fragment,{children:"You have written a \\right command without a corresponding \\left command. Check that all \\left and \\right commands balance everywhere."})},hint_missing_begin_document_:{extraInfoURL:"https://www.overleaf.com/learn/Errors%2FLaTeX%20Error%3A%20Missing%20%5Cbegin%20document",formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["No \\begin","{document}"," command was found. Make sure you have included \\begin","{document}"," in your preamble, and that your main document is set correctly."]})},hint_mismatched_environment2:{formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["You have used \\begin","{}"," without a corresponding \\end","{}","."]})},hint_mismatched_environment3:{formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["You have used \\begin","{}"," without a corresponding \\end","{}","."]})},hint_mismatched_environment4:{formattedContent:()=>(0,d.jsxs)(d.Fragment,{children:["You have used \\begin","{}"," without a corresponding \\end","{}","."]})}};Object.keys(D);(0,T.A)("ol-wikiEnabled")||Object.keys(D).forEach((e=>{D[e].extraInfoURL=null}));const N=D;var X=n(5964);function $(e){let{ruleId:t,headerTitle:n,headerIcon:r,rawContent:o,logType:s,formattedContent:a,extraInfoURL:c,level:l,sourceLocation:h,showSourceLocationLink:u=!0,showCloseButton:p=!1,entryAriaLabel:g=null,customClass:f,contentDetails:_,onSourceLocationClick:w,onClose:v,index:b,logEntry:y,id:x}=e;const k=(0,T.A)("ol-showAiErrorAssistant");if(t&&N[t]){const e=N[t];a=e.formattedContent(_),c=e.extraInfoURL}const j=(0,i.useCallback)((e=>{e.preventDefault(),w(h);const n=h?.file?.split("."),r=n?.length>1?n.pop():"";(0,X._)("log-entry-link-click",{level:l,ruleId:t,extension:r})}),[l,w,t,h]);return(0,d.jsxs)("div",{className:m()("log-entry",f),"aria-label":g,"data-ruleid":t,"data-log-entry-id":x,children:[(0,d.jsx)(E,{level:l,sourceLocation:h,headerTitle:n,headerIcon:r,logType:s,showSourceLocationLink:u,onSourceLocationClick:j,showCloseButton:p,onClose:v}),(o||a||k)&&(0,d.jsx)(M,{rawContent:o,formattedContent:a,extraInfoURL:c,index:b,logEntry:y})]})}$.propTypes={ruleId:_().string,sourceLocation:E.propTypes.sourceLocation,headerTitle:E.propTypes.headerTitle,headerIcon:_().element,rawContent:_().string,logType:_().string,formattedContent:_().node,extraInfoURL:_().string,level:_().oneOf(["error","warning","info","typesetting","raw","success"]).isRequired,customClass:_().string,showSourceLocationLink:_().bool,showCloseButton:_().bool,entryAriaLabel:_().string,contentDetails:_().arrayOf(_().string),onSourceLocationClick:_().func,onClose:_().func,index:_().number,logEntry:_().any,id:_().string};const U=(0,i.memo)($);function V(e){let{issue:t,name:n}=e;const{t:r}=(0,l.Bd)();switch(n){case"sizeCheck":return(0,d.jsx)(U,{headerTitle:r("project_too_large"),formattedContent:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{children:r("project_too_large_please_reduce")}),(0,d.jsx)("ul",{className:"list-no-margin-bottom",children:t.resources.map((e=>(0,d.jsxs)("li",{children:[e.path," — ",e.kbSize,"kb"]},e.path)))})]}),entryAriaLabel:r("validation_issue_entry_description"),level:"error"});case"conflictedPaths":return(0,d.jsx)(U,{headerTitle:r("conflicting_paths_found"),formattedContent:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{children:r("following_paths_conflict")}),(0,d.jsx)("ul",{className:"list-no-margin-bottom",children:t.map((e=>(0,d.jsxs)("li",{children:["/",e.path]},e.path)))})]}),entryAriaLabel:r("validation_issue_entry_description"),level:"error"});case"mainFile":return(0,d.jsx)(U,{headerTitle:r("main_file_not_found"),formattedContent:r("please_set_main_file"),entryAriaLabel:r("validation_issue_entry_description"),level:"error"});default:return null}}V.propTypes={name:_().string.isRequired,issue:_().any};const B=(0,i.memo)(V);var W=n(8164),H=n(66666);function useStopOnFirstError(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{eventSource:t}=e,{stopOnFirstError:n,setStopOnFirstError:r}=(0,W.Rf)(),{_id:o}=(0,H.O)(),s=(0,i.useCallback)((()=>{if(!n){const e={projectId:o};t&&(e.source=t),X._("stop-on-first-error-enabled",e)}r(!0)}),[t,o,n,r]),a=(0,i.useCallback)((()=>{const e={projectId:o};t&&(e.source=t),n&&X._("stop-on-first-error-disabled",e),r(!1)}),[t,o,n,r]);return{enableStopOnFirstError:s,disableStopOnFirstError:a}}function z(){const{t:e}=(0,l.Bd)(),{startCompile:t,setAnimateCompileDropdownArrow:n}=(0,W.Rf)(),{disableStopOnFirstError:r}=useStopOnFirstError({eventSource:"logs-pane"}),o=(0,i.useCallback)((()=>{r(),t({stopOnFirstError:!1}),n(!0)}),[r,t,n]);return(0,d.jsx)(U,{headerTitle:e("stop_on_first_error_enabled_title"),formattedContent:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(l.x6,{i18nKey:"stop_on_first_error_enabled_description",components:[(0,d.jsx)("strong",{})]})," ",(0,d.jsx)(a.A,{variant:"info",size:"sm",onClick:o,bs3Props:{bsSize:"xsmall"},children:e("disable_stop_on_first_error")})]}),level:"info"})}var J=n(4607),q=n(17112);function K(){const{startCompile:e,lastCompileOptions:t,setAnimateCompileDropdownArrow:n,isProjectOwner:r}=(0,W.Rf)(),{enableStopOnFirstError:o}=useStopOnFirstError({eventSource:"timeout-new"}),s=(0,i.useCallback)((()=>{o(),e({stopOnFirstError:!0}),n(!0)}),[o,e,n]);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(G,{isProjectOwner:r}),(0,T.A)("ol-ExposedSettings").enableSubscriptions&&(0,d.jsx)(Y,{handleEnableStopOnFirstErrorClick:s,lastCompileOptions:t,isProjectOwner:r})]})}const G=(0,i.memo)((function(e){let{isProjectOwner:t}=e;const{t:n}=(0,l.Bd)(),r=(0,q.u)("paywall-cta");return(0,d.jsx)(U,{headerTitle:n("your_compile_timed_out"),formattedContent:(0,T.A)("ol-ExposedSettings").enableSubscriptions&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("p",{children:n(t?"your_project_exceeded_compile_timeout_limit_on_free_plan":"this_project_exceeded_compile_timeout_limit_on_free_plan")}),t?(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:n("upgrade_for_12x_more_compile_time")})," ",n("plus_additional_collaborators_document_history_track_changes_and_more")]}):(0,d.jsx)(l.x6,{i18nKey:"tell_the_project_owner_and_ask_them_to_upgrade",components:[(0,d.jsx)("strong",{})]}),t&&(0,d.jsx)("p",{className:"text-center",children:(0,d.jsx)(J.A,{source:"compile-timeout",buttonProps:{variant:"primary",className:"w-100"},children:n(r?"get_more_compile_time":"start_a_free_trial")})})]}),entryAriaLabel:n("your_compile_timed_out"),level:"error"})})),Y=(0,i.memo)((function(e){let{lastCompileOptions:t,handleEnableStopOnFirstErrorClick:n,isProjectOwner:r}=e;const{t:o}=(0,l.Bd)();const s=(0,d.jsx)("a",{"aria-label":o("read_more_about_free_compile_timeouts_servers"),href:"/blog/changes-to-free-compile-timeouts-and-servers",rel:"noopener noreferrer",target:"_blank",onClick:function(){X._("paywall-info-click",{"paywall-type":"compile-timeout",content:"blog"})}});return(0,d.jsx)(U,{headerTitle:o("reasons_for_compile_timeouts"),formattedContent:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("p",{children:[o("common_causes_of_compile_timeouts_include"),":"]}),(0,d.jsxs)("ul",{children:[(0,d.jsx)("li",{children:(0,d.jsx)(l.x6,{i18nKey:"large_or_high-resolution_images_taking_too_long",components:[(0,d.jsx)("a",{href:"/learn/how-to/Optimising_very_large_image_files",rel:"noopener noreferrer",target:"_blank"})]})}),(0,d.jsxs)("li",{children:[(0,d.jsx)(l.x6,{i18nKey:"a_fatal_compile_error_that_completely_blocks_compilation",components:[(0,d.jsx)("a",{href:"/learn/how-to/Fixing_and_preventing_compile_timeouts#Step_3:_Assess_your_project_for_time-consuming_tasks_and_fatal_errors",rel:"noopener noreferrer",target:"_blank"})]}),!t.stopOnFirstError&&(0,d.jsxs)(d.Fragment,{children:[" ",(0,d.jsx)(l.x6,{i18nKey:"enable_stop_on_first_error_under_recompile_dropdown_menu",components:[(0,d.jsx)(a.A,{variant:"link",className:"btn-inline-link fw-bold",size:"sm",onClick:n,bs3Props:{bsSize:"xsmall"}}),(0,d.jsx)("strong",{})]})," "]})]})]}),(0,d.jsx)("p",{children:(0,d.jsx)(l.x6,{i18nKey:"learn_more_about_other_causes_of_compile_timeouts",components:[(0,d.jsx)("a",{href:"/learn/how-to/Fixing_and_preventing_compile_timeouts",rel:"noopener noreferrer",target:"_blank"})]})}),(0,d.jsx)("p",{children:(0,d.jsx)("em",{children:(0,d.jsx)(d.Fragment,{children:r?(0,d.jsx)(l.x6,{i18nKey:"weve_recently_reduced_the_compile_timeout_limit_which_may_have_affected_your_project",components:[s]}):(0,d.jsx)(l.x6,{i18nKey:"weve_recently_reduced_the_compile_timeout_limit_which_may_have_affected_this_project",components:[s]})})})})]}),entryAriaLabel:o("reasons_for_compile_timeouts"),level:"raw"})})),Q=(0,i.memo)(K);n(3296),n(27208),n(48408),n(14603),n(47566),n(98721);function PdfPreviewError(e){let{error:t}=e;const{t:n}=(0,l.Bd)(),{startCompile:r}=(0,W.Rf)();switch(t){case"rendering-error-expected":return(0,d.jsx)(U,{headerTitle:n("pdf_rendering_error"),formattedContent:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(l.x6,{i18nKey:"something_went_wrong_rendering_pdf_expected",components:[(0,d.jsx)(a.A,{variant:"info",size:"sm",bs3Props:{bsSize:"xsmall"},onClick:()=>r()})]}),(0,d.jsx)("br",{}),(0,d.jsx)("br",{}),(0,d.jsx)(l.x6,{i18nKey:"last_resort_trouble_shooting_guide",components:[(0,d.jsx)("a",{href:"/learn/how-to/Resolving_access%2C_loading%2C_and_display_problems",target:"_blank"},"troubleshooting-link")]})]}),level:"warning"});case"rendering-error":return(0,d.jsxs)(ee,{title:n("pdf_rendering_error"),children:[n("something_went_wrong_rendering_pdf")," ",(0,d.jsx)(l.x6,{i18nKey:"try_recompile_project_or_troubleshoot",components:[(0,d.jsx)("a",{href:"/learn/how-to/Resolving_access%2C_loading%2C_and_display_problems",target:"_blank"},"troubleshooting-link")]}),(0,T.A)("ol-compilesUserContentDomain")&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("br",{}),(0,d.jsx)("br",{}),(0,d.jsx)(l.x6,{i18nKey:"new_compile_domain_notice",values:{compilesUserContentDomain:new URL((0,T.A)("ol-compilesUserContentDomain")).hostname},shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}},components:[(0,d.jsx)("code",{},"domain"),(0,d.jsx)("a",{href:"/learn/how-to/Resolving_access%2C_loading%2C_and_display_problems",target:"_blank"},"troubleshooting-link")]})]})]});case"clsi-maintenance":return(0,d.jsx)(ee,{title:n("server_error"),children:n("clsi_maintenance")});case"clsi-unavailable":return(0,d.jsx)(ee,{title:n("server_error"),children:n("clsi_unavailable")});case"too-recently-compiled":return(0,d.jsx)(ee,{title:n("server_error"),children:n("too_recently_compiled")});case"terminated":return(0,d.jsx)(ee,{title:n("terminated"),children:n("compile_terminated_by_user")});case"rate-limited":return(0,d.jsx)(ee,{title:n("pdf_compile_rate_limit_hit"),children:n("project_flagged_too_many_compiles")});case"compile-in-progress":return(0,d.jsx)(ee,{title:n("pdf_compile_in_progress_error"),children:n("pdf_compile_try_again")});case"auto-compile-disabled":return(0,d.jsx)(ee,{title:n("autocompile_disabled"),children:n("autocompile_disabled_reason")});case"project-too-large":return(0,d.jsx)(ee,{title:n("project_too_large"),children:n("project_too_much_editable_text")});case"timedout":return(0,d.jsx)(te,{});case"failure":return(0,d.jsxs)(ee,{title:n("no_pdf_error_title"),children:[n("no_pdf_error_explanation"),(0,d.jsxs)("ul",{className:"my-1 ps-3",children:[(0,d.jsx)("li",{children:n("no_pdf_error_reason_unrecoverable_error")}),(0,d.jsx)("li",{children:(0,d.jsx)(l.x6,{i18nKey:"no_pdf_error_reason_no_content",components:{code:(0,d.jsx)("code",{})}})}),(0,d.jsx)("li",{children:(0,d.jsx)(l.x6,{i18nKey:"no_pdf_error_reason_output_pdf_already_exists",components:{code:(0,d.jsx)("code",{})}})})]})]});case"clear-cache":case"error":default:return(0,d.jsx)(ee,{title:n("server_error"),children:n("somthing_went_wrong_compiling")});case"pdf-viewer-loading-error":return(0,d.jsx)(ee,{title:n("pdf_rendering_error"),children:(0,d.jsx)(l.x6,{i18nKey:"something_went_wrong_loading_pdf_viewer",components:[(0,d.jsx)("strong",{},"strong-"),(0,d.jsx)("a",{href:"/learn/how-to/Resolving_access%2C_loading%2C_and_display_problems",target:"_blank"},"troubleshooting-link"),(0,d.jsx)("a",{target:"_blank",href:"/contact"},"contact-link")]})});case"validation-problems":return null}}PdfPreviewError.propTypes={error:_().string.isRequired};const Z=(0,i.memo)(PdfPreviewError);function ee(e){let{title:t,headerIcon:n,children:r}=e;const{t:o}=(0,l.Bd)();return(0,d.jsx)(U,{headerTitle:t,headerIcon:n,formattedContent:r,entryAriaLabel:o("compile_error_entry_description"),level:"error"})}function te(){const{t:e}=(0,l.Bd)(),{enableStopOnFirstError:t}=useStopOnFirstError({eventSource:"timeout"}),{startCompile:n,lastCompileOptions:r,setAnimateCompileDropdownArrow:o}=(0,W.Rf)(),s=(0,i.useCallback)((()=>{t(),n({stopOnFirstError:!0}),o(!0)}),[t,n,o]);return(0,d.jsxs)(ee,{title:e("timedout"),children:[(0,d.jsx)("p",{children:e("project_timed_out_intro")}),(0,d.jsxs)("ul",{children:[(0,d.jsx)("li",{children:(0,d.jsx)(l.x6,{i18nKey:"project_timed_out_optimize_images",components:[(0,d.jsx)("a",{href:"https://www.overleaf.com/learn/how-to/Optimising_very_large_image_files"})]})}),(0,d.jsxs)("li",{children:[(0,d.jsx)(l.x6,{i18nKey:"project_timed_out_fatal_error",components:[(0,d.jsx)("a",{href:"https://www.overleaf.com/learn/how-to/Why_do_I_keep_getting_the_compile_timeout_error_message%3F#Fatal_compile_errors_blocking_the_compilation"})]}),!r.stopOnFirstError&&(0,d.jsxs)(d.Fragment,{children:[" ",(0,d.jsx)(l.x6,{i18nKey:"project_timed_out_enable_stop_on_first_error",components:[(0,d.jsx)(a.A,{variant:"info",size:"sm",bs3Props:{bsSize:"xsmall"},onClick:s})]})," "]})]})]}),(0,d.jsx)("p",{children:(0,d.jsx)(l.x6,{i18nKey:"project_timed_out_learn_more",components:[(0,d.jsx)("a",{href:"https://www.overleaf.com/learn/how-to/Why_do_I_keep_getting_the_compile_timeout_error_message%3F"})]})})]})}function ne(){const{compiling:e,clearCache:t,clearingCache:n}=(0,W.Rf)(),{t:r}=(0,l.Bd)();return(0,d.jsxs)(a.A,{size:"sm",variant:"danger",className:"logs-pane-actions-clear-cache",onClick:()=>t(),isLoading:n,disabled:n||e,leadingIcon:"delete",children:[(0,d.jsx)(y.A,{bs3:(0,d.jsxs)(d.Fragment,{children:[n?(0,d.jsx)(b.A,{type:"refresh",spin:!0}):(0,d.jsx)(b.A,{type:"trash-o"})," "]})}),(0,d.jsx)("span",{children:r("clear_cached_files")})]})}ee.propTypes={title:_().string.isRequired,headerIcon:_().element,children:_().any.isRequired},te.propTypes={};const re=(0,i.memo)(ne);var oe=n(42118),se=n(61160),ie=n(2439);function ae(e){let{fileList:t}=e;const{t:n}=(0,l.Bd)();if(!t)return null;function r(e){return e.path.split("/").pop()}return(0,d.jsx)(y.A,{bs3:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(ie.A,{header:!0,children:n("other_output_files")}),t.top.map((e=>(0,d.jsx)(ie.A,{download:r(e),href:e.url,children:(0,d.jsx)("b",{children:e.path})},e.path))),t.other.length>0&&t.top.length>0&&(0,d.jsx)(ie.A,{divider:!0}),t.other.map((e=>(0,d.jsx)(ie.A,{download:r(e),href:e.url,children:(0,d.jsx)("b",{children:e.path})},e.path))),t.archive?.fileCount&&t.archive?.fileCount>0&&(0,d.jsx)(ie.A,{download:r(t.archive),href:t.archive.url,children:(0,d.jsxs)("b",{children:[n("download_all")," (",t.archive.fileCount,")"]})})]}),bs5:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(se.hO,{children:n("other_output_files")}),t.top.map((e=>(0,d.jsx)("li",{role:"menuitem",children:(0,d.jsx)(se.tJ,{role:"link",download:r(e),href:e.url,children:e.path})},e.path))),t.other.length>0&&t.top.length>0&&(0,d.jsx)(se.rx,{divider:!0}),t.other.map((e=>(0,d.jsx)("li",{role:"menuitem",children:(0,d.jsx)(se.tJ,{role:"link",download:r(e),href:e.url,children:e.path})},e.path))),t.archive?.fileCount>0&&(0,d.jsx)("li",{role:"menuitem",children:(0,d.jsxs)(se.tJ,{role:"link",download:r(t.archive),href:t.archive.url,children:[n("download_all")," (",t.archive.fileCount,")"]})})]})})}const ce=_().arrayOf(_().shape({path:_().string.isRequired,url:_().string.isRequired}));ae.propTypes={fileList:_().shape({top:ce,other:ce,archive:_().shape({path:_().string.isRequired,url:_().string.isRequired,fileCount:_().number.isRequired})})};const le=(0,i.memo)(ae);var he=n(64526);function de(){const{compiling:e,fileList:t}=(0,W.Rf)(),{t:n}=(0,l.Bd)();return(0,d.jsx)(y.A,{bs3:(0,d.jsxs)(he.A,{id:"dropdown-files-logs-pane",dropup:!0,pullRight:!0,disabled:e||!t,children:[(0,d.jsx)(oe.A.Toggle,{className:"dropdown-toggle btn-secondary-info btn-secondary",title:n("other_logs_and_files"),bsSize:"small",bsStyle:null}),(0,d.jsx)(oe.A.Menu,{id:"dropdown-files-logs-pane-list",children:(0,d.jsx)(le,{fileList:t})})]}),bs5:(0,d.jsxs)(se.ms,{drop:"up",children:[(0,d.jsx)(se.C,{id:"dropdown-files-logs-pane",variant:"secondary",title:n("other_logs_and_files"),size:"sm",disabled:e||!t,children:n("other_logs_and_files")}),(0,d.jsx)(se.rI,{id:"dropdown-files-logs-pane-list",children:(0,d.jsx)(le,{fileList:t})})]})})}const ue=(0,i.memo)(de);var pe=n(56447),ge=n(32912),me=n(28252),fe=n(23442),_e=n(49438);const we=()=>{const[e,t]=(0,i.useState)(0),[n]=(0,j.A)("editor.view"),{t:r}=(0,l.Bd)(),[o,s]=(0,i.useState)(!1),[c]=(0,i.useState)((()=>n?.state.field(fe.previousFixState,!1))),h=(0,i.useMemo)((()=>{if(c)for(const e of c.messages)if(e.tool_calls)for(const t of e.tool_calls)if("suggestLineChange"===t.tool)return t.args}),[c]);return n&&c?(0,d.jsx)("div",{className:"ai-error-assistant-previous-fix",children:(0,d.jsxs)("div",{className:"ai-error-assistant",children:[(0,d.jsx)("div",{className:"ai-error-assistant-meta",children:(0,d.jsxs)("div",{className:"ai-error-assistant-previous-fix-heading",children:[(0,d.jsxs)("div",{className:"ai-error-assistant-previous-fix-meta",children:[(0,d.jsx)(x.A,{type:"history"}),h?(0,d.jsxs)("span",{children:[(0,d.jsx)("b",{children:r("last_suggested_fix")})," - ",r("line")," ",h.from.line,h.path&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("span",{children:[" ",r("of")," "]}),(0,d.jsx)("span",{children:(0,_e.I)(h.path)})]})]}):(0,d.jsx)("span",{children:(0,d.jsx)("b",{children:r("last_suggested_fix")})})]}),!o&&(0,d.jsx)(a.A,{variant:"secondary",size:"sm",onClick:()=>s(!0),children:r("reopen")})]})}),o&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"ai-error-assistant-messages",children:c.messages.map(((e,t)=>"assistant"===e.role&&(0,d.jsx)(me.K,{view:n,level:"previous-fix",message:e},t)))}),(0,d.jsx)(ge.I,{messages:c.messages,logEntry:c.logEntry,applied:c.applied,rating:e,setRating:t,finished:!0})]})]})}):null},ve=()=>{const{detachRole:e}=(0,pe.LV)();return e||!(0,T.A)("ol-showAiErrorAssistant")?null:(0,d.jsx)(we,{})};function be(e){let{totalEntries:t,entriesShown:n,hasErrors:r}=e;const{t:o}=(0,l.Bd)(),{startCompile:s,stoppedOnFirstError:c,setAnimateCompileDropdownArrow:h}=(0,W.Rf)(),{enableStopOnFirstError:u}=useStopOnFirstError({eventSource:"too-many-logs"}),p=o("log_entry_maximum_entries_title",{total:t,displayed:n}),g=(0,i.useCallback)((()=>{u(),s({stopOnFirstError:!0}),h(!0)}),[u,s,h]);return(0,d.jsxs)("div",{className:"log-entry","aria-label":o("log_entry_maximum_entries"),children:[(0,d.jsx)(E,{level:"raw",headerTitle:p}),(0,d.jsx)("div",{className:"log-entry-content",children:(0,d.jsx)("div",{className:"log-entry-formatted-content",children:r&&!c?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("p",{children:[(0,d.jsx)(y.A,{bs3:(0,d.jsx)(b.A,{type:"lightbulb-o"}),bs5:(0,d.jsx)(x.A,{type:"lightbulb",className:"align-middle"})})," ",(0,d.jsxs)("strong",{children:[o("tip"),": "]}),(0,d.jsx)(l.x6,{i18nKey:"log_entry_maximum_entries_enable_stop_on_first_error",components:[(0,d.jsx)(a.A,{variant:"info",size:"sm",bs3Props:{bsSize:"xsmall"},onClick:g},"enable-stop-on-first-error"),(0,d.jsx)("a",{href:"https://www.overleaf.com/learn/latex/Questions/Tips_and_Tricks_for_Troubleshooting_LaTeX"},"learn-more")]})," "]}),(0,d.jsx)("p",{children:o("log_entry_maximum_entries_see_full_logs")})]}):(0,d.jsxs)("p",{children:[(0,d.jsx)(y.A,{bs3:(0,d.jsx)(b.A,{type:"lightbulb-o"}),bs5:(0,d.jsx)(x.A,{type:"lightbulb",className:"align-middle"})})," ",(0,d.jsxs)("strong",{children:[o("tip"),": "]}),o("log_entry_maximum_entries_see_full_logs")]})})})]})}be.propTypes={totalEntries:_().number,entriesShown:_().number,hasErrors:_().bool};const ye=be,xe=[{import:s,path:"/overleaf/services/web/modules/ai/frontend/js/components/ai-error-assistant-previous-fix"}];function ke(e){let{entries:t,hasErrors:n}=e;const{t:r}=(0,l.Bd)(),{syncToEntry:o}=(0,W.Rf)(),s=t.slice(0,100);return(0,d.jsxs)(d.Fragment,{children:[t.length>100&&(0,d.jsx)(ye,{totalEntries:t.length,entriesShown:100,hasErrors:n}),xe.map((e=>{let{import:{default:t},path:n}=e;return(0,d.jsx)(t,{},n)})),s.map(((e,t)=>(0,d.jsx)(U,{index:t,id:e.key,logEntry:e,ruleId:e.ruleId,headerTitle:e.messageComponent??e.message,rawContent:e.content,logType:e.type,level:e.level,contentDetails:e.contentDetails,entryAriaLabel:r("log_entry_description",{level:e.level}),sourceLocation:{file:e.file,line:e.line,column:e.column},onSourceLocationClick:o},e.key)))]})}ke.propTypes={entries:_().arrayOf(_().object),hasErrors:_().bool};const Ee=(0,i.memo)(ke);var Te=n(64826),je=n(11796),Ce=n(22046),Ie=n(10009);function Se(){const{t:e}=(0,l.Bd)();return(0,d.jsx)(Ce.A,{type:"error",content:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(y.A,{bs3:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(b.A,{type:"exclamation-triangle",fw:!0})," "]})}),e("code_check_failed_explanation")]}),className:(0,Ie.q$)({bs5:"m-0",bs3:"mb-2"})})}const Le=(0,i.memo)(Se);var Ae=n(63815);function Oe(){const{codeCheckFailed:e,error:t,hasShortCompileTimeout:n,logEntries:r,rawLog:o,validationIssues:s,showLogs:i,stoppedOnFirstError:a}=(0,W.Rf)(),{loadingError:c}=(0,Ae.J)(),{t:h}=(0,l.Bd)();return(0,d.jsx)("div",{className:m()("logs-pane",{hidden:!i&&!c}),children:(0,d.jsxs)("div",{className:"logs-pane-content",children:[e&&(0,d.jsx)(Le,{}),a&&(0,d.jsx)(z,{}),c&&(0,d.jsx)(Z,{error:"pdf-viewer-loading-error"}),n&&"timedout"===t?(0,d.jsx)(Q,{}):(0,d.jsx)(d.Fragment,{children:t&&(0,d.jsx)(Z,{error:t})}),s&&Object.entries(s).map((e=>{let[t,n]=e;return(0,d.jsx)(B,{name:t,issue:n},t)})),r?.all&&(0,d.jsx)(Ee,{entries:r.all,hasErrors:r.errors.length>0}),o&&(0,d.jsx)(U,{headerTitle:h("raw_logs"),rawContent:o,entryAriaLabel:h("raw_logs_description"),level:"raw"}),(0,d.jsxs)("div",{className:"logs-pane-actions",children:[(0,d.jsx)(re,{}),(0,d.jsx)(ue,{})]})]})})}const Re=(0,Te.A)((0,i.memo)(Oe),(()=>(0,d.jsx)(je.A,{type:"logs"}))),Me=(0,i.lazy)((()=>Promise.all([n.e(2335),n.e(2768),n.e(2943),n.e(5460)]).then(n.bind(n,21945))));function Fe(){const{pdfUrl:e,pdfFile:t,pdfViewer:n}=(0,W.Rf)();return e?"native"===n?(0,d.jsx)("iframe",{title:"PDF Preview",src:e}):(0,d.jsx)(Me,{url:e,pdfFile:t}):null}const Pe=(0,i.memo)(Fe);var De=n(34325),Ne=n(98509),Xe=n(29139),$e=n(96047);function Ue(e){let{bsStyle:t,bsSize:n="md",button:r,dropdown:o,dropdownToggle:s,disabled:i=!1,children:a}=e;const{tooltip:c,icon:l,...h}=r,u=m()("split-menu",{[`btn-${n}`]:!0}),p=m()("split-menu-dropdown-toggle",s?.className);return(0,d.jsxs)("div",{className:u,children:[(0,d.jsxs)(Ve,{onClick:h.onClick,className:h.className,disabled:i,tooltip:c,bsStyle:t,children:[l?(0,d.jsx)(b.A,{className:"split-menu-icon",type:l.type,spin:l.spin}):null,(0,d.jsx)("span",{className:"split-menu-button",children:h.text})]}),(0,d.jsxs)(oe.A,{className:m()("split-menu-dropdown",o.className),id:o.id,children:[(0,d.jsx)(oe.A.Toggle,{"aria-label":s?.["aria-label"],className:p,bsStyle:t,onAnimationEnd:s?.handleAnimationEnd,"data-ol-loading":i}),(0,d.jsx)(oe.A.Menu,{children:a})]})]})}function Ve(e){let{onClick:t,disabled:n,tooltip:r,bsStyle:o,children:s,className:i,...a}=e;const c=m()("split-menu-button",i);return r?(0,d.jsx)($e.A,{id:r.id,description:r.description,tooltipProps:r.tooltipProps,overlayProps:r.overlayProps,children:(0,d.jsx)(Xe.A,{className:c,bsStyle:o,onClick:t,"aria-label":a["aria-label"],disabled:n,"data-ol-loading":n,children:s})}):(0,d.jsx)(Xe.A,{className:c,bsStyle:o,onClick:t,"aria-label":a["aria-label"],disabled:n,"data-ol-loading":n,children:s})}Ue.Item=function(e){return(0,d.jsx)(ie.A,{...e,draggable:"false"})};const Be=Ue;var We=n(71805);const He=/Mac/i.test(navigator.platform)?"Cmd":"Ctrl";function ze(e,t,n){X._("recompile-setting-changed",{setting:n,settingVal:e}),t(e)}function Je(){const{animateCompileDropdownArrow:e,autoCompile:t,compiling:n,draft:r,hasChanges:o,setAnimateCompileDropdownArrow:s,setAutoCompile:i,setDraft:c,setStopOnValidationError:h,stopOnFirstError:u,stopOnValidationError:p,startCompile:g,stopCompile:f,recompileFromScratch:_}=(0,W.Rf)(),{enableStopOnFirstError:w,disableStopOnFirstError:x}=useStopOnFirstError({eventSource:"dropdown"}),{t:k}=(0,l.Bd)(),{detachRole:E}=(0,pe.LV)(),T=()=>{X._("recompile-setting-changed",{setting:"from-scratch"}),_()},j=n?`${k("compiling")}…`:k("recompile"),C=(0,d.jsxs)(d.Fragment,{children:[k("recompile_pdf")," ",(0,d.jsxs)("span",{className:"keyboard-shortcut",children:["(",He," + Enter)"]})]}),I=m()({"detach-compile-button-animate":e,"btn-striped-animated":o,"no-left-border":!0},(0,Ie.q$)({bs5:"dropdown-button-toggle"})),S=m()({"btn-striped-animated":o,"no-left-radius":!0});return(0,d.jsx)(y.A,{bs3:(0,d.jsxs)(Be,{bsStyle:"primary",bsSize:"xs",disabled:n,button:{tooltip:{description:C,id:"compile",tooltipProps:{className:"keyboard-tooltip"},overlayProps:{delayShow:500,placement:"detached"===E?"bottom":void 0}},icon:{type:"refresh",spin:n},onClick:()=>g(),text:j,className:S},dropdownToggle:{"aria-label":k("toggle_compile_options_menu"),handleAnimationEnd:()=>s(!1),className:I},dropdown:{id:"pdf-recompile-dropdown"},children:[(0,d.jsx)(Be.Item,{header:!0,children:k("auto_compile")}),(0,d.jsxs)(Be.Item,{onSelect:()=>ze(!0,i,"auto-compile"),children:[(0,d.jsx)(b.A,{type:t?"check":"",fw:!0}),k("on")]}),(0,d.jsxs)(Be.Item,{onSelect:()=>ze(!1,i,"auto-compile"),children:[(0,d.jsx)(b.A,{type:t?"":"check",fw:!0}),k("off")]}),(0,d.jsx)(Be.Item,{header:!0,children:k("compile_mode")}),(0,d.jsxs)(Be.Item,{onSelect:()=>ze(!1,c,"compile-mode"),children:[(0,d.jsx)(b.A,{type:r?"":"check",fw:!0}),k("normal")]}),(0,d.jsxs)(Be.Item,{onSelect:()=>ze(!0,c,"compile-mode"),children:[(0,d.jsx)(b.A,{type:r?"check":"",fw:!0}),k("fast")," ",(0,d.jsx)("span",{className:"subdued",children:"[draft]"})]}),(0,d.jsx)(Be.Item,{header:!0,children:"Syntax Checks"}),(0,d.jsxs)(Be.Item,{onSelect:()=>ze(!0,h,"syntax-check"),children:[(0,d.jsx)(b.A,{type:p?"check":"",fw:!0}),k("stop_on_validation_error")]}),(0,d.jsxs)(Be.Item,{onSelect:()=>ze(!1,h,"syntax-check"),children:[(0,d.jsx)(b.A,{type:p?"":"check",fw:!0}),k("ignore_validation_errors")]}),(0,d.jsx)(Be.Item,{header:!0,children:k("compile_error_handling")}),(0,d.jsxs)(Be.Item,{onSelect:w,children:[(0,d.jsx)(b.A,{type:u?"check":"",fw:!0}),k("stop_on_first_error")]}),(0,d.jsxs)(Be.Item,{onSelect:x,children:[(0,d.jsx)(b.A,{type:u?"":"check",fw:!0}),k("try_to_compile_despite_errors")]}),(0,d.jsx)(Be.Item,{divider:!0}),(0,d.jsx)(Be.Item,{onSelect:()=>f(),disabled:!n,"aria-disabled":!n,children:k("stop_compile")}),(0,d.jsx)(Be.Item,{onSelect:T,disabled:n,"aria-disabled":n,children:k("recompile_from_scratch")})]}),bs5:(0,d.jsxs)(se.ms,{as:We.A,autoClose:"outside",children:[(0,d.jsx)(v.A,{description:C,id:"compile",tooltipProps:{className:"keyboard-tooltip"},overlayProps:{delay:{show:500,hide:0},placement:"detached"===E?"bottom":void 0},children:(0,d.jsx)(a.A,{variant:"primary",size:"sm",disabled:n,isLoading:n,onClick:()=>g(),className:S,children:k("recompile")})}),(0,d.jsx)(se.C,{split:!0,variant:"primary",id:"pdf-recompile-dropdown",size:"sm","aria-label":k("toggle_compile_options_menu"),className:I}),(0,d.jsxs)(se.rI,{children:[(0,d.jsx)(se.hO,{children:k("auto_compile")}),(0,d.jsx)("li",{role:"none",children:(0,d.jsx)(se.tJ,{as:"button",onClick:()=>ze(!0,i,"auto-compile"),trailingIcon:t?"check":null,children:k("on")})}),(0,d.jsx)("li",{role:"none",children:(0,d.jsx)(se.tJ,{as:"button",onClick:()=>ze(!1,i,"auto-compile"),trailingIcon:t?null:"check",children:k("off")})}),(0,d.jsx)(se.rx,{}),(0,d.jsx)(se.hO,{children:k("compile_mode")}),(0,d.jsx)("li",{role:"none",children:(0,d.jsx)(se.tJ,{as:"button",onClick:()=>ze(!1,c,"compile-mode"),trailingIcon:r?null:"check",children:k("normal")})}),(0,d.jsx)("li",{role:"none",children:(0,d.jsxs)(se.tJ,{as:"button",onClick:()=>ze(!0,c,"compile-mode"),trailingIcon:r?"check":null,children:[k("fast")," ",(0,d.jsx)("span",{className:"subdued",children:"[draft]"})]})}),(0,d.jsx)(se.rx,{}),(0,d.jsx)(se.hO,{children:"Syntax Checks"}),(0,d.jsx)("li",{role:"none",children:(0,d.jsx)(se.tJ,{as:"button",onClick:()=>ze(!0,h,"syntax-check"),trailingIcon:p?"check":null,children:k("stop_on_validation_error")})}),(0,d.jsx)("li",{role:"none",children:(0,d.jsx)(se.tJ,{as:"button",onClick:()=>ze(!1,h,"syntax-check"),trailingIcon:p?null:"check",children:k("ignore_validation_errors")})}),(0,d.jsx)(se.rx,{}),(0,d.jsx)(se.hO,{children:k("compile_error_handling")}),(0,d.jsx)("li",{role:"none",children:(0,d.jsx)(se.tJ,{as:"button",onClick:w,trailingIcon:u?"check":null,children:k("stop_on_first_error")})}),(0,d.jsx)("li",{role:"none",children:(0,d.jsx)(se.tJ,{as:"button",onClick:x,trailingIcon:u?null:"check",children:k("try_to_compile_despite_errors")})}),(0,d.jsx)(se.rx,{}),(0,d.jsx)("li",{role:"none",children:(0,d.jsx)(se.tJ,{as:"button",onClick:()=>f(),disabled:!n,"aria-disabled":!n,children:k("stop_compile")})}),(0,d.jsx)("li",{role:"none",children:(0,d.jsx)(se.tJ,{as:"button",onClick:T,disabled:n,"aria-disabled":n,children:k("recompile_from_scratch")})})]})]})})}const qe=(0,i.memo)(Je);const Ke=function(){const{pdfLayout:e,setView:t,detachRole:n}=(0,pe.LV)(),{t:r}=(0,l.Bd)();return n||"sideBySide"===e?null:(0,d.jsxs)(a.A,{variant:"secondary",size:"sm",onClick:function(){t("editor")},bs3Props:{bsSize:"xsmall",className:"switch-to-editor-btn toolbar-btn-secondary"},children:[(0,d.jsx)(y.A,{bs3:(0,d.jsx)(b.A,{type:"code",className:"toolbar-btn-secondary-icon"}),bs5:(0,d.jsx)(x.A,{type:"code"})}),r("switch_to_editor")]})};var Ge=n(35722);function Ye(){const{error:e,logEntries:t,toggleLogs:n,showLogs:r,stoppedOnFirstError:o}=(0,W.Rf)(),{t:s}=(0,l.Bd)(),c=(0,i.useCallback)((()=>{r||X._("logs-click"),n()}),[n,r]),h=Number(t?.errors?.length),u=h+Number(t?.warnings?.length);return(0,d.jsx)(v.A,{id:"logs-toggle",description:s("logs_and_output_files"),overlayProps:{placement:"bottom"},children:(0,d.jsxs)(a.A,{variant:"link",disabled:Boolean(e||o),active:r,className:"pdf-toolbar-btn toolbar-item log-btn",onClick:c,style:{position:"relative"},"aria-label":s(r?"view_pdf":"view_logs"),children:[(0,d.jsx)(y.A,{bs3:(0,d.jsx)(b.A,{type:"file-text-o",fw:!0}),bs5:(0,d.jsx)(x.A,{type:"description"})}),!r&&u>0&&(0,d.jsx)(Ge.A,{bg:0===h?"warning":"danger",children:u})]})})}const Qe=(0,i.memo)(Ye);const Ze=function(){const{pdfDownloadUrl:e}=(0,W.Rf)(),{_id:t}=(0,H.O)(),{t:n}=(0,l.Bd)(),r=n(e?"download_pdf":"please_compile_pdf_before_download");return(0,d.jsx)(v.A,{id:"download-pdf",description:r,overlayProps:{placement:"bottom"},children:(0,d.jsx)(a.A,{onClick:function(e){const n=e;"true"!==n.currentTarget.dataset.disabled?(0,X._)("download-pdf-button-click",{projectId:t,location:"pdf-preview",isSmallDevice:X.mP}):n.preventDefault()},variant:"link",className:"pdf-toolbar-btn",draggable:!1,"data-disabled":!e,disabled:!e,download:!0,href:e||"#",target:"_blank",style:{pointerEvents:"auto"},"aria-label":n("download_pdf"),children:(0,d.jsx)(y.A,{bs3:(0,d.jsx)(b.A,{type:"download",fw:!0}),bs5:(0,d.jsx)(x.A,{type:"download"})})})})};function et(){const{codeCheckFailed:e,error:t,toggleLogs:n}=(0,W.Rf)(),{t:r}=(0,l.Bd)(),o=(0,i.useCallback)((()=>{n()}),[n]);return e?(0,d.jsxs)(a.A,{variant:"danger",size:"sm",disabled:Boolean(t),className:"btn-toggle-logs toolbar-item",onClick:o,bs3Props:{bsSize:"xsmall"},children:[(0,d.jsx)(y.A,{bs3:(0,d.jsx)(b.A,{type:"exclamation-triangle"}),bs5:(0,d.jsx)(x.A,{type:"warning"})}),(0,d.jsx)("span",{className:(0,Ie.q$)({bs3:"toolbar-text"}),children:r("code_check_failed")})]}):null}const tt=(0,i.memo)(et);var nt=n(85289),rt=n(89753);function ot(){const{t:e}=(0,l.Bd)(),t=(0,rt.z)(),n=(0,i.useCallback)((()=>{t.assign((0,nt.Z)(null).toString())}),[t]);return(0,d.jsx)(a.A,{variant:"primary",size:"sm",onClick:n,children:e("redirect_to_editor")})}const st=(0,i.memo)(ot);var it=n(40802),at=n(237);function ct(){const{detachRole:e,detachIsLinked:t}=(0,pe.LV)(),n=(0,i.useRef)(),[r,o]=(0,i.useState)(!1),s=!t&&"detached"===e;(0,i.useEffect)((()=>{n.current&&clearTimeout(n.current),s?n.current=setTimeout((()=>{o(!0)}),5e3):o(!1)}),[s]);let a=null;return a=r?(0,d.jsx)(ht,{}):s?(0,d.jsx)(dt,{}):(0,d.jsx)(lt,{}),(0,d.jsx)(Ne.A,{className:"toolbar toolbar-pdf toolbar-pdf-hybrid",children:a})}function lt(){return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"toolbar-pdf-left",children:[(0,d.jsx)(qe,{}),(0,d.jsx)(Qe,{}),(0,d.jsx)(Ze,{})]}),(0,d.jsxs)("div",{className:"toolbar-pdf-right",children:[(0,d.jsx)("div",{className:"toolbar-pdf-controls",id:"toolbar-pdf-controls"}),(0,d.jsx)(tt,{}),(0,d.jsx)(Ke,{}),(0,d.jsx)(it.Yu,{})]})]})}function ht(){const{t:e}=(0,l.Bd)();return(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)("div",{className:"toolbar-pdf-orphan",children:[e("tab_no_longer_connected"),(0,d.jsx)(st,{})]})})}function dt(){const{t:e}=(0,l.Bd)();return(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)("div",{className:"toolbar-pdf-orphan",children:[(0,d.jsx)(y.A,{bs3:(0,d.jsx)(b.A,{type:"refresh",fw:!0,spin:!0}),bs5:(0,d.jsx)(at.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"})})," ",e("tab_connecting"),"…"]})})}const ut=(0,i.memo)(ct),pt=e=>{let{children:t}=e;return(0,d.jsx)("div",{className:"pdf-preview-messages",children:t})};var gt=n(42093);const mt=e=>{let{handleDismissWarning:t}=e;const{t:n}=(0,l.Bd)(),r=(0,q.u)("paywall-cta");return(0,d.jsx)(c.A,{action:(0,d.jsx)(J.A,{variant:"new-10s",source:"compile-time-warning",buttonProps:{className:"btn-secondary-compile-timeout-override"},children:n(r?"get_more_compile_time":"start_free_trial_without_exclamation")}),ariaLive:"polite",content:(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{children:(0,d.jsx)("span",{children:n("your_project_near_compile_timeout_limit")})}),(0,d.jsx)("strong",{children:n("upgrade_for_12x_more_compile_time")}),". "]}),type:"warning",title:n("took_a_while"),isActionBelowContent:!0,isDismissible:!0,onDismiss:t})};function ft(){const{isProjectOwner:e,deliveryLatencies:t,compiling:n,showLogs:r,error:o}=(0,W.Rf)(),[s,a]=(0,i.useState)(!1),[c,l]=(0,gt.A)("has-dismissed-10s-compile-time-warning-until"),h=(0,i.useCallback)((t=>{a(!1),t>1e4&&e&&(!c||new Date(c)<new Date)&&(a(!0),X._("compile-time-warning-displayed",{time:10,isProjectOwner:e}))}),[e,c]),u=(0,i.useCallback)((()=>{X._("compile-time-warning-dismissed",{time:10,isProjectOwner:e}),a(!1);const t=new Date;t.setDate(t.getDate()+1),l(t)}),[e,l]);return(0,i.useEffect)((()=>{n||o||r||h(t.compileTimeServerE2E)}),[n,o,r,t,h]),(0,T.A)("ol-ExposedSettings").enableSubscriptions?n||o||r?null:s?(0,d.jsx)("div",{children:s&&e&&(0,d.jsx)(mt,{handleDismissWarning:u})}):null:null}const _t=(0,i.memo)(ft),wt=[{import:r,path:"/overleaf/services/web/modules/ai/frontend/js/components/promotions/ai-error-assistant-feedback-prompt"}];function vt(){const{pdfUrl:e,hasShortCompileTimeout:t}=(0,W.Rf)(),n=m()("pdf","full-size",{"pdf-empty":!e});return(0,d.jsx)("div",{className:n,children:(0,d.jsxs)(Ae.K,{children:[(0,d.jsx)(ut,{}),(0,d.jsxs)(pt,{children:[wt.map((e=>{let{import:{default:t},path:n}=e;return(0,d.jsx)(t,{},n)})),t&&(0,d.jsx)(_t,{})]}),(0,d.jsx)(i.Suspense,{fallback:(0,d.jsx)(De.e,{delay:500}),children:(0,d.jsx)("div",{className:"pdf-viewer",children:(0,d.jsx)(Pe,{})})}),(0,d.jsx)(Re,{})]})})}const bt=(0,i.memo)(vt);function yt(){const{detachRole:e}=(0,pe.LV)();return"detacher"===e?null:(0,d.jsx)(bt,{})}const xt=(0,Te.A)((0,i.memo)(yt),(()=>(0,d.jsx)(je.A,{type:"preview"})))},88495:(e,t,n)=>{"use strict";n.d(t,{A:()=>a,c:()=>i});var r=n(14041),o=n(89139),s=n(94234);const i=e=>{if(e.shiftKey||e.altKey)return!1;if(e.ctrlKey){if("s"===e.key||"Enter"===e.key||"."===e.key)return!0;if("S"===e.key&&!e.shiftKey)return!0}else if(e.metaKey){if("s"===e.key||"Enter"===e.key)return!0;if("S"===e.key&&!e.shiftKey)return!0}};function a(e,t){const n=(0,r.useCallback)((t=>{i(t)&&(t.preventDefault(),e())}),[e]),a=(0,r.useCallback)((()=>{e()}),[e]);(0,o.A)("pdf:recompile",a),(0,r.useEffect)((()=>(document.body.addEventListener("keydown",n),()=>{document.body.removeEventListener("keydown",n)})),[n]);const c=(0,s.A)("set-changed-at",t,"detacher","detached"),l=(0,r.useCallback)((()=>{c(Date.now())}),[c]);(0,o.A)("doc:changed",l)}},51275:(e,t,n)=>{"use strict";n.d(t,{I:()=>d,T:()=>h});var r=n(33829),o=n(5964),s=n(33478),i=n(60961);const a=9,c=(0,r.A)(),l={viewerId:c};function h(){return l}function d(e,t,n){const{timings:r,pdfCachingMinChunkSize:l}=e,h={compileTimeClientE2E:t,compileTimeServerE2E:r?.compileE2E};let d=!0;return{deliveryLatencies:h,firstRenderDone:function(e){let{latencyFetch:t,latencyRender:r,pdfCachingMetrics:u}=e;d&&(d=!1,h.totalDeliveryTime=Math.ceil(performance.now()-n),h.latencyFetch=t,r&&(h.latencyRender=r),s.Hs&&function(e){const t={version:a,...e,id:c};i.$.log("/event/compile-metrics",JSON.stringify(t)),(0,o._)("compile-metrics-v6",t)}({pdfCachingMinChunkSize:l,...h,...u}))}}}},33478:(e,t,n)=>{"use strict";n.d(t,{Hs:()=>u,Ly:()=>c,bu:()=>l,ez:()=>h,lW:()=>d});var r=n(64932),o=n(60961);const s="undefined"!=typeof TextEncoder;s||o.$.warn("TextEncoder is not available. Disabling pdf-caching.");const i=Array.isArray(navigator.userAgentData?.brands)&&navigator.userAgentData.brands.some((e=>"Opera"===e.brand));function a(e){return!!s&&(!i&&"enabled"===(0,r.A)("ol-splitTestVariants")?.[e])}i&&o.$.warn("Browser cache is limited in Opera. Disabling pdf-caching.");const c=a("pdf-caching-cached-url-lookup"),l=a("pdf-caching-prefetching"),h=a("pdf-caching-prefetch-large"),d=a("pdf-caching-mode"),u=a("track-pdf-download")},83681:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(79907),o=n(31085);const s=function(e){let{prepend:t,children:n,...s}=e;return(0,o.jsxs)(r.A,{...s,children:[t&&(0,o.jsx)("span",{className:"badge-prepend",children:t}),(0,o.jsx)("span",{className:"badge-content",children:n})]})}},35722:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(83681),o=n(71943),s=n(67993),i=n(31085);const a=function(e){const{bs3Props:t,...n}=e;let a={prepend:n.prepend,children:n.children,className:n.className,bsStyle:n.bg};if(t){const{bsStyle:e,...r}=t;a={...a,...r,bsStyle:"bsStyle"in t?e:n.bg}}return(0,i.jsx)(s.A,{bs3:(0,i.jsx)(o.A,{...a}),bs5:(0,i.jsx)(r.A,{...n})})}},71606:(e,t,n)=>{"use strict";n.d(t,{H:()=>r,P:()=>o});const r=new Map([["\\includegraphics",{name:"graphicx",command:"\\usepackage{graphicx}"}],["\\toprule",{name:"booktabs",command:"\\usepackage{booktabs}"}],["\\midrule",{name:"booktabs",command:"\\usepackage{booktabs}"}],["\\bottomrule",{name:"booktabs",command:"\\usepackage{booktabs}"}],["\\cmidrule",{name:"booktabs",command:"\\usepackage{booktabs}"}],["\\multirow",{name:"multirow",command:"\\usepackage{multirow}"}],["\\justifying",{name:"ragged2e",command:"\\usepackage{ragged2e}"}],["\\tag",{name:"amsmath",command:"\\usepackage{amsmath}"}],["\\notag",{name:"amsmath",command:"\\usepackage{amsmath}"}],["\\text",{name:"amsmath",command:"\\usepackage{amsmath}"}],["\\boldsymbol",{name:"amsmath",command:"\\usepackage{amsmath}"}],["\\eqref",{name:"amsmath",command:"\\usepackage{amsmath}"}],["\\iint",{name:"amsmath",command:"\\usepackage{amsmath}"}],["\\iiint",{name:"amsmath",command:"\\usepackage{amsmath}"}],["\\nmid",{name:"amssymb",command:"\\usepackage{amssymb}"}],["\\varnothing",{name:"amssymb",command:"\\usepackage{amssymb}"}],["\\Box",{name:"amssymb",command:"\\usepackage{amssymb}"}],["\\citep",{name:"natbib",command:"\\usepackage{natbib}"}],["\\citet",{name:"natbib",command:"\\usepackage{natbib}"}],["\\citepalias",{name:"natbib",command:"\\usepackage{natbib}"}],["\\citetalias",{name:"natbib",command:"\\usepackage{natbib}"}],["\\url",{name:"url",command:"\\usepackage{url}"}],["\\href",{name:"hyperref",command:"\\usepackage{hyperref}"}],["\\texorpdfstring",{name:"hyperref",command:"\\usepackage{hyperref}"}],["\\phantomsection",{name:"hyperref",command:"\\usepackage{hyperref}"}],["\\arraybackslash",{name:"array",command:"\\usepackage{array}"}]]),o=new Map([["justify",{name:"ragged2e",command:"\\usepackage{ragged2e}"}],["align",{name:"amsmath",command:"\\usepackage{amsmath}"}],["align*",{name:"amsmath",command:"\\usepackage{amsmath}"}],["split",{name:"amsmath",command:"\\usepackage{amsmath}"}],["gather",{name:"amsmath",command:"\\usepackage{amsmath}"}],["cases",{name:"amsmath",command:"\\usepackage{amsmath}"}],["matrix",{name:"amsmath",command:"\\usepackage{amsmath}"}],["pmatrix",{name:"amsmath",command:"\\usepackage{amsmath}"}],["bmatrix",{name:"amsmath",command:"\\usepackage{amsmath}"}],["subequations",{name:"amsmath",command:"\\usepackage{amsmath}"}]])},5964:(e,t,n)=>{"use strict";n.d(t,{mP:()=>y,tN:()=>g,_:()=>f,JY:()=>_,v4:()=>b,MY:()=>w,E4:()=>m});n(43375),n(39225),n(13972),n(99209),n(25714),n(17561),n(66197);var r=n(60961);const o=function(e,t,n){try{return e(t,n)}catch(e){return r.$.error("sessionStorage exception",e),null}},s=function(e){return JSON.parse(sessionStorage.getItem(e))},i=function(e,t){sessionStorage.setItem(e,JSON.stringify(t))},a=function(){sessionStorage.clear()},c=function(e){return sessionStorage.removeItem(e)},l={getItem:e=>o(s,e),setItem:(e,t)=>o(i,e,t),clear:()=>o(a),removeItem:e=>o(c,e)};var h=n(64932);const d="mbEvents";function u(e){return!!(l.getItem(d)||{})[e]}function p(e){const t=l.getItem(d)||{};t[e]=!0,l.setItem(d,t)}function g(e,t,n,r){"function"==typeof window.ga&&window.ga("send","event",e,t,n,r)}function m(e,t,n,r){u(e)||"function"==typeof window.ga&&(window.ga("send","event",e,t,n,r),p(e))}function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.page||(t.page=window.location.pathname),function(e,t){if(!navigator||!navigator.sendBeacon)return;if(!(0,h.A)("ol-ExposedSettings").isOverleaf)return;t._csrf=(0,h.A)("ol-csrfToken");const n=new Blob([JSON.stringify(t)],{type:"application/json; charset=UTF-8"});try{navigator.sendBeacon(`/event/${e}`,n)}catch(e){}}(e,t),"function"==typeof window.gtag&&["paywall-click","paywall-prompt","plans-page-click"].includes(e)&&window.gtag("event",e,t)}function _(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};u(e)||(f(e,t),p(e))}function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.01;Math.random()<n&&f(e,t)}const v=new Set;function b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};v.has(e)||(f(e,t),v.add(e))}const y=window.screen.width<768},82671:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var r=n(64932);const o=function(e){return new RegExp(`\\.(${(0,r.A)("ol-ExposedSettings").validRootDocExtensions.join("|")})$`,"i").test(e)}},71943:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=n(53373),o=n.n(r),s=n(31085);const i=function(e){let{prepend:t,children:n,bsStyle:r,className:i,...a}=e;const c=null===r?i:o()("label",`label-${r}`,i);return(0,s.jsxs)("span",{className:c,...a,children:[t&&(0,s.jsx)("span",{className:"badge-tag-bs3-prepend",children:t}),(0,s.jsx)("span",{className:"badge-tag-bs3-content",children:n})]})}},45330:(e,t,n)=>{"use strict";n.d(t,{j:()=>i});var r=n(29295),o=n(22046),s=n(31085);const i=e=>{let{children:t,modal:n}=e;return(0,s.jsxs)("div",{className:"error-boundary-alert",children:[(0,s.jsx)(o.A,{type:"error",content:t||(0,s.jsx)(r.f,{})}),n]})}},8164:(e,t,n)=>{"use strict";n.d(t,{oG:()=>u,Rf:()=>p});n(16280);var r=n(14041),o=n(71110),s=n(37939);const i=function(e,t,n,o){const[i,a]=(0,s.A)(e,t,n,o);return(0,r.useEffect)((()=>{a(t)}),[a,t]),[i,a]};var a=n(94234),c=n(88495),l=n(56447);var h=n(31085);const d=(0,r.createContext)(void 0),u=e=>{let{children:t}=e;const n=(0,o.tB)();if(!n)throw new Error("DetachCompileProvider is only available inside LocalCompileProvider");const{animateCompileDropdownArrow:s,autoCompile:u,clearingCache:p,clsiServerId:g,codeCheckFailed:m,compiling:f,deliveryLatencies:_,draft:w,editedSinceCompileStarted:v,error:b,fileList:y,hasChanges:x,hasShortCompileTimeout:k,highlights:E,isProjectOwner:T,lastCompileOptions:j,logEntries:C,logEntryAnnotations:I,pdfFile:S,pdfViewer:L,position:A,rawLog:O,setAnimateCompileDropdownArrow:R,setAutoCompile:M,setDraft:F,setError:P,setHasLintingError:D,setHighlights:N,setPosition:X,setShowCompileTimeWarning:$,setShowLogs:U,toggleLogs:V,setStopOnFirstError:B,setStopOnValidationError:W,showLogs:H,showCompileTimeWarning:z,stopOnFirstError:J,stopOnValidationError:q,stoppedOnFirstError:K,uncompiled:G,validationIssues:Y,firstRenderDone:Q,cleanupCompileResult:Z,recompileFromScratch:ee,setCompiling:te,startCompile:ne,stopCompile:re,setChangedAt:oe,clearCache:se,syncToEntry:ie,recordAction:ae}=n,[ce]=i("animateCompileDropdownArrow",s,"detacher","detached"),[le]=i("autoCompile",u,"detacher","detached"),[he]=i("clearingCache",p,"detacher","detached"),[de]=i("clsiServerId",g,"detacher","detached"),[ue]=i("codeCheckFailed",m,"detacher","detached"),[pe]=i("compiling",f,"detacher","detached"),[ge]=i("deliveryLatencies",_,"detacher","detached"),[me]=i("draft",w,"detacher","detached"),[fe]=i("error",b,"detacher","detached"),[_e]=i("fileList",y,"detacher","detached"),[we]=i("hasChanges",x,"detacher","detached"),[ve]=i("hasShortCompileTimeout",k,"detacher","detached"),[be]=i("highlights",E,"detacher","detached"),[ye]=i("isProjectOwner",T,"detacher","detached"),[xe]=i("lastCompileOptions",j,"detacher","detached"),[ke]=i("logEntries",C,"detacher","detached"),[Ee]=i("logEntryAnnotations",I,"detacher","detached"),[Te]=i("pdfFile",S,"detacher","detached"),[je]=i("pdfViewer",L,"detacher","detached"),[Ce]=i("position",A,"detacher","detached"),[Ie]=i("rawLog",O,"detacher","detached"),[Se]=i("showCompileTimeWarning",z,"detacher","detached"),[Le]=i("showLogs",H,"detacher","detached"),[Ae]=i("stopOnFirstError",J,"detacher","detached"),[Oe]=i("stopOnValidationError",q,"detacher","detached"),[Re]=i("stoppedOnFirstError",K,"detacher","detached"),[Me]=i("uncompiled",G,"detacher","detached"),[Fe]=i("editedSinceCompileStarted",v,"detacher","detached"),[Pe]=i("validationIssues",Y,"detacher","detached"),De=(0,a.A)("setAnimateCompileDropdownArrow",R,"detached","detacher"),Ne=(0,a.A)("setAutoCompile",M,"detached","detacher"),Xe=(0,a.A)("setDraft",F,"detached","detacher"),$e=(0,a.A)("setError",P,"detacher","detached"),Ue=(0,a.A)("setPosition",X,"detached","detacher"),Ve=(0,a.A)("firstRenderDone",Q,"detached","detacher"),Be=(0,a.A)("setHasLintingError",D,"detacher","detached"),We=(0,a.A)("setHighlights",N,"detacher","detached"),He=(0,a.A)("setShowCompileTimeWarning",$,"detached","detacher"),ze=(0,a.A)("setShowLogs",U,"detached","detacher"),Je=(0,a.A)("toggleLogs",V,"detached","detacher"),qe=(0,a.A)("setStopOnFirstError",B,"detached","detacher"),Ke=(0,a.A)("setStopOnValidationError",W,"detached","detacher"),Ge=(0,a.A)("cleanupCompileResult",Z,"detached","detacher"),Ye=(0,a.A)("recompileFromScratch",ee,"detached","detacher"),Qe=(0,a.A)("setCompiling",te,"detacher","detached"),Ze=(0,a.A)("startCompile",ne,"detached","detacher"),et=(0,a.A)("stopCompile",re,"detached","detacher"),tt=(0,a.A)("setChangedAt",oe,"detached","detacher"),nt=(0,a.A)("clearCache",se,"detached","detacher"),rt=(0,a.A)("sync-to-entry",ie,"detached","detacher"),ot=(0,a.A)("record-action",ae,"detached","detacher");(0,c.A)(Ze,tt),(e=>{const{pdfLayout:t,setView:n}=(0,l.LV)();(0,r.useEffect)((()=>{const r=r=>{const{id:o,suggestFix:s}=r.detail;e(!0),"flat"===t&&n("pdf"),window.setTimeout((()=>{const e=document.querySelector(`.log-entry[data-log-entry-id="${o}"]`);e&&(e.scrollIntoView({block:"start",inline:"nearest"}),s&&e.querySelector('button[data-action="suggest-fix"]')?.click())}))};return window.addEventListener("editor:view-compile-log-entry",r),()=>{window.removeEventListener("editor:view-compile-log-entry",r)}}),[t,n,e])})(ze);const st=(0,r.useMemo)((()=>({animateCompileDropdownArrow:ce,autoCompile:le,clearCache:nt,clearingCache:he,clsiServerId:de,codeCheckFailed:ue,compiling:pe,deliveryLatencies:ge,draft:me,editedSinceCompileStarted:Fe,error:fe,fileList:_e,hasChanges:we,hasShortCompileTimeout:ve,highlights:be,isProjectOwner:ye,lastCompileOptions:xe,logEntryAnnotations:Ee,logEntries:ke,pdfDownloadUrl:Te?.pdfDownloadUrl,pdfFile:Te,pdfUrl:Te?.pdfUrl,pdfViewer:je,position:Ce,rawLog:Ie,recompileFromScratch:Ye,setAnimateCompileDropdownArrow:De,setAutoCompile:Ne,setCompiling:Qe,setDraft:Xe,setError:$e,setHasLintingError:Be,setHighlights:We,setPosition:Ue,setShowCompileTimeWarning:He,setShowLogs:ze,toggleLogs:Je,setStopOnFirstError:qe,setStopOnValidationError:Ke,showLogs:Le,showCompileTimeWarning:Se,startCompile:Ze,stopCompile:et,stopOnFirstError:Ae,stopOnValidationError:Oe,stoppedOnFirstError:Re,uncompiled:Me,validationIssues:Pe,firstRenderDone:Ve,setChangedAt:tt,cleanupCompileResult:Ge,syncToEntry:rt,recordAction:ot})),[ce,le,nt,he,de,ue,pe,ge,me,Fe,fe,_e,we,ve,be,ye,xe,Ee,ke,Te,je,Ce,Ie,Ye,De,Ne,Qe,Xe,$e,Be,We,Ue,He,ze,Je,qe,Ke,Se,Le,Ze,et,Ae,Oe,Re,Me,Pe,Ve,tt,Ge,rt,ot]);return(0,h.jsx)(d.Provider,{value:st,children:t})};function p(){const e=(0,r.useContext)(d);if(!e)throw new Error("useDetachCompileContext is ony available inside DetachCompileProvider");return e}},93588:(e,t,n)=>{"use strict";n.d(t,{lt:()=>u,Q2:()=>p});n(16280);var r=n(14041),o=n(64932),s=n(85289);n(43375),n(39225),n(13972),n(99209),n(25714),n(17561),n(66197);var i=n(60961),a=n(31085);const c=(0,r.createContext)(void 0),l=(0,o.A)("ol-debugPdfDetach"),h=(0,o.A)("ol-project_id"),d="BroadcastChannel"in window?new BroadcastChannel(`detach-${h}`):void 0,u=e=>{let{children:t}=e;const[n,h]=(0,r.useState)(),[u,p]=(0,r.useState)((()=>(0,o.A)("ol-detachRole")||null)),{addHandler:g,deleteHandler:m,callHandlers:f}=function(){const e=(0,r.useRef)(new Set),t=(0,r.useCallback)((t=>{e.current.add(t)}),[]),n=(0,r.useCallback)((t=>{e.current.delete(t)}),[]),o=(0,r.useCallback)((function(){for(const t of e.current)t(...arguments)}),[]);return{addHandler:t,deleteHandler:n,callHandlers:o}}();(0,r.useEffect)((()=>{l&&i.$.warn("Effect",{role:u}),window.history.replaceState({},"",(0,s.Z)(u).toString())}),[u]),(0,r.useEffect)((()=>{if(d){const e=e=>{l&&i.$.warn("Receiving:",e.data),f(e.data)};return d.addEventListener("message",e),()=>{d.removeEventListener("message",e)}}}),[f]);const _=(0,r.useCallback)(((e,t)=>{if(!u)return void(l&&i.$.warn("Not Broadcasting (no role)",{role:u,event:e,data:t}));l&&i.$.warn("Broadcasting",{role:u,event:e,data:t});const n={role:u,event:e};t&&(n.data=t),d?.postMessage(n)}),[u]);(0,r.useEffect)((()=>{_("connected")}),[_]),(0,r.useEffect)((()=>{const e=()=>_("closed");return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)}),[_]),(0,r.useEffect)((()=>{const e=e=>{"detached"===e.role&&"connected"===e.event&&h(new Date)};return g(e),()=>m(e)}),[g,m]);const w=(0,r.useMemo)((()=>({role:u,setRole:p,broadcastEvent:_,lastDetachedConnectedAt:n,addEventHandler:g,deleteEventHandler:m})),[u,p,_,n,g,m]);return(0,a.jsx)(c.Provider,{value:w,children:t})};function p(){const e=(0,r.useContext)(c);if(!e)throw new Error("useDetachContext is only available inside DetachProvider");return e}},10646:(e,t,n)=>{"use strict";n.d(t,{mi:()=>f,zz:()=>m});n(16280);var r=n(14041),o=n(14936),s=n(30741),i=n(67353),a=n(66666),c=n(93588),l=n(64932),h=n(85960),d=n(14901),u=n(67603),p=n(31085);const g=(0,r.createContext)(void 0),m=e=>{let{children:t}=e;const n=(0,i.nK)(),{id:m}=(0,h.ur)(),{role:f}=(0,c.Q2)(),{showGenericMessageModal:_}=(0,u.T)(),{owner:w,features:v,_id:b,members:y}=(0,a.O)(),x=(0,r.useMemo)((()=>{const e=(0,l.A)("ol-brandVariation");return e&&{logoImgUrl:e.logo_url,brandVariationName:e.name,brandVariationId:e.id,brandId:e.brand_id,brandVariationHomeUrl:e.home_url,publishGuideHtml:e.publish_guide_html,partner:e.partner,brandedMenu:e.branded_menu,submitBtnHtml:e.submit_button_html}}),[]),[k]=(0,o.A)("state.loading"),[E,T]=(0,o.A)("project.name"),[j,C]=(0,o.A)("permissionsLevel"),[I,S]=(0,r.useState)(!1),[L]=(0,o.A)("editor.showSymbolPalette"),[A]=(0,o.A)("editor.toggleSymbolPalette"),[O,R]=(0,r.useState)((()=>(0,l.A)("ol-inactiveTutorials")||[])),[M,F]=(0,r.useState)(null),P=(0,r.useMemo)((()=>y?.some((e=>e._id===m&&e.pendingEditor))),[y,m]),D=(0,r.useCallback)((e=>{R([...O,e])}),[O]);(0,r.useEffect)((()=>{if(n?.socket)return n.socket.on("projectNameUpdated",T),()=>n.socket.removeListener("projectNameUpdated",T)}),[n?.socket,T]);const N=(0,r.useCallback)((e=>{T((t=>(t!==e&&(0,d.Y)(b,{name:e}).catch((e=>{T(t);const{data:n,status:r}=e;_("Error renaming project",400===r?n:"Please try again in a moment")})),e)))}),[T,b,_]),{setTitle:X}=(0,s.A)();(0,r.useEffect)((()=>{const e=[];"detached"===f&&e.push("[PDF]"),E&&(e.push(E),e.push("-")),e.push("Online LaTeX Editor"),e.push((0,l.A)("ol-ExposedSettings").appName);const t=e.join(" ");X(t)}),[E,X,f]);const $=(0,r.useCallback)((e=>{window.dispatchEvent(new CustomEvent("editor:insert-symbol",{detail:e}))}),[]),U=(0,r.useMemo)((()=>({cobranding:x,hasPremiumCompile:"priority"===v?.compileGroup,loading:k,renameProject:N,permissionsLevel:I?"readOnly":j,setPermissionsLevel:C,isProjectOwner:w?._id===m,isRestrictedTokenMember:(0,l.A)("ol-isRestrictedTokenMember"),isPendingEditor:P,showSymbolPalette:L,toggleSymbolPalette:A,insertSymbol:$,inactiveTutorials:O,deactivateTutorial:D,currentPopup:M,setCurrentPopup:F,setOutOfSync:S})),[x,v?.compileGroup,w,m,k,N,j,C,P,L,A,$,O,D,M,F,I,S]);return(0,p.jsx)(g.Provider,{value:U,children:t})};function f(){const e=(0,r.useContext)(g);if(!e)throw new Error("useEditorContext is only available inside EditorProvider");return e}},71573:(e,t,n)=>{"use strict";n.d(t,{_:()=>j,Q:()=>T});n(16280);var r=n(22743),o=n(14041),s=n(14936),i=n(79550);function a(e,t){return l(e,t,((e,t,n)=>[...e.slice(0,n),...e.slice(n+1)]))}function c(e,t,n){const{type:r,...o}=n;if(!r)throw new Error("Entity has no type");const s=`${r}s`;return l(e,t,((e,t,n)=>(e[n]={...t,[s]:[...t[s],o]},e)))}function l(e,t,n){if(!t||e._id===t){const[t]=n([],e,0);return t}for(const r of["docs","fileRefs","folders"])for(let o=0;o<e[r].length;o++){const s=e[r][o];if(s._id===t)return{...e,[r]:n(e[r],s,o)}}const r=e.folders.map((e=>l(e,t,n)));return{...e,folders:r}}var h=n(64932);function d(e){if(!e)return 0;const t=function(e){function t(e){if(null==e)return 0;let n=0;if(e.folders){n+=e.folders.length;for(const r of e.folders)n+=t(r)}return e.docs&&(n+=e.docs.length),e.fileRefs&&(n+=e.fileRefs.length),n}return t(e)}(e),n=(0,h.A)("ol-ExposedSettings").maxEntitiesPerProject,r=function(e,t,n){if(e>=t)return"error";if(e>=t-n)return"warning";return"success"}(t,n,Math.ceil(n/20));return{value:t,status:r,limit:n}}var u=n(45250),p=n.n(u);function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e.docs.map((e=>({doc:{id:e._id,name:e.name},path:t+e.name})));for(const r of e.folders)n.push(...g(r,`${t}${r.name}/`));return n}function m(e){const t=g(e);return t.sort((function(e,t){const n=(e.path.match(/\//g)||[]).length,r=(t.path.match(/\//g)||[]).length;return n-r!=0?-(n-r):e.path<t.path?-1:e.path>t.path?1:0})),t}var f=n(76113),_=n(65982),w=n(31085);const{buildFileTree:v,createFolder:b}=r||_.CH,y=(0,o.createContext)(void 0);var x=function(e){return e.RENAME="RENAME",e.RESET="RESET",e.DELETE="DELETE",e.MOVE="MOVE",e.CREATE="CREATE",e}(x||{});function k(e,t){let{fileTreeData:n}=e;switch(t.type){case x.RESET:{const e=t.fileTreeData;return{fileTreeData:e,fileCount:d(e)}}case x.RENAME:{const e=function(e,t,n){let{newName:r}=n;return l(e,t,((e,t,n)=>{const o=Object.assign([],e),s={...t,name:r};return o[n]=s,o}))}(n,t.id,{newName:t.newName});return{fileTreeData:e,fileCount:d(e)}}case x.DELETE:{const e=a(n,t.id);return{fileTreeData:e,fileCount:d(e)}}case x.MOVE:{const e=function(e,t,n){const r=(0,i.k3)(e,t);return r.parentFolderId===n?e:c(a(e,t),n,{...r.entity,type:r.type})}(n,t.entityId,t.toFolderId);return{fileTreeData:e,fileCount:d(e)}}case x.CREATE:{const e=c(n,t.parentFolderId,t.entity);return{fileTreeData:e,fileCount:d(e)}}default:throw new Error(`Unknown mutable file tree action type: ${t.type}`)}}const E=e=>{const t=e?.[0];return{fileTreeData:t,fileCount:d(t)}};function T(){const e=(0,o.useContext)(y);if(!e)throw new Error("useFileTreeData is only available inside FileTreeDataProvider");return e}const j=e=>{let{children:t}=e;const[n]=(0,s.A)("project"),[r]=(0,s.A)("editor.open_doc_id"),[,i]=(0,f.A)("editor.open_doc_name"),[a]=(0,s.A)("permissionsLevel"),{fileTreeFromHistory:c,snapshot:l,snapshotVersion:h}=(0,_.P4)(),d="readOnly"===a||c,[u,g]=(0,o.useState)(n?.rootFolder);(0,o.useEffect)((()=>{c||g(n?.rootFolder)}),[n,c]),(0,o.useEffect)((()=>{c&&(u&&!u?.[0]?._id||g([b("","")]))}),[c,u]),(0,o.useEffect)((()=>{c&&l&&g([v(l)])}),[c,l,h]);const[{fileTreeData:T,fileCount:j},C]=(0,o.useReducer)(k,u,E),[I,S]=(0,o.useState)([]),L=(0,o.useMemo)((()=>T?m(T):void 0),[T]);!function(e,t){const n=(0,o.useRef)();(0,o.useEffect)((()=>{p().isEqual(t,n.current)||(n.current=t,e())}),t)}((()=>{C({type:x.RESET,fileTreeData:u?.[0]})}),[u]);const A=(0,o.useCallback)(((e,t)=>{t.type="folder",C({type:x.CREATE,parentFolderId:e,entity:t})}),[]),O=(0,o.useCallback)(((e,t)=>{t.type="doc",C({type:x.CREATE,parentFolderId:e,entity:t})}),[]),R=(0,o.useCallback)(((e,t)=>{t.type="fileRef",C({type:x.CREATE,parentFolderId:e,entity:t})}),[]),M=(0,o.useCallback)(((e,t)=>{C({type:x.RENAME,newName:t,id:e}),e===r&&i(t)}),[r,i]),F=(0,o.useCallback)((e=>{C({type:x.DELETE,id:e})}),[]),P=(0,o.useCallback)(((e,t)=>{C({type:x.MOVE,entityId:e,toFolderId:t})}),[]),D=(0,o.useMemo)((()=>({dispatchCreateDoc:O,dispatchCreateFile:R,dispatchCreateFolder:A,dispatchDelete:F,dispatchMove:P,dispatchRename:M,fileCount:j,fileTreeData:T,fileTreeReadOnly:d,hasFolders:T?.folders.length>0,selectedEntities:I,setSelectedEntities:S,docs:L})),[O,R,A,F,P,M,j,T,d,I,S,L]);return(0,w.jsx)(y.Provider,{value:D,children:t})}},67353:(e,t,n)=>{"use strict";n.d(t,{Qi:()=>i,nK:()=>a});n(16280);var r=n(14041),o=n(31085);const s=(0,r.createContext)(void 0),i=e=>{let{ide:t,scopeStore:n,scopeEventEmitter:i,children:a}=e;(0,r.useEffect)((()=>{window.overleaf={...window.overleaf,unstable:{...window.overleaf?.unstable,store:n}}}),[n]);const c=(0,r.useMemo)((()=>({...t,scopeStore:n,scopeEventEmitter:i})),[t,n,i]);return(0,o.jsx)(s.Provider,{value:c,children:a})};function a(){const e=(0,r.useContext)(s);if(!e)throw new Error("useIdeContext is only available inside IdeProvider");return e}},56447:(e,t,n)=>{"use strict";n.d(t,{UY:()=>w,LV:()=>v});n(16280);var r=n(14041),o=n(14936),s=n(93588),i=n(64932),a=n(85289),c=n(5964),l=n(28699),h=n(60961);const d=(0,i.A)("ol-debugPdfDetach");var u=n(83566),p=n(37766),g=n(89139),m=n(31085);const f=(0,i.A)("ol-debugPdfDetach"),_=(0,r.createContext)(void 0);const w=e=>{let{children:t}=e;const[n,i]=(0,o.A)("ui.view"),[w]=(0,o.A)("openFile"),v=(0,p.A)("history:toggle",!0),b=(0,r.useCallback)((e=>{i((t=>("history"!==e&&"history"!==t||v(),"editor"===e&&w?"file":e)))}),[i,w,v]),[y,x]=(0,o.A)("ui.chatOpen"),[k,E]=(0,o.A)("ui.reviewPanelOpen"),[T,j]=(0,o.A)("ui.miniReviewPanelVisible"),[C,I]=(0,o.A)("ui.leftMenuShown");(0,g.A)("ui.toggle-left-menu",(0,r.useCallback)((e=>{I(e.detail)}),[I])),(0,g.A)("ui.toggle-review-panel",(0,r.useCallback)((()=>{E((e=>!e))}),[E]));const[S,L]=(0,o.A)("ui.pdfLayout"),[A,O]=(0,o.A)("ui.loadingStyleSheet"),R=(0,r.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"editor";L(e),b("sideBySide"===e?"editor":t),function(e){u.A.setItem("pdf.layout","sideBySide"===e?"split":"flat")}(e)}),[L,b]),{reattach:M,detach:F,isLinking:P,isLinked:D,role:N,isRedundant:X}=function(){const{role:e,setRole:t,broadcastEvent:n,addEventHandler:o,deleteEventHandler:i}=(0,s.Q2)(),[u,p]=(0,r.useState)(!1),[g,m]=(0,r.useState)(!1),[f,_]=(0,r.useState)(!1),w=(0,r.useRef)();(0,r.useEffect)((()=>{d&&h.$.warn("Effect",{isLinked:g}),p(!1)}),[g,p]),(0,r.useEffect)((()=>{d&&h.$.warn("Effect",{role:e,isLinked:g}),"detached"===e&&g&&c._("project-layout-detached")}),[e,g]),(0,r.useEffect)((()=>{w.current&&clearTimeout(w.current),"detacher"===e&&!1===g&&(w.current=setTimeout((()=>{t(null)}),u?6e4:1e4))}),[e,u,g,t]),(0,r.useEffect)((()=>{d&&h.$.warn("Effect",{isLinking:u})}),[u]);const v=(0,l.A)(e);(0,r.useEffect)((()=>{v&&!e&&c._("project-layout-reattached")}),[v,e]);const b=(0,r.useCallback)((()=>{n("reattach"),t(null),m(!1)}),[t,m,n]),y=(0,r.useCallback)((()=>{_(!1),t("detacher"),p(!0),window.open((0,a.Z)("detached").toString(),"_blank")}),[t,p]),x=(0,r.useCallback)((()=>{d&&h.$.warn("Duplicate detacher detected, turning into a regular editor again"),_(!0),m(!1),t(null)}),[t,m]),k=(0,r.useCallback)((e=>{switch(e.event){case"connected":n("up"),m(!0);break;case"up":m(!0);break;case"closed":m(!1)}}),[m,n]),E=(0,r.useCallback)((e=>{switch(e.event){case"connected":n("up"),m(!0);break;case"up":m(!0);break;case"closed":m(!1);break;case"reattach":m(!1),window.close()}}),[m,n]),T=(0,r.useCallback)((e=>{"closed"===e.event&&n("up")}),[n]),j=(0,r.useCallback)((t=>{"detacher"===e?"detacher"===t.role?x():"detached"===t.role&&k(t):"detached"===e&&("detacher"===t.role?E(t):"detached"===t.role&&T(t))}),[e,x,k,E,T]);return(0,r.useEffect)((()=>(o(j),()=>i(j))),[o,i,j]),{reattach:b,detach:y,isLinked:g,isLinking:u,role:e,isRedundant:f}}(),$="sideBySide"===S||"pdf"===n||"detacher"===N;(0,r.useEffect)((()=>{f&&h.$.warn("Layout Effect",{detachIsRedundant:X,detachRole:N,detachIsLinking:P,detachIsLinked:D}),"detacher"===N&&(X?R("sideBySide"):(P||D)&&R("flat","editor"))}),[X,N,P,D,R]);const U=(0,r.useMemo)((()=>({reattach:M,detach:F,detachIsLinked:D,detachRole:N,changeLayout:R,chatIsOpen:y,leftMenuShown:C,pdfLayout:S,pdfPreviewOpen:$,reviewPanelOpen:k,miniReviewPanelVisible:T,loadingStyleSheet:A,setChatIsOpen:x,setLeftMenuShown:I,setPdfLayout:L,setReviewPanelOpen:E,setMiniReviewPanelVisible:j,setLoadingStyleSheet:O,setView:b,view:n})),[M,F,D,N,R,y,C,S,$,k,T,A,x,I,L,E,j,O,b,n]);return(0,m.jsx)(_.Provider,{value:U,children:t})};function v(){const e=(0,r.useContext)(_);if(!e)throw new Error("useLayoutContext is only available inside LayoutProvider");return e}},71110:(e,t,n)=>{"use strict";n.d(t,{eS:()=>de,tB:()=>ue});n(16280);var r=n(14041),o=n(14936),s=n(76113),i=n(42093),a=n(52155);n(48408),n(14603),n(47566),n(98721);const c=/^[^%]*\\documentclass/;var l=n(64932),h=n(37858),d=n(45250),u=n(51275),p=n(33478),g=n(60961);const m=new URLSearchParams(window.location.search);class f{constructor(e){let{compilingRef:t,projectId:n,setChangedAt:r,setCompiling:o,setData:s,setFirstRenderDone:i,setDeliveryLatencies:a,setError:c,cleanupCompileResult:l,signal:h}=e;this.compilingRef=t,this.projectId=n,this.setChangedAt=r,this.setCompiling=o,this.setData=s,this.setFirstRenderDone=i,this.setDeliveryLatencies=a,this.setError=c,this.cleanupCompileResult=l,this.signal=h,this.projectRootDocId=null,this.clsiServerId=null,this.currentDoc=null,this.error=void 0,this.timer=0,this.defaultOptions={draft:!1,stopOnFirstError:!1},this.debouncedAutoCompile=(0,d.debounce)((()=>{this.compile({isAutoCompileOnChange:!0})}),2500,{maxWait:5e3}),this._onDocSavedCallback=null}async _awaitBufferedOps(){const e=()=>{clearTimeout(this.pendingOpTimeout),this._onDocSavedCallback&&(window.removeEventListener("doc:saved",this._onDocSavedCallback),this._onDocSavedCallback=null)};return e(),new Promise((t=>{if(!this.currentDoc?.hasBufferedOps?.())return t();this._onDocSavedCallback=()=>{e(),t()},clearTimeout(this.pendingOpTimeout),this.pendingOpTimeout=setTimeout((()=>{e(),t()}),1e4),window.addEventListener("doc:saved",this._onDocSavedCallback),window.dispatchEvent(new CustomEvent("flush-changes"))}))}async compile(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e={...this.defaultOptions,...e},e.isAutoCompileOnLoad&&(0,l.A)("ol-preventCompileOnLoad"))return;const t=this.compilingRef.current;if(this.setCompiling(!0),t)e.isAutoCompileOnChange&&this.debouncedAutoCompile();else try{await this._awaitBufferedOps(),this.setChangedAt(0),this.validationIssues=void 0;const t=this.buildCompileParams(e),n=performance.now(),r=this.getRootDocOverrideId(),o={rootDoc_id:r,draft:e.draft,check:"silent",incrementalCompilesEnabled:!this.error,stopOnFirstError:e.stopOnFirstError},s=await(0,h.TB)(`/project/${this.projectId}/compile?${t}`,{body:o,signal:this.signal}),i=Math.ceil(performance.now()-n),{deliveryLatencies:a,firstRenderDone:c}=(0,u.I)(s,i,n);this.setDeliveryLatencies((()=>a)),this.setFirstRenderDone((()=>c)),this.setError(void 0),s.options=e,s.rootDocId=r,s.clsiServerId&&(this.clsiServerId=s.clsiServerId),this.setData(s)}catch(e){g.$.error(e),this.cleanupCompileResult(),this.setError(429===e.info?.statusCode?"rate-limited":"error")}finally{this.setCompiling(!1)}}getRootDocOverrideId(){if(this.currentDoc.doc_id!==this.projectRootDocId){const e=this.currentDoc.getSnapshot();if(e&&e.split("\n").some((e=>c.test(e))))return this.currentDoc.doc_id}return null}buildPostCompileParams(){const e=new URLSearchParams;return this.clsiServerId&&e.set("clsiserverid",this.clsiServerId),e}buildCompileParams(e){const t=new URLSearchParams;return(e.isAutoCompileOnLoad||e.isAutoCompileOnChange)&&t.set("auto_compile","true"),p.lW&&t.set("enable_pdf_caching","true"),"true"===m.get("file_line_errors")&&(t.file_line_errors="true"),t}stopCompile(){const e=this.buildPostCompileParams();return(0,h.TB)(`/project/${this.projectId}/compile/stop?${e}`,{signal:this.signal}).catch((e=>{g.$.error(e),this.setError("error")})).finally((()=>{this.setCompiling(!1)}))}clearCache(){const e=this.buildPostCompileParams();return(0,h.Un)(`/project/${this.projectId}/output?${e}`,{signal:this.signal}).catch((e=>{g.$.error(e),this.setError("clear-cache")}))}setOption(e,t){this.defaultOptions[e]=t}}var _=n(5964);n(25440),n(43375),n(39225),n(13972),n(99209),n(25714),n(17561),n(66197);const w=/^LaTeX(?:3| Font)? Warning: (.*)$/,v=/^(Over|Under)full \\(v|h)box/,b=/^((?:Package|Class|Module) \b.+\b Warning:.*)$/,y=/lines? ([0-9]+)/,x=/^(?:Package|Class|Module) (\b.+\b) Warning/,k=/^([./].*):(\d+): (.*)/,E=0,T=1;class j{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.state=E,this.fileBaseNames=t.fileBaseNames||[/compiles/,/\/usr\/local/],this.ignoreDuplicates=t.ignoreDuplicates,this.data=[],this.fileStack=[],this.currentFileList=this.rootFileList=[],this.openParens=0,this.latexWarningRegex=w,this.packageWarningRegex=b,this.packageRegex=x,this.log=new C(e)}parse(){for(;!1!==(this.currentLine=this.log.nextLine());)if(this.state===E&&(this.currentLineIsError()?(this.state=T,this.currentError={line:null,file:this.currentFilePath,level:"error",message:this.currentLine.slice(2),content:"",raw:this.currentLine+"\n"}):this.currentLineIsFileLineError()?(this.state=T,this.parseFileLineError()):this.currentLineIsRunawayArgument()?this.parseRunawayArgumentError():this.currentLineIsWarning()?this.parseSingleWarningLine(this.latexWarningRegex):this.currentLineIsHboxWarning()?this.parseHboxLine():this.currentLineIsPackageWarning()?this.parseMultipleWarningLine():this.parseParensForFilenames()),this.state===T){this.currentError.content+=this.log.linesUpToNextMatchingLine(/^l\.[0-9]+/).join("\n"),this.currentError.content+="\n",this.currentError.content+=this.log.linesUpToNextWhitespaceLine(!0).join("\n"),this.currentError.content+="\n",this.currentError.content+=this.log.linesUpToNextWhitespaceLine(!0).join("\n"),this.currentError.raw+=this.currentError.content;const e=this.currentError.raw.match(/l\.([0-9]+)/);e&&null===this.currentError.line&&(this.currentError.line=parseInt(e[1],10)),this.data.push(this.currentError),this.state=E}return this.postProcess(this.data)}currentLineIsError(){return"!"===this.currentLine[0]&&"!  ==> Fatal error occurred, no output PDF file produced!"!==this.currentLine}currentLineIsFileLineError(){return k.test(this.currentLine)}currentLineIsRunawayArgument(){return this.currentLine.match(/^Runaway argument/)}currentLineIsWarning(){return!!this.currentLine.match(this.latexWarningRegex)}currentLineIsPackageWarning(){return!!this.currentLine.match(this.packageWarningRegex)}currentLineIsHboxWarning(){return!!this.currentLine.match(v)}parseFileLineError(){const e=this.currentLine.match(k);this.currentError={line:e[2],file:e[1],level:"error",message:e[3],content:"",raw:this.currentLine+"\n"}}parseRunawayArgumentError(){this.currentError={line:null,file:this.currentFilePath,level:"error",message:this.currentLine,content:"",raw:this.currentLine+"\n"},this.currentError.content+=this.log.linesUpToNextWhitespaceLine().join("\n"),this.currentError.content+="\n",this.currentError.content+=this.log.linesUpToNextWhitespaceLine().join("\n"),this.currentError.raw+=this.currentError.content;const e=this.currentError.raw.match(/l\.([0-9]+)/);return e&&(this.currentError.line=parseInt(e[1],10)),this.data.push(this.currentError)}parseSingleWarningLine(e){const t=this.currentLine.match(e);if(!t)return;const n=t[1],r=n.match(y),o=r?parseInt(r[1],10):null;this.data.push({line:o,file:this.currentFilePath,level:"warning",message:n,raw:n})}parseMultipleWarningLine(){let e=this.currentLine.match(this.packageWarningRegex);if(!e)return;const t=[e[1]];let n=this.currentLine.match(y),r=n?parseInt(n[1],10):null;const o=this.currentLine.match(this.packageRegex)[1],s=new RegExp("(?:\\("+o+"\\))*[\\s]*(.*)","i");for(;this.currentLine=this.log.nextLine();)n=this.currentLine.match(y),r=n?parseInt(n[1],10):r,e=this.currentLine.match(s),t.push(e[1]);const i=t.join(" ");this.data.push({line:r,file:this.currentFilePath,level:"warning",message:i,raw:i})}parseHboxLine(){const e=this.currentLine.match(y),t=e?parseInt(e[1],10):null;this.data.push({line:t,file:this.currentFilePath,level:"typesetting",message:this.currentLine,raw:this.currentLine})}parseParensForFilenames(){const e=this.currentLine.search(/[()]/);if(-1!==e){const t=this.currentLine[e];if(this.currentLine=this.currentLine.slice(e+1),"("===t){const e=this.consumeFilePath();if(e){this.currentFilePath=e;const t={path:e,files:[]};this.fileStack.push(t),this.currentFileList.push(t),this.currentFileList=t.files}else this.openParens++}else if(")"===t)if(this.openParens>0)this.openParens--;else if(this.fileStack.length>1){this.fileStack.pop();const e=this.fileStack[this.fileStack.length-1];this.currentFilePath=e.path,this.currentFileList=e.files}this.parseParensForFilenames()}}consumeFilePath(){if(!this.currentLine.match(/^\/?([^ ()\\]+\/)+/))return!1;let e,t=this.currentLine.search(/[ ()\\]/);for(;-1!==t&&" "===this.currentLine[t];){const e=this.currentLine.slice(0,t);if(/\.\w+$/.test(e))break;const n=this.currentLine.slice(t+1);if(/^\s*["()[\]]/.test(n))break;const r=n.search(/[ "()[\]]/);-1===r?t=-1:t+=r+1}return-1===t?(e=this.currentLine,this.currentLine=""):(e=this.currentLine.slice(0,t),this.currentLine=this.currentLine.slice(t)),e}postProcess(e){const t=[],n={error:[],warning:[],typesetting:[]},r=new Set;return e.forEach((e=>{const o=e.raw;this.ignoreDuplicates&&r.has(o)||(n[e.level]?.push(e),t.push(e),r.add(o))})),{errors:n.error,warnings:n.warning,typesetting:n.typesetting,all:t,files:this.rootFileList}}}class C{constructor(e){this.text=e.replace(/(\r\n)|\r/g,"\n");const t=this.text.split("\n");this.lines=[t[0]];for(let e=1;e<t.length;e++){const n=t[e-1],r=t[e];79===n.length&&"..."!==n.slice(-3)&&"!"!==r.charAt(0)?this.lines[this.lines.length-1]+=r:this.lines.push(r)}this.row=0}nextLine(){return this.row++,!(this.row>=this.lines.length)&&this.lines[this.row]}rewindLine(){this.row--}linesUpToNextWhitespaceLine(e){return this.linesUpToNextMatchingLine(/^ *$/,e)}linesUpToNextMatchingLine(e,t){const n=[];for(;;){const r=this.nextLine();if(!1===r)break;if(t&&r.match(/^! /)){this.rewindLine();break}if(n.push(r),r.match(e))break}return n}}var I=n(71606),S=n(31085);const L=[...[{ruleId:"hint_misplaced_alignment_tab_character",regexToMatch:/Misplaced alignment tab character &/},{ruleId:"hint_extra_alignment_tab_has_been_changed",regexToMatch:/Extra alignment tab has been changed to \\cr/},{ruleId:"hint_display_math_should_end_with",regexToMatch:/Display math should end with \$\$/},{ruleId:"hint_missing_inserted",regexToMatch:/Missing [{$] inserted\./},{ruleId:"hint_reference_undefined",regexToMatch:/Reference.+undefined/},{ruleId:"hint_there_were_undefined_references",regexToMatch:/There were undefined references/},{ruleId:"hint_citation_on_page_undefined_on_input_line",regexToMatch:/Citation .+ on page .+ undefined on input line .+/},{ruleId:"hint_label_multiply_defined_labels",regexToMatch:/(Label .+)? multiply[ -]defined( labels)?/},{ruleId:"hint_float_specifier_changed",regexToMatch:/`!?h' float specifier changed to `!?ht/},{ruleId:"hint_no_positions_in_optional_float_specifier",regexToMatch:/No positions in optional float specifier/},{ruleId:"hint_undefined_control_sequence",regexToMatch:/Undefined control sequence/,contentRegex:/^[^\n]*(\\\S+)\s*[\n]/,improvedTitle:(e,t)=>{if(t?.length&&I.H.has(t[0])){const e=t[0],n=I.H.get(e);return[`Is ${n.command} missing?`,(0,S.jsxs)("span",{children:["Is ",(0,S.jsx)("code",{children:n.command})," missing?"]})]}return e},highlightCommand:e=>e[0]},{ruleId:"hint_undefined_environment",regexToMatch:/LaTeX Error: Environment .+ undefined/,contentRegex:/\\begin\{(\S+)\}/,improvedTitle:(e,t)=>{if(t?.length&&I.P.has(t[0])){const e=t[0],n=I.P.get(e);return[`Is ${n.command} missing?`,(0,S.jsxs)("span",{children:["Is ",(0,S.jsx)("code",{children:n.command})," missing?"]})]}return e}},{ruleId:"hint_file_not_found",regexToMatch:/File .+ not found/},{ruleId:"hint_unknown_graphics_extension",regexToMatch:/LaTeX Error: Unknown graphics extension: \..+/},{ruleId:"hint_unknown_float_option_h",regexToMatch:/LaTeX Error: Unknown float option `H/},{ruleId:"hint_unknown_float_option_q",regexToMatch:/LaTeX Error: Unknown float option `q/},{ruleId:"hint_math_allowed_only_in_math_mode",regexToMatch:/LaTeX Error: \\math.+ allowed only in math mode/},{ruleId:"hint_mismatched_environment",types:["environment"],regexToMatch:/Error: `([^']{2,})' expected, found `([^']{2,})'.*/,newMessage:"Error: environment does not match \\begin{$1} ... \\end{$2}"},{ruleId:"hint_mismatched_brackets",types:["environment"],regexToMatch:/Error: `([^a-zA-Z0-9])' expected, found `([^a-zA-Z0-9])'.*/,newMessage:"Error: brackets do not match, found '$2' instead of '$1'"},{ruleId:"hint_can_be_used_only_in_preamble",regexToMatch:/LaTeX Error: Can be used only in preamble/},{ruleId:"hint_missing_right_inserted",regexToMatch:/Missing \\right inserted/},{ruleId:"hint_double_superscript",regexToMatch:/Double superscript/},{ruleId:"hint_double_subscript",regexToMatch:/Double subscript/},{ruleId:"hint_no_author_given",regexToMatch:/No \\author given/},{ruleId:"hint_somethings_wrong_perhaps_a_missing_item",regexToMatch:/LaTeX Error: Something's wrong--perhaps a missing \\item/},{ruleId:"hint_misplaced_noalign",regexToMatch:/Misplaced \\noalign/},{ruleId:"hint_no_line_here_to_end",regexToMatch:/LaTeX Error: There's no line here to end/},{ruleId:"hint_verb_ended_by_end_of_line",regexToMatch:/LaTeX Error: \\verb ended by end of line/},{ruleId:"hint_illegal_unit_of_measure_pt_inserted",regexToMatch:/Illegal unit of measure (pt inserted)/},{ruleId:"hint_extra_right",regexToMatch:/Extra \\right/},{ruleId:"hint_missing_begin_document",regexToMatch:/Missing \\begin{document}/},{ruleId:"hint_mismatched_environment2",types:["environment"],cascadesFrom:["environment"],regexToMatch:/Error: `\\end\{([^\}]+)\}' expected but found `\\end\{([^\}]+)\}'.*/,newMessage:"Error: environments do not match: \\begin{$1} ... \\end{$2}"},{ruleId:"hint_mismatched_environment3",types:["environment"],cascadesFrom:["environment"],regexToMatch:/Warning: No matching \\end found for `\\begin\{([^\}]+)\}'.*/,newMessage:"Warning: No matching \\end found for \\begin{$1}"},{ruleId:"hint_mismatched_environment4",types:["environment"],cascadesFrom:["environment"],regexToMatch:/Error: Found `\\end\{([^\}]+)\}' without corresponding \\begin.*/,newMessage:"Error: found \\end{$1} without a corresponding \\begin{$1}"}],{ruleId:"hint_character_invalid_at_this_point",regexToMatch:/^Package calc error: `(.+?)' invalid at this point/,package:"calc"},{ruleId:"hint_command_allowed_only_in_math_mode",regexToMatch:/^Package amsmath error: (.+?) allowed only in math mode/,package:"amsmath"},{ruleId:"hint_command_undefined",regexToMatch:/^LaTeX error: (.+?) undefined/,package:"LaTeX"},{ruleId:"hint_lt_in_mid_line",regexToMatch:/^LaTeX error: \\< in mid line/,package:"LaTeX"},{ruleId:"hint_a_box_was_supposed_to_be_here",regexToMatch:/^A <Box> was supposed to be here/i,package:"TeX"},{ruleId:"hint_accent_not_provided_by_font_family",regexToMatch:/^Package textcomp error: Accent (.+?) not provided by font family (.+)/,package:"textcomp"},{ruleId:"hint_argument_of_has_an_extra",regexToMatch:/^Argument of (.+?) has an extra }/,package:"TeX"},{ruleId:"hint_bad_line_or_vector_argument",regexToMatch:/^LaTeX error: Bad \\line or \\vector argument/,package:"LaTeX"},{ruleId:"hint_bad_math_environment_delimiter",regexToMatch:/^LaTeX error: Bad math environment delimiter/,package:"LaTeX"},{ruleId:"hint_begin_env_allowed_only_in_paragraph_mode",regexToMatch:/^Package amsmath error: \\begin{(.+?)} allowed only in paragraph mode/,package:"amsmath"},{ruleId:"hint_begin_env_on_input_line_x_ended_by_end_x",regexToMatch:/^LaTeX error: \\begin{(.+?)} on input line (.+?) ended by \\end{(.+?)}/,package:"LaTeX"},{ruleId:"hint_begin_split_wont_work_here",regexToMatch:/^Package amsmath error: \\begin{split} won't work here/,package:"amsmath"},{ruleId:"hint_can_be_used_only_in_preamble",regexToMatch:/^LaTeX error: Can be used only in preamble/,package:"LaTeX"},{ruleId:"hint_cannot_be_used_in_preamble",regexToMatch:/^LaTeX error: Cannot be used in preamble/,package:"LaTeX"},{ruleId:"hint_cannot_define_unicode_char_value_lt_00a0",regexToMatch:/^Package inputenc error: Cannot define Unicode char value < 00A0/,package:"inputenc"},{ruleId:"hint_cannot_determine_size_of_graphic_in_file",regexToMatch:/^Package (graphics|graphicx) error: Cannot determine size of graphic in (.+)/,package:"graphics/graphicx"},{ruleId:"hint_cannot_include_graphics_of_type",regexToMatch:/^Package (graphics|graphicx) error: Cannot include graphics of type\s*: (.+)/,package:"graphics/graphicx"},{ruleId:"hint_caption_outside_float",regexToMatch:/^LaTeX error: \\caption outside float/,package:"LaTeX"},{ruleId:"hint_command_already_defined",regexToMatch:/^LaTeX error: Command (.+?) already defined/,package:"LaTeX"},{ruleId:"hint_command_invalid_in_math_mode",regexToMatch:/^LaTeX error: Command (.+?) invalid in math mode/,package:"LaTeX"},{ruleId:"hint_command_not_defined_as_a_math_alphabet",regexToMatch:/^LaTeX error: Command (.+?) not defined as a math alphabet/,package:"LaTeX"},{ruleId:"hint_corrupted_nfss_tables",regexToMatch:/^LaTeX error: Corrupted NFSS tables/,package:"LaTeX"},{ruleId:"hint_counter_too_large",regexToMatch:/^LaTeX error: Counter too large/,package:"LaTeX"},{ruleId:"hint_dimension_too_large",regexToMatch:/^Dimension too large/,package:"TeX"},{ruleId:"hint_displaybreak_cannot_be_applied_here",regexToMatch:/^Package amsmath error: \\displaybreak cannot be applied here/,package:"amsmath"},{ruleId:"hint_division_by_0",regexToMatch:/^Package (graphics|graphicx) error: Division by 0/,package:"graphics/graphicx"},{ruleId:"hint_double_subscript",regexToMatch:/^Double subscript/,package:"TeX"},{ruleId:"hint_double_superscript",regexToMatch:/^Double superscript/,package:"TeX"},{ruleId:"hint_encoding_file_not_found",regexToMatch:/^Package fontenc error: Encoding file `(.+?)' not found/,package:"fontenc"},{ruleId:"hint_encoding_scheme_unknown",regexToMatch:/^LaTeX error: Encoding scheme `(.+?)' unknown/,package:"LaTeX"},{ruleId:"hint_environment_undefined",regexToMatch:/^LaTeX error: Environment (.+?) undefined/,package:"LaTeX"},{ruleId:"hint_erroneous_nesting_of_equation_structures",regexToMatch:/^Package amsmath error: Erroneous nesting of equation structures/,package:"amsmath"},{ruleId:"hint_extra_on_this_line",regexToMatch:/^Package amsmath error: Extra & on this line/,package:"amsmath"},{ruleId:"hint_extra_alignment_tab_has_been_changed_to_cr",regexToMatch:/^Extra alignment tab has been changed to \\cr/,package:"TeX"},{ruleId:"hint_extra_endgroup",regexToMatch:/^Extra \\endgroup/,package:"TeX"},{ruleId:"hint_extra_or",regexToMatch:/^Extra \\or/,package:"TeX"},{ruleId:"hint_extra_right",regexToMatch:/^Extra \\right/,package:"TeX"},{ruleId:"hint_extra_or_forgotten",regexToMatch:/^Extra }, or forgotten \$/,package:"TeX"},{ruleId:"hint_extra_or_forgotten_endgroup",regexToMatch:/^Extra }, or forgotten \\endgroup/,package:"TeX"},{ruleId:"hint_file_not_found",regexToMatch:/^LaTeX error: File `(.+?)' not found/,package:"LaTeX"},{ruleId:"hint_file_ended_while_scanning",regexToMatch:/^File ended while scanning (.+)/,package:"TeX"},{ruleId:"hint_float_lost",regexToMatch:/^LaTeX error: Float\(s\) lost/,package:"LaTeX"},{ruleId:"hint_font_family_unknown",regexToMatch:/^LaTeX error: Font family `(.+?)\+(.+?)' unknown/,package:"LaTeX"},{ruleId:"hint_font_not_found",regexToMatch:/^LaTeX error: Font (.+?) not found/,package:"LaTeX"},{ruleId:"hint_font_not_loaded_not_enough_room_left",regexToMatch:/^Font (.+?)=(.+?) not loaded: Not enough room left/,package:"TeX"},{ruleId:"hint_font_shape_not_found",regexToMatch:/^LaTeX error: Font shape (.+?) not found/,package:"LaTeX"},{ruleId:"hint_i_cant_find_file",regexToMatch:/^I can't find file `(.+?)'/,package:"TeX"},{ruleId:"hint_i_cant_write_on_file",regexToMatch:/^I can't write on file `(.+?)'/,package:"TeX"},{ruleId:"hint_illegal_character_in_array_arg",regexToMatch:/^LaTeX error: Illegal character in array arg/,package:"LaTeX"},{ruleId:"hint_illegal_parameter_number_in_definition_of",regexToMatch:/^Illegal parameter number in definition of (.+)/,package:"TeX"},{ruleId:"hint_illegal_unit_of_measure_pt_inserted",regexToMatch:/^Illegal unit of measure \(pt inserted\)/,package:"TeX"},{ruleId:"hint_improper_argument_for_math_accent",regexToMatch:/^Package amsmath error: Improper argument for math accent/,package:"amsmath"},{ruleId:"hint_improper_discretionary_list",regexToMatch:/^Improper discretionary list/,package:"TeX"},{ruleId:"hint_improper_hyphenation",regexToMatch:/^Improper \\hyphenation/,package:"TeX"},{ruleId:"hint_improper_prevdepth",regexToMatch:/^Improper \\prevdepth/,package:"TeX"},{ruleId:"hint_improper_spacefactor",regexToMatch:/^Improper \\spacefactor/,package:"TeX"},{ruleId:"hint_include_cannot_be_nested",regexToMatch:/^LaTeX error: \\include cannot be nested/,package:"LaTeX"},{ruleId:"hint_incompatible_list_cant_be_unboxed",regexToMatch:/^Incompatible list can't be unboxed/,package:"TeX"},{ruleId:"hint_incomplete_all_text_was_ignored_after_line",regexToMatch:/^Incomplete (.+?); all text was ignored after line (.+)/,package:"TeX"},{ruleId:"hint_infinite_glue_shrinkage_found",regexToMatch:/^Infinite glue shrinkage found (.+)/,package:"TeX"},{ruleId:"hint_interruption",regexToMatch:/^Interruption/,package:"TeX"},{ruleId:"hint_invalid_use_of_commande",regexToMatch:/^Package amsmath error: Invalid use of (.+)/,package:"amsmath"},{ruleId:"hint_keyboard_character_used_is_undefined_in_input_encoding",regexToMatch:/^Package inputenc error: Keyboard character used is undefined in input encoding (.+)/,package:"inputenc"},{ruleId:"hint_language_definition_file_not_found",regexToMatch:/^Package babel error: Language definition file (.+?)\.ldf not found /,package:"babel"},{ruleId:"hint_limit_controls_must_follow_a_math_operator",regexToMatch:/^Limit controls must follow a math operator/,package:"TeX"},{ruleId:"hint_loadclass_in_package_file",regexToMatch:/^LaTeX error: \\LoadClass in package file/,package:"LaTeX"},{ruleId:"hint_lonely_item_perhaps_a_missing_list_environment",regexToMatch:/^LaTeX error: Lonely \\item--perhaps a missing list environment/,package:"LaTeX"},{ruleId:"hint_math_alphabet_identifier_is_undefined_in_math_version",regexToMatch:/^LaTeX error: Math alphabet identifier (.+?) is undefined in math version (.+)/,package:"LaTeX"},{ruleId:"hint_math_version_is_not_defined",regexToMatch:/^LaTeX error: Math version (.+?) is not defined/,package:"LaTeX"},{ruleId:"hint_misplaced_alignment_tab_character",regexToMatch:/^Misplaced alignment tab character &/,package:"TeX"},{ruleId:"hint_misplaced_cr",regexToMatch:/^Misplaced \\cr/,package:"TeX"},{ruleId:"hint_misplaced_crcr",regexToMatch:/^Misplaced \\crcr/,package:"TeX"},{ruleId:"hint_misplaced_noalign",regexToMatch:/^Misplaced \\noalign/,package:"TeX"},{ruleId:"hint_misplaced_omit",regexToMatch:/^Misplaced \\omit/,package:"TeX"},{ruleId:"hint_missing_begin_document",regexToMatch:/^LaTeX error: Missing \\begin{document}/,package:"LaTeX"},{ruleId:"hint_missing_control_sequence_inserted",regexToMatch:/^Missing control sequence inserted/,package:"TeX"},{ruleId:"hint_missing_cr_inserted",regexToMatch:/^Missing \\cr inserted/,package:"TeX"},{ruleId:"hint_missing_delimiter_inserted",regexToMatch:/^Missing delimiter \(. inserted\)/,package:"TeX"},{ruleId:"hint_missing_endcsname_inserted",regexToMatch:/^Missing \\endcsname inserted/,package:"TeX"},{ruleId:"hint_missing_number_treated_as_zero",regexToMatch:/^Missing number, treated as zero/,package:"TeX"},{ruleId:"hint_missing_p_arg_in_array_arg",regexToMatch:/^LaTeX error: Missing p-arg in array arg/,package:"LaTeX"},{ruleId:"hint_missing_exp_in_array_arg",regexToMatch:/^LaTeX error: Missing @-exp in array arg/,package:"LaTeX"},{ruleId:"hint_missing_inserted_in_alignment_preamble",regexToMatch:/^Missing # inserted in alignment preamble/,package:"TeX"},{ruleId:"hint_missing_inserted_for_ifnum",regexToMatch:/^Missing = inserted for \\ifnum/,package:"TeX"},{ruleId:"hint_missing_inserted_for_ifdim",regexToMatch:/^Missing = inserted for \\ifdim/,package:"TeX"},{ruleId:"hint_missing_inserted",regexToMatch:/^Missing \$ inserted/,package:"TeX"},{ruleId:"hint_missing_endgroup_inserted",regexToMatch:/^Missing \\endgroup inserted/,package:"TeX"},{ruleId:"hint_missing_right_inserted",regexToMatch:/^Missing \\right\. inserted/,package:"TeX"},{ruleId:"hint_missing_inserted",regexToMatch:/^Missing \{ inserted/,package:"TeX"},{ruleId:"hint_missing_inserted",regexToMatch:/^Missing } inserted/,package:"TeX"},{ruleId:"hint_multiple_labels_label_tiquette_will_be_lost",regexToMatch:/^Package amsmath error: Multiple \\label's: label (.+?) will be lost/,package:"amsmath"},{ruleId:"hint_multiple_tag",regexToMatch:/^Package amsmath error: Multiple \\tag/,package:"amsmath"},{ruleId:"hint_no_counter_defined",regexToMatch:/^LaTeX error: No counter '(.+?)' defined/,package:"LaTeX"},{ruleId:"hint_no_cyrillic_encoding_definition_files_were_found",regexToMatch:/^Package babel error: No Cyrillic encoding definition files were found/,package:"babel"},{ruleId:"hint_no_declaration_for_shape",regexToMatch:/^LaTeX error: No declaration for shape (.+)/,package:"LaTeX"},{ruleId:"hint_no_driver_specified",regexToMatch:/^Package (color|graphics|graphicx) error: No driver specified/,package:"color/graphics/graphicx"},{ruleId:"hint_no_room_for_a_new_register",regexToMatch:/^No room for a new (.+)/,package:"TeX"},{ruleId:"hint_no_title_given",regexToMatch:/^LaTeX error: No \\title given/,package:"LaTeX"},{ruleId:"hint_not_a_letter",regexToMatch:/^Not a letter/,package:"TeX"},{ruleId:"hint_not_in_outer_par_mode",regexToMatch:/^LaTeX error: Not in outer par mode/,package:"LaTeX"},{ruleId:"hint_number_too_big",regexToMatch:/^Number too big/,package:"TeX"},{ruleId:"hint_ok_see_the_transcript_file",regexToMatch:/^OK \(see the transcript file\)/,package:"TeX"},{ruleId:"hint_old_form_should_be_begin",regexToMatch:/^Package amsmath error: Old form (.+?) should be \\begin{(.+?)} /,package:"amsmath"},{ruleId:"hint_only_one_is_allowed_per_tab",regexToMatch:/^Only one # is allowed per tab/,package:"TeX"},{ruleId:"hint_option_clash_for_package",regexToMatch:/^LaTeX error: Option clash for package (.+)/,package:"LaTeX"},{ruleId:"hint_page_height_already_too_large",regexToMatch:/^LaTeX error: Page height already too large/,package:"LaTeX"},{ruleId:"hint_paragraph_ended_before_command_was_complete",regexToMatch:/^Paragraph ended before (.+?) was complete/,package:"TeX"},{ruleId:"hint_please_type_a_command_or_say_end",regexToMatch:/^\(Please type a command or say `\\end'\)/,package:"TeX"},{ruleId:"hint_pushtabs_and_poptabs_dont_match",regexToMatch:/^LaTeX error: \\pushtabs and \\poptabs don't match/,package:"LaTeX"},{ruleId:"hint_requirepackage_or_loadclass_in_options_section",regexToMatch:/^LaTeX error: \\RequirePackage or \\LoadClass in Options Section/,package:"LaTeX"},{ruleId:"hint_rotation_not_supported",regexToMatch:/^Package (graphics|graphicx) error: Rotation not supported/,package:"graphics/graphicx"},{ruleId:"hint_runaway",regexToMatch:/^Runaway (.+)/,package:"TeX"},{ruleId:"hint_you_havent_specified_a_language_option",regexToMatch:/^Package babel error: You haven't specified a language option/,package:"babel"},{ruleId:"hint_calculating_math_sizes_for_size",regexToMatch:/^LaTeX (Font )?(Warning|Info): Calculating math sizes for size (.+)/,package:"LaTeX"},{ruleId:"hint_checking_defaults_for",regexToMatch:/^LaTeX (Font )?(Warning|Info): Checking defaults for (.+)/,package:"LaTeX"},{ruleId:"hint_citation_on_page_undefined",regexToMatch:/^LaTeX (Font )?(Warning|Info): Citation `(.+?)' on page (.+?) undefined/,package:"LaTeX"},{ruleId:"hint_command_invalid_in_math_mode",regexToMatch:/^LaTeX (Font )?(Warning|Info): Command (.+?) invalid in math mode/,package:"LaTeX"},{ruleId:"hint_document_class",regexToMatch:/^LaTeX (Font )?(Warning|Info): Document Class\s*: (.+)/,package:"LaTeX"},{ruleId:"hint_empty_thebibliography_environment",regexToMatch:/^LaTeX (Font )?(Warning|Info): Empty `thebibliography' environment/,package:"LaTeX"},{ruleId:"hint_encoding_has_changed_to_for",regexToMatch:/^LaTeX (Font )?(Warning|Info): Encoding (.+?) has changed to (.+?) for/,package:"LaTeX"},{ruleId:"hint_end_occurred_inside_a_group_at_level",regexToMatch:/^\(\\end occurred inside a group at level (.+)\)/,package:"TeX"},{ruleId:"hint_when_condition_on_line_was_incomplete",regexToMatch:/^\(\\end occurred when (.+?) on line (.+) was incomplete\)/,package:"TeX"},{ruleId:"hint_external_font_loaded_for_size",regexToMatch:/^LaTeX (Font )?(Warning|Info): External font (.+?) loaded for size (.+)/,package:"LaTeX"},{ruleId:"hint_faking_for_font_family_in_ts1_encoding",regexToMatch:/^Package TeXtcomp (Warning|Info): Faking (.+?) for font family (.+?) in TS1 encoding/,package:"TeXtcomp"},{ruleId:"hint_file_already_exists_on_the_system_not_generating_it_from_this_source",regexToMatch:/^LaTeX (Font )?(Warning|Info): File `(.+?)' already exists on the system\.\nNot generating it from this source\./,package:"LaTeX"},{ruleId:"hint_file",regexToMatch:/^LaTeX (Font )?(Warning|Info): File\s*: (.+)/,package:"LaTeX"},{ruleId:"hint_file_font_definition",regexToMatch:/^LaTeX (Font )?(Warning|Info): File\s*: (.+?)\.fd (.+)/,package:"LaTeX"},{ruleId:"hint_float_too_large_for_page_by",regexToMatch:/^LaTeX (Font )?(Warning|Info): Float too large for page by (.+)/,package:"LaTeX"},{ruleId:"hint_font_shape_in_size_not_available_external_font_used",regexToMatch:/^LaTeX (Font )?(Warning|Info): Font shape (.+?) in size (.+?) not available\nexternal font (.+?) used/,package:"LaTeX"},{ruleId:"hint_font_shape_in_size_not_available_size_substituted",regexToMatch:/^LaTeX (Font )?(Warning|Info): Font shape (.+?) in size (.+?) not available\nsize (.+?) substituted/,package:"LaTeX"},{ruleId:"hint_font_shape_in_size_not_available_shape_forme_tried",regexToMatch:/^LaTeX (Font )?(Warning|Info): Font shape (.+?) in size (.+?) not available\nshape (.+?) tried/,package:"LaTeX"},{ruleId:"hint_font_shape_forme_undefined_using_autre_forme_instead",regexToMatch:/^LaTeX (Font )?(Warning|Info): Font shape (.+?) undefined\. Using `(.+?)' instead/,package:"LaTeX"},{ruleId:"hint_font_shape_forme_will_be_scaled_to_size_taille_",regexToMatch:/^LaTeX (Font )?(Warning|Info): Font shape (.+?) will be scaled to size (.+)/,package:"LaTeX"},{ruleId:"hint_foreign_command",regexToMatch:/^Package amsmath (Warning|Info): Foreign command (.+?);/,package:"amsmath"},{ruleId:"hint_form_feed_has_been_converted_to_blank_line",regexToMatch:/^LaTeX (Font )?(Warning|Info): Form feed has been converted to Blank Line/,package:"LaTeX"},{ruleId:"hint_float_specifier_changed",regexToMatch:/^LaTeX (Font )?(Warning|Info): `(.+?)' float specifier changed to `(.+?)'/,package:"LaTeX"},{ruleId:"hint_ignoring_text_after_end",regexToMatch:/^LaTeX (Font )?(Warning|Info): Ignoring text `(.+?)' after \\end{(.+?)}/,package:"LaTeX"},{ruleId:"hint_label_multiply_defined",regexToMatch:/^LaTeX (Font )?(Warning|Info): Label `(.+?)' multiply defined/,package:"LaTeX"},{ruleId:"hint_labels_may_have_changed_rerun_to_get_cross_references_right",regexToMatch:/^LaTeX (Font )?(Warning|Info): Label\(s\) may have changed\. Rerun to get cross-references right\./,package:"LaTeX"},{ruleId:"hint_loose_hbox_badness",regexToMatch:/^Loose \\hbox \(badness (.+?)\) (.+)/,package:"TeX"},{ruleId:"hint_loose_vbox_badness",regexToMatch:/^Loose \\vbox \(badness (.+?)\) (.+)/,package:"TeX"},{ruleId:"hint_making_an_active_character",regexToMatch:/^Package babel (Warning|Info): Making (.+?) an active character/,package:"babel"},{ruleId:"hint_marginpar_on_page_moved",regexToMatch:/^LaTeX (Font )?(Warning|Info): Marginpar on page (.+?) moved/,package:"LaTeX"},{ruleId:"hint_missing_character_there_is_no_in_font",regexToMatch:/^Missing character\s*: There is no (.+?) in font (.+?)!/,package:"TeX"},{ruleId:"hint_no_author_given",regexToMatch:/^LaTeX (Font )?(Warning|Info): No \\author given/,package:"LaTeX"},{ruleId:"hint_no_auxiliary_output_files",regexToMatch:/^LaTeX (Font )?(Warning|Info): No auxiliary output files/,package:"LaTeX"},{ruleId:"hint_no_characters_defined_by_input_encoding_change_to",regexToMatch:/^LaTeX (Font )?(Warning|Info): No characters defined by input encoding change to (.+)/,package:"LaTeX"},{ruleId:"hint_no_file",regexToMatch:/^LaTeX (Font )?(Warning|Info): No file (.+)/,package:"LaTeX"},{ruleId:"hint_no_hyphenation_patterns_were_loaded_for_the_language",regexToMatch:/^Package babel (Warning|Info): No hyphenation patterns were loaded for the language `(.+?)'/,package:"babel"},{ruleId:"hint_no_input_encoding_specified_for_language",regexToMatch:/^Package babel (Warning|Info): No input encoding specified for (.+?) language/,package:"babel"},{ruleId:"hint_no_positions_in_optional_float_specifier",regexToMatch:/^LaTeX (Font )?(Warning|Info): No positions in optional float specifier\./,package:"LaTeX"},{ruleId:"hint_oldstyle_digits_unavailable_for_family",regexToMatch:/^LaTeX (Font )?(Warning|Info): Oldstyle digits unavailable for family (.+)/,package:"Textcomp"},{ruleId:"hint_optional_argument_of_twocolumn_too_tall_on_page",regexToMatch:/^LaTeX (Font )?(Warning|Info): Optional argument of \\twocolumn too tall on page (.+)/,package:"LaTeX"},{ruleId:"hint_oval_circle_or_line_size_unavailable",regexToMatch:/^LaTeX (Font )?(Warning|Info): \\oval, \\circle, or \\line size unavailable/,package:"LaTeX"},{ruleId:"hint_overfull_hbox_too_wide_quelque_part_",regexToMatch:/^Overfull \\hbox \((.+?)pt too wide\) (.+)/,package:"TeX"},{ruleId:"hint_overfull_vbox_pt_too_wide",regexToMatch:/^Overfull \\vbox \((.+?)pt too wide\)\) (.+)/,package:"TeX"},{ruleId:"hint_overwriting_encoding_scheme_quelque_chose_defaults",regexToMatch:/^LaTeX (Font )?(Warning|Info): Overwriting encoding scheme (.+?) defaults/,package:"LaTeX"},{ruleId:"hint_overwriting_in_version",regexToMatch:/^LaTeX (Font )?(Warning|Info): Overwriting (.+?) in version `(.+)'/,package:"LaTeX"},{ruleId:"hint_package",regexToMatch:/^LaTeX (Font )?(Warning|Info): Package: (.+)/,package:"LaTeX"},{ruleId:"hint_redeclaring_font_encoding",regexToMatch:/^LaTeX (Font )?(Warning|Info): Redeclaring font encoding (.+)/,package:"LaTeX"},{ruleId:"hint_redeclaring_math_accent",regexToMatch:/^LaTeX (Font )?(Warning|Info): Redeclaring math accent (.+)/,package:"LaTeX"},{ruleId:"hint_redeclaring_math_alphabet",regexToMatch:/^LaTeX (Font )?(Warning|Info): Redeclaring math alphabet (.+)/,package:"LaTeX"},{ruleId:"hint_redeclaring_math_symbol",regexToMatch:/^LaTeX (Font )?(Warning|Info): Redeclaring math symbol (.+)/,package:"LaTeX"},{ruleId:"hint_redeclaring_math_version",regexToMatch:/^LaTeX (Font )?(Warning|Info): Redeclaring math version (.+)/,package:"LaTeX"},{ruleId:"hint_redeclaring_symbol_font",regexToMatch:/^LaTeX (Font )?(Warning|Info): Redeclaring symbol font (.+)/,package:"LaTeX"},{ruleId:"hint_reference_on_page_undefined",regexToMatch:/^LaTeX (Font )?(Warning|Info): Reference `(.+?)' on page (.+?) undefined/,package:"LaTeX"},{ruleId:"hint_size_substitutions_with_differences_up_to_have_occurred",regexToMatch:/^LaTeX (Font )?(Warning|Info): Size substitutions with differences up to (.+?) have occurred/,package:"LaTeX"},{ruleId:"hint_some_font_shapes_were_not_available_defaults_substituted",regexToMatch:/^LaTeX (Font )?(Warning|Info): Some font shapes were not available, defaults substituted/,package:"LaTeX"},{ruleId:"hint_tab_has_been_converted_to_blank_space",regexToMatch:/^LaTeX (Font )?(Warning|Info): Tab has been converted to Blank Space/,package:"LaTeX"},{ruleId:"hint_text_page_contains_only_floats",regexToMatch:/^LaTeX (Font )?(Warning|Info): text page (.+?) contains only floats/,package:"LaTeX"},{ruleId:"hint_there_were_multiply_defined_labels",regexToMatch:/^LaTeX (Font )?(Warning|Info): There were multiply-defined labels/,package:"LaTeX"},{ruleId:"hint_there_were_undefined_references",regexToMatch:/^LaTeX (Font )?(Warning|Info): There were undefined references/,package:"LaTeX"},{ruleId:"hint_tight_hbox_badness",regexToMatch:/^Tight \\hbox \(badness (.+?)\) (.+)/,package:"TeX"},{ruleId:"hint_tight_vbox_badness",regexToMatch:/^Tight \\vbox \(badness (.+?)\) (.+)/,package:"TeX"},{ruleId:"hint_try_loading_font_information_for",regexToMatch:/^LaTeX (Font )?(Warning|Info): Try loading font information for (.+?)\+(.+)/,package:"LaTeX"},{ruleId:"hint_unable_to_redefine_math_accent",regexToMatch:/^Package amsmath (Warning|Info): Unable to redefine math accent (.+)/,package:"amsmath"},{ruleId:"hint_hbox_badness_detected_at_line",regexToMatch:/^Underfull \\hbox \(badness (.+?)\) (.+?) detected at line (.+)/,package:"TeX"},{ruleId:"hint_hbox_badness_has_occurred_while_output_is_active",regexToMatch:/^Underfull \\hbox \(badness (.+?)\) (.+?) has occurred while \\output is active/,package:"TeX"},{ruleId:"hint_hbox_badness_in_alignment_at_lines",regexToMatch:/^Underfull \\hbox \(badness (.+?)\) (.+?) in alignment at lines (.+)/,package:"TeX"},{ruleId:"hint_hbox_badness_in_paragraph_at_lines",regexToMatch:/^Underfull \\hbox \(badness (.+?)\) (.+?) in paragraph at lines (.+)/,package:"TeX"},{ruleId:"hint_vbox_badness_detected_at_line",regexToMatch:/^Underfull \\vbox \(badness (.+?)\) (.+?) detected at line (.+)/,package:"TeX"},{ruleId:"hint_vbox_badness_has_occurred_while_output_is_active",regexToMatch:/^Underfull \\vbox \(badness (.+?)\) (.+?) has occurred while \\output is active/,package:"TeX"},{ruleId:"hint_vbox_badness_in_alignment_at_lines",regexToMatch:/^Underfull \\vbox \(badness (.+?)\) (.+?) in alignment at lines (.+)/,package:"TeX"},{ruleId:"hint_unused_global_options",regexToMatch:/^LaTeX (Font )?(Warning|Info): Unused global option\(s\)\s*: \[(.+?)]/,package:"LaTeX"},{ruleId:"hint_writing_file",regexToMatch:/^LaTeX (Font )?(Warning|Info): Writing file `(.+?)'/,package:"LaTeX"},{ruleId:"hint_writing_text_before_end_as_last_line_of",regexToMatch:/^LaTeX (Font )?(Warning|Info): Writing text `(.+?)' before \\end{(.+?)} as last line of (.+)/,package:"LaTeX"},{ruleId:"hint_you_have_more_than_once_selected_the_attribute_for_language",regexToMatch:/^Package babel (Warning|Info): You have more than once selected the attribute `(.+?)' for language (.+)/,package:"babel"},{ruleId:"hint_you_have_requested_package_or_class_but_the_package_or_class_provides",regexToMatch:/^LaTeX (Font )?(Warning|Info): You have requested (package|class) `(.+?)', but the (package|class) provides `(.+?)'/,package:"LaTeX"},{ruleId:"hint_you_have_requested_release_date_of_latex_but_only_release_ancienne_date_is_available",regexToMatch:/^LaTeX (Font )?(Warning|Info): You have requested release `(.+?)' of LaTeX, but only release `(.+?)' is available/,package:"LaTeX"},{ruleId:"hint_you_have_requested_on_line_version_of_but_only_version_is_available",regexToMatch:/^LaTeX (Font )?(Warning|Info): You have requested, on line (.+?), version `(.+?)' of (.+?), but only version `(.+?)' is available/,package:"LaTeX"}],A={parse(e,t){const n="string"==typeof e?new j(e,t).parse():e,r={};for(const e of n.all){const t=L.find((t=>t.regexToMatch.test(e.message)));if(t){if(t.ruleId&&(e.ruleId=t.ruleId),t.newMessage&&(e.message=e.message.replace(t.regexToMatch,t.newMessage)),t.contentRegex){const n=e.content.match(t.contentRegex);n&&(e.contentDetails=n.slice(1))}if(e.contentDetails&&t.improvedTitle){const n=t.improvedTitle(e.message,e.contentDetails);Array.isArray(n)?e.message=n[0]:e.message=n}if(e.contentDetails&&t.highlightCommand&&(e.command=t.highlightCommand(e.contentDetails)),t.cascadesFrom)for(const n of t.cascadesFrom)r[n]&&(e.suppressed=!0);if(t.types)for(const e of t.types)r[e]=!0}}for(const[e,t]of Object.entries(n))"object"==typeof t&&t.length>0&&(n[e]=Array.from(t).filter((e=>!e.suppressed)));return n}},O=/^\[(\d+)].*>\s(INFO|WARN|ERROR)\s-\s(.*)$/,R=/^Warning--(.+)\n--line (\d+) of file (.+)$/m,M=/^Warning--(.+)$/m,F=/^(.*)---line (\d+) of file (.*)\n([^]+?)\nI'm skipping whatever remains of this entry$/m,P=/^(A bad cross reference---entry ".+?"\nrefers to entry.+?, which doesn't exist)$/m,D=/^(.*)\n?---line (\d+) of file (.*)\n([^]+?)\nI'm skipping whatever remains of this command$/m,N=/^(.*?)\nwhile executing---line (\d+) of file (.*)/m,X={INFO:"info",WARN:"warning",ERROR:"error"},$=function(e){return function(t,n){const[r,o]=t,[s,i]=n,[a,c]=function(t,n,r){let o,s=t;const i=[];let a=0;for(;o=n.exec(s);){a++;const t=r(o);if(null!=e&&a>=e)return[i,""];i.push(t),s=o.input.slice(0,o.index)+o.input.slice(o.index+o[0].length+1,o.input.length)}return[i,s]}(o,s,i);return[r.concat(a),c]}};class U{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"!=typeof e)throw new Error("BibLogParser Error: text parameter must be a string");this.text=e.replace(/(\r\n)|\r/g,"\n"),this.options=t,this.lines=e.split("\n"),this.warningParsers=[[R,function(e){const[t,n,r,o]=e;return{file:o,level:"warning",message:n,line:r,raw:t}}],[M,function(e){const[t,n]=e;return{file:"",level:"warning",message:n,line:"",raw:t}}]],this.errorParsers=[[F,function(e){const[t,n,r,o,s]=e;return{file:o,level:"error",message:n+"\n"+s,line:r,raw:t}}],[P,function(e){const[t,n]=e;return{file:"",level:"error",message:n,line:"",raw:t}}],[D,function(e){const[t,n,r,o,s]=e;return{file:o,level:"error",message:n+"\n"+s,line:r,raw:t}}],[N,function(e){const[t,n,r,o]=e;return{file:o,level:"error",message:n,line:r,raw:t}}]]}parseBibtex(){const[e,t]=this.warningParsers.reduce($(this.options.maxErrors),[[],this.text]),[n]=this.errorParsers.reduce($(this.options.maxErrors),[[],t]);return{all:e.concat(n),errors:n,warnings:e,files:[],typesetting:[]}}parseBiber(){const e={all:[],errors:[],warnings:[],files:[],typesetting:[]};return this.lines.forEach((function(t){const n=t.match(O);if(n){const[t,,r,o]=n,s={file:"",level:X[r]||"INFO",message:o,line:"",raw:t},i=s.message.match(/^BibTeX subsystem: \/.+\/(\w+\.\w+)_.+, line (\d+), (.+)$/);if(i){const[,e,t,n]=i;s.file=e,s.line=t,s.message=n}switch(e.all.push(s),s.level){case"error":return e.errors.push(s);case"warning":return e.warnings.push(s)}}})),e}parse(){const e=this.lines[0];if(e.match(/^.*INFO - This is Biber.*$/))return this.parseBiber();if(e.match(/^This is BibTeX, Version.+$/))return this.parseBibtex();throw new Error("BibLogParser Error: cannot determine whether text is biber or bibtex output")}}var V=n(35287);n(63308);const B=/^(Reference|Citation).+undefined on input line/,W=1048576,H=W;let z=1;const J=async(e,t,n)=>{const r={log:null,logEntries:{errors:[],warnings:[],typesetting:[]}};function o(e,t){for(const n in r.logEntries)if(e[n]){for(const r of e[n])t&&(r.type=e.type),r.file&&(r.file=K(r.file)),r.key="compile-log-entry-"+z++;r.logEntries[n].push(...e[n])}}const s=e.get("output.log");if(s){r.log=await G(q(s,t.pdfDownloadDomain),n,W);try{let{errors:e,warnings:n,typesetting:s}=A.parse(r.log,{ignoreDuplicates:!0});"stopped-on-first-error"===t.status&&(n=n.filter((e=>!function(e){return B.test(e.message)}(e)))),o({errors:e,warnings:n,typesetting:s})}catch(e){g.$.warn(e)}}const i=[];for(const[t,n]of e)t.endsWith(".blg")&&i.push(n);for(const e of i){const r=await G(q(e,t.pdfDownloadDomain),n,H);try{const{errors:e,warnings:t}=new U(r,{maxErrors:100}).parse();o({errors:e,warnings:t},"BibTeX:")}catch(e){}}return r.logEntries.all=[...r.logEntries.errors,...r.logEntries.warnings,...r.logEntries.typesetting],r};function q(e,t){return e.build&&t?`${t}${e.url}`:`${window.origin}${e.url}`}function K(e,t){return e=(e=(e=e.replace(/\/\//g,"/")).replace(/^.*\/compiles\/[0-9a-f]{24}(-[0-9a-f]{24})?\/(\.\/)?/,"")).replace(/^\/compile\//,""),t&&(e=e.replace(/^\.\//,t+"/")),e}async function G(e,t,n){let r="";try{const o=new AbortController;t.addEventListener("abort",(()=>{o.abort()}));const s=await fetch(e,{signal:o.signal});if(!s.ok)throw new Error("Failed to fetch log file");const i=s.body.pipeThrough(new TextDecoderStream);for await(const e of i)r+=e,r.length>n&&o.abort()}catch(e){g.$.warn(e)}return r}var Y=n(67353),Q=n(66666),Z=n(10646);const ee=["bbl","gls","ind"],te=["output.fls","output.fdb_latexmk"];var ne=n(56447),re=n(85960),oe=n(71573),se=n(89997),ie=n(66020),ae=n(17112),ce=n(77135),le=n(83566);const he=(0,r.createContext)(void 0),de=e=>{let{children:t}=e;const n=(0,Y.nK)(),{hasPremiumCompile:c,isProjectOwner:l}=(0,Z.mi)(),{openDocId:h}=(0,ce.TS)(),{_id:d,rootDocId:u}=(0,Q.O)(),{pdfPreviewOpen:m}=(0,ne.LV)(),{features:w,alphaProgram:v,labsProgram:b}=(0,re.ur)(),{fileTreeData:y}=(0,oe.Q)(),{findEntityByPath:x}=(0,se.m8)(),[k,E]=(0,r.useState)(!1),[T,j]=(0,r.useState)(!1),[C,I]=(0,r.useState)(!1),[L,A]=(0,s.A)("pdf.logEntries"),[O,R]=(0,o.A)("pdf.logEntryAnnotations"),{userSettings:M}=(0,ie.dk)(),{pdfViewer:F,syntaxValidation:P}=M,[,D]=(0,s.A)("pdf.downloadUrl"),[,N]=(0,s.A)("pdf.url"),[X,$]=(0,r.useState)();(0,r.useEffect)((()=>{D(X?.pdfDownloadUrl),N(X?.pdfUrl)}),[X,D,N]);const[U,B]=(0,o.A)("pdf.uncompiled"),[W,H]=(0,r.useState)(!1),[z,G]=(0,r.useState)(),[de,ue]=(0,r.useState)(),pe=de?de.rootDocId??u:null,[ge,me]=(0,r.useState)((()=>()=>{})),[fe,_e]=(0,r.useState)({}),[we,ve]=(0,r.useState)(!1),[be,ye]=(0,r.useState)(!1),[xe,ke]=(0,r.useState)(!1),[Ee,Te]=(0,r.useState)(!1),je=(0,r.useCallback)((()=>{ke((e=>(e||(0,_.JY)("ide-open-logs-once"),!e)))}),[ke]),[Ce,Ie]=(0,r.useState)(),[Se,Le]=(0,r.useState)(),[Ae,Oe]=(0,r.useState)(),[Re,Me]=(0,r.useState)(),[Fe,Pe]=(0,r.useState)(),[De,Ne]=(e=>{const[t,n]=(0,r.useState)(),o=(0,r.useRef)(e);(0,r.useEffect)((()=>{o.current=e}),[e]);const s=(0,r.useRef)(null);return(0,r.useEffect)((()=>{if(e){const t=le.A.getItem(`pdf.position.${e}`);t&&(g.$.log("loaded position for",e,t),s.current=t,n(t))}}),[e]),(0,r.useEffect)((()=>{o.current&&t&&t!==s.current&&(g.$.log("storing position for",o.current,t),le.A.setItem(`pdf.position.${o.current}`,t))}),[t]),[t,n]})(pe),[Xe,$e]=(0,i.A)(`autocompile_enabled:${d}`,!1,!0),[Ue,Ve]=(0,i.A)(`draft:${d}`,!1,!0),[Be,We]=(0,i.A)(`stop_on_first_error:${d}`,!1,!0),[He,ze]=(0,r.useState)(!1),[Je,qe]=(0,i.A)(`stop_on_validation_error:${d}`,!0,!0),[Ke]=(0,o.A)("editor.sharejs_doc"),[Ge,Ye]=(0,o.A)("hasLintingError"),[Qe,Ze]=(0,r.useState)(0),{signal:et}=(0,a.A)(),tt=(0,r.useCallback)((()=>{$(void 0),A(null),R({})}),[$,A,R]),nt=(0,r.useRef)(!1);(0,r.useEffect)((()=>{nt.current=k}),[k]);const rt=(0,r.useCallback)((e=>function(e,t,n){const r=(0,V.pD)(t,n),o={},s={};for(const n of e)if(n.file){n.file=K(n.file,r);const e=(0,V.Xk)(t,n.file)?.entity;if(e){e._id in o||(o[e._id]=[]);const t={id:n.key,entryIndex:o[e._id].length,row:n.line-1,type:"error"===n.level?"error":"warning",text:n.message,source:"compile",ruleId:n.ruleId,command:n.command};"typesetting"!==n.level&&(s[n.line]||(t.firstOnLine=!0,s[n.line]=!0)),o[e._id].push(t)}}return o}(e,y,pe)),[y,pe]),ot=(0,r.useRef)(rt);(0,r.useEffect)((()=>{ot.current=rt}),[rt]);const[st]=(0,r.useState)((()=>new f({projectId:d,setChangedAt:Ze,setCompiling:E,setData:ue,setFirstRenderDone:me,setDeliveryLatencies:_e,setError:Ie,cleanupCompileResult:tt,compilingRef:nt,signal:et})));(0,r.useEffect)((()=>{st.currentDoc=Ke}),[st,Ke]),(0,r.useEffect)((()=>{st.projectRootDocId=u}),[st,u]),(0,r.useEffect)((()=>{st.setOption("draft",Ue)}),[st,Ue]),(0,r.useEffect)((()=>{st.setOption("stopOnFirstError",Be)}),[st,Be]),(0,r.useEffect)((()=>{B(Qe>0)}),[B,Qe]),(0,r.useEffect)((()=>{H(Qe>0)}),[H,Qe]),(0,r.useEffect)((()=>{!we&&Ke&&(ve(!0),st.compile({isAutoCompileOnLoad:!0}))}),[we,Ke,st]),(0,r.useEffect)((()=>{I(void 0!==w?.compileTimeout&&w.compileTimeout<=60)}),[w]),(0,r.useEffect)((()=>{if(C&&k&&l){const e=window.setTimeout((()=>{j(!0)}),3e4);return()=>{window.clearTimeout(e)}}}),[k,l,C]);const it=(0,ae.u)("compile-log-events"),at=(0,r.useRef)(null),ct=(0,r.useRef)({}),lt=(0,r.useCallback)((e=>{ct.current[e]=!0}),[]);(0,r.useEffect)((()=>{const e=new AbortController,t=ct.current;if(ct.current={},de){if(de.clsiServerId&&G(de.clsiServerId),de.outputFiles){const n=new Map;for(const e of de.outputFiles)n.set(e.path,e);"success"===de.status&&$(function(e,t,n){const r=e.get("output.pdf");if(!r)return null;const o=new URLSearchParams({compileGroup:n.compileGroup});return n.clsiServerId&&o.set("clsiserverid",n.clsiServerId),p.lW&&o.set("enable_pdf_caching","true"),r.pdfUrl=`${q(r,n.pdfDownloadDomain)}?${o}`,o.set("popupDownload","true"),r.pdfDownloadUrl=`/download/project/${t}/build/${r.build}/output/output.pdf?${o}`,r}(n,d,de)),Le(((e,t,n,r)=>{const o={top:[],other:[]};if(e){const s=new URLSearchParams;t&&s.set("clsiserverid",t),n&&s.set("compileGroup",n);const i=s.toString(),a=[];for(const t of e.values())te.includes(t.path)||(t.main=t.path.startsWith("output."),i.length&&(t.url+=`?${i}`),a.push(t));a.sort(((e,t)=>e.main&&!t.main?-1:t.main&&!e.main?1:e.path.localeCompare(t.path,void 0,{numeric:!0})));for(const e of a)ee.includes(e.type)?o.top.push(e):"pdf"===e.type&&!0===e.main||o.other.push(e);const c=[...o.top,...o.other];r&&c.length>0&&(c.forEach((e=>s.append("files",e.path))),o.archive={...r,fileCount:c.length,url:`${r.url}?${s.toString()}`})}return o})(n,de.clsiServerId,de.compileGroup,de.outputFilesArchive)),R(null),A(null),Oe(void 0),J(n,de,e.signal).then((e=>{if(Oe(e.log),A(e.logEntries),R(ot.current(e.logEntries.all)),!v&&(["success","stopped-on-first-error"].includes(de.status)&&(0,_.MY)("compile-result",{errors:e.logEntries.errors.length,warnings:e.logEntries.warnings.length,typesetting:e.logEntries.typesetting.length,newPdfPreview:!0,stopOnFirstError:de.options.stopOnFirstError},.01),it||b)){const n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t={};for(const n of e){const e=`${n.level}_${n.ruleId}`;t[e]=t[e]?t[e]+1:1}return t}(e.logEntries.all),r=de.rootDocId||st.projectRootDocId,o=at.current;at.current={ruleCounts:n,rootDocId:r};const s=o&&o.rootDocId===r?((e,t)=>{const n={};for(const[r,o]of Object.entries(e)){const e=t[r]??0;n[`delta_${r}`]=o-e}for(const[r,o]of Object.entries(t))r in e||(n[r]=0,n[`delta_${r}`]=-o);return n})(n,o.ruleCounts):{};(0,_._)("compile-log-entries",{status:de.status,stopOnFirstError:de.options.stopOnFirstError,isAutoCompileOnLoad:!!de.options.isAutoCompileOnLoad,isAutoCompileOnChange:!!de.options.isAutoCompileOnChange,rootDocId:r,...t,...n,...s})}}))}switch(de.status){case"success":Ie(void 0),ke(!1);break;case"stopped-on-first-error":Ie(void 0),ke(!0);break;case"clsi-maintenance":case"compile-in-progress":case"exited":case"failure":case"project-too-large":case"rate-limited":case"terminated":case"too-recently-compiled":Ie(de.status);break;case"timedout":Ie("timedout"),!c&&l&&(0,_.tN)("subscription-funnel","editor-click-feature","compile-timeout");break;case"autocompile-backoff":de.options.isAutoCompileOnLoad||(Ie("autocompile-disabled"),$e(!1));break;case"unavailable":Ie("clsi-unavailable");break;case"validation-problems":Ie("validation-problems"),Me(de.validationProblems);break;default:Ie("error")}ze("stopped-on-first-error"===de.status)}return()=>{e.abort()}}),[de,n,v,b,w,it,c,l,d,$e,G,A,R,$,st]),(0,r.useEffect)((()=>{Ce&&ke(!0)}),[Ce]);const ht=Boolean(Xe&&P&&Ge),dt=Je&&ht,ut=Boolean(Xe&&m&&!dt),pt=Boolean(ut&&U&&we);(0,r.useEffect)((()=>{ut?Qe>0&&st.debouncedAutoCompile():st.debouncedAutoCompile.cancel()}),[st,ut,Qe]),(0,r.useEffect)((()=>()=>{st.debouncedAutoCompile.cancel()}),[st]);const gt=(0,r.useCallback)((e=>{st.compile(e)}),[st]),mt=(0,r.useCallback)((()=>{st.stopCompile()}),[st]),ft=(0,r.useCallback)((()=>(ye(!0),st.clearCache().then((()=>{Le(void 0),$(void 0)})).finally((()=>{ye(!1)})))),[st]),_t=(0,r.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=x(e.file);n&&"doc"===n.type&&h(n.entity._id,{gotoLine:e.line??void 0,gotoColumn:e.column??void 0,keepCurrentView:t})}),[x,h]),wt=(0,r.useCallback)((()=>{ft().then((()=>{st.compile()}))}),[ft,st]),vt=(0,r.useMemo)((()=>de?.options||{}),[de]);(0,r.useEffect)((()=>{const e=e=>{ke(e.detail)};return window.addEventListener("editor:show-logs",e),()=>{window.removeEventListener("editor:show-logs",e)}}),[]);const bt=(0,r.useMemo)((()=>({animateCompileDropdownArrow:Ee,autoCompile:Xe,clearCache:ft,clearingCache:be,clsiServerId:z,codeCheckFailed:dt,compiling:k,deliveryLatencies:fe,draft:Ue,editedSinceCompileStarted:W,error:Ce,fileList:Se,hasChanges:pt,hasShortCompileTimeout:C,highlights:Fe,isProjectOwner:l,lastCompileOptions:vt,logEntryAnnotations:O,logEntries:L,pdfDownloadUrl:X?.pdfDownloadUrl,pdfFile:X,pdfUrl:X?.pdfUrl,pdfViewer:F,position:De,rawLog:Ae,recompileFromScratch:wt,setAnimateCompileDropdownArrow:Te,setAutoCompile:$e,setCompiling:E,setDraft:Ve,setError:Ie,setHasLintingError:Ye,setHighlights:Pe,setPosition:Ne,showCompileTimeWarning:T,setShowCompileTimeWarning:j,setShowLogs:ke,toggleLogs:je,setStopOnFirstError:We,setStopOnValidationError:qe,showLogs:xe,startCompile:gt,stopCompile:mt,stopOnFirstError:Be,stopOnValidationError:Je,stoppedOnFirstError:He,uncompiled:U,validationIssues:Re,firstRenderDone:ge,setChangedAt:Ze,cleanupCompileResult:tt,syncToEntry:_t,recordAction:lt})),[Ee,Xe,ft,be,z,dt,k,fe,Ue,W,Ce,Se,pt,C,Fe,l,vt,L,O,De,X,F,Ae,wt,Te,$e,Ve,Ie,Ye,Pe,Ne,j,We,qe,T,xe,gt,mt,Be,Je,He,U,Re,ge,Ze,tt,ke,je,_t,lt]);return(0,S.jsx)(he.Provider,{value:bt,children:t})};function ue(){const e=(0,r.useContext)(he);if(!e)throw new Error("useLocalCompileContext is only available inside LocalCompileProvider");return e}},66666:(e,t,n)=>{"use strict";n.d(t,{N:()=>h,O:()=>c});n(16280);var r=n(14041),o=n(14936),s=n(64932),i=n(31085);const a=(0,r.createContext)(void 0);function c(){const e=(0,r.useContext)(a);if(!e)throw new Error("useProjectContext is only available inside ProjectProvider");return e}const l={_id:(0,s.A)("ol-project_id"),name:"",features:{}},h=e=>{let{children:t}=e;const[n]=(0,o.A)("project"),{_id:c,compiler:h,name:d,rootDoc_id:u,members:p,invites:g,features:m,publicAccesLevel:f,owner:_,trackChangesState:w,mainBibliographyDoc_id:v}=n||l,b=(0,r.useMemo)((()=>((0,s.A)("ol-projectTags")||[]).map((e=>({...e,name:e.name??""})))),[]),y=(0,r.useMemo)((()=>({_id:c,compiler:h,name:d,rootDocId:u,members:p,invites:g,features:m,publicAccessLevel:f,owner:_,tags:b,trackChangesState:w,mainBibliographyDocId:v})),[c,h,d,u,p,g,m,f,_,b,w,v]);return(0,i.jsx)(a.Provider,{value:y,children:t})}},66020:(e,t,n)=>{"use strict";n.d(t,{dk:()=>h,wI:()=>l});n(16280);var r=n(14041),o=n(64932),s=n(14936),i=n(31085);const a={pdfViewer:"pdfjs",autoComplete:!0,autoPairDelimiters:!0,syntaxValidation:!1,editorTheme:"textmate",overallTheme:"",mode:"default",fontSize:12,fontFamily:"monaco",lineHeight:"normal",mathPreview:!0},c=(0,r.createContext)(void 0),l=e=>{let{children:t}=e;const[n,l]=(0,r.useState)((()=>(0,o.A)("ol-userSettings")||a)),[,h]=(0,s.A)("settings");(0,r.useEffect)((()=>{h({overallTheme:"light-"===n.overallTheme?"light":"dark",keybindings:"none"===n.mode?"default":n.mode})}),[h,n]);const d=(0,r.useMemo)((()=>({userSettings:n,setUserSettings:l})),[n,l]);return(0,i.jsx)(c.Provider,{value:d,children:t})};function h(){const e=(0,r.useContext)(c);if(!e)throw new Error("useUserSettingsContext is only available inside UserSettingsProvider");return e}},30741:(e,t,n)=>{"use strict";n.d(t,{A:()=>h});var r=n(14041);let o,s=!1,i="";function a(e){document.hasFocus()||s||(i=window.document.title,window.document.title=e,s=!0,o=setInterval((function(){window.document.title===i?window.document.title=e:window.document.title=i}),800))}function c(){s&&(clearInterval(o),window.document.title=i,i="",s=!1)}function l(e){s?i=e:window.document.title=e}const h=function(){const[e,t]=(0,r.useState)((()=>document.hasFocus()));return(0,r.useEffect)((()=>{function e(){t(!0)}function n(){t(!1)}return window.addEventListener("focus",e),window.addEventListener("blur",n),()=>{window.removeEventListener("focus",e),window.removeEventListener("blur",n)}}),[]),{hasFocus:e,flashTitle:a,stopFlashingTitle:c,setTitle:l}}},94234:(e,t,n)=>{"use strict";n.d(t,{A:()=>c});var r=n(14041),o=n(93588),s=n(64932),i=n(60961);const a=(0,s.A)("ol-debugPdfDetach");function c(e,t,n,s){const{role:c,broadcastEvent:l,addEventHandler:h,deleteEventHandler:d}=(0,o.Q2)(),u=`action-${e}`,p=(0,r.useCallback)((function(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];c===n?l(u,{args:r}):t(...r)}),[c,n,u,t,l]),g=(0,r.useCallback)((e=>{e.event===u&&c===s&&(a&&i.$.warn(`Do ${t.name} on event ${u}`),t(...e.data.args))}),[c,s,u,t]);return(0,r.useEffect)((()=>(h(g),()=>d(g))),[h,d,g]),p}},37939:(e,t,n)=>{"use strict";n.d(t,{A:()=>c});var r=n(14041),o=n(93588),s=n(64932),i=n(60961);const a=(0,s.A)("ol-debugPdfDetach");function c(e,t,n,s){const[c,l]=(0,r.useState)(t),{role:h,broadcastEvent:d,lastDetachedConnectedAt:u,addEventHandler:p,deleteEventHandler:g}=(0,o.Q2)(),m=`state-${e}`;(0,r.useEffect)((()=>{h===n&&d(m,{value:c})}),[h,n,m,c,d,u]);const f=(0,r.useCallback)((e=>{e.event===m&&h===s&&(a&&i.$.warn(`Set ${e.data.value} for ${m}`),l(e.data.value))}),[h,s,m,l]);return(0,r.useEffect)((()=>(p(f),()=>g(f))),[p,g,f]),[c,l]}},89139:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var r=n(14041);function o(e,t){(0,r.useEffect)((()=>(window.addEventListener(e,t),()=>{window.removeEventListener(e,t)})),[e,t])}},28699:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var r=n(14041);function o(e){const t=(0,r.useRef)();return(0,r.useEffect)((()=>{t.current=e})),t.current}},68273:(e,t,n)=>{"use strict";n.d(t,{w:()=>o});var r=n(14041);const o=e=>{const t=(0,r.useRef)(null),n=(0,r.useCallback)((n=>{if(n&&"ResizeObserver"in window){t.current&&t.current.observer.unobserve(t.current.element);const r=new ResizeObserver((t=>{let[n]=t;e(n.target)}));t.current={element:n,observer:r},r.observe(n),e(n)}}),[e]);return(0,r.useEffect)((()=>()=>{t.current&&t.current.observer.unobserve(t.current.element)}),[]),{elementRef:n,resizeRef:t}}},37766:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(14041),o=n(67353);function s(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{scopeEventEmitter:n}=(0,o.nK)();return(0,r.useCallback)((function(){for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];n.emit(e,t,...o)}),[n,e,t])}},91542:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(14041),o=n(67353);function s(e,t){const{scopeEventEmitter:n}=(0,o.nK)();(0,r.useEffect)((()=>n.on(e,t)),[n,e,t])}},76113:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(14041),o=n(67353),s=n(45250),i=n.n(s);function a(e,t){const{scopeStore:n}=(0,o.nK)(),[s,a]=(0,r.useState)(t);return[s,(0,r.useCallback)((t=>{a((r=>{const o=i().isFunction(t)?t(r):t;return n.set(e,o),o}))}),[e,n])]}},14936:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(14041),o=n(45250),s=n.n(o),i=n(67353);function a(e){const{scopeStore:t}=(0,i.nK)(),[n,o]=(0,r.useState)((()=>t.get(e)));(0,r.useEffect)((()=>t.watch(e,(e=>{o((()=>e))}))),[e,t]);return[n,(0,r.useCallback)((n=>{o((r=>{const o=s().isFunction(n)?n(r):n;return t.set(e,o),o}))}),[e,t])]}},5805:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var r=n(10646),o=n(64932);const s=function(){const{permissionsLevel:e}=(0,r.mi)();return(0,o.A)("ol-linkSharingWarning")&&"readOnly"===e}},5804:(e,t,n)=>{"use strict";function r(e){const t=(new TextEncoder).encode(e),n=function(e){const t=[];for(let n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=e[n]<<24-r%32;return t}(t),r=8*t.length,o=[];let s=1732584193,i=-271733879,a=-1732584194,c=271733878,l=-1009589776;n[r>>5]|=128<<24-r%32,n[15+(r+64>>>9<<4)]=r;for(let e=0;e<n.length;e+=16){const t=s,r=i,h=a,d=c,u=l;for(let t=0;t<80;t++){if(t<16)o[t]=n[e+t];else{const e=o[t-3]^o[t-8]^o[t-14]^o[t-16];o[t]=e<<1|e>>>31}const r=(s<<5|s>>>27)+l+(o[t]>>>0)+(t<20?1518500249+(i&a|~i&c):t<40?1859775393+(i^a^c):t<60?(i&a|i&c|a&c)-1894007588:(i^a^c)-899497514);l=c,c=a,a=i<<30|i>>>2,i=s,s=r}s+=t,i+=r,a+=h,c+=d,l+=u}return function(e){const t=[];for(let n=0;n<32*e.length;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t}([s,i,a,c,l]).map((e=>e.toString(16).padStart(2,"0"))).join("")}n.d(t,{V:()=>r})},85289:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});n(25440),n(3296),n(27208),n(48408),n(14603),n(47566),n(98721);function r(e){const t=new URL(window.location);let n=t.pathname.replace(/\/(detached|detacher)\/?$/,"").replace(/\/$/,"");return e&&(n+=`/${e}`),t.pathname=n,t}},72607:(e,t,n)=>{"use strict";n.d(t,{A8:()=>c,H8:()=>o,Tb:()=>r,XQ:()=>s,YL:()=>i,sm:()=>a});const r=e=>"i"in e,o=e=>"c"in e,s=e=>"d"in e,i=e=>r(e.op),a=e=>s(e.op),c=e=>o(e)?e.c.length:r(e)?e.i.length:0},63308:()=>{var e,t,n;(e=ReadableStream.prototype).values??(e.values=function(){let{preventCancel:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this.getReader();return{async next(){try{const e=await t.read();return e.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(n){if(e)t.releaseLock();else{const e=t.cancel(n);t.releaseLock(),await e}return{done:!0,value:n}},[Symbol.asyncIterator](){return this}}}),(t=ReadableStream.prototype)[n=Symbol.asyncIterator]??(t[n]=ReadableStream.prototype.values)},58528:(e,t,n)=>{"use strict";n.d(t,{g9:()=>o,qR:()=>s});var r=n(64932);function o(e){return"enabled"===(0,r.A)("ol-splitTestVariants")?.[e]}function s(e,t){return(0,r.A)("ol-splitTestVariants")?.[e]||t}},23442:(e,t,n)=>{"use strict";n.r(t),n.d(t,{extension:()=>i,previousFixEffect:()=>o,previousFixState:()=>s});var r=n(14830);const o=r.Pe.define(),s=r.sU.define({create:()=>null,update(e,t){for(const n of t.effects)n.is(o)&&(e=n.value);return e}}),i=()=>[s]},32912:(e,t,n)=>{"use strict";n.d(t,{I:()=>C});var r=n(71627),o=n(14041),s=n(60961),i=n(89135),a=n(96713),c=n(97434),l=n(63003),h=n(11456),d=n(1705),u=n(23588),p=n(96700),g=n(67993),m=n(31085);const f=e=>{let{rating:t,setRating:n,messages:r,logEntry:s}=e;const[i,a]=(0,o.useState)(!1),[c,l]=(0,o.useState)(!1);return 1===t?(0,m.jsx)(v,{messages:r,rating:t,logEntry:s,clearRating:()=>n(0),isSending:i,setIsSending:a,isSent:c,setIsSent:l}):-1===t?(0,m.jsx)(b,{messages:r,rating:t,logEntry:s,clearRating:()=>n(0),isSending:i,setIsSending:a,isSent:c,setIsSent:l}):null};let _=1;const w=(e,t)=>`${e}-${t}`,v=e=>{let{rating:t,logEntry:n,messages:p,clearRating:f,isSending:v,setIsSending:b,isSent:E,setIsSent:T}=e;const[j]=(0,o.useState)(String(_++)),{t:C}=(0,c.Bd)(),I=(0,o.useCallback)((async e=>{e.preventDefault(),b(!0);try{const r=new FormData(e.target),o={level:n.level,ruleId:n.ruleId,rating:t,notes:r.get("notes")};r.get("consent")&&(o.rawLog=n.raw,o.messages=x(p)),await k(o)}catch(e){s.$.error(e)}finally{b(!1),T(!0)}}),[n,p,t,b,T]);return E?(0,m.jsx)(y,{clearRating:f}):(0,m.jsxs)(d.A,{onSubmit:I,className:"ai-error-assistant-feedback-form",children:[(0,m.jsxs)("div",{className:"ai-error-assistant-feedback-form-heading",children:[(0,m.jsx)("div",{children:"What did you find most helpful?"}),(0,m.jsx)("button",{"aria-label":"Close",onClick:f,children:(0,m.jsx)(a.A,{type:"close"})})]}),(0,m.jsx)(h.A,{controlId:"aiErrorAssistantFeedbackLatex",children:(0,m.jsx)(u.A,{as:"textarea",name:"notes"})}),(0,m.jsx)(l.A,{name:"consent",id:w("consent",j),label:C("include_the_error_message_and_ai_response")}),(0,m.jsx)("div",{className:"ai-error-assistant-feedback-form-footer",children:(0,m.jsxs)(r.A,{variant:"secondary",type:"submit",disabled:v,isLoading:v,children:[C("submit_title"),(0,m.jsx)(g.A,{bs3:v&&(0,m.jsxs)(m.Fragment,{children:[" ",(0,m.jsx)(i.A,{type:"spinner",spin:!0,fw:!0})]})})]})})]})},b=e=>{let{rating:t,logEntry:n,messages:s,clearRating:f,isSending:v,setIsSending:b,isSent:E,setIsSent:T}=e;const{t:j}=(0,c.Bd)(),[C]=(0,o.useState)(String(_++)),I=(0,o.useCallback)((async e=>{e.preventDefault(),b(!0);try{const r=new FormData(e.target),o={level:n.level,ruleId:n.ruleId,rating:t,notes:r.get("notes"),reason:r.get("reason")};r.get("consent")&&(o.rawLog=n.raw,o.messages=x(s)),await k(o)}finally{b(!1),T(!0)}}),[n,s,t,b,T]);return E?(0,m.jsx)(y,{clearRating:f}):(0,m.jsxs)(d.A,{onSubmit:I,className:"ai-error-assistant-feedback-form",children:[(0,m.jsxs)("div",{className:"ai-error-assistant-feedback-form-heading",children:[(0,m.jsx)("div",{children:j("ai_feedback_tell_us_what_was_wrong_so_we_can_improve")}),(0,m.jsx)("button",{"aria-label":"Close",onClick:f,children:(0,m.jsx)(a.A,{type:"close"})})]}),(0,m.jsxs)(h.A,{className:"ai-error-assistant-feedback-form-choices",children:[(0,m.jsx)(l.A,{type:"radio",inline:!0,name:"reason",id:w("reason",C),value:"error-not-fixed",label:j("ai_feedback_the_suggestion_didnt_fix_the_error")}),(0,m.jsx)(l.A,{type:"radio",inline:!0,name:"reason",id:w("no-suggested-change",C),value:"no-suggested-change",label:j("ai_feedback_there_was_no_code_fix_suggested")}),(0,m.jsx)(l.A,{type:"radio",inline:!0,name:"reason",id:w("answer-too-long",C),value:"answer-too-long",label:j("ai_feedback_the_answer_was_too_long")}),(0,m.jsx)(l.A,{type:"radio",inline:!0,name:"reason",id:w("answer-not-detailed",C),value:"answer-not-detailed",label:j("ai_feedback_the_answer_wasnt_detailed_enough")}),(0,m.jsx)(l.A,{type:"radio",inline:!0,name:"reason",id:w("answer-not-best-fix",C),value:"answer-not-best-fix",label:j("ai_feedback_the_suggestion_wasnt_the_best_fix_available")}),(0,m.jsx)(l.A,{type:"radio",inline:!0,name:"reason",id:w("other",C),value:"other",label:j("other")})]}),(0,m.jsxs)(h.A,{controlId:"aiErrorAssistantFeedbackNotes",children:[(0,m.jsx)(p.A,{children:j("ai_feedback_do_you_have_any_thoughts_or_suggestions")}),(0,m.jsx)(u.A,{as:"textarea",name:"notes"})]}),(0,m.jsx)(l.A,{name:"consent",id:w("consent",C),label:j("include_the_error_message_and_ai_response")}),(0,m.jsx)("div",{className:"ai-error-assistant-feedback-form-footer",children:(0,m.jsxs)(r.A,{type:"submit",disabled:v,variant:"secondary",isLoading:v,children:[j("submit_title"),(0,m.jsx)(g.A,{bs3:v&&(0,m.jsxs)(m.Fragment,{children:[" ",(0,m.jsx)(i.A,{type:"spinner",spin:!0,fw:!0})]})})]})})]})},y=e=>{let{clearRating:t}=e;const{t:n}=(0,c.Bd)();return(0,m.jsx)("div",{className:"ai-error-assistant-feedback-form",children:(0,m.jsxs)("div",{className:"ai-error-assistant-feedback-form-heading",children:[(0,m.jsx)("div",{children:n("thank_you_for_your_feedback")}),(0,m.jsx)("button",{"aria-label":n("close"),onClick:t,children:(0,m.jsx)(a.A,{type:"close"})})]})})},x=e=>e.flatMap((e=>[e.content,...e.tool_calls.map((e=>`${e.tool} ${JSON.stringify(e.args)||""}`))])).join("\n\n"),k=async e=>{const t=await fetch("https://script.google.com/macros/s/AKfycbzReBQ1jUgZVWQ8m0Kiwb_SFcBYTvpBseiwS99P4c0ObZmgQHFntrt0I8JG15tLxUj_/exec",{mode:"no-cors",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return t.ok||s.$.error(await t.text()),t};var E=n(53373),T=n.n(E),j=n(93075);const C=e=>{let{messages:t,finished:n,applied:o=!1,suggestFix:s,logEntry:i,rating:l,setRating:h}=e;const{t:d}=(0,c.Bd)();return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("div",{className:"ai-error-assistant-footer",children:[n?(0,m.jsxs)("div",{className:"ai-error-assistant-feedback",children:[(0,m.jsx)(j.A,{id:"ai-error-assistant-feedback-positive-tooltip",description:d("this_was_helpful"),children:(0,m.jsx)(r.A,{type:"button",variant:"ghost",size:"sm","aria-label":d("this_was_helpful"),onClick:()=>h((e=>1!==e?1:0)),className:T()("ai-error-assistant-feedback-button","ai-error-assistant-feedback-positive",{active:1===l}),children:(0,m.jsx)(a.A,{type:"thumb_up"})})}),(0,m.jsx)(j.A,{id:"ai-error-assistant-feedback-negative-tooltip",description:d("this_wasnt_helpful"),children:(0,m.jsx)(r.A,{type:"button",variant:"ghost",size:"sm","aria-label":d("this_wasnt_helpful"),onClick:()=>h((e=>-1!==e?-1:0)),className:T()("ai-error-assistant-feedback-button","ai-error-assistant-feedback-negative",{active:-1===l}),children:(0,m.jsx)(a.A,{type:"thumb_down"})})}),s&&(0,m.jsx)(j.A,{id:"ai-error-assistant-feedback-retry-tooltip",description:d("suggest_a_different_fix"),children:(0,m.jsx)(r.A,{type:"button",variant:"ghost",size:"sm","aria-label":d("suggest_a_different_fix"),onClick:s,className:"ai-error-assistant-feedback-button",children:(0,m.jsx)(a.A,{type:"refresh"})})})]}):(0,m.jsx)("span",{}),o&&(0,m.jsx)("div",{children:d("suggestion_applied")}),s&&(0,m.jsx)("div",{children:d("ai_can_make_mistakes")})]}),(0,m.jsx)(f,{rating:l,setRating:h,messages:t,logEntry:i},l),(0,m.jsxs)("div",{className:"ai-error-assistant-survey",children:[(0,m.jsx)(a.A,{type:"science",className:"labs-icon",accessibilityLabel:"Labs"}),(0,m.jsxs)("div",{children:[d("this_is_a_labs_experiment")," -"," ",(0,m.jsxs)("a",{href:"https://docs.google.com/forms/d/e/1FAIpQLSdo3QEilLyOAGS5-6n9IiO39P6pOQrPZrii6irULWJc22V4hw/viewform",target:"_blank",rel:"noopener noreferrer",children:[d("give_your_feedback"),"."]})]})]})]})}},28252:(e,t,n)=>{"use strict";n.d(t,{K:()=>E});var r=n(73647),o=n(71651),s=n.n(o),i=n(31085);const a={ALLOWED_TAGS:["#text","p","ol","ul","li","pre","code"],ALLOWED_ATTR:[]},c=e=>{let{message:t}=e;const n=s().sanitize((0,r.yt)(t),a);return(0,i.jsx)("div",{className:"ai-error-assistant-output",dangerouslySetInnerHTML:{__html:n}})};var l=n(14041),h=n(90254),d=n(71627),u=n(89135),p=n(97434),g=n(96713),m=n(93075),f=n(67993),_=n(10009);const w=e=>{let{content:t}=e;const{t:n}=(0,p.Bd)(),[r,o]=(0,l.useState)(!1),s=(0,l.useCallback)((()=>{navigator.clipboard.writeText(t).then((()=>{o(!0),window.setTimeout((()=>{o(!1)}),1500)}))}),[t]);return navigator.clipboard?.writeText?(0,i.jsx)(m.A,{id:"ai-error-assistant-copy-code",description:r?`${n("copied")}!`:n("copy"),overlayProps:{delay:r?1e3:250},children:(0,i.jsxs)(d.A,{variant:"ghost",size:"sm",bs3Props:{bsSize:"xsmall"},onClick:s,className:(0,_.q$)({bs3:"m-2 btn-bg-ghost",bs5:"m-2 ai-error-assistant-copy-code-btn"}),children:[(0,i.jsx)(f.A,{bs3:(0,i.jsx)(u.A,{type:r?"check":"copy"}),bs5:(0,i.jsx)(g.A,{type:r?"check":"content_copy"})})," ",n("copy_code")]})}):null},v=(0,l.memo)((e=>{let{suggestion:t,syncToEntry:n,showActions:r=!0}=e;const o=(0,h.b2)(t.from.content,t.to.content),s=(0,l.useCallback)((e=>{if(e){e.textContent="";let n=t.from.content;for(const t of o)if(t.count)if(t.removed){const r=document.createElement("del");r.append(n.substring(0,t.value.length)),e.append(r),n=n.substring(t.value.length)}else if(!t.added){const r=n.substring(0,t.value.length);e.append(r),n=n.substring(t.value.length)}}}),[o,t.from.content]),a=(0,l.useCallback)((e=>{if(e){e.textContent="";let n=t.to.content;for(const t of o)if(t.value.length)if(t.added){const r=document.createElement("ins");r.append(n.substring(0,t.value.length)),e.append(r),n=n.substring(t.value.length)}else if(!t.removed){const r=n.substring(0,t.value.length);e.append(r),n=n.substring(t.value.length)}}}),[o,t.to.content]),c=(0,l.useCallback)((()=>{n({file:t.path,line:t.from.line,column:0})}),[t,n]);return(0,i.jsxs)("div",{className:"ai-error-assistant-suggested-change",children:[(0,i.jsxs)("div",{className:"ai-error-assistant-from",children:[(0,i.jsx)("div",{className:"ai-error-assistant-line-number",children:(0,i.jsx)("button",{onClick:c,children:t.from.line})}),(0,i.jsx)("div",{className:"ai-error-assistant-code",ref:s})]}),(0,i.jsxs)("div",{className:"ai-error-assistant-to",children:[(0,i.jsx)("div",{className:"ai-error-assistant-line-number",children:(0,i.jsx)("button",{onClick:c,children:t.from.line})}),(0,i.jsx)("div",{className:"ai-error-assistant-code",ref:a})]}),r&&(0,i.jsx)("div",{className:"ai-error-assistant-suggested-change-footer",children:(0,i.jsx)(w,{content:t.to.content})})]})}));v.displayName="SuggestedChange";var b=n(8164),y=n(89997),x=n(14936),k=n(49438);const E=(0,l.memo)((e=>{let{message:t,view:n,level:r,replaceContent:o}=e;const{t:s}=(0,p.Bd)(),{syncToEntry:a,compiling:h,startCompile:u,recordAction:g}=(0,b.Rf)(),{pathInFolder:f}=(0,y.m8)(),[_]=(0,x.A)("editor.sharejs_doc"),w=(0,l.useMemo)((()=>_?.doc_id?f(_.doc_id):null),[_?.doc_id,f]),E=t.tool_calls?.filter((e=>"suggestLineChange"===e.tool)).length,T=(0,l.useCallback)((e=>{const{from:t}=e,r=e.from.line+t.content.split("\n").length-1;if(t.line>0&&r>=t.line&&r<=n.state.doc.lines){const e={from:n.state.doc.line(t.line),to:n.state.doc.line(r)};return n.state.sliceDoc(e.from.from,e.to.to)}}),[n.state]),j=(0,l.useCallback)(((e,t)=>{if(!o)return;const{path:s,from:i,to:c}=e;let l=e.from.line+i.content.split("\n").length-1;if(a({file:s,line:i.line,column:0},!0),w===s){const{doc:e}=n.state;if(i.line>0&&l<=e.length){const n={from:e.line(i.line),to:e.line(l)};i.line<l&&""===n.from.text&&(i.line++,n.from=e.line(i.line)),l>i.line&&""===n.to.text&&(l--,n.to=e.line(l));const s=[{from:n.from.from,to:n.to.to,insert:c.content}];o(s),g(`appliedSuggestionFor${r}`),1===t&&window.setTimeout((()=>{u()}),500)}}}),[w,o,u,a,n.state,r,g]);return(0,i.jsxs)("div",{className:"ai-error-assistant-message",children:[t.content&&(0,i.jsx)(c,{message:t.content}),t.tool_calls.length>0&&(0,i.jsx)("ul",{className:"ai-error-assistant-tool-calls",children:t.tool_calls.map((e=>{const{tool:t,toolCallId:n,args:r}=e;if("suggestLineChange"===t){const e=w===r.path,t=e?T(r):void 0,c=e&&t?.includes(r.from.content),l=()=>{if(!o)return null;const t=()=>(0,i.jsx)(d.A,{variant:"secondary",disabled:h||e&&!c,onClick:()=>{j(r,E)},children:e?s("apply_suggestion"):s("open_path",{path:(0,k.I)(r.path,16)})});return!e||c||h?(0,i.jsx)(t,{}):(0,i.jsx)(m.A,{description:s("the_original_text_has_changed"),id:"ai-error-assistant-cannot-apply-tooltip",children:(0,i.jsx)("span",{children:(0,i.jsx)(t,{})})})};return(0,i.jsxs)("li",{children:[(0,i.jsx)(v,{suggestion:r,syncToEntry:a,showActions:!!o}),(0,i.jsx)("div",{className:"ai-error-assistant-actions",children:(0,i.jsx)(l,{})})]},n)}return null}))})]})}));E.displayName="AiErrorAssistantMessage"},49438:(e,t,n)=>{"use strict";n.d(t,{I:()=>r});n(25440);const r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16;return(e=e.replace(/^\.\//,"")).length>t+3&&(e="…"+e.substring(e.length-t).trim()),e}},22743:(e,t,n)=>{"use strict";n.r(t),n.d(t,{SnapshotUpdater:()=>v,buildFileTree:()=>g,createFolder:()=>u,populateSnapshot:()=>_});n(16280),n(43375),n(39225),n(13972),n(99209),n(25714),n(17561),n(66197);var r=n(58756),o=n(37603),s=n.n(o),i=n(60961),a=n(37858),c=n(64932),l=n(90165),h=n.n(l);const d=10;function u(e,t){return{_id:e,name:t,folders:[],docs:[],fileRefs:[]}}function p(e){const t=e.lastIndexOf("/");return-1===t?["",e]:[e.slice(0,t),e.slice(t+1)]}function g(e){const t=e.getFileMap(),n=u("","");let r="",o=n;const s=e=>{if(""===e)return n;if(r===e&&o)return o;const[t,i]=p(e),a=s(t);let c=a.folders.find((e=>e.name===i));return c||(c=u(e,i),a.folders.push(c)),o=c,r=e,c},i=new Map;for(const[t,{pathname:n}]of Object.entries(e.getV2DocVersions()?.data||{}))i.set(n,t);for(const e of t.getPathnames().sort()){const n=t.getFile(e),[r,o]=p(e),a=s(r),c=n.getMetadata();n.isEditable()&&0===Object.keys(c).length?a.docs.push({_id:i.get(e)||e,name:o}):a.fileRefs.push({_id:e,created:c.importedAt,name:o,hash:n.getHash(),linkedFileData:c})}return n}async function m(e){if((0,c.A)("ol-ro-mirror-on-client-no-local-storage"))throw new Error("indexedDB persistence is disabled");try{await window.navigator.storage.persist()}catch{}return await new Promise(((t,n)=>{const r=window.indexedDB.open(`snapshot-data:${e}`,2);r.onerror=e=>{n(new(s())("failed to open IndexDB",{event:e}))},r.onsuccess=()=>t(r.result),r.onupgradeneeded=()=>{r.result.createObjectStore("blobs")}}))}class NotFoundError extends(s()){}class f{constructor(e,t,n){this.projectId=e,this.db=t,this.signal=n,this.prefetchedBlobs=new Map}async prefetchBlobs(e){const t=h()(d);await Promise.all(Array.from(e).map((e=>t((async()=>{this.prefetchedBlobs.set(e,await this.getString(e))})))))}async getString(e){if(this.prefetchedBlobs.has(e))return this.prefetchedBlobs.get(e);if(this.db)try{return await new Promise(((t,n)=>{const r=this.db.transaction("blobs","readonly").objectStore("blobs").get(e);r.onsuccess=()=>{"string"!=typeof r.result?n(new NotFoundError("blob not cached")):t(r.result)},r.onerror=e=>{n(new(s())("failed to read IndexDB",{event:e}))}}))}catch(e){e instanceof NotFoundError||i.$.error(e)}const t=`/project/${this.projectId}/blob/${e}`,n=await fetch(t,{signal:this.signal,cache:this.db||(0,c.A)("ol-ro-mirror-on-client-no-local-storage")?"no-store":"force-cache"});if(!n.ok)throw new a.fk(n.statusText,t,void 0,n);const r=await n.text();if(this.db)try{await new Promise(((t,n)=>{const o=this.db.transaction("blobs","readwrite").objectStore("blobs").put(r,e);o.onsuccess=()=>t(),o.onerror=e=>{n(new(s())("failed to write IndexDB",{event:e}))}}))}catch(e){i.$.error(e)}return r}async getObject(e){return JSON.parse(await this.getString(e))}}async function _(e){const t=(0,c.A)("ol-project_id");let n;try{n=await m(t)}catch(e){i.$.error(e)}const r=AbortSignal.timeout(6e5);try{const o=new f(t,n,r);await o.prefetchBlobs(w(e)),await e.getFileMap().mapAsync((e=>{if(e&&e.isEditable())return e.load("eager",o)}),d)}finally{n&&n.close()}}function w(e){const t=new Set;return e.getFileMap().map((e=>{if(!e||!e.isEditable())return;const n=e.data;n instanceof r.LazyStringFileData&&(t.add(n.hash),n.rangesHash&&t.add(n.rangesHash))})),t}class v{constructor(e){this.projectId=e,this.ac=new AbortController}async tryFlush(e){try{await(0,a.TB)(`/project/${this.projectId}/flush`,{signal:e})}catch(e){(0,a.Jz)(e)||i.$.error(s().tag(e,"flush history"))}}abort(){this.ac.abort()}resetTimeout(){this.abort(),this.ac=new AbortController;const e=setTimeout((()=>this.ac.abort()),3e4),t=this.ac.signal;return t.addEventListener("abort",(()=>clearTimeout(e))),t}async refresh(){const e=this.resetTimeout();try{return await this.doRefresh(e)}finally{this.abort()}}async doRefresh(e){if(await this.tryFlush(e),this.chunk)for(;;){const{changes:t,latestStartVersion:n}=await(0,a.hm)(`/project/${this.projectId}/changes-in-chunk?since=${this.chunk.getEndVersion()}`,{signal:e});for(const e of t){const t=r.Change.fromRaw(e);t.applyTo(this.chunk.getSnapshot(),{strict:!0}),this.chunk.pushChanges([t])}if(!(n>this.chunk.getStartVersion()))break;this.chunk=new r.Chunk(new r.History(this.chunk.getSnapshot(),[]),this.chunk.getEndVersion())}else{this.chunk=r.Chunk.fromRaw((await(0,a.hm)(`/project/${this.projectId}/latest/history`,{signal:e})).chunk),this.chunk.getSnapshot().applyAll(this.chunk.getChanges(),{strict:!0});try{await async function(e){const t=(0,c.A)("ol-project_id"),n=await m(t),r=await new Promise(((e,t)=>{const r=n.transaction("blobs","readonly").objectStore("blobs").getAllKeys();r.onsuccess=()=>e(r.result),r.onerror=e=>t(new(s())("list IndexDB",{event:e}))})),o=w(e),i=[];for(const e of r)o.has(e)||i.push(e);await new Promise(((e,t)=>{const r=n.transaction("blobs","readwrite");for(const e of i)r.objectStore("blobs").delete(e);r.oncomplete=()=>e(),r.onerror=e=>t(new(s())("remove from IndexDB",{event:e}))}))}(this.chunk.getSnapshot())}catch(e){i.$.error(s().tag(e,"purge unused blobs"))}}return{snapshot:this.chunk.getSnapshot(),snapshotVersion:this.chunk.getEndVersion()}}}},18860:(e,t,n)=>{"use strict";n.d(t,{J:()=>h});var r=n(5804),o=n(60961),s=n(64932);e=n.hmd(e);var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,s=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,s=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw s}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}const{Doc:h}=(()=>{var e,t,n,h=void 0;window.sharejs=h={};var d=h.types={};h._bt=t=function(e,t,n,r){var o=void 0;return e.transformX=e.transformX=o=function(e,s){n(e),n(s);var i,a,l,h=[],d=!0,u=!1,p=void 0;try{for(var g,m=Array.from(s)[Symbol.iterator]();!(d=(g=m.next()).done);d=!0){for(var f=g.value,_=[],w=0;w<e.length;){var v,b=[];if(i=e[w],l=b,t(_,i,a=f,"left"),t(l,a,i,"right"),w++,1!==b.length){if(0===b.length){var y=!0,x=!1,k=void 0;try{for(var E,T=Array.from(e.slice(w))[Symbol.iterator]();!(y=(E=T.next()).done);y=!0)v=E.value,r(_,v)}catch(e){x=!0,k=e}finally{try{!y&&T.return&&T.return()}finally{if(x)throw k}}f=null;break}var j=Array.from(o(e.slice(w),b)),C=c(j,2),I=C[0],S=C[1],L=!0,A=!1,O=void 0;try{for(var R,M=Array.from(I)[Symbol.iterator]();!(L=(R=M.next()).done);L=!0)v=R.value,r(_,v)}catch(e){A=!0,O=e}finally{try{!L&&M.return&&M.return()}finally{if(A)throw O}}var F=!0,P=!1,D=void 0;try{for(var N,X=Array.from(S)[Symbol.iterator]();!(F=(N=X.next()).done);F=!0){var $=N.value;r(h,$)}}catch(e){P=!0,D=e}finally{try{!F&&X.return&&X.return()}finally{if(P)throw D}}f=null;break}f=b[0]}null!=f&&r(h,f),e=_}}catch(e){u=!0,p=e}finally{try{!d&&m.return&&m.return()}finally{if(u)throw p}}return[e,h]},e.transform=e.transform=function(e,n,r){if("left"!==r&&"right"!==r)throw new Error("type must be 'left' or 'right'");if(0===n.length)return e;if(1===e.length&&1===n.length)return t([],e[0],n[0],r);if("left"===r){var s,i=Array.from(o(e,n)),a=c(i,2);return s=a[0],a[1],s}var l=Array.from(o(n,e)),h=c(l,2);return h[0],h[1]}};var u={name:"text",create:function(){return""}},p=function(e,t,n){return e.slice(0,t)+n+e.slice(t)},g=function(e){if("number"!=typeof e.p)throw new Error("component missing position field");if(!("string"===a(e.i)^"string"===a(e.d)^"string"===a(e.c)))throw new Error("component needs an i, d or c field");if(!(e.p>=0))throw new Error("position cannot be negative")},m=function(e){var t=!0,n=!1,r=void 0;try{for(var o,s=Array.from(e)[Symbol.iterator]();!(t=(o=s.next()).done);t=!0){var i=o.value;g(i)}}catch(e){n=!0,r=e}finally{try{!t&&s.return&&s.return()}finally{if(n)throw r}}return!0};u.apply=function(e,t){m(t);var n=!0,r=!1,o=void 0;try{for(var s,i=Array.from(t)[Symbol.iterator]();!(n=(s=i.next()).done);n=!0){var a=s.value;if(null!=a.i)e=p(e,a.p,a.i);else if(null!=a.d){var c=e.slice(a.p,a.p+a.d.length);if(a.d!==c)throw new Error("Delete component '"+a.d+"' does not match deleted text '"+c+"'");e=e.slice(0,a.p)+e.slice(a.p+a.d.length)}else{if(null==a.c)throw new Error("Unknown op type");var l=e.slice(a.p,a.p+a.c.length);if(a.c!==l)throw new Error("Comment component '"+a.c+"' does not match commented text '"+l+"'")}}}catch(e){r=!0,o=e}finally{try{!n&&i.return&&i.return()}finally{if(r)throw o}}return e};var f=function(e,t){var n=void 0,r={};for(var o in e)n=e[o],r[o]=n;for(o in t)n=t[o],r[o]=n;return r};u._append=e=function(e,t){if(""!==t.i&&""!==t.d){if(0===e.length)return e.push(t);var n=e[e.length-1];return null!=n.i&&null!=t.i&&n.p<=t.p&&t.p<=n.p+n.i.length&&n.u===t.u?e[e.length-1]=f(n,{i:p(n.i,t.p-n.p,t.i)}):null!=n.d&&null!=t.d&&t.p<=n.p&&n.p<=t.p+t.d.length&&n.u===t.u?e[e.length-1]=f(n,{d:p(t.d,n.p-t.p,n.d),p:t.p}):e.push(t)}},u.compose=function(t,n){m(t),m(n);var r=t.slice(),o=!0,s=!1,i=void 0;try{for(var a,c=Array.from(n)[Symbol.iterator]();!(o=(a=c.next()).done);o=!0){var l=a.value;e(r,l)}}catch(e){s=!0,i=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw i}}return r},u.compress=function(e){return u.compose([],e)},u.normalize=function(t){var n=[];null==t.i&&null==t.p||(t=[t]);var r=!0,o=!1,s=void 0;try{for(var i,a=Array.from(t)[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var c=i.value;null==c.p&&(c.p=0),e(n,c)}}catch(e){o=!0,s=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw s}}return n};var _=function(e,t,n){if(null!=t.i)return t.p<e||t.p===e&&n?e+t.i.length:e;if(null!=t.d)return e<=t.p?e:e<=t.p+t.d.length?t.p:e-t.d.length;if(null!=t.c)return e;throw new Error("unknown op type")};u.transformCursor=function(e,t,n){var r="right"===n,o=!0,s=!1,i=void 0;try{for(var a,c=Array.from(t)[Symbol.iterator]();!(o=(a=c.next()).done);o=!0){var l=a.value;e=_(e,l,r)}}catch(e){s=!0,i=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw i}}return e},u._tc=n=function(t,n,r,o){var s=void 0,i=void 0,a=void 0;if(m([n]),m([r]),null!=n.i)e(t,f(n,{p:_(n.p,r,"right"===o)}));else if(null!=n.d)if(null!=r.i){var c=n.d;n.p<r.p&&(e(t,f(n,{d:c.slice(0,r.p-n.p)})),c=c.slice(r.p-n.p)),""!==c&&e(t,f(n,{d:c,p:n.p+r.i.length}))}else if(null!=r.d)if(n.p>=r.p+r.d.length)e(t,f(n,{p:n.p-r.d.length}));else if(n.p+n.d.length<=r.p)e(t,n);else{if(a=f(n,{d:""}),n.p<r.p&&(a.d=n.d.slice(0,r.p-n.p)),n.p+n.d.length>r.p+r.d.length&&(a.d+=n.d.slice(r.p+r.d.length-n.p)),i=Math.max(n.p,r.p),s=Math.min(n.p+n.d.length,r.p+r.d.length),n.d.slice(i-n.p,s-n.p)!==r.d.slice(i-r.p,s-r.p))throw new Error("Delete ops delete different text in the same region of the document");""!==a.d&&(a.p=_(a.p,r),e(t,a))}else{if(null==r.c)throw new Error("unknown op type");e(t,n)}else if(null!=n.c)if(null!=r.i)if(n.p<r.p&&r.p<n.p+n.c.length){var l=r.p-n.p,h=n.c.slice(0,+(l-1)+1||void 0)+r.i+n.c.slice(l);e(t,f(n,{c:h}))}else e(t,f(n,{p:_(n.p,r,!0)}));else if(null!=r.d)if(n.p>=r.p+r.d.length)e(t,f(n,{p:n.p-r.d.length}));else if(n.p+n.c.length<=r.p)e(t,n);else{if(a=f(n,{c:""}),n.p<r.p&&(a.c=n.c.slice(0,r.p-n.p)),n.p+n.c.length>r.p+r.d.length&&(a.c+=n.c.slice(r.p+r.d.length-n.p)),i=Math.max(n.p,r.p),s=Math.min(n.p+n.c.length,r.p+r.d.length),n.c.slice(i-n.p,s-n.p)!==r.d.slice(i-r.p,s-r.p))throw new Error("Delete ops delete different text in the same region of the document");a.p=_(a.p,r),e(t,a)}else{if(null==r.c)throw new Error("unknown op type");e(t,n)}return t};u.invert=function(e){return Array.from(e.slice().reverse()).map((function(e){return function(e){return null!=e.i?{d:e.i,p:e.p}:{i:e.d,p:e.p}}(e)}))},h.types||(h.types={}),t(u,n,m,e),h.types.text=u,u.api={provides:{text:!0},getLength:function(){return this.snapshot.length},getText:function(){return this.snapshot},insert:function(e,t,n,r){var o={p:e,i:t};return n&&(o.u=!0),o=[o],this.submitOp(o,r),o},del:function(e,t,n,r){var o={p:e,d:this.snapshot.slice(e,e+t)};return n&&(o.u=!0),o=[o],this.submitOp(o,r),o},_register:function(){return this.on("remoteop",(function(e){var t=this;return function(){var n=[],r=!0,o=!1,s=void 0;try{for(var i,a=Array.from(e)[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var c=i.value;void 0!==c.i?n.push(t.emit("insert",c.p,c.i)):void 0!==c.d?n.push(t.emit("delete",c.p,c.d)):n.push(void 0)}}catch(e){o=!0,s=e}finally{try{!r&&a.return&&a.return()}finally{if(o)throw s}}return n}()}))}};var w=function(e){return setTimeout(e,0)},v=function(){function e(){l(this,e)}return i(e,[{key:"on",value:function(e,t){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),this._events[e].push(t),this}},{key:"removeListener",value:function(e,t){var n=this;this._events||(this._events={});for(var r=this._events[e]||(this._events[e]=[]),o=0;o<r.length;)r[o]===t&&(r[o]=void 0),o++;return w((function(){return n._events[e]=Array.from(n._events[e]).filter((function(e){return e}))})),this}},{key:"emit",value:function(e){if(!(null!=this._events?this._events[e]:void 0))return this;for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=!0,s=!1,i=void 0;try{for(var a,c=Array.from(this._events[e])[Symbol.iterator]();!(o=(a=c.next()).done);o=!0){var l=a.value;l&&l.apply(this,n)}}catch(e){s=!0,i=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw i}}return this}}]),e}();v.mixin=function(e){var t=e.prototype||e;return t.on=v.prototype.on,t.removeListener=v.prototype.removeListener,t.emit=v.prototype.emit,e},h.extendDoc=function(e,t){return b.prototype[e]=t};var b=function(){function e(t,n,r){l(this,e),this.flush=this.flush.bind(this),this.setFlushDelay=this.setFlushDelay.bind(this),this.shout=this.shout.bind(this),this.connection=t,this.name=n,r||(r={}),this.version=r.v,this.lastServerActivity=performance.now(),this.snapshot=r.snaphot,r.type&&this._setType(r.type),this.state="closed",this.autoOpen=!1,this._create=r.create,this.inflightOp=null,this.inflightCallbacks=[],this.inflightSubmittedIds=[],this.pendingOp=null,this.pendingCallbacks=[]}return i(e,[{key:"_xf",value:function(e,t){return this.type.transformX?this.type.transformX(e,t):[this.type.transform(e,t,"left"),this.type.transform(t,e,"right")]}},{key:"_otApply",value:function(e,t,n){var r=this.snapshot;if(this.snapshot=this.type.apply(this.snapshot,e),this.emit("change",e,r,n),t)return this.emit("remoteop",e,r,n)}},{key:"_connectionStateChanged",value:function(e,t){switch(e){case"disconnected":this.state="closed",this.inflightOp&&this.inflightSubmittedIds.push(this.connection.id),this.emit("closed");break;case"ok":this.autoOpen&&this.open();break;case"stopped":"function"==typeof this._openCallback&&this._openCallback(t)}return this.emit(e,t)}},{key:"_setType",value:function(e){if("string"==typeof e&&(e=d[e]),!e||!e.compose)throw new Error("Support for types without compose() is not implemented");if(this.type=e,e.api){for(var t in e.api){var n=e.api[t];this[t]=n}return"function"==typeof this._register?this._register():void 0}return this.provides={}}},{key:"_onMessage",value:function(e){if(!0===e.open){if(this.state="open",this._create=!1,null==this.created&&(this.created=!!e.create),e.type&&this._setType(e.type),e.create?(this.created=!0,this.snapshot=this.type.create()):(!0!==this.created&&(this.created=!1),void 0!==e.snapshot&&(this.snapshot=e.snapshot)),null!=e.v&&(this.version=e.v),this.inflightOp){var t={doc:this.name,op:this.inflightOp,v:this.version};this.inflightSubmittedIds.length&&(t.dupIfSource=this.inflightSubmittedIds),this.connection.send(t)}else this.flush();return this.emit("open"),"function"==typeof this._openCallback?this._openCallback(null):void 0}if(!1===e.open)return e.error&&(o.$.error("Could not open document: "+e.error),this.emit("error",e.error),"function"==typeof this._openCallback&&this._openCallback(e.error)),this.state="closed",this.emit("closed"),"function"==typeof this._closeCallback&&this._closeCallback(),this._closeCallback=null;if(null!==e.op||"Op already submitted"!==r){if(void 0===e.op&&void 0!==e.v||e.op&&Array.from(this.inflightSubmittedIds).includes(e.meta.source)){var n=this.inflightOp;this.inflightOp=null,this.inflightSubmittedIds.length=0,null===this.pendingOp&&this.emit("saved");var r=e.error;if(r){if(this.type.invert){var s=this.type.invert(n);if(this.pendingOp){var i=Array.from(this._xf(this.pendingOp,s)),a=c(i,2);this.pendingOp=a[0],s=a[1]}this._otApply(s,!0,e)}else this.emit("error","Op apply failed ("+r+") and the op could not be reverted");var l=!0,h=!1,d=void 0;try{for(var u,p=Array.from(this.inflightCallbacks)[Symbol.iterator]();!(l=(u=p.next()).done);l=!0)(0,u.value)(r)}catch(e){h=!0,d=e}finally{try{!l&&p.return&&p.return()}finally{if(h)throw d}}}else{if(e.v<this.version)return;if(e.v!==this.version)throw new Error("Invalid version from server");this.version++,this.lastServerActivity=performance.now(),this.emit("acknowledge",n);var g=!0,m=!1,f=void 0;try{for(var _,w=Array.from(this.inflightCallbacks)[Symbol.iterator]();!(g=(_=w.next()).done);g=!0)(0,_.value)(null,n)}catch(e){m=!0,f=e}finally{try{!g&&w.return&&w.return()}finally{if(m)throw f}}}return this.delayedFlush()}if(e.op){if(e.v<this.version)return;if(e.doc!==this.name)return this.emit("error","Expected docName '"+this.name+"' but got "+e.doc);if(e.v!==this.version)return this.emit("error","Expected version "+this.version+" but got "+e.v);var v=e.op;if(null!==this.inflightOp){var b=Array.from(this._xf(this.inflightOp,v)),y=c(b,2);this.inflightOp=y[0],v=y[1]}if(null!==this.pendingOp){var x=Array.from(this._xf(this.pendingOp,v)),k=c(x,2);this.pendingOp=k[0],v=k[1]}return this.version++,this.lastServerActivity=performance.now(),this._otApply(v,!0,e)}if(e.meta){var E=e.meta,T=E.path,j=E.value;return"shout"===(null!=T?T[0]:void 0)?this.emit("shout",j):o.$.warn("Unhandled meta op:",e)}return o.$.warn("Unhandled document message:",e)}}},{key:"flush",value:function(){if(this.flushTimeout=null,"ok"===this.connection.state&&null===this.inflightOp&&null!==this.pendingOp){if(this.inflightOp=this.pendingOp,this.inflightCallbacks=this.pendingCallbacks,this.pendingOp=null,this.pendingCallbacks=[],this.emit("flipped_pending_to_inflight"),(0,s.A)("ol-useShareJsHash")||o.v){var e=Date.now(),t=this.__lastSubmitTimestamp&&e-this.__lastSubmitTimestamp;if(!this.__lastSubmitTimestamp||t>5e3||t<0||o.v){var n=(0,r.V)("blob "+this.snapshot.length+"\0"+this.snapshot);this.__lastSubmitTimestamp=e}}var i=this.__lastVersion;return this.__lastVersion=this.version,this.connection.send({doc:this.name,op:this.inflightOp,v:this.version,lastV:i,hash:n})}}},{key:"submitOp",value:function(e,t){null!=this.type.normalize&&(e=this.type.normalize(e));var n=this.snapshot;return this.snapshot=this.type.apply(this.snapshot,e),null!==this.pendingOp?this.pendingOp=this.type.compose(this.pendingOp,e):this.pendingOp=e,t&&this.pendingCallbacks.push(t),this.emit("change",e,n),this.delayedFlush()}},{key:"delayedFlush",value:function(){if(null==this.flushTimeout)return this.flushTimeout=setTimeout(this.flush,this._flushDelay||0)}},{key:"setFlushDelay",value:function(e){return this._flushDelay=e}},{key:"shout",value:function(e){return this.connection.send({doc:this.name,meta:{path:["shout"],value:e}})}},{key:"open",value:function(e){var t=this;if(this.autoOpen=!0,"closed"===this.state){var n={doc:this.name,open:!0};return void 0===this.snapshot&&(n.snapshot=null),this.type&&(n.type=this.type.name),null!=this.version&&(n.v=this.version),this._create&&(n.create=!0),this.connection.send(n),this.state="opening",this._openCallback=function(n){return t._openCallback=null,"function"==typeof e?e(n):void 0}}}},{key:"close",value:function(e){return this.autoOpen=!1,"closed"===this.state?"function"==typeof e?e():void 0:(this.connection.send({doc:this.name,open:!1}),this.state="closed",this.emit("closing"),this._closeCallback=e)}}]),e}();return v.mixin(b),h.Doc=b,h})();window.sharejs},81714:()=>{}}]);