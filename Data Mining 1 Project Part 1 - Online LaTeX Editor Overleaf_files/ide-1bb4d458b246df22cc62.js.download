"use strict";!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Frontend=t():(e.Frontend=e.Frontend||{},e.Frontend["pages/ide"]=t())}(self,(()=>(self.webpackChunkFrontend=self.webpackChunkFrontend||[]).push([[1320],{7725:(e,t,n)=>{n.d(t,{GR:()=>a,xx:()=>l});n(16280);var r=n(14041),i=n(89139),s=n(31085);const o=(0,r.createContext)(void 0),l=e=>{let{children:t}=e;const[n,l]=(0,r.useState)((()=>({settingToFocus:void 0})));return(0,i.A)("ui.focus-setting",(0,r.useCallback)((e=>{l((t=>({...t,settingToFocus:e.detail})))}),[])),(0,s.jsx)(o.Provider,{value:n,children:t})},a=()=>{const e=(0,r.useContext)(o);if(!e)throw new Error("useEditorLeftMenuContext is only available inside EditorLeftMenuProvider");return e}},80124:(e,t,n)=>{n.d(t,{A:()=>l});var r=n(22046),i=n(39067),s=n.n(i),o=n(31085);function l(e){let{children:t}=e;return(0,o.jsx)(r.A,{type:"error",content:t})}l.propTypes={children:s().any.isRequired}},60718:(e,t,n)=>{n.d(t,{A:()=>h});var r=n(39067),i=n.n(r),s=n(97434),o=n(37858),l=n(14041),a=n(66666),c=n(89753);function d(){const{t:e}=(0,s.Bd)(),{_id:t}=(0,a.O)(),[n,r]=(0,l.useState)(10),i=(0,c.z)();return(0,l.useEffect)((()=>{r(10);const e=window.setInterval((()=>{r((n=>0===n?(window.clearInterval(e),i.assign(`/login?redir=/project/${t}`),0):n-1))}),1e3);return()=>{window.clearInterval(e)}}),[t,i]),e("session_expired_redirecting_to_login",{seconds:n})}var u=n(27916),p=n(80124),m=n(31085);function h(e){let{error:t}=e;const{t:n}=(0,s.Bd)();if("string"==typeof t)switch(t){case"name-exists":return(0,m.jsx)(p.A,{children:n("file_already_exists")});case"too-many-files":return(0,m.jsx)(p.A,{children:n("project_has_too_many_files")});case"remote-service-error":return(0,m.jsx)(p.A,{children:n("remote_service_error")});case"folder_not_found":return(0,m.jsx)(p.A,{children:n("the_target_folder_could_not_be_found")});case"invalid_filename":return(0,m.jsx)(p.A,{children:n("invalid_filename",{nameLimit:150})});case"duplicate_file_name":return(0,m.jsx)(p.A,{children:n("file_or_folder_name_already_exists")});case"rate-limit-hit":return(0,m.jsx)(p.A,{children:n("too_many_files_uploaded_throttled_short_period")});case"not-logged-in":return(0,m.jsx)(p.A,{children:(0,m.jsx)(d,{})});case"linked-project-compile-error":return(0,m.jsx)(p.A,{children:n("generic_linked_file_compile_error")});default:return(0,m.jsx)(p.A,{children:n("generic_something_went_wrong")})}switch(t.constructor){case o.fk:{const e=t.data?.message;if(e)return(0,m.jsx)(p.A,{children:e.text||e});switch(t.response?.status){case 400:return(0,m.jsx)(p.A,{children:n("invalid_request")});case 403:return(0,m.jsx)(p.A,{children:n("session_error")});case 429:return(0,m.jsx)(p.A,{children:n("too_many_attempts")});default:return(0,m.jsx)(p.A,{children:n("something_went_wrong_server")})}}case u.Lc:case u.di:case u.yG:return null;default:return(0,m.jsx)(p.A,{children:n("generic_something_went_wrong")})}}h.propTypes={error:i().oneOfType([i().string,i().object]).isRequired}},92902:(e,t,n)=>{n.d(t,{g:()=>_,m:()=>v});n(16280);var r=n(14041),i=n(22344),s=n(9993),o=n(79550),l=n(71735),a=n(67227),c=n(66666),d=n(71573),u=n(88588),p=n(27916),m=n(94012),h=n(65982),f=n(31085);const g=(0,r.createContext)(void 0);var x=function(e){return e.START_RENAME="START_RENAME",e.START_DELETE="START_DELETE",e.DELETING="DELETING",e.START_CREATE_FILE="START_CREATE_FILE",e.START_CREATE_FOLDER="START_CREATE_FOLDER",e.CREATING_FILE="CREATING_FILE",e.CREATING_FOLDER="CREATING_FOLDER",e.MOVING="MOVING",e.CANCEL="CANCEL",e.CLEAR="CLEAR",e.ERROR="ERROR",e}(x||{});const j={isDeleting:!1,isRenaming:!1,isCreatingFile:!1,isCreatingFolder:!1,isMoving:!1,inFlight:!1,actionedEntities:null,newFileCreateMode:null,error:null};function b(e){return e}function y(e,t){switch(t.type){case x.START_RENAME:return{...j,isRenaming:!0};case x.START_DELETE:return{...j,isDeleting:!0,actionedEntities:t.actionedEntities};case x.START_CREATE_FILE:return{...j,isCreatingFile:!0,newFileCreateMode:t.newFileCreateMode};case x.START_CREATE_FOLDER:return{...j,isCreatingFolder:!0};case x.CREATING_FILE:return{...j,isCreatingFile:!0,newFileCreateMode:e.newFileCreateMode,inFlight:!0};case x.CREATING_FOLDER:return{...j,isCreatingFolder:!0,inFlight:!0};case x.DELETING:return{...j,isDeleting:!0,inFlight:!0,actionedEntities:e.actionedEntities};case x.MOVING:return{...j,isMoving:!0,inFlight:!0};case x.CLEAR:return{...j};case x.CANCEL:return e.inFlight?e:{...j};case x.ERROR:return{...e,inFlight:!1,error:t.error};default:throw new Error(`Unknown user action type: ${t.type}`)}}const _=e=>{let{children:t}=e;const{_id:n}=(0,c.O)(),{fileTreeReadOnly:_}=(0,d.Q)(),{indexAllReferences:v}=(0,m.B4)(),{fileTreeFromHistory:C}=(0,h.P4)(),[w,A]=(0,r.useReducer)(_?b:y,j),{fileTreeData:k,dispatchRename:E,dispatchMove:S}=(0,d.Q)(),{selectedEntityIds:N,isRootFolderSelected:R}=(0,u.G1)(),[F,T]=(0,r.useState)(null),P=(0,r.useCallback)((()=>{A({type:x.START_RENAME})}),[]),L=(0,r.useCallback)((e=>{const t=Array.from(N)[0],r=(0,o.k3)(k,t),i=r.entity.name;if(e===i)return A({type:x.CLEAR});const c=function(e,t,n){if(!(0,a.tL)(n))return new p.di;if(!(0,l.MS)(e,t.parentFolderId,n))return new p.Lc;const r=1===t.path.length,i="folder"===t.type;if(r&&!i&&(0,a.kW)(n))return new p.yG}(k,r,e);return c?A({type:x.ERROR,error:c}):(A({type:x.CLEAR}),E(t,e),(0,s.Mb)(n,r.type,r.entity._id,e).catch((e=>{E(t,i),A({type:x.ERROR,error:e})})))}),[E,k,n,N]),D=(0,r.useCallback)(((e,t)=>!(0,l.MS)(k,e,t)),[k]),I=(0,r.useCallback)((()=>{const e=Array.from(N).map((e=>(0,o.k3)(k,e).entity));A({type:x.START_DELETE,actionedEntities:e})}),[k,N]),M=(0,r.useCallback)((()=>{A({type:x.DELETING});let e=!1;return(0,i._)(Array.from(N),(t=>{const r=(0,o.k3)(k,t);return e=e||/\.bib$/.test(r.entity.name),(0,s.Dl)(n,r.type,r.entity._id).catch((e=>{if(404!==e.info.statusCode)throw e}))})).then((()=>{e&&v(!0),A({type:x.CLEAR})})).catch((e=>{A({type:x.ERROR,error:e})}))}),[k,n,N,v]),O=(0,r.useCallback)(((e,t)=>{A({type:x.MOVING});const r=Array.from(t).map((e=>(0,o.k3)(k,e))).filter((n=>n.parentFolderId!==e&&!t.has(n.parentFolderId))),c=e===k._id,d=r.map((t=>function(e,t,n,r){if(!(0,l.MS)(e,t,n.entity.name)){const e=new p.ui;return e.entityName=n.entity.name,e}const i="folder"===n.type;if(r&&!i&&(0,a.kW)(n.entity.name))return new p.yG}(k,e,t,c))).find((e=>e));if(d)return A({type:x.ERROR,error:d});const u={};let m=!1;return r.forEach((t=>{u[t.entity._id]=t.parentFolderId,S(t.entity._id,e)})),(0,i._)(r,(async t=>{try{await(0,s.r_)(n,t.type,t.entity._id,e)}catch(e){m=!0,S(t.entity._id,u[t.entity._id]),A({type:x.ERROR,error:e})}})).then((()=>{m||A({type:x.CLEAR})}))}),[S,k,n]),B=(0,r.useCallback)((()=>{A({type:x.START_CREATE_FOLDER})}),[]),q=(0,r.useMemo)((()=>function(e,t,n){if(n)return e._id;const r=Array.from(t)[0];if(!r)return e._id;const i=(0,o.lE)(e,r);if(!i)return e._id;return"folder"===i.type?i.entity._id:i.parentFolderId}(k,N,R)),[k,N,R]),$=(0,r.useMemo)((()=>{if(1===N.size){const[e]=N,t=(0,o.lE)(k,e);return t?.entity?.name}return null}),[k,N]),z=(0,r.useCallback)((e=>{const t=function(e,t,n){if(!(0,a.tL)(n.name))return new p.di;if(!(0,l.MS)(e,t,n.name))return new p.Lc;const r=t===e._id,i="folder"===n.endpoint;if(r&&!i&&(0,a.kW)(n.name))return new p.yG}(k,q,e);return t?Promise.reject(t):(0,s.xy)(n,q,e)}),[k,q,n]),U=(0,r.useCallback)((e=>(A({type:x.CREATING_FOLDER}),z({endpoint:"folder",name:e}).then((()=>{A({type:x.CLEAR})})).catch((e=>{A({type:x.ERROR,error:e})})))),[z]),V=(0,r.useCallback)((e=>{A({type:x.START_CREATE_FILE,newFileCreateMode:e})}),[]),H=(0,r.useCallback)((()=>{V("doc")}),[V]),G=(0,r.useCallback)((()=>{V("upload")}),[V]),K=(0,r.useCallback)((e=>(A({type:x.CREATING_FILE}),z(e).then((()=>{A({type:x.CLEAR})})).catch((e=>{A({type:x.ERROR,error:e})})))),[z]),Y=(0,r.useCallback)((e=>(e.endpoint="doc",K(e))),[K]),W=(0,r.useCallback)((e=>(e.endpoint="linked_file",K(e))),[K]),Z=(0,r.useCallback)((()=>{A({type:x.CANCEL})}),[]);(0,r.useEffect)((()=>{function e(e){A({type:x.START_CREATE_FILE,newFileCreateMode:e.detail.mode})}return window.addEventListener("file-tree.start-creating",e),()=>{window.removeEventListener("file-tree.start-creating",e)}}),[]);const Q=(0,r.useMemo)((()=>{if(1===N.size){const[e]=N,t=(0,o.lE)(k,e);if("fileRef"===t?.type)return C?`/project/${n}/blob/${t.entity.hash}`:`/project/${n}/file/${e}`;if("doc"===t?.type)return`/project/${n}/doc/${e}/download`}}),[k,n,N,C]),X={canDelete:N.size>0&&!R,canRename:1===N.size&&!R,canCreate:N.size<2,...w,parentFolderId:q,selectedFileName:$,isDuplicate:D,startRenaming:P,finishRenaming:L,startDeleting:I,finishDeleting:M,finishMoving:O,startCreatingFile:V,startCreatingFolder:B,finishCreatingFolder:U,startCreatingDocOrFile:H,startUploadingDocOrFile:G,finishCreatingDoc:Y,finishCreatingLinkedFile:W,cancel:Z,droppedFiles:F,setDroppedFiles:T,downloadPath:Q};return(0,f.jsx)(g.Provider,{value:X,children:t})};function v(){const e=(0,r.useContext)(g);if(!e)throw new Error("useFileTreeActionable is only available inside FileTreeActionableProvider");return e}},11787:(e,t,n)=>{n.d(t,{e:()=>o,r:()=>l});n(16280);var r=n(14041),i=n(31085);const s=(0,r.createContext)(void 0);function o(){const e=(0,r.useContext)(s);if(!e)throw new Error("useFileTreeMainContext is only available inside FileTreeMainProvider");return e}const l=e=>{let{refProviders:t,setRefProviderEnabled:n,setStartedFreeTrial:o,children:l}=e;const[a,c]=(0,r.useState)(null);return(0,i.jsx)(s.Provider,{value:{refProviders:t,setRefProviderEnabled:n,setStartedFreeTrial:o,contextMenuCoords:a,setContextMenuCoords:c},children:l})}},88588:(e,t,n)=>{n.d(t,{G1:()=>w,hj:()=>C,k2:()=>_});n(16280),n(43375),n(39225),n(13972),n(99209),n(25714),n(17561),n(66197);var r=n(14041),i=n(53373),s=n.n(i),o=n(45250),l=n.n(o),a=n(79550),c=n(71573),d=n(66666),u=n(56447),p=n(42093),m=n(28699),h=n(11787),f=n(88091),g=n(31085);const x=(0,r.createContext)(void 0);var j=function(e){return e.SELECT="SELECT",e.MULTI_SELECT="MULTI_SELECT",e.UNSELECT="UNSELECT",e}(j||{});function b(e,t){switch(t.type){case j.SELECT:return new Set(Array.isArray(t.id)?t.id:[t.id]);case j.MULTI_SELECT:{const n=new Set(e);return n.has(t.id)?n.size>1&&n.delete(t.id):n.add(t.id),n}case j.UNSELECT:{const n=new Set(e);return n.delete(t.id),n}default:throw new Error(`Unknown selectable action type: ${t.type}`)}}function y(e,t){switch(t.type){case j.SELECT:return new Set([t.id]);case j.MULTI_SELECT:case j.UNSELECT:return e;default:throw new Error(`Unknown selectable action type: ${t.type}`)}}const _=e=>{let{onSelect:t,children:n}=e;const{_id:i,rootDocId:s}=(0,d.O)(),[o]=(0,p.A)(`doc.open_id.${i}`,s),{fileTreeData:u,setSelectedEntities:h,fileTreeReadOnly:f}=(0,c.Q)(),[_,v]=(0,r.useState)(!1),[C,w]=(0,r.useReducer)(f?y:b,null,(()=>o&&(0,a.lE)(u,o)?new Set([o]):new Set)),[A,k]=(0,r.useState)(new Set);(0,r.useEffect)((()=>{const e=new Set;C.forEach((t=>{const n=(0,a.lE)(u,t);n&&n.path.forEach((t=>e.add(t)))})),k(e)}),[u,C]);const E=(0,m.A)(C);(0,r.useEffect)((()=>{if(l().isEqual(C,E))return;const e=Array.from(C).map((e=>(0,a.lE)(u,e))).filter(Boolean);t(e),h(e)}),[u,C,E,t,h]),(0,r.useEffect)((()=>{function e(e){const t=(0,a.lE)(u,e.detail);t&&w({type:j.SELECT,id:t.entity._id})}return window.addEventListener("editor.openDoc",e),()=>window.removeEventListener("editor.openDoc",e)}),[u]);const S=(0,r.useCallback)((e=>{w({type:j.SELECT,id:e})}),[]),N=(0,r.useCallback)((e=>{w({type:j.UNSELECT,id:e})}),[]),R=(0,r.useCallback)(((e,t)=>{const n=t?j.MULTI_SELECT:j.SELECT;w({type:n,id:e})}),[]),F={selectedEntityIds:C,selectedEntityParentIds:A,select:S,unselect:N,selectOrMultiSelectEntity:R,isRootFolderSelected:_,setIsRootFolderSelected:v};return(0,g.jsx)(x.Provider,{value:F,children:n})},v=/Mac/.test(window.navigator?.platform);function C(e,t){const{view:n,setView:i}=(0,u.LV)(),{setContextMenuCoords:o}=(0,h.e)(),{fileTreeData:l}=(0,c.Q)(),{selectedEntityIds:d,selectOrMultiSelectEntity:p,isRootFolderSelected:m,setIsRootFolderSelected:f}=w(),g=d.has(e),x=(0,r.useCallback)((e=>{const t=[];let n=!1;for(const r of k(l))if(r===e){if(t.push(r),n)break;n=!0}else if(d.has(r)){if(t.push(r),n)break;n=!0}else n&&t.push(r);return t}),[l,d]),j=(0,r.useCallback)((()=>{for(const e of d){const t=(0,a.lE)(l,e);if("doc"===t.type)return"editor";if("fileRef"===t.type)return"file";if("folder"===t.type)return n}return null}),[l,d,n]),b=(0,r.useCallback)((n=>{n.stopPropagation();const r=!m&&(v?n.metaKey:n.ctrlKey);f(!1),n.shiftKey?p(x(e)):p(e,r),"file"===t?i("file"):"doc"===t?i("editor"):"folder"===t&&i(j())}),[e,m,f,p,i,t,x,j]),y=(0,r.useCallback)((e=>{b(e),e.ctrlKey||e.metaKey||o(null)}),[b,o]),_=(0,r.useCallback)((e=>{"Enter"!==e.key&&" "!==e.key||b(e)}),[b]),C=(0,r.useCallback)((t=>{d.has(e)||b(t)}),[e,b,d]),A=!m&&g&&"pdf"!==n;return{isSelected:g,props:(0,r.useMemo)((()=>({className:s()({selected:A}),"aria-selected":A,onClick:y,onContextMenu:C,onKeyPress:_})),[y,C,_,A])}}function w(){const e=(0,r.useContext)(x);if(!e)throw new Error("useFileTreeSelectable is only available inside FileTreeSelectableProvider");return e}const A=(e,t)=>f.h.compare(e.name,t.name);function*k(e){yield e._id;const t=[...e.folders].sort(A);for(const e of t)for(const t of k(e))yield t;const n=[...e.docs,...e.fileRefs].sort(A);for(const e of n)yield e._id}},27916:(e,t,n)=>{n.d(t,{Lc:()=>DuplicateFilenameError,di:()=>InvalidFilenameError,ui:()=>DuplicateFilenameMoveError,yG:()=>BlockedFilenameError});n(16280);class InvalidFilenameError extends Error{constructor(){super("invalid filename")}}class BlockedFilenameError extends Error{constructor(){super("blocked filename")}}class DuplicateFilenameError extends Error{constructor(){super("duplicate filename")}}class DuplicateFilenameMoveError extends Error{constructor(){super("duplicate filename on move")}}},4941:(e,t,n)=>{n.d(t,{i:()=>a});var r=n(14041),i=n(37858),s=n(88091),o=n(52155);const l=(e,t)=>s.h.compare(e.path,t.path);function a(e){const[t,n]=(0,r.useState)(!1),[s,a]=(0,r.useState)(null),[c,d]=(0,r.useState)(!1),{signal:u}=(0,o.A)();return(0,r.useEffect)((()=>{e&&(n(!0),d(!1),a(null),(0,i.hm)(`/project/${e}/entities`,{signal:u}).then((e=>{a(e.entities.sort(l))})).catch((e=>d(e))).finally((()=>n(!1))))}),[e,u]),{loading:t,data:s,error:c}}},87833:(e,t,n)=>{n.d(t,{z:()=>a});var r=n(14041),i=n(37858),s=n(88091),o=n(52155);const l=(e,t)=>s.h.compare(e.path,t.path);function a(e){const[t,n]=(0,r.useState)(!1),[s,a]=(0,r.useState)(null),[c,d]=(0,r.useState)(!1),{signal:u}=(0,o.A)();return(0,r.useEffect)((()=>{e&&(n(!0),d(!1),a(null),(0,i.TB)(`/project/${e}/compile`,{body:{check:"silent",draft:!1,incrementalCompilesEnabled:!1},signal:u}).then((e=>{if("success"===e.status){const t=e.outputFiles.filter((e=>e.path.match(/.*\.(pdf|png|jpeg|jpg|gif)/)));e.outputFiles.forEach((t=>{t.clsiServerId=e.clsiServerId,t.compileGroup=e.compileGroup})),a(t.sort(l))}else d("linked-project-compile-error")})).catch((e=>d(e))).finally((()=>n(!1))))}),[e,u]),{loading:t,data:s,error:c}}},45524:(e,t,n)=>{n.d(t,{r:()=>a});var r=n(14041),i=n(37858),s=n(88091),o=n(52155);const l=(e,t)=>s.h.compare(e.name,t.name);function a(){const[e,t]=(0,r.useState)(!0),[n,s]=(0,r.useState)(null),[a,c]=(0,r.useState)(!1),{signal:d}=(0,o.A)();return(0,r.useEffect)((()=>{(0,i.hm)("/user/projects",{signal:d}).then((e=>{s(e.projects.sort(l))})).catch((e=>c(e))).finally((()=>t(!1)))}),[d]),{loading:e,data:n,error:a}}},88091:(e,t,n)=>{n.d(t,{h:()=>r});const r=new Intl.Collator("en",{numeric:!0,sensitivity:"variant",caseFirst:"upper"})},66285:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(10009);function i(e){let t=e.split(".").pop();return t=t?t.toLowerCase():t,["png","pdf","jpg","jpeg","gif"].includes(t)?"image":["csv","xls","xlsx"].includes(t)?(0,r.yU)()?"table_chart":"table":["py","r"].includes(t)?(0,r.yU)()?"code":"file-text":["bib"].includes(t)?(0,r.yU)()?"menu_book":"book":(0,r.yU)()?"description":"file"}},4816:(e,t,n)=>{n.d(t,{n:()=>o});var r=n(69687),i=n(64932);let s;const o=(e,t)=>(s||(s=new r.VR((0,i.A)("ol-ExposedSettings").fileIgnorePattern,{nocase:!0,dot:!0})),!!e&&(!t||!s.match(t+"/"+e)))},71735:(e,t,n)=>{n.d(t,{MS:()=>i,Ro:()=>s,tL:()=>o});var r=n(79550);function i(e,t,n){return!(s(e,t,n)||o(e,t,n))}function s(e,t,n){return e._id!==t&&(e=(0,r.lE)(e,t).entity),e.docs.find((e=>e.name===n))||e.fileRefs.find((e=>e.name===n))}function o(e,t,n){return e._id!==t&&(e=(0,r.lE)(e,t).entity),e.folders.find((e=>e.name===n))}},67227:(e,t,n)=>{n.d(t,{kW:()=>a,tL:()=>l});n(25440);const r=new RegExp("[\\/\\\\\\*\\u0000-\\u001F\\u007F\\u0080-\\u009F\\uD800-\\uDFFF]","g"),i=new RegExp("(^\\.$)|(^\\.\\.$)|(^\\s+)|(\\s+$)","g"),s=new RegExp("^(prototype|constructor|toString|toLocaleString|valueOf|hasOwnProperty|isPrototypeOf|propertyIsEnumerable|__defineGetter__|__lookupGetter__|__defineSetter__|__lookupSetter__|__proto__)$"),o=1024;function l(e){return(t=e).length>0&&t.length<=o&&!e.match(r)&&!e.match(i);var t}function a(e){return s.test(e)}},9993:(e,t,n)=>{n.d(t,{Dl:()=>s,Mb:()=>i,r_:()=>o,xy:()=>l});var r=n(37858);function i(e,t,n,i){return(0,r.TB)(`/project/${e}/${a(t)}/${n}/rename`,{body:{name:i}})}function s(e,t,n){return(0,r.Un)(`/project/${e}/${a(t)}/${n}`)}function o(e,t,n,i){return(0,r.TB)(`/project/${e}/${a(t)}/${n}/move`,{body:{folder_id:i}})}function l(e,t,n){const{endpoint:i,...s}=n;return(0,r.TB)(`/project/${e}/${i}`,{body:{parent_folder_id:t,...s}})}function a(e){return"fileRef"===e?"file":e}},36471:(e,t,n)=>{n.d(t,{J:()=>l,a:()=>o});n(16280);var r=n(14041),i=n(31085);const s=(0,r.createContext)(void 0),o=e=>{let{children:t}=e;const[n,o]=(0,r.useState)(null),l=(0,r.useCallback)((e=>{o(e)}),[]);return(0,i.jsxs)(s.Provider,{value:n,children:[(0,i.jsx)("div",{className:"global-alerts",ref:l}),t]})},l=()=>{const e=(0,r.useContext)(s);if(void 0===e)throw new Error("useGlobalAlertsContainer is only available inside GlobalAlertsProvider");return e}},17515:(e,t,n)=>{n.d(t,{A:()=>k,h:()=>A});n(16280);var r=n(14041),i=n(97434),s=n(89135),o=n(10646),l=n(34325),a=n(57732),c=n(28812),d=n(22046),u=n(71627),p=n(67993),m=n(10009),h=n(237),f=n(31085);const g=(0,r.lazy)((()=>n.e(4761).then(n.bind(n,14761)).then((e=>{let{ReadOnlyTokenLink:t}=e;return{default:t}})))),x=(0,r.lazy)((()=>Promise.all([n.e(3939),n.e(1168)]).then(n.bind(n,11168))));function j(e){let{show:t,cancel:n,animation:j,inFlight:y,error:_}=e;const{t:v}=(0,i.Bd)(),{isRestrictedTokenMember:C}=(0,o.mi)();return(0,f.jsxs)(c.Ay,{show:t,onHide:n,animation:j,children:[(0,f.jsx)(c.IK,{closeButton:!0,children:(0,f.jsx)(c.rA,{children:v("share_project")})}),(0,f.jsx)(c.$8,{className:"modal-body-share modal-link-share-new",children:(0,f.jsxs)("div",{className:"container-fluid",children:[(0,f.jsx)(r.Suspense,{fallback:(0,f.jsx)(l.e,{minHeight:"15rem"}),children:C?(0,f.jsx)(g,{}):(0,f.jsx)(x,{})}),_&&(0,f.jsx)(d.A,{type:"error",content:(0,f.jsx)(b,{error:_}),className:"mb-0 mt-3"})]})}),(0,f.jsxs)(c.E9,{children:[(0,f.jsx)("div",{className:(0,m.q$)({bs3:"pull-left",bs5:"me-auto"}),children:y&&(0,f.jsx)(p.A,{bs3:(0,f.jsx)(s.A,{type:"refresh",spin:!0}),bs5:(0,f.jsx)(h.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"})})}),(0,f.jsx)(a.A,{onClick:n,as:u.A,variant:"secondary",disabled:y,children:v("close")})]})]})}function b(e){let{error:t}=e;const{t:n}=(0,i.Bd)();switch(t){case"cannot_invite_non_user":return(0,f.jsx)(f.Fragment,{children:n("cannot_invite_non_user")});case"cannot_verify_user_not_robot":return(0,f.jsx)(f.Fragment,{children:n("cannot_verify_user_not_robot")});case"cannot_invite_self":return(0,f.jsx)(f.Fragment,{children:n("cannot_invite_self")});case"invalid_email":return(0,f.jsx)(f.Fragment,{children:n("invalid_email")});case"too_many_requests":return(0,f.jsx)(f.Fragment,{children:n("too_many_requests")});case"invite_expired":return(0,f.jsx)(f.Fragment,{children:n("invite_expired")});case"invite_resend_limit_hit":return(0,f.jsx)(f.Fragment,{children:n("invite_resend_limit_hit")});default:return(0,f.jsx)(f.Fragment,{children:n("generic_something_went_wrong")})}}var y=n(66666),_=n(17112),v=n(5964),C=n(83566);const w=(0,r.createContext)(void 0);function A(){const e=(0,r.useContext)(w);if(!e)throw new Error("useShareProjectContext is only available inside ShareProjectProvider");return e}const k=r.memo((function(e){let{handleHide:t,show:n,handleOpen:i,animation:s=!0}=e;const[l,a]=(0,r.useState)(!1),[c,d]=(0,r.useState)(),u=(0,y.O)(),{isProjectOwner:p}=(0,o.mi)(),{splitTestVariants:m}=(0,_.d1)();(0,r.useEffect)((()=>{if(!(!p||!u.features)&&-1!==u.features.collaborators&&(u.members.filter((e=>"readAndWrite"===e.privileges)).length>(u.features.collaborators??1)||u.members.some((e=>e.pendingEditor)))){const e=`last-shown-share-modal.${u._id}`,t=C.A.getItem(e);(!t||t+864e5<Date.now())&&(i(),C.A.setItem(e,Date.now()))}}),[u,p,i]),(0,r.useEffect)((()=>{n&&(0,v._)("share-modal-opened",{splitTestVariant:m["null-test-share-modal"],project_id:u._id})}),[m,u._id,n]),(0,r.useEffect)((()=>{n&&d(void 0)}),[n]);const h=(0,r.useCallback)((()=>{l||t()}),[t,l]),g=(0,r.useCallback)((e=>{d(void 0),a(!0);const t=e();return t.catch((e=>{d(e.data?.errorReason||e.data?.error||"generic_something_went_wrong")})),t.finally((()=>{a(!1)})),t}),[]),x=(0,r.useCallback)((e=>Object.assign(u,e)),[u]);return u?(0,f.jsx)(w.Provider,{value:{updateProject:x,monitorRequest:g,inFlight:l,setInFlight:a,error:c,setError:d},children:(0,f.jsx)(j,{animation:s,cancel:h,error:c,inFlight:l,show:n})}):null}))},30158:(e,t,n)=>{n.d(t,{A:()=>A,h:()=>w});n(16280);var r=n(14041),i=n(97434),s=n(89135),o=n(10646),l=n(34325),a=n(57732),c=n(28812),d=n(22046),u=n(71627),p=n(67993),m=n(10009),h=n(237),f=n(31085);const g=(0,r.lazy)((()=>n.e(4903).then(n.bind(n,64903)).then((e=>{let{ReadOnlyTokenLink:t}=e;return{default:t}})))),x=(0,r.lazy)((()=>Promise.all([n.e(3939),n.e(890)]).then(n.bind(n,20890))));function j(e){let{show:t,cancel:n,animation:j,inFlight:y,error:_}=e;const{t:v}=(0,i.Bd)(),{isRestrictedTokenMember:C}=(0,o.mi)();return(0,f.jsxs)(c.Ay,{show:t,onHide:n,animation:j,children:[(0,f.jsx)(c.IK,{closeButton:!0,children:(0,f.jsx)(c.rA,{children:v("share_project")})}),(0,f.jsx)(c.$8,{className:"modal-body-share",children:(0,f.jsxs)("div",{className:"container-fluid",children:[(0,f.jsx)(r.Suspense,{fallback:(0,f.jsx)(l.e,{minHeight:"15rem"}),children:C?(0,f.jsx)(g,{}):(0,f.jsx)(x,{})}),_&&(0,f.jsx)(d.A,{type:"error",content:(0,f.jsx)(b,{error:_}),className:"mb-0 mt-3"})]})}),(0,f.jsxs)(c.E9,{children:[(0,f.jsx)("div",{className:(0,m.q$)({bs3:"pull-left",bs5:"me-auto"}),children:y&&(0,f.jsx)(p.A,{bs3:(0,f.jsx)(s.A,{type:"refresh",spin:!0}),bs5:(0,f.jsx)(h.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"})})}),(0,f.jsx)(a.A,{onClick:n,as:u.A,variant:"secondary",disabled:y,children:v("close")})]})]})}function b(e){let{error:t}=e;const{t:n}=(0,i.Bd)();switch(t){case"cannot_invite_non_user":return(0,f.jsx)(f.Fragment,{children:n("cannot_invite_non_user")});case"cannot_verify_user_not_robot":return(0,f.jsx)(f.Fragment,{children:n("cannot_verify_user_not_robot")});case"cannot_invite_self":return(0,f.jsx)(f.Fragment,{children:n("cannot_invite_self")});case"invalid_email":return(0,f.jsx)(f.Fragment,{children:n("invalid_email")});case"too_many_requests":return(0,f.jsx)(f.Fragment,{children:n("too_many_requests")});case"invite_expired":return(0,f.jsx)(f.Fragment,{children:n("invite_expired")});case"invite_resend_limit_hit":return(0,f.jsx)(f.Fragment,{children:n("invite_resend_limit_hit")});default:return(0,f.jsx)(f.Fragment,{children:n("generic_something_went_wrong")})}}var y=n(66666),_=n(17112),v=n(5964);const C=(0,r.createContext)(void 0);function w(){const e=(0,r.useContext)(C);if(!e)throw new Error("useShareProjectContext is only available inside ShareProjectProvider");return e}const A=r.memo((function(e){let{handleHide:t,show:n,animation:i=!0}=e;const[s,o]=(0,r.useState)(!1),[l,a]=(0,r.useState)(),c=(0,y.O)(),{splitTestVariants:d}=(0,_.d1)();(0,r.useEffect)((()=>{n&&(0,v._)("share-modal-opened",{splitTestVariant:d["null-test-share-modal"],project_id:c._id})}),[d,c._id,n]),(0,r.useEffect)((()=>{n&&a(void 0)}),[n]);const u=(0,r.useCallback)((()=>{s||t()}),[t,s]),p=(0,r.useCallback)((e=>{a(void 0),o(!0);const t=e();return t.catch((e=>{a(e.data?.errorReason||e.data?.error||"generic_something_went_wrong")})),t.finally((()=>{o(!1)})),t}),[]),m=(0,r.useCallback)((e=>Object.assign(c,e)),[c]);return c?(0,f.jsx)(C.Provider,{value:{updateProject:m,monitorRequest:p,inFlight:s,setInFlight:o,error:l,setError:a},children:(0,f.jsx)(j,{animation:i,cancel:u,error:l,inFlight:s,show:n})}):null}))},31622:(e,t,n)=>{n.d(t,{kn:()=>f,hu:()=>h,ee:()=>u,$S:()=>a,eb:()=>c,kw:()=>l,u6:()=>m,mI:()=>p,ON:()=>d});var r=n(37858);let i,s;var o=n(64932);function l(e,t,n){return function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(((t,n)=>{if(e||!window.grecaptcha)return t();try{i||(i=window.grecaptcha.render("recaptcha",{callback:e=>{s&&(s(e),s=void 0),window.grecaptcha.reset()}})),s=t}catch(e){n(e)}}))}((0,o.A)("ol-ExposedSettings").recaptchaDisabled?.invite).then((i=>(0,r.TB)(`/project/${e}/invite`,{body:{email:t,privileges:n,"g-recaptcha-response":i}})))}function a(e,t){return(0,r.TB)(`/project/${e}/invite/${t._id}/resend`)}function c(e,t){return(0,r.Un)(`/project/${e}/invite/${t._id}`)}function d(e,t,n){return(0,r.mI)(`/project/${e}/users/${t._id}`,{body:n})}function u(e,t){return(0,r.Un)(`/project/${e}/users/${t._id}`)}function p(e,t){return(0,r.TB)(`/project/${e}/transfer-ownership`,{body:{user_id:t._id}})}function m(e,t){return(0,r.TB)(`/project/${e}/settings/admin`,{body:{publicAccessLevel:t}})}function h(e){return(0,r.hm)(`/project/${e}/members`)}function f(e){return(0,r.hm)(`/project/${e}/invites`)}},43480:(e,t,n)=>{n.d(t,{V:()=>r});const r=(0,n(86954).Y)(new Date(2024,7,26),"MMMM Do")},15947:(e,t,n)=>{n.d(t,{By:()=>a,QV:()=>c,zP:()=>o});var r=n(14830);const i=r.Pe.define(),s=r.Pe.define(),o=()=>[l],l=r.sU.define({create:()=>[],update(e,t){for(const n of t.effects){n.is(i)&&e.push(n.value),n.is(s)&&(e=e.filter((e=>!(e.effect===n.value.effect&&e.callback===n.value.callback))));for(let t=0;t<e.length;++t){const r=e[t];n.is(r.effect)&&(setTimeout((()=>r.callback(n.value))),r.options?.once&&(e.splice(t,1),--t))}}return e}}),a=(e,t,n,r)=>{e.dispatch({effects:i.of({effect:t,callback:n,options:r})})},c=(e,t,n)=>{e.dispatch({effects:s.of({effect:t,callback:n})})}},83290:(e,t,n)=>{n.d(t,{FW:()=>u,Ib:()=>m,Nw:()=>c,a9:()=>p,nE:()=>f,sp:()=>d});n(43375),n(39225),n(13972),n(99209),n(25714),n(17561),n(66197);var r=n(14830),i=n(83173),s=n(15947),o=n(38188),l=n(60961);function a(e,t){return e?{...e,from:t.mapPos(e.from),to:t.mapPos(e.to)}:e}class c{constructor(e){this.props=e}get from(){return this.props.from}get to(){return this.props.to}get caption(){return this.props.caption}get label(){return this.props.label}get width(){return this.props.width}get unknownGraphicsArguments(){return this.props.unknownGraphicsArguments}get graphicsCommandArguments(){return this.props.graphicsCommandArguments}get graphicsCommand(){return this.props.graphicsCommand}get file(){return this.props.file}map(e){return new c({from:e.mapPos(this.from),to:e.mapPos(this.to),caption:a(this.caption,e),label:a(this.label,e),graphicsCommand:a(this.graphicsCommand,e),width:this.width,file:a(this.file,e),graphicsCommandArguments:a(this.graphicsCommandArguments,e),unknownGraphicsArguments:this.unknownGraphicsArguments})}}const d=r.Pe.define(),u=r.sU.define({create:()=>null,update:(e,t)=>{let n;for(const e of t.effects)e.is(d)&&(n=e.value);return void 0!==n?n:e?e.map(t.changes):e}}),p=()=>[u];function m(e){const t=new AbortController,n=new Promise((n=>{const r=()=>{l.$.warn("Aborting wait for file tree update"),(0,s.QV)(e,o.TY,i),n()};function i(){t.signal.aborted||(t.signal.removeEventListener("abort",r),n())}t.signal.addEventListener("abort",r,{once:!0}),(0,s.By)(e,o.TY,i,{once:!0})}));return{withTimeout(){return setTimeout((()=>t.abort()),arguments.length>0&&void 0!==arguments[0]?arguments[0]:500),n},promise:n}}const h=new Set(["image/jpeg","image/png","application/pdf"]),f=()=>i.Lz.domEventHandlers({drop:e=>{if(!e.dataTransfer||0===e.dataTransfer.files.length)return;const t=e.dataTransfer.files[0];h.has(t.type)&&window.dispatchEvent(new CustomEvent("figure-modal:paste-image",{detail:{name:t.name,type:t.type,data:t}}))},paste:e=>{if(!e.clipboardData||0===e.clipboardData.files.length)return;if(e.clipboardData.types.includes("text/plain"))return;const t=e.clipboardData.files[0];h.has(t.type)&&window.dispatchEvent(new CustomEvent("figure-modal:paste-image",{detail:{name:t.name,type:t.type,data:t}}))}})},38188:(e,t,n)=>{n.d(t,{B8:()=>c,BH:()=>m,HT:()=>u,TY:()=>g,Tm:()=>a,_X:()=>j,jC:()=>b,kq:()=>x,xC:()=>f});var r=n(14830),i=n(30789),s=n(83173),o=n(29587),l=n(45197);const a=r.Pe.define(),c=(0,l.v)(a),d=new r.xx,u=r.sU.define({create:()=>{},update:(e,t)=>{for(const e of t.effects)if(e.is(g))return e.value;return e}}),p=new r.xx,m=(e,t,n)=>{let{syntaxValidation:r}=n;return p.of(h(e,t,r))},h=(e,t,n)=>{const r=o.t$.matchFilename(i.e,e);return r?[d.of(o.Xt.of("    ")),u,s.Z9.define((e=>(r.load().then((r=>{e.dispatch({effects:[d.reconfigure(r),a.of(null)]}),e.dispatch({effects:[g.of(t),j.of(n)]})})),{}))),u]:[]},f=(e,t,n)=>({effects:p.reconfigure(h(e,t,n))}),g=r.Pe.define(),x=e=>({effects:g.of(e)}),j=r.Pe.define(),b=e=>({effects:j.of(e)})},30789:(e,t,n)=>{n.d(t,{e:()=>i});var r=n(29587);const i=[r.t$.of({name:"latex",extensions:["tex","sty","cls","clo","bst","bbl","pdf_tex","pdf_t","map","fd","enc","def","mf","pgf","tikz","bbx","cbx","dbx","lbx","lco","ldf","xmpdata","Rnw","rnw","lyx","inc","dtx","hak","eps_tex","brf","ins","hva","Rtex","rtex","pstex","pstex_t","gin","fontspec","pygstyle","pygtex","ps_tex","ltx"],load:()=>Promise.all([n.e(4695),n.e(5982),n.e(188),n.e(1290),n.e(4372),n.e(7430)]).then(n.bind(n,37430)).then((e=>e.latex()))}),r.t$.of({name:"bibtex",extensions:["bib"],load:()=>Promise.all([n.e(4695),n.e(5982),n.e(9065)]).then(n.bind(n,9065)).then((e=>e.bibtex()))}),r.t$.of({name:"markdown",extensions:["md","markdown"],load:()=>Promise.all([n.e(4695),n.e(2348),n.e(188),n.e(6456)]).then(n.bind(n,14075)).then((e=>e.markdown()))})]},5383:(e,t,n)=>{n.r(t),n.d(t,{AffilCtrlSeq:()=>ie,AffiliationCtrlSeq:()=>se,Ampersand:()=>At,AuthorCtrlSeq:()=>re,BareFilePathArgument:()=>St,Begin:()=>f,BibKeyArgument:()=>pt,BibliographyCtrlSeq:()=>te,BibliographyStyleCtrlSeq:()=>ne,BlankLine:()=>Ve,Book:()=>ln,BookCtrlSeq:()=>$,BottomRuleCtrlSeq:()=>me,BracketMath:()=>Ht,CaptionCtrlSeq:()=>T,CenteringCtrlSeq:()=>ee,Chapter:()=>cn,ChapterCtrlSeq:()=>U,CiteCtrlSeq:()=>b,CiteStarrableCtrlSeq:()=>y,CloseBrace:()=>Ye,CloseBracket:()=>nt,CloseBracketCtrlSym:()=>Be,CloseBracketMath:()=>Kt,CloseParenCtrlSym:()=>Me,CloseParenMath:()=>Zt,ColorBoxCtrlSeq:()=>ce,Command:()=>Xe,Comment:()=>$e,Csname:()=>a,CtrlSeq:()=>yt,CtrlSym:()=>mt,DateCtrlSeq:()=>oe,DefCtrlSeq:()=>P,DefinitionArgument:()=>gt,DefinitionFragment:()=>jt,DefinitionFragmentArgument:()=>_t,DefinitionFragmentCommand:()=>bt,DisplayMath:()=>Vt,DocumentClassCtrlSeq:()=>A,DocumentEnvName:()=>Ee,DocumentEnvironment:()=>Ge,Dollar:()=>Ct,DollarMath:()=>Tt,EmphasisCtrlSeq:()=>Ae,End:()=>g,EnvName:()=>it,Environment:()=>rt,EquationArrayEnvName:()=>Re,EquationArrayEnvironment:()=>Jt,EquationEnvName:()=>Ne,EquationEnvironment:()=>Xt,FigureEnvName:()=>Pe,FigureEnvironment:()=>rn,FilePathArgument:()=>ct,HLineCtrlSeq:()=>de,HboxCtrlSeq:()=>C,HrefCtrlSeq:()=>E,IncludeCtrlSeq:()=>Z,IncludeGraphicsCtrlSeq:()=>F,InlineMath:()=>Pt,InputCtrlSeq:()=>W,ItemCtrlSeq:()=>Q,KnownCtrlSym:()=>vt,KnownEnvironment:()=>He,LaTeX:()=>ze,LabelArgument:()=>dt,LabelCtrlSeq:()=>_,LeftCtrlSeq:()=>D,LetCtrlSeq:()=>L,LineBreakCtrlSym:()=>qe,ListEnvName:()=>Le,ListEnvironment:()=>sn,LiteralArgContent:()=>s,LongArg:()=>tt,LstInlineContent:()=>i,LstInlineCtrlSeq:()=>R,MacroParameter:()=>ht,MaketitleCtrlSeq:()=>le,Math:()=>Lt,MathArgument:()=>It,MathChar:()=>Ut,MathClosing:()=>qt,MathCommand:()=>Dt,MathDelimitedGroup:()=>Mt,MathDelimiter:()=>Bt,MathOpening:()=>Ot,MathSpecialChar:()=>$t,MathTextCtrlSeq:()=>v,MidRuleCtrlSeq:()=>pe,MultiColumnCtrlSeq:()=>he,NewCommandCtrlSeq:()=>M,NewEnvironmentCtrlSeq:()=>B,NewLine:()=>xt,NewTheoremCtrlSeq:()=>X,Normal:()=>wt,Number:()=>zt,OpenBrace:()=>Ke,OpenBracket:()=>Ze,OpenBracketCtrlSym:()=>Oe,OpenBracketMath:()=>Gt,OpenParenCtrlSym:()=>Ie,OpenParenMath:()=>Wt,OptionalArgument:()=>We,OptionalMacroParameter:()=>ft,PackageArgument:()=>lt,ParBoxCtrlSeq:()=>fe,Paragraph:()=>mn,ParagraphCtrlSeq:()=>K,ParenMath:()=>Yt,Part:()=>an,PartCtrlSeq:()=>z,RefArgument:()=>ut,RefCtrlSeq:()=>x,RefStarrableCtrlSeq:()=>j,RenewCommandCtrlSeq:()=>O,RenewEnvironmentCtrlSeq:()=>q,RightCtrlSeq:()=>I,Section:()=>dn,SectionCtrlSeq:()=>V,SectioningArgument:()=>Et,ShortArg:()=>ot,ShortOptionalArg:()=>Qe,ShortTextArgument:()=>st,SpaceDelimitedLiteralArgContent:()=>o,SubParagraph:()=>hn,SubParagraphCtrlSeq:()=>Y,SubSection:()=>un,SubSectionCtrlSeq:()=>H,SubSubSection:()=>pn,SubSubSectionCtrlSeq:()=>G,TableEnvName:()=>De,TableEnvironment:()=>on,TabularArgument:()=>Nt,TabularContent:()=>Rt,TabularEnvName:()=>Se,TabularEnvironment:()=>Qt,Text:()=>Ue,TextArgument:()=>et,TextBoldCtrlSeq:()=>ge,TextColorCtrlSeq:()=>ae,TextItalicCtrlSeq:()=>xe,TextMediumCtrlSeq:()=>ye,TextSansSerifCtrlSeq:()=>_e,TextSmallCapsCtrlSeq:()=>je,TextStrikeOutCtrlSeq:()=>we,TextSubscriptCtrlSeq:()=>Ce,TextSuperscriptCtrlSeq:()=>ve,TextTeletypeCtrlSeq:()=>be,TheoremStyleCtrlSeq:()=>J,TikzPictureContent:()=>nn,TikzPictureEnvName:()=>Te,TikzPictureEnvironment:()=>tn,Tilde:()=>kt,TitleCtrlSeq:()=>w,TopRuleCtrlSeq:()=>ue,TrailingContent:()=>d,TrailingWhitespaceOnly:()=>c,UnderlineCtrlSeq:()=>ke,UnknownCommand:()=>Ft,UrlArgument:()=>at,UrlCtrlSeq:()=>S,UsePackageCtrlSeq:()=>k,VerbContent:()=>r,VerbCtrlSeq:()=>N,VerbatimContent:()=>l,VerbatimEnvName:()=>Fe,VerbatimEnvironment:()=>en,Whitespace:()=>Je,endOfArguments:()=>p,endOfArgumentsAndOptionals:()=>h,hasMoreArguments:()=>u,hasMoreArgumentsOrOptionals:()=>m});const r=1,i=2,s=3,o=4,l=5,a=6,c=7,d=8,u=373,p=374,m=375,h=376,f=9,g=10,x=11,j=12,b=13,y=14,_=15,v=16,C=17,w=18,A=19,k=20,E=21,S=22,N=23,R=24,F=25,T=26,P=27,L=28,D=29,I=30,M=31,O=32,B=33,q=34,$=35,z=36,U=37,V=38,H=39,G=40,K=41,Y=42,W=43,Z=44,Q=45,X=46,J=47,ee=48,te=49,ne=50,re=51,ie=52,se=53,oe=54,le=55,ae=56,ce=57,de=58,ue=59,pe=60,me=61,he=62,fe=63,ge=64,xe=65,je=66,be=67,ye=68,_e=69,ve=70,Ce=71,we=72,Ae=73,ke=74,Ee=75,Se=76,Ne=77,Re=78,Fe=79,Te=80,Pe=81,Le=82,De=83,Ie=84,Me=85,Oe=86,Be=87,qe=88,$e=89,ze=90,Ue=91,Ve=92,He=93,Ge=94,Ke=97,Ye=98,We=99,Ze=100,Qe=101,Xe=102,Je=105,et=106,tt=107,nt=108,rt=110,it=113,st=120,ot=121,lt=130,at=134,ct=142,dt=145,ut=147,pt=149,mt=151,ht=152,ft=153,gt=154,xt=155,jt=156,bt=157,yt=159,_t=160,vt=161,Ct=164,wt=165,At=166,kt=167,Et=169,St=178,Nt=188,Rt=189,Ft=203,Tt=204,Pt=205,Lt=206,Dt=207,It=222,Mt=269,Ot=270,Bt=271,qt=272,$t=273,zt=274,Ut=275,Vt=276,Ht=277,Gt=278,Kt=279,Yt=280,Wt=281,Zt=282,Qt=285,Xt=290,Jt=295,en=299,tn=304,nn=308,rn=311,sn=315,on=319,ln=324,an=327,cn=330,dn=333,un=336,pn=339,mn=342,hn=345},45197:(e,t,n)=>{n.d(t,{u:()=>r,v:()=>i});const r=e=>t=>t.effects.some((t=>t.is(e))),i=e=>t=>t.transactions.some((t=>t.effects.some((t=>t.is(e)))))},94355:(e,t,n)=>{n.d(t,{Kn:()=>a,l_:()=>o});n(16280);var r=n(97900),i=n(47200);i.Tq;const s=(e,t,n)=>{const i=(0,r.G2)(e,...n);if(i){const e=t.doc.sliceString(i.from,i.to);if(e.length>0)return e}return null},o=(e,t,n,i)=>{if(t.type.is("NewCommand")||t.type.is("RenewCommand")){if(!i(t.node))return;const o=s(t.node,e,["LiteralArgContent","Csname"]);if(null===o)return;const l=t.node.getChildren("OptionalArgument");let a=0;if(l.length>0){const t=l[0],n=(0,r.H)(e,t);if(n)try{a=parseInt(n,10)}catch(e){}}const c=2===l.length;c&&a>0&&a--,n.push({line:e.doc.lineAt(t.from).number,title:o,from:t.from,to:t.to,optionalArgCount:c?1:0,requiredArgCount:a,type:"definition",raw:e.sliceDoc(t.from,t.to)})}else if(t.type.is("Def")){if(!i(t.node))return;const r=s(t.node,e,["Csname","CtrlSym"]);if(null===r)return;const o=t.node.getChildren("MacroParameter").length,l=t.node.getChildren("OptionalMacroParameter").length;n.push({line:e.doc.lineAt(t.from).number,title:r,from:t.from,to:t.to,optionalArgCount:l,requiredArgCount:o,type:"definition",raw:e.sliceDoc(t.from,t.to)})}else if(t.type.is("Let")){if(!i(t.node))return;const r=s(t.node,e,["Csname"]);if(null===r)return;n.push({line:e.doc.lineAt(t.from).number,title:r,from:t.from,to:t.to,ignoreInAutocomplete:!0,optionalArgCount:void 0,requiredArgCount:void 0,type:"definition",raw:e.sliceDoc(t.from,t.to)})}else if(t.type.is("UnknownCommand")||t.type.is("KnownCommand")||t.type.is("MathUnknownCommand")||t.type.is("DefinitionFragmentUnknownCommand")){if(!i(t.node))return;let r=t.node;if(t.type.is("KnownCommand")&&(r=r.firstChild),!r)return;const s=r.getChild("$CtrlSeq");if(!s)return;if(s.type.is("$CtrlSym"))return;const o=r.getChildren("OptionalArgument"),l=r.getChildren("$Argument"),a=e.doc.sliceString(s.from,s.to);n.push({line:e.doc.lineAt(r.from).number,title:a,from:r.from,to:r.to,optionalArgCount:o.length,requiredArgCount:l.length-o.length,type:"usage",raw:void 0})}},l={tex:0,pdf:1},a=(e,t,n)=>{if("\\texorpdfstring"===s(t.node,e,["CtrlSeq"])){const r=t.getChildren("TextArgument")[l[n]]?.getChild("LongArg");if(r)return e.doc.sliceString(r.from,r.to)}}},97900:(e,t,n)=>{n.d(t,{B9:()=>nodeHasError,G2:()=>o,H:()=>s,I8:()=>i});var r=n(29587);const i=(e,t,n)=>{const i=(0,r.a_)(e,t,100);if(!i)return null;const s=i.resolve(t),o=s?.prevSibling;return o?.type.name===n},s=(e,t)=>{const n=t.getChild("ShortOptionalArg");if(n)return e.doc.sliceString(n.from,n.to)},nodeHasError=e=>{let t=!1;return e.cursor().iterate((e=>{let{type:n}=e;return!t&&(!n.isError||(t=!0,!1))})),t},o=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];let i=null;return e.cursor().iterate((e=>{if(null!==i)return!1;for(const t of n)if(e.type.is(t))return i=e.node,!1;return!0})),i}},21947:(e,t,n)=>{n.d(t,{$2:()=>d,E9:()=>p,ee:()=>a,hN:()=>u,l_:()=>l,ob:()=>c,qI:()=>m});n(16280);var r=n(29587),i=n(97900),s=n(47200),o=n(83290);s.Tq;const l=(e,t,n,r)=>{if(t.type.is("EnvNameGroup")){if(!r(t.node))return!1;if(!t.node.prevSibling?.type.is("Begin"))return!1;const i=t.node.getChild("OpenBrace");if(!i)return!1;const s=i.node.nextSibling;if(!s)return!1;const o=e.doc.sliceString(s.from,s.to);if(o.length<1)return!1;const l={title:o,from:s.from,to:s.to,line:e.doc.lineAt(s.from).number,type:"usage",raw:e.sliceDoc(t.from,t.to)};n.push(l)}else if(t.type.is("NewEnvironment")||t.type.is("RenewEnvironment")){if(!r(t.node))return!1;const i=t.node.getChild("LiteralArgContent");if(!i)return;const s=e.doc.sliceString(i.from,i.to);if(!s)return;const o={title:s,from:i.from,to:i.to,line:e.doc.lineAt(i.from).number,type:"definition",raw:e.sliceDoc(t.from,t.to)};n.push(o)}},a=(e,t)=>{const n=(0,r.a_)(e,t,100);if(!n)return;let s=n.resolve(t);if(s){if(s.type.is("EnvNameGroup")&&(0,i.I8)(e,t,"Begin"))return!0;if(s.type.is("$Environment")||s.type.is("LaTeX")&&t===e.doc.length){if(s=n.resolve(t,-1),!s)return;if(s.type.is("OpenBrace")||s.type.is("$EnvName"))return!0}}},c=(e,t)=>{const n=(0,r.a_)(e,t,100);if(!n)return;let s=n.resolve(t);if(s){if(s.type.is("EnvNameGroup")&&(0,i.I8)(e,t,"End"))return!0;if(s.type.is("$Environment")||s.type.is("Content")){if(s=n.resolve(t,-1),!s)return;if(s.type.is("OpenBrace")||s.type.is("EnvName"))return!0}}};function d(e,t){if(e?.type.is("$Environment")&&(e=e.getChild("BeginEnv")),!e?.type.is("BeginEnv")&&!e?.type.is("EndEnv"))return null;const n=e?.getChild("EnvNameGroup")?.getChild("OpenBrace")?.nextSibling;return n?n.type.is("CloseBrace")?null:t.sliceDoc(n.from,n.to):null}const u=(e,t)=>d(e,t)?.replace(/\*$/,"");function p(e){return e.getChild("BeginEnv")?.getChildren("TextArgument")}function m(e,t){let n,r,i,s,l=null,a=null,c=null;const d=e.from,u=e.to;let p=!1;return e.cursor().iterate((e=>{if(p)return!1;if(e.type.is("Caption")){if(l)return p=!0,!1;l={from:e.from,to:e.to}}if(e.type.is("Label")){if(a)return p=!0,!1;a={from:e.from,to:e.to}}if(e.type.is("IncludeGraphics")){if(n)return p=!0,!1;s={from:e.from,to:e.to};const o=e.node.getChild("IncludeGraphicsArgument")?.getChild("FilePathArgument")?.getChild("LiteralArgContent");if(!o)return p=!0,!1;n={from:o.from,to:o.to,path:t.sliceDoc(o.from,o.to)};const l=e.node.getChild("OptionalArgument")?.getChild("ShortOptionalArg");if(!l)return r=void 0,!1;c={from:l.from,to:l.to};const a=t.sliceDoc(l.from,l.to),d=a.match(/^width=([0-9]|(?:[0-9]*\.[0-9]+)|(?:[0-9]+\.))\\(linewidth|pagewidth|textwidth|hsize|columnwidth)$/);d?(r=parseFloat(d[1]),"linewidth"!==d[2]&&(i=a)):i=a}})),p||void 0===s||void 0===n?null:new o.Nw({caption:l,label:a,file:n,from:d,to:u,width:r,unknownGraphicsArguments:i,graphicsCommand:s,graphicsCommandArguments:c})}},60347:(e,t,n)=>{n.d(t,{l_:()=>u,z_:()=>m});n(16280);var r=n(47200),i=n(5383),s=n(21947),o=n(94355);r.Tq;var l=function(e){return e[e.Book=1]="Book",e[e.Part=2]="Part",e[e.Chapter=3]="Chapter",e[e.Section=4]="Section",e[e.SubSection=5]="SubSection",e[e.SubSubSection=6]="SubSubSection",e[e.Paragraph=7]="Paragraph",e[e.SubParagraph=8]="SubParagraph",e[e.Frame=9]="Frame",e[e.Invalid=-1]="Invalid",e}(l||{});const a={book:l.Book,part:l.Part,chapter:l.Part,section:l.Section,subsection:l.SubSection,subsubsection:l.SubSubSection,paragraph:l.Paragraph,subparagraph:l.SubParagraph,frame:l.Frame},c=e=>{if("string"==typeof e)return a[e]??l.Invalid;switch(e){case i.Book:return l.Book;case i.Part:return l.Part;case i.Chapter:return l.Chapter;case i.Section:return l.Section;case i.SubSection:return l.SubSection;case i.SubSubSection:return l.SubSubSection;case i.Paragraph:return l.Paragraph;case i.SubParagraph:return l.SubParagraph;default:return l.Invalid}},d=(e,t)=>{const n=[];return t.node.cursor().iterate((r=>{if(r.from>=t.to)return!1;if(r.type.is("Label"))return!1;if(r.type.is("UnknownCommand")){const t=(0,o.Kn)(e,r.node,"pdf");if(t)return n.push(t),!1}if(r.node.firstChild)return!0;n.push(e.doc.sliceString(r.from,r.to))})),n.join("")},u=(e,t,n,r)=>{if(t.type.is("SectioningCommand")){const i=t.node,s=i.parent;if(!r(i))return;const o=i.getChild("SectioningArgument")?.getChild("LongArg");if(!o)return;for(let e=s;e;e=e.parent)if(e.type.is("NewCommand")||e.type.is("RenewCommand"))return!1;const l=()=>{const t=i.firstChild;return t?e.doc.sliceString(t.from+1,t.to):""},a=s?.type.is("$SectioningCommand")?c(s.type.id):c(l()),u={line:e.doc.lineAt(i.from).number,title:d(e,o),from:i.from,to:i.to,level:a};n.push(u)}if(t.type.is("$Environment")){const i=t.node;if("frame"===(0,s.$2)(i,e)){const t=i.getChild("BeginEnv");if(!r(t))return;const o=(0,s.E9)(i)?.map((e=>e.getChild("LongArg")));if(o?.length){const r=o[0],i=r?e.sliceDoc(r.from,r.to):"",s={line:e.doc.lineAt(t.from).number,title:i,from:t.from,to:t.to,level:l.Frame};n.push(s)}}}},p=e=>({title:e.title,line:e.line,level:e.level}),m=e=>{const t=[],n=[];for(const r of e){const e=p(r);for(;t.length&&t[t.length-1].level>=e.level;)t.pop();if(t.length){const n=t[t.length-1];n.children?n.children.push(e):n.children=[e],t.push(e)}else t.push(e),n.push(e)}return n}},47200:(e,t,n)=>{n.d(t,{CN:()=>c,P4:()=>u,Tq:()=>a});n(16280);var r=n(29587),i=n(79066);function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const o=20,l=500;class a{constructor(){s(this,"from",0),s(this,"to",0),s(this,"line",0)}}let c=function(e){return e[e.Pending=0]="Pending",e[e.Partial=1]="Partial",e[e.Complete=2]="Complete",e}({});const d=(e,t,n,r)=>!(t<n||e>r);function u(e,t,n,s,a){let u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6?arguments[6]:void 0,m=arguments.length>7?arguments[7]:void 0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{items:[],status:c.Pending};const f=h.status===c.Complete?h.items.filter((e=>!d(e.from,e.to,t,n))).map((e=>function(e,t){if(!t)return e;const{from:n,to:r}=e,i=t.changes.mapPos(n),s=t.changes.mapPos(r),o=t.state.doc.lineAt(i).number;return i===n&&s===r&&o===e.line?e:{...e,from:i,to:s,line:o}}(e,m))):[];h.status!==c.Complete&&(a=e.doc.length,s=0);const g=(0,r.a_)(e,a,u?l:o);return g?(g.iterate({from:s,to:a,enter:t=>p(e,t,f,(e=>d(e.from,e.to,s,a))),mode:i.Qj.IgnoreMounts|i.Qj.IgnoreOverlays}),{status:c.Complete,items:f.sort(((e,t)=>e.from-t.from))}):h.status!==c.Pending?{status:c.Partial,items:h.items}:{items:[],status:c.Pending}}},85868:(e,t,n)=>{n.d(t,{A:()=>d});var r=n(14041),i=n(26802),s=n(46794),o=n(67993),l=n(10009),a=n(31085);const c=(0,r.forwardRef)(((e,t)=>{const{bs3Props:n,...r}=e,c={children:r.children,bsSize:r.size,name:r.name,value:r.value,defaultValue:r.defaultValue,disabled:r.disabled,onChange:r.onChange,required:r.required,placeholder:r.placeholder,className:r.className,inputRef:e=>{"function"==typeof t?t(e):t&&(t.current=e)},...n},d=(0,l.tz)(r);return(0,a.jsx)(o.A,{bs3:(0,a.jsx)(s.A,{componentClass:"select",...c,...d}),bs5:(0,a.jsx)(i.A.Select,{ref:t,...r})})}));c.displayName="OLFormSelect";const d=c},52553:(e,t,n)=>{n.d(t,{Pp:()=>o,XH:()=>a,fU:()=>s,mp:()=>l});var r=n(99420),i=n.n(r);function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"h:mm a";return i()(e).format(t)}function o(e){return i()(e).calendar()}function l(e){return i()().diff(e,"years")>0?s(e,"D MMMM YYYY, h:mm a"):s(e,"D MMMM, h:mm a")}function a(e){return Date.parse(e)/1e3}i().updateLocale("en",{calendar:{lastDay:"[Yesterday]",sameDay:"[Today]",nextDay:"[Tomorrow]",lastWeek:"ddd, Do MMM YY",nextWeek:"ddd, Do MMM YY",sameElse:"ddd, Do MMM YY"}})},95898:(e,t,n)=>{n.d(t,{T:()=>k,k:()=>v});var r=n(14830),i=n(45250),s=n(37235),o=n(64932),l=n(60961);const a="CM6-BeforeUpdate",c="CM6-AfterUpdate",d="CM6-DomUpdate",u="CM6-Update",p="CM6-Keypress-Measure";let m=0;const h=Date.now();let f=!1;try{const e="featureTestMark";performance.mark(e,{startTime:performance.now(),detail:{test:1}}),performance.clearMarks(e);const t="featureTestMeasure";performance.measure(t,{start:performance.now(),detail:{test:1}}),performance.clearMeasures(t),f=!0}catch(e){}let g=!1;function x(){return performance.memory.usedJSHeapSize}try{"memory"in window.performance&&(x(),g=!0)}catch(e){}let j=!1,b=0;try{if(PerformanceObserver.supportedEntryTypes.includes("longtask")){j=!0;new PerformanceObserver((e=>{b+=e.getEntries().length})).observe({entryTypes:["longtask"]})}}catch(e){}function y(e){return!!e&&["input","delete"].includes(e.split(".")[0])}function _(e){return!!e&&["input.type","delete.forward","delete.backward"].includes(e)}function v(){if(!f)return{start:()=>{},end:()=>{}};let e=0,t=0;const n=[];return{start:e=>{const t=performance.now();e.forEach((e=>{_(e.annotation(r.ZX.userEvent))&&n.push(t)})),performance.mark(a)},end:(i,s)=>{performance.mark(c);let o=!1;i.forEach((n=>{const i=n.annotation(r.ZX.userEvent);y(i)&&(o=!0,++e,_(i)&&++t,performance.measure(u,{start:a,end:c,detail:{userEventType:i,userEventsSinceDomUpdateCount:e}}))})),o&&s.requestMeasure({key:"inputEventCounter",read(){performance.mark(d,{detail:{keypressesSinceDomUpdateCount:t}}),e=0,t=0;const r=performance.now();for(const e of n)performance.measure(p,{start:e,end:r});n.length=0}}),m=i[i.length-1].state.doc.length}}}function C(e){if(0===e.length)return 0;return e.reduce(((e,t)=>e+t),0)/e.length}function w(e){return e.reduce(((e,t)=>Math.max(e,t)),0)}function A(e){switch(e){case"measure":performance.clearMeasures(u),performance.clearMarks(a),performance.clearMarks(c);break;case"dom":performance.clearMarks(d);break;case"keypress":performance.clearMeasures(p)}}function k(){const e=performance.getEntriesByName(u,"measure");A("measure");const t=e.filter((e=>{let{detail:t}=e;return y(t.userEventType)})),n=t.map((e=>{let{duration:t}=e;return t})).sort(((e,t)=>e-t)),r=(0,i.round)(w(n),2),l=(0,i.round)(C(n),2),a=(0,i.round)(function(e){if(0===e.length)return 0;const t=Math.floor(e.length/2);return e.length%2==0?(e[t-1]+e[t])/2:e[t]}(n),2),c=(0,i.round)(0===(f=n).length?0:f[Math.round(.95*(f.length-1))],2);var f;const _=w(t.map((e=>e.detail.userEventsSinceDomUpdateCount))),v=(0,s.A)(),k=Math.floor((Date.now()-h)/1e3),E=g?x():null,S=performance.getEntriesByName(d,"mark");A("dom");let N=0,R=0,F=0,T=0;for(const e of S){const t=e.detail.keypressesSinceDomUpdateCount;1===t?++R:t>1&&++N,t>F&&(F=t),T+=t}const P=(0,i.round)(N/(N+R),4),L=(0,i.round)(T/(N+R),4),D=performance.getEntriesByName(p,"measure").map((e=>{let{duration:t}=e;return t})),I=(0,i.round)(C(D),2);A("keypress");let M=null;j&&(M=b,b=0);const O=(0,o.A)("ol-ExposedSettings")?.sentryRelease||null;return{max:r,mean:l,median:a,ninetyFifthPercentile:c,maxUserEventsBetweenDomUpdates:_,docLength:m,numberOfEntries:n.length,grammarly:v,sessionLength:k,memory:E,lags:N,nonLags:R,longestLag:F,meanLagsPerMeasure:P,meanKeypressesPerMeasure:L,meanKeypressPaint:I,longTasks:M,release:O}}window.addEventListener("editor:visual-switch",(()=>{A("measure"),A("dom"),A("keypress")})),window._reportCM6Perf=()=>{l.$.warn(k())}},22344:(e,t,n)=>{function r(e,t){return e.reduce((async(e,n)=>[...await e,await t(n)]),Promise.resolve([]))}n.d(t,{_:()=>r})},68910:(e,t,n)=>{var r={};n.r(r),n.d(r,{default:()=>V});var i={};n.r(i),n.d(i,{default:()=>ce});var s={};n.r(s),n.d(s,{default:()=>Ee});var o={};n.r(o),n.d(o,{CreateFileMode:()=>Pr,CreateFilePane:()=>Lr});var l={};n.r(l),n.d(l,{CreateFileMode:()=>Dr,CreateFilePane:()=>Ir});var a={};n.r(a),n.d(a,{default:()=>Vr});var c={};n.r(c),n.d(c,{TPRFileViewNotOriginalImporter:()=>Ii});var d={};n.r(d),n.d(d,{TPRFileViewInfo:()=>Bi});var u={};n.r(u),n.d(u,{TPRFileViewRefreshButton:()=>$i});var p={};n.r(p),n.d(p,{TPRFileViewRefreshError:()=>TPRFileViewRefreshError});var m={};n.r(m),n.d(m,{default:()=>ys});n(76786),n(9155);var h=n(64932),f=n(58528),g=n(60961);const{hotjarId:x,hotjarVersion:j}=(0,h.A)("ol-ExposedSettings");let b=!1;if(x&&j&&(0,f.g9)("hotjar")){const e=()=>{document.cookie.split("; ").some((e=>"oa=1"===e))&&(/^\d+$/.test(x)&&/^\d+$/.test(j)?b||(g.$.log("Loading Hotjar"),b=!0,((e,t)=>{return n=window,r=document,n.hj=n.hj||function(){(n.hj.q=n.hj.q||[]).push(arguments)},n._hjSettings={hjid:e,hjsv:t},i=r.getElementsByTagName("head")[0],(s=r.createElement("script")).async=1,s.src="https://static.hotjar.com/c/hotjar-"+n._hjSettings.hjid+".js?sv="+n._hjSettings.hjsv,void i.appendChild(s);var n,r,i,s})(x,j)):g.$.error("Invalid Hotjar id or version"))};"function"==typeof window.requestIdleCallback?window.requestIdleCallback(e):e(),window.addEventListener("cookie-consent",(t=>{t.detail&&e()}))}var y=n(43144),_=n(14041),v=n(36266),C=n(64826),w=n(97434),A=n(3218),k=n(22046),E=n(71627),S=n(31085);function N(e){let{reconnectAt:t,tryReconnectNow:n}=e;const{t:r}=(0,w.Bd)(),[i,s]=(0,_.useState)((0,A.C)(t));return(0,_.useEffect)((()=>{const e=window.setInterval((()=>{s((0,A.C)(t))}),1e3);return()=>window.clearInterval(e)}),[t]),(0,S.jsx)(k.A,{type:"warning",content:(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("strong",{children:r("lost_connection")})," ",r("reconnecting_in_x_secs",{seconds:i}),"."]}),action:(0,S.jsx)(E.A,{id:"try-reconnect-now-button",onClick:()=>n(),size:"sm",variant:"secondary",bs3Props:{className:"pull-right"},children:r("try_now")})})}var R=n(12391),F=n(14936),T=n(36471);function P(){const{t:e}=(0,w.Bd)(),{connectionState:t,isConnected:n,isStillReconnecting:r,tryReconnectNow:i,secondsUntilReconnect:s}=(0,R.FX)(),o=(0,T.J)(),[l]=(0,F.A)("sync_tex_error");return o?(0,y.createPortal)((0,S.jsxs)(S.Fragment,{children:[t.forceDisconnected?(0,S.jsx)(k.A,{type:"error",content:(0,S.jsx)("strong",{children:e("disconnected")})}):null,t.reconnectAt?(0,S.jsx)(N,{reconnectAt:t.reconnectAt,tryReconnectNow:i}):null,r?(0,S.jsx)(k.A,{type:"warning",content:(0,S.jsxs)("strong",{children:[e("reconnecting"),""]})}):null,l?(0,S.jsx)(k.A,{type:"warning",content:(0,S.jsx)("strong",{children:e("synctex_failed")}),action:(0,S.jsx)(E.A,{href:"/learn/how-to/SyncTeX_Errors",target:"_blank",id:"synctex-more-info-button",variant:"secondary",size:"sm",bs3Props:{className:"alert-link-as-btn pull-right"},children:e("more_info")})}):null,t.inactiveDisconnect||t.readyState===WebSocket.CLOSED&&("rate-limited"===t.error||"unable-to-connect"===t.error)&&!s()?(0,S.jsx)(k.A,{type:"warning",content:(0,S.jsx)("strong",{children:e("editor_disconected_click_to_reconnect")})}):null,g.v?(0,S.jsx)(k.A,{type:"warning",content:(0,S.jsxs)("strong",{children:["Connected: ",n.toString()]})}):null]}),o):null}var L=n(73613),D=n(53373),I=n.n(D);const M=e=>{let{children:t,resizable:n=!0,onDoubleClick:r,...i}=e;const{t:s}=(0,w.Bd)(),[o,l]=(0,_.useState)(!1);return(0,_.useEffect)((()=>{if(o){const e=()=>{i.onDragging?.(!0)};return document.addEventListener("pointermove",e),()=>{document.removeEventListener("pointermove",e)}}i.onDragging?.(!1)}),[o,i]),(0,S.jsx)(L.TW,{disabled:!n&&!o,...i,onDragging:function(e){(o||n)&&l(e)},children:(0,S.jsx)("div",{className:I()("horizontal-resize-handle",{"horizontal-resize-handle-enabled":n}),title:s("resize"),onDoubleClick:()=>r?.(),children:t})})};var O=n(56447),B=n(52036),q=n(77135),$=n(5964),z=(n(48408),n(14603),n(47566),n(98721),n(96713)),U=n(65982);function V(){const{fileTreeFromHistory:e,snapshotLoadingState:t,setFileTreeFromHistory:n}=(0,U.P4)();let r="sync_disabled";if(e)switch(t){case"":r="cloud_sync";break;case"loading":r="hourglass_top";break;case"error":r="sync_problem"}return(0,S.jsx)("div",{className:"toolbar-item",children:(0,S.jsx)("button",{className:"btn btn-full-height",onClick:()=>n(!e),children:(0,S.jsx)(z.A,{type:r})})})}var H=n(16065),G=n(81023),K=n(51763),Y=n(9781),W=n(81114),Z=n(97294),Q=n(46794),X=n(43721),J=n(309),ee=n(89135),te=n(22743),ne=n(37603),re=n.n(ne);class ie extends(re()){}function se(e){let{handleHide:t}=e;const{snapshot:n,snapshotVersion:r}=(0,U.P4)(),{t:i}=(0,w.Bd)(),[s,o]=(0,_.useState)(""),[l,a]=(0,_.useState)(!1),[c,d]=(0,_.useState)(!1),[u,p]=(0,_.useState)(""),[m,h]=(0,_.useState)([]),[f,x]=(0,_.useState)(!1),[j,b]=(0,_.useState)(!1),[y,v]=(0,_.useState)(),C=(0,J.A)(s,100);(0,_.useEffect)((()=>{if(0===C.length)return h([]),void b(!0);v(void 0),p(""),x(!0),n&&async function(e){let t,n,{snapshot:r,term:i,isRegex:s,matchCase:o,maxResultsPerFile:l}=e;if(s)try{t=new RegExp(i,"g"+(o?"":"i"))}catch(e){throw new ie(e.message)}else n=o?i:i.toLowerCase();return await(0,te.populateSnapshot)(r),r.getFileMap().map((e=>{const r=[];if(!e||!e.isEditable())return r;const a=e.getContent({filterTrackedDeletes:!0});if(s){for(const e of a.matchAll(t))if(r.push({idx:e.index,match:e[0],content:a}),r.length>l)break}else{let e=-1;const t=o?a:a.toLowerCase();for(;-1!==(e=t.indexOf(n,e+1))&&(r.push({idx:e,match:a.slice(e,e+i.length),content:a}),!(r.length>l)););}return r}))}({snapshot:n,term:C,isRegex:l,matchCase:c,maxResultsPerFile:100}).then((e=>{h(Object.entries(e).filter((e=>{let[,t]=e;return 0!==t.length})).map((e=>{let[t,n]=e;return{path:t,results:n}}))),b(!0)})).catch((e=>{e instanceof ie?p(e.message):(g.$.error(e),v(e))})).finally((()=>{x(!1)}))}),[l,c,C,n,r]);const A=(0,_.useCallback)((e=>{let{inputValue:t}=e;o(t)}),[]),k=(0,_.useCallback)((()=>{t()}),[t]),{getMenuProps:E,getInputProps:N,getComboboxProps:R,getItemProps:F,highlightedIndex:T}=(0,H.Bp)({items:m,itemToString:e=>e?.path??"",onInputValueChange:A,onSelectedItemChange:k});return(0,S.jsxs)(G.A,{fluid:!0,children:[(0,S.jsx)(K.A,{children:(0,S.jsx)(Y.A,{md:12,className:"search-form",children:(0,S.jsxs)(W.A,{...R(),children:[(0,S.jsx)(Z.A,{srOnly:!0,children:i("search_terms")}),(0,S.jsx)(Q.A,{...N({autoFocus:!0,autoComplete:"off",refKey:"inputRef",placeholder:i("search_all_project_files")+""})}),(0,S.jsx)("input",{type:"checkbox",id:"full-project-search-regex",checked:l,onChange:e=>a(e.target.checked)})," ",(0,S.jsx)("label",{htmlFor:"full-project-search-regex",children:i("search_regexp")})," ",(0,S.jsx)("input",{type:"checkbox",id:"full-project-search-case-sensitive",checked:c,onChange:e=>d(e.target.checked)})," ",(0,S.jsx)("label",{htmlFor:"full-project-search-case-sensitive",children:i("search_match_case")}),f&&(0,S.jsx)(ee.A,{type:"spinner",spin:!0,className:"form-control-feedback"}),(0,S.jsx)(Q.A.Feedback,{})]})})}),y&&(0,S.jsx)(K.A,{children:(0,S.jsx)(Y.A,{md:12,children:(0,S.jsx)(X.A,{bsStyle:"danger",children:i("generic_something_went_wrong")})})}),u&&(0,S.jsx)(K.A,{children:(0,S.jsx)(Y.A,{md:12,children:(0,S.jsx)(X.A,{bsStyle:"warning",children:u})})}),(0,S.jsxs)(K.A,{className:"search-results",children:[(0,S.jsxs)(Y.A,{md:12,children:[j&&0===m.length&&(0,S.jsx)("div",{className:"no-results-message",children:(0,S.jsx)("div",{className:"text-center",children:i("no_search_results")})}),m.length>100&&(0,S.jsx)("div",{className:"too-many-results-message text-center",children:i("too_many_search_results")})]}),(0,S.jsx)(Y.A,{md:12,className:"search-results-scroll-container",children:(0,S.jsx)("ul",{...E(),className:"list-unstyled",children:m.map(((e,t)=>{const n=e.results[0];return(0,S.jsxs)("li",{...F({item:e,index:t}),className:I()("search-result-hit",{"selected-search-result-hit":T===t}),children:[(0,S.jsx)(K.A,{children:(0,S.jsxs)(Y.A,{md:12,children:[(0,S.jsx)("span",{className:"hit-title",children:(0,S.jsx)("b",{children:e.path})}),(0,S.jsx)("span",{className:"hit-key pull-right",children:i("n_matches",{n:e.results.length>100?"100+":e.results.length})})]})}),(0,S.jsx)(K.A,{children:(0,S.jsxs)(Y.A,{md:12,children:[""," ",n.content.slice(Math.max(0,n.idx-15),n.idx),(0,S.jsx)("b",{children:n.match}),n.content.slice(n.idx+n.match.length,n.idx+n.match.length+15)," ",""]})})]},e.path)}))})})]})]})}var oe=n(28812);const le=_.memo((function(e){let{show:t,handleHide:n}=e;const{t:r}=(0,w.Bd)();return(0,S.jsxs)(oe.Ay,{animation:!0,show:t,onHide:n,id:"full-project-search-modal",children:[(0,S.jsx)(oe.IK,{closeButton:!0,children:(0,S.jsx)(oe.rA,{children:r("full_project_search")})}),(0,S.jsx)(oe.$8,{children:(0,S.jsx)(se,{handleHide:n})}),(0,S.jsx)(oe.E9,{children:(0,S.jsx)(E.A,{variant:"secondary",onClick:n,children:r("close")})})]})})),ae=(0,C.A)(le);const ce=function(){const{fileTreeFromHistory:e}=(0,U.P4)(),[t,n]=(0,_.useState)(!1);return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{className:"toolbar-item",children:(0,S.jsx)("button",{className:"btn btn-full-height",disabled:!e,onClick:()=>n(!0),children:(0,S.jsx)(z.A,{type:"search"})})}),t&&(0,S.jsx)(ae,{show:t,handleHide:()=>n(!1)})]})};var de=n(39067),ue=n.n(de),pe=n(67993),me=(n(16280),n(10646)),he=n(85960),fe=n(8164),ge=n(69475),xe=n(66666),je=n(71573),be=n(37858),ye=n(67353);const _e=(0,_.createContext)(void 0),ve=e=>{let{children:t}=e;const{first_name:n,last_name:r}=(0,he.ur)(),{_id:i,name:s,rootDocId:o}=(0,xe.O)(),{hasFolders:l}=(0,je.Q)(),a=(0,ye.nK)(),{cobranding:c}=(0,me.mi)(),{pdfDownloadUrl:d,pdfUrl:u,logEntries:p}=(0,fe.Rf)(),{uncompiled:m}=(0,fe.Rf)();let h,f,g;c&&(c.publishGuideHtml||c.partner)?c.brandedMenu?(f=`/journals/${c.brandId}`,h="branded"):c.partner?(f=`/journals/${c.brandId}`,h="export",g=c.brandVariationId):(f=`/journals/${c.brandId}`,h="guide",g=c.brandVariationId):(f="/journals",h="basic");const[x,j]=(0,_.useState)(null),[b,y]=(0,_.useState)(null),v=(0,ge.A)(),C=(0,_.useCallback)((()=>{const e=`/latest_template/${i}`;return Promise.all([(0,be.hm)(e),(0,be.hm)(f)]).then((e=>{let[t,n]=e;if(v.current){const e=t.title?{title:t.title}:{};e.description=t.description,e.author=t.author,e.license=t.license,y(t),j(n)}}))}),[v,f,i]),w=(0,_.useCallback)((()=>{const e=o;if(a.editorManager.getCurrentDocId()===e)return!1;const t=a.editorManager.getCurrentDocValue();if(null==t)return!1;for(const e of t.split("\n"))if(/^[^%]*\\documentclass/.test(e))return!0;return!1}),[a.editorManager,o]),A={entries:x,initialShown:h,brandVariationId:g,fetchData:C,initParams:{projectId:i,pdfUrl:u?d:void 0,logs:p,uncompiled:m,hasFolders:l,rootDocOverridden:w(),firstName:n,lastName:r,title:s,...b}};return(0,S.jsx)(_e.Provider,{value:A,children:t})};class DestinationsError extends _.Component{render(){return(0,S.jsx)(S.Fragment,{children:(0,S.jsxs)("p",{children:["Sorry, we had trouble retrieving our list of submission destinations. If you give us a minute, retry, and still find this error, please notify support at"," ",(0,S.jsx)("a",{href:"mailto:support@overleaf.com?subject=Unable to submit",children:"support@overleaf.com"})]})})}}var Ce=n(34325);const we=(0,_.lazy)((()=>Promise.all([n.e(4651),n.e(5628),n.e(5196)]).then(n.bind(n,85196))));function Ae(e){let{handleHide:t}=e;const{t:r}=(0,w.Bd)(),{entries:i,initialShown:s,initParams:o,fetchData:l,brandVariationId:a}=function(){const e=(0,_.useContext)(_e);if(!e)throw new Error("usePublishContext is only available inside PublishProvider");return e}(),[c,d]=(0,_.useState)(!0),[u,p]=(0,_.useState)(!1),[m,h]=(0,_.useState)(!1),f=(0,ge.A)();let g;function x(){t(),d(!1)}return(0,_.useEffect)((()=>{Promise.all([n.e(4651),n.e(5628),n.e(5196)]).then(n.bind(n,85196)).catch((()=>h(!0))),u||(l().catch((()=>{f.current&&h(!0)})),p(!0))}),[f,u,l]),g=i&&o?.logs?(0,S.jsx)(_.Suspense,{fallback:(0,S.jsx)(Ce.A,{}),children:(0,S.jsx)(we,{entries:i,initialShown:s,initParams:o,brandVariationId:a})}):m?(0,S.jsx)(DestinationsError,{}):(0,S.jsx)(Ce.A,{}),(0,S.jsxs)(oe.Ay,{size:"lg",show:c,onHide:x,children:[(0,S.jsx)(oe.IK,{closeButton:!0,children:(0,S.jsx)(oe.rA,{children:r("submit_title")})}),(0,S.jsx)(oe.$8,{children:(0,S.jsx)("div",{className:"modal-body-publish",children:g})}),(0,S.jsx)(oe.E9,{children:(0,S.jsx)(E.A,{variant:"secondary",onClick:x,children:r("close")})})]})}function ke(e){let{cobranding:t}=e;const{t:n}=(0,w.Bd)(),[r,i]=(0,_.useState)(!1);const s=I()("btn","btn-full-height");return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{className:"toolbar-item",children:(0,S.jsxs)("button",{type:"button",id:"publishButton",className:s,onClick:function(){$._("navigation-clicked-submit"),i(!0)},children:[(0,S.jsx)(pe.A,{bs3:(0,S.jsx)(ee.A,{type:"globe",fw:!0}),bs5:(0,S.jsx)(z.A,{type:"public",className:"align-middle"})}),t?.submitBtnHtml?(0,S.jsx)("p",{className:"toolbar-label toolbar-label-multiline",dangerouslySetInnerHTML:{__html:t.submitBtnHtml}}):(0,S.jsx)("p",{className:"toolbar-label",children:n("submit_title")})]})}),r&&(0,S.jsx)(ve,{children:(0,S.jsx)(Ae,{handleHide:function(){i(!1)}})})]})}ke.propTypes={cobranding:ue().shape({submitBtnHtml:ue().string})};const Ee=(0,C.A)(ke);function Se(e){let{onClick:t}=e;const{t:n}=(0,w.Bd)();return(0,S.jsx)("div",{className:"toolbar-item",children:(0,S.jsxs)("button",{type:"button",className:"btn btn-full-height",onClick:t,children:[(0,S.jsx)(pe.A,{bs3:(0,S.jsx)(ee.A,{type:"bars",fw:!0,className:"editor-menu-icon"}),bs5:(0,S.jsx)(z.A,{type:"menu",className:"editor-menu-icon align-middle"})}),(0,S.jsx)("p",{className:"toolbar-label",children:n("menu")})]})})}Se.propTypes={onClick:ue().func.isRequired};const Ne=Se;function Re(e){let{brandVariationHomeUrl:t,brandVariationName:n,logoImgUrl:r}=e;return(0,S.jsx)("a",{className:"btn btn-full-height header-cobranding-logo-container",href:t,target:"_blank",rel:"noreferrer noopener",children:(0,S.jsx)("img",{src:r,className:"header-cobranding-logo",alt:n})})}Re.propTypes={brandVariationHomeUrl:ue().string.isRequired,brandVariationName:ue().string.isRequired,logoImgUrl:ue().string.isRequired};const Fe=Re;var Te=n(93075);const Pe=function(){const{t:e}=(0,w.Bd)();return(0,S.jsx)(Te.A,{id:"back-to-projects",description:e("back_to_your_projects"),overlayProps:{placement:"right"},children:(0,S.jsx)("div",{className:"toolbar-item",children:(0,S.jsx)("a",{className:"btn btn-full-height",draggable:"false",href:"/project",onClick:()=>{$._("navigation-clicked-home")},children:(0,S.jsx)(pe.A,{bs3:(0,S.jsx)(ee.A,{type:"home",fw:!0,accessibilityLabel:e("back_to_your_projects")}),bs5:(0,S.jsx)(z.A,{type:"home",className:"align-text-bottom",accessibilityLabel:e("back_to_your_projects")})})})})})};var Le=n(10009);const De=function(){const{t:e}=(0,w.Bd)();return(0,S.jsx)(E.A,{variant:"primary",size:"sm",className:I()("toolbar-header-upgrade-prompt",(0,Le.q$)({bs3:"btn-xs"})),href:"/user/subscription/plans?itm_referrer=editor-header-upgrade-prompt",target:"_blank",onClick:function(e){$.tN("subscription-funnel","code-editor","upgrade"),$._("upgrade-button-click",{source:"code-editor"})},children:e("upgrade")})};var Ie=n(35722);function Me(e){let{chatIsOpen:t,unreadMessageCount:n,onClick:r}=e;const{t:i}=(0,w.Bd)(),s=I()("btn","btn-full-height",{active:t}),o=n>0;return(0,S.jsx)("div",{className:"toolbar-item",children:(0,S.jsxs)("button",{type:"button",className:s,onClick:r,children:[(0,S.jsx)(pe.A,{bs3:(0,S.jsx)(ee.A,{type:"comment",fw:!0,className:I()({bounce:o})}),bs5:(0,S.jsx)(z.A,{type:"chat",className:I()("align-middle",{bounce:o})})}),o&&(0,S.jsx)(Ie.A,{bg:"info",children:n}),(0,S.jsx)("p",{className:"toolbar-label",children:i("chat")})]})})}Me.propTypes={chatIsOpen:ue().bool,unreadMessageCount:ue().number.isRequired,onClick:ue().func.isRequired};const Oe=Me;var Be=n(2439),qe=n(42118),$e=n(237),ze=n(61160),Ue=n(96047);const Ve=function(){const{t:e}=(0,w.Bd)();return(0,S.jsx)(ee.A,{type:"check",fw:!0,accessibilityLabel:e("selected")})};var He=n(64526),Ge=n(89139);function Ke(){return(0,S.jsx)(ee.A,{type:"",fw:!0})}function Ye(){return(0,S.jsx)(ee.A,{type:"refresh",fw:!0,spin:!0})}function We(){return(0,S.jsx)(ee.A,{type:"columns",fw:!0})}function Ze(){return(0,S.jsx)(ee.A,{type:"columns",fw:!0})}function Qe(){return(0,S.jsx)(ee.A,{type:"window-restore",fw:!0})}function Xe(){return(0,S.jsx)(ee.A,{type:"code",fw:!0})}function Je(){return(0,S.jsx)(ee.A,{type:"file-pdf-o",fw:!0})}const et=e=>{let{iconFor:t,pdfLayout:n,view:r,detachRole:i}=e;return"detacher"!==i&&"history"!==r&&("editorOnly"===t&&"flat"===n&&("editor"===r||"file"===r)||("pdfOnly"===t&&"flat"===n&&"pdf"===r||"sideBySide"===t&&"sideBySide"===n))};function tt(e){return et(e)?(0,S.jsx)(Ve,{}):(0,S.jsx)(Ke,{})}function nt(e){let{checkmark:t,icon:n,text:r,...i}=e;return(0,S.jsx)(Be.A,{...i,children:(0,S.jsx)("div",{className:"layout-menu-item",children:(0,S.jsxs)("div",{className:"layout-menu-item-start",children:[(0,S.jsx)("div",{children:t}),(0,S.jsx)("div",{children:n}),(0,S.jsx)("div",{children:r})]})})})}function rt(e){let{active:t,...n}=e;return(0,S.jsx)(ze.tJ,{active:t,"aria-current":t,trailingIcon:t?"check":null,...n})}const it=(0,_.forwardRef)(((e,t)=>{let{onClick:n,...r}=e;return(0,S.jsx)("button",{...r,ref:t,onClick:e=>{$._("navigation-clicked-layout"),n(e)}})}));function st(){const{t:e}=(0,w.Bd)();return(0,S.jsx)(Ue.A,{id:"detach-disabled",description:e("your_browser_does_not_support_this_feature"),overlayProps:{placement:"left"},children:(0,S.jsx)(nt,{disabled:!0,checkmark:(0,S.jsx)(Ke,{}),icon:(0,S.jsx)(Qe,{}),text:e("pdf_in_separate_tab")})})}function ot(){const{t:e}=(0,w.Bd)();return(0,S.jsx)(Te.A,{id:"detach-disabled",description:e("your_browser_does_not_support_this_feature"),overlayProps:{placement:"left"},children:(0,S.jsx)("span",{children:(0,S.jsx)(rt,{disabled:!0,leadingIcon:"select_window",children:e("pdf_in_separate_tab")})})})}function lt(){const{reattach:e,detach:t,detachIsLinked:n,detachRole:r,changeLayout:i,view:s,pdfLayout:o}=(0,O.LV)(),l=(0,_.useCallback)((()=>{t(),$._("project-layout-detach")}),[t]),a=(0,_.useCallback)((()=>{"detacher"===r&&(e(),$._("project-layout-reattach"))}),[r,e]);(0,Ge.A)("ui:pdf-open",a);const c=(0,_.useCallback)(((e,t)=>{a(),i(e,t),$._("project-layout-change",{layout:e,view:t})}),[i,a]);return(0,S.jsx)(at,{processing:!n&&"detacher"===r,handleChangeLayout:c,handleDetach:l,detachIsLinked:n,detachRole:r,pdfLayout:o,view:s,detachable:"BroadcastChannel"in window})}it.displayName="LayoutDropdownToggleButton";const at=e=>{let{processing:t,handleChangeLayout:n,handleDetach:r,detachIsLinked:i,detachRole:s,view:o,pdfLayout:l,detachable:a}=e;const{t:c}=(0,w.Bd)();return(0,S.jsxs)(S.Fragment,{children:[t&&(0,S.jsx)("div",{"aria-live":"assertive",className:"sr-only",children:c("layout_processing")}),(0,S.jsx)(pe.A,{bs3:(0,S.jsxs)(He.A,{id:"layout-dropdown",onMainButtonClick:()=>{$._("navigation-clicked-layout")},className:"toolbar-item layout-dropdown",pullRight:!0,children:[(0,S.jsxs)(qe.A.Toggle,{className:"btn-full-height",bsStyle:"link",children:[t?(0,S.jsx)(Ye,{}):(0,S.jsx)(We,{}),(0,S.jsx)("span",{className:"toolbar-label",children:c("layout")})]}),(0,S.jsxs)(qe.A.Menu,{className:"layout-dropdown-list",children:[(0,S.jsx)(nt,{onSelect:()=>n("sideBySide"),checkmark:(0,S.jsx)(tt,{iconFor:"sideBySide",pdfLayout:l,view:o,detachRole:s}),icon:(0,S.jsx)(Ze,{}),text:c("editor_and_pdf")}),(0,S.jsx)(nt,{onSelect:()=>n("flat","editor"),checkmark:(0,S.jsx)(tt,{iconFor:"editorOnly",pdfLayout:l,view:o,detachRole:s}),icon:(0,S.jsx)(Xe,{}),text:(0,S.jsx)(w.x6,{i18nKey:"editor_only_hide_pdf",components:[(0,S.jsx)("span",{className:"subdued"},"editor_only_hide_pdf")]})}),(0,S.jsx)(nt,{onSelect:()=>n("flat","pdf"),checkmark:(0,S.jsx)(tt,{iconFor:"pdfOnly",pdfLayout:l,view:o,detachRole:s}),icon:(0,S.jsx)(Je,{}),text:(0,S.jsx)(w.x6,{i18nKey:"pdf_only_hide_editor",components:[(0,S.jsx)("span",{className:"subdued"},"pdf_only_hide_editor")]})}),a?(0,S.jsx)(nt,{onSelect:()=>r(),checkmark:"detacher"===s?i?(0,S.jsx)(Ve,{}):(0,S.jsx)(Ye,{}):(0,S.jsx)(Ke,{}),icon:(0,S.jsx)(Qe,{}),text:c("pdf_in_separate_tab")}):(0,S.jsx)(st,{})]})]}),bs5:(0,S.jsxs)(ze.ms,{className:"toolbar-item layout-dropdown",align:"end",children:[(0,S.jsxs)(ze.C,{id:"layout-dropdown-btn",className:"btn-full-height",as:it,children:[t?(0,S.jsx)($e.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"}):(0,S.jsx)(z.A,{type:"dock_to_right",className:"align-middle"}),(0,S.jsx)("span",{className:"toolbar-label",children:c("layout")})]}),(0,S.jsxs)(ze.rI,{children:[(0,S.jsx)(rt,{onClick:()=>n("sideBySide"),active:et({iconFor:"sideBySide",pdfLayout:l,view:o,detachRole:s}),leadingIcon:"dock_to_right",children:c("editor_and_pdf")}),(0,S.jsx)(rt,{onClick:()=>n("flat","editor"),active:et({iconFor:"editorOnly",pdfLayout:l,view:o,detachRole:s}),leadingIcon:"code",children:(0,S.jsx)("div",{className:"d-flex flex-column",children:(0,S.jsx)(w.x6,{i18nKey:"editor_only_hide_pdf",components:[(0,S.jsx)("span",{className:"subdued"},"editor_only_hide_pdf")]})})}),(0,S.jsx)(rt,{onClick:()=>n("flat","pdf"),active:et({iconFor:"pdfOnly",pdfLayout:l,view:o,detachRole:s}),leadingIcon:"picture_as_pdf",children:(0,S.jsx)("div",{className:"d-flex flex-column",children:(0,S.jsx)(w.x6,{i18nKey:"pdf_only_hide_editor",components:[(0,S.jsx)("span",{className:"subdued"},"pdf_only_hide_editor")]})})}),a?(0,S.jsx)(rt,{onClick:()=>r(),active:"detacher"===s&&i,trailingIcon:"detacher"===s?i?"check":(0,S.jsxs)("span",{className:"spinner-container",children:[(0,S.jsx)($e.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"}),(0,S.jsx)("span",{className:"visually-hidden",children:c("loading")})]}):null,leadingIcon:"select_window",children:c("pdf_in_separate_tab")}):(0,S.jsx)(ot,{})]})]})})]})},ct=(0,_.memo)(lt);var dt=n(37365);function ut(e){let{onlineUsers:t,goToUser:n}=e;const{t:r}=(0,w.Bd)();return t.length>=4?(0,S.jsx)(pe.A,{bs3:(0,S.jsxs)(He.A,{id:"online-users",className:"online-users",pullRight:!0,children:[(0,S.jsx)(mt,{bsRole:"toggle",onlineUserCount:t.length}),(0,S.jsxs)(qe.A.Menu,{children:[(0,S.jsx)(Be.A,{header:!0,children:r("connected_users")}),t.map(((e,t)=>(0,S.jsx)(Be.A,{as:"button",eventKey:e,onSelect:n,children:(0,S.jsx)(pt,{user:e,showName:!0})},`${e.user_id}_${t}`)))]})]}),bs5:(0,S.jsxs)(ze.ms,{id:"online-users",className:"online-users",align:"end",children:[(0,S.jsx)(ze.C,{as:mt,onlineUserCount:t.length}),(0,S.jsxs)(ze.rI,{children:[(0,S.jsx)(ze.hO,{"aria-hidden":"true",children:r("connected_users")}),t.map(((e,t)=>(0,S.jsx)("li",{role:"none",children:(0,S.jsx)(ze.tJ,{as:"button",tabIndex:-1,onClick:()=>n(e),children:(0,S.jsx)(pt,{user:e,showName:!0})})},`${e.user_id}_${t}`)))]})]})}):(0,S.jsx)("div",{className:"online-users",children:t.map(((e,t)=>(0,S.jsx)(Te.A,{id:"online-user",description:e.name,overlayProps:{placement:"bottom",trigger:["hover","focus"]},children:(0,S.jsx)("span",{children:(0,S.jsx)(pt,{user:e,onClick:n})})},`${e.user_id}_${t}`)))})}function pt(e){let{user:t,showName:n,onClick:r}=e;const i=`hsl(${(0,dt.O)(t.user_id)}, 70%, 50%)`;const[s]=[...t.name];return(0,S.jsxs)("span",{onClick:function(){r?.(t)},children:[(0,S.jsx)("span",{className:"online-user",style:{backgroundColor:i},children:s}),n&&t.name]})}ut.propTypes={onlineUsers:ue().arrayOf(ue().shape({user_id:ue().string.isRequired,name:ue().string.isRequired})).isRequired,goToUser:ue().func.isRequired},pt.propTypes={user:ue().shape({user_id:ue().string.isRequired,name:ue().string.isRequired}),showName:ue().bool,onClick:ue().func};const mt=_.forwardRef(((e,t)=>{const{t:n}=(0,w.Bd)();return(0,S.jsx)(Te.A,{id:"connected-users",description:n("connected_users"),overlayProps:{placement:"left"},children:(0,S.jsxs)("button",{type:"button",className:"online-user online-user-multi",onClick:e.onClick,ref:t,children:[(0,S.jsx)("strong",{children:e.onlineUserCount}),"",(0,S.jsx)(pe.A,{bs3:(0,S.jsx)(ee.A,{type:"users",fw:!0}),bs5:(0,S.jsx)(z.A,{type:"groups"})})]})})}));mt.displayName="DropDownToggleButton",mt.propTypes={onlineUserCount:ue().number.isRequired,onClick:ue().func};const ht=ut;var ft=n(23588);const gt=function(e){let{projectName:t,hasRenamePermissions:n,onChange:r,className:i}=e;const{t:s}=(0,w.Bd)(),[o,l]=(0,_.useState)(!1),a=n&&!o,[c,d]=(0,_.useState)(t),u=(0,_.useRef)(null);function p(){a&&(d(t),l(!0))}function m(){l(!1),r(c)}return(0,_.useEffect)((()=>{o&&u.current?.select()}),[o]),(0,S.jsxs)("div",{className:I()("project-name",i),children:[!o&&(0,S.jsx)("span",{className:"name",onDoubleClick:p,children:t}),o&&(0,S.jsx)(ft.A,{ref:u,type:"text",onKeyDown:function(e){"Enter"===e.key&&(e.preventDefault(),m())},onChange:function(e){d(e.target.value)},onBlur:function(){o&&m()},value:c}),a&&(0,S.jsx)(Te.A,{id:"online-user",description:s("rename"),overlayProps:{placement:"bottom",trigger:["hover","focus"]},children:(0,S.jsx)("a",{className:"rename",role:"button",onClick:p,children:(0,S.jsx)(pe.A,{bs3:(0,S.jsx)(ee.A,{type:"pencil",fw:!0}),bs5:(0,S.jsx)(z.A,{type:"edit",className:"align-text-bottom"})})})})]})};function xt(e){let{trackChangesIsOpen:t,disabled:n,onMouseDown:r}=e;const{t:i}=(0,w.Bd)(),s=I()("btn","btn-full-height",{active:t&&!n,disabled:n});return(0,S.jsx)("div",{className:"toolbar-item",children:(0,S.jsxs)("button",{type:"button",disabled:n,className:s,onMouseDown:r,children:[(0,S.jsx)("i",{className:"review-icon"}),(0,S.jsx)("p",{className:"toolbar-label",children:i("review")})]})})}xt.propTypes={trackChangesIsOpen:ue().bool,disabled:ue().bool,onMouseDown:ue().func.isRequired};const jt=xt;function bt(e){let{onClick:t}=e;const{t:n}=(0,w.Bd)();return(0,S.jsx)("div",{className:"toolbar-item",children:(0,S.jsxs)("button",{type:"button",className:"btn btn-full-height",onClick:t,children:[(0,S.jsx)(pe.A,{bs3:(0,S.jsx)(ee.A,{type:"history",fw:!0}),bs5:(0,S.jsx)(z.A,{type:"history",className:"align-middle"})}),(0,S.jsx)("p",{className:"toolbar-label",children:n("history")})]})})}bt.propTypes={onClick:ue().func.isRequired};const yt=bt;function _t(e){let{onClick:t}=e;const{t:n}=(0,w.Bd)();return(0,S.jsx)("div",{className:"toolbar-item",children:(0,S.jsxs)("button",{type:"button",className:"btn btn-full-height",onClick:t,children:[(0,S.jsx)(pe.A,{bs3:(0,S.jsx)(ee.A,{type:"group",fw:!0}),bs5:(0,S.jsx)(z.A,{type:"group_add",className:"align-middle"})}),(0,S.jsx)("p",{className:"toolbar-label",children:n("share")})]})})}_t.propTypes={onClick:ue().func.isRequired};const vt=_t;const Ct=function(e){let{onClick:t}=e;const{t:n}=(0,w.Bd)();return(0,S.jsxs)(E.A,{variant:"secondary",size:"sm",onClick:t,className:"back-to-editor-btn",children:[(0,S.jsx)(z.A,{type:"arrow_back",className:"toolbar-btn-secondary-icon"}),(0,S.jsx)("span",{className:"toolbar-label",children:n("back_to_editor")})]})},[wt]=[{import:s,path:"/overleaf/services/web/modules/publish-modal/frontend/js/components/publish-toolbar-button"}],At=wt?.import.default,kt=[{import:r,path:"/overleaf/services/web/modules/offline-mode/frontend/js/components/editor-toolbar/file-tree-from-history-button"},{import:i,path:"/overleaf/services/web/modules/offline-mode/frontend/js/components/editor-toolbar/full-project-search-button"}],Et=(0,f.g9)("ro-mirror-on-client")&&"enabled"===new URLSearchParams(window.location.search).get("ro-mirror-on-client"),St=_.memo((function(e){let{cobranding:t,onShowLeftMenuClick:n,chatIsOpen:r,toggleChatOpen:i,reviewPanelOpen:s,toggleReviewPanelOpen:o,historyIsOpen:l,toggleHistoryOpen:a,unreadMessageCount:c,onlineUsers:d,goToUser:u,isRestrictedTokenMember:p,hasPublishPermissions:m,chatVisible:f,projectName:g,renameProject:x,hasRenamePermissions:j,openShareModal:b,trackChangesVisible:y}=e;const _=(0,h.A)("ol-chatEnabled"),{t:v}=(0,w.Bd)(),C=m&&At;return(0,S.jsxs)("header",{className:"toolbar toolbar-header",role:"navigation","aria-label":v("project_layout_sharing_submission"),children:[(0,S.jsxs)("div",{className:"toolbar-left",children:[(0,S.jsx)(Ne,{onClick:n}),t&&t.logoImgUrl&&(0,S.jsx)(Fe,{...t}),(0,S.jsx)(Pe,{}),Et&&kt.map((e=>{let{path:t,import:{default:n}}=e;return(0,S.jsx)(n,{},t)}))]}),(0,h.A)("ol-showUpgradePrompt")&&(0,S.jsx)(pe.A,{bs3:(0,S.jsx)(De,{}),bs5:(0,S.jsx)("div",{className:"d-flex align-items-center",children:(0,S.jsx)(De,{})})}),(0,S.jsx)(gt,{className:"toolbar-center",projectName:g,hasRenamePermissions:j,onChange:x}),(0,S.jsxs)("div",{className:"toolbar-right",children:[(0,S.jsx)(ht,{onlineUsers:d,goToUser:u}),l?(0,S.jsx)(pe.A,{bs3:(0,S.jsx)(Ct,{onClick:a}),bs5:(0,S.jsx)("div",{className:"d-flex align-items-center",children:(0,S.jsx)(Ct,{onClick:a})})}):(0,S.jsxs)(S.Fragment,{children:[y&&(0,S.jsx)(jt,{onMouseDown:o,disabled:l,trackChangesIsOpen:s}),(0,S.jsx)(vt,{onClick:b}),C&&(0,S.jsx)(At,{cobranding:t}),!p&&(0,S.jsx)(yt,{onClick:a}),(0,S.jsx)(ct,{}),_&&f&&(0,S.jsx)(Oe,{chatIsOpen:r,onClick:i,unreadMessageCount:c})]})]})]})}));St.propTypes={onShowLeftMenuClick:ue().func.isRequired,cobranding:ue().object,chatIsOpen:ue().bool,toggleChatOpen:ue().func.isRequired,reviewPanelOpen:ue().bool,toggleReviewPanelOpen:ue().func.isRequired,historyIsOpen:ue().bool,toggleHistoryOpen:ue().func.isRequired,unreadMessageCount:ue().number.isRequired,onlineUsers:ue().array.isRequired,goToUser:ue().func.isRequired,isRestrictedTokenMember:ue().bool,hasPublishPermissions:ue().bool,chatVisible:ue().bool,projectName:ue().string.isRequired,renameProject:ue().func.isRequired,hasRenamePermissions:ue().bool,openShareModal:ue().func.isRequired,trackChangesVisible:ue().bool};const Nt=St;var Rt=n(99806);function Ft(e){return e?"open":"close"}const Tt=_.memo((function(e){let{onlineUsersArray:t,openDoc:n,openShareProjectModal:r}=e;const{name:i,features:{trackChangesVisible:s}}=(0,xe.O)(),{cobranding:o,isRestrictedTokenMember:l,renameProject:a,permissionsLevel:c}=(0,me.mi)(),{chatIsOpen:d,setChatIsOpen:u,reviewPanelOpen:p,setReviewPanelOpen:m,view:h,setView:f,setLeftMenuShown:g}=(0,O.LV)(),{markMessagesAsRead:x,unreadMessageCount:j}=(0,Rt.vd)(),b=(0,_.useCallback)((()=>{d||x(),$._("navigation-clicked-chat",{action:Ft(!d)}),u(!d)}),[d,u,x]),y=(0,_.useCallback)((e=>{e.preventDefault(),$._("navigation-clicked-review",{action:Ft(!p)}),m((e=>!e))}),[p,m]),[v,C]=(0,_.useState)(d),w=(0,_.useCallback)((()=>{const e="history"===h?"close":"open";$._("navigation-clicked-history",{action:e}),d&&"open"===e&&(C(!0),b()),v&&"close"===e&&(C(!1),b()),f("history"===h?"editor":"history")}),[h,d,v,f,b]),A=(0,_.useCallback)((()=>{$._("navigation-clicked-share"),r()}),[r]),k=(0,_.useCallback)((()=>{$._("navigation-clicked-menu"),g((e=>!e))}),[g]),E=(0,_.useCallback)((e=>{e.doc&&"number"==typeof e.row&&n(e.doc,{gotoLine:e.row+1})}),[n]);return(0,S.jsx)(Nt,{cobranding:o,onShowLeftMenuClick:k,chatIsOpen:d,unreadMessageCount:j,toggleChatOpen:b,reviewPanelOpen:p,toggleReviewPanelOpen:y,historyIsOpen:"history"===h,toggleHistoryOpen:w,onlineUsers:t,goToUser:E,isRestrictedTokenMember:l,hasPublishPermissions:"owner"===c||"readAndWrite"===c,chatVisible:!l,projectName:i,renameProject:a,hasRenamePermissions:"owner"===c,openShareModal:A,trackChangesVisible:s})}));var Pt=n(17515),Lt=n(30158),Dt=n(43480);function It(e){let{handleHide:t}=e;const{t:n}=(0,w.Bd)();return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(oe.IK,{closeButton:!0,children:(0,S.jsx)(oe.rA,{children:n("do_you_need_edit_access")})}),(0,S.jsxs)(oe.$8,{children:[(0,S.jsx)("p",{children:n("this_project_has_more_than_max_collabs",{linkSharingDate:Dt.V})}),(0,S.jsx)("p",{children:n("to_keep_edit_access")})]}),(0,S.jsxs)(oe.E9,{children:[(0,S.jsx)(E.A,{variant:"secondary",href:"/blog/changes-to-project-sharing",target:"_blank",rel:"noreferrer",onClick:()=>{(0,$._)("notification-click",{name:"link-sharing-collaborator-limit",button:"learn"})},children:n("learn_more")}),(0,S.jsx)(E.A,{variant:"primary",onClick:()=>{(0,$._)("notification-click",{name:"link-sharing-collaborator-limit",button:"ok"}),t()},children:n("ok")})]})]})}var Mt=n(83566);const Ot=()=>{const[e,t]=(0,_.useState)(!1),{isProjectOwner:n,permissionsLevel:r}=(0,me.mi)(),{members:i,features:s,_id:o}=(0,xe.O)(),l=()=>{t(!1)};return(0,_.useEffect)((()=>{if(!(n||!s||"readOnly"===r)&&-1!==s.collaborators&&i.filter((e=>"readAndWrite"===e.privileges)).length>(s.collaborators??1)){const e=`last-shown-need-edit-modal.${o}`,n=Mt.A.getItem(e);(!n||n+864e5<Date.now())&&(t(!0),Mt.A.setItem(e,Date.now()),(0,$._)("notification-prompt",{name:"link-sharing-collaborator-limit"}))}}),[s,n,i,r,o]),e?(0,S.jsx)(oe.Ay,{animation:!0,show:e,onHide:()=>{(0,$._)("notification-dismiss",{name:"link-sharing-collaborator-limit"}),l()},id:"editor-over-limit-modal",children:(0,S.jsx)(It,{handleHide:l})}):null};function Bt(e){let{handleHide:t}=e;const{t:n}=(0,w.Bd)();return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(oe.IK,{closeButton:!0,children:(0,S.jsx)(oe.rA,{children:n("view_only_access")})}),(0,S.jsxs)(oe.$8,{children:[(0,S.jsx)("p",{children:n("this_project_already_has_maximum_editors")}),(0,S.jsx)("p",{children:n("please_ask_the_project_owner_to_upgrade_more_editors")})]}),(0,S.jsxs)(oe.E9,{children:[(0,S.jsx)(E.A,{variant:"secondary",href:"/blog/changes-to-project-sharing",target:"_blank",rel:"noreferrer",onClick:()=>{(0,$._)("notification-click",{name:"link-sharing-collaborator-limit",button:"learn"})},children:n("learn_more")}),(0,S.jsx)(E.A,{variant:"primary",onClick:()=>{(0,$._)("notification-click",{name:"link-sharing-collaborator-limit",button:"ok"}),t()},children:n("ok")})]})]})}const qt=()=>{const[e,t]=(0,_.useState)(!1),{isProjectOwner:n,isPendingEditor:r,permissionsLevel:i}=(0,me.mi)(),{members:s,features:o,_id:l}=(0,xe.O)(),a=()=>{t(!1)};return(0,_.useEffect)((()=>{if(!(n||!o)&&-1!==o.collaborators&&r){const e=`last-shown-view-only-access-modal.${l}`,n=Mt.A.getItem(e);(!n||n+6048e5<Date.now())&&(t(!0),Mt.A.setItem(e,Date.now()),(0,$._)("notification-prompt",{name:"link-sharing-collaborator-limit"}))}}),[o,n,r,s,i,l]),e?(0,S.jsx)(oe.Ay,{animation:!0,show:e,onHide:()=>{(0,$._)("notification-dismiss",{name:"link-sharing-collaborator-limit"}),a()},id:"editor-over-limit-modal",children:(0,S.jsx)(Bt,{handleHide:a})}):null};const $t=function(){const[e,t]=(0,_.useState)(!1),{onlineUsersArray:n}=(0,B.E1)(),{openDoc:r}=(0,q.TS)(),i=(0,_.useCallback)((()=>{$.JY("ide-open-share-modal-once"),t(!0)}),[]),s=(0,_.useCallback)((()=>{t(!1)}),[]),o=(0,h.A)("ol-linkSharingWarning");return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(Tt,{onlineUsersArray:n,openDoc:r,openShareProjectModal:i}),o?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(Ot,{}),(0,S.jsx)(qt,{}),(0,S.jsx)(Pt.A,{show:e,handleOpen:i,handleHide:s})]}):(0,S.jsx)(Lt.A,{show:e,handleHide:s})]})};const zt=function(e){let{resetUnreadMessages:t,sendMessage:n}=e;const{t:r}=(0,w.Bd)();return(0,S.jsxs)("form",{className:"new-message",children:[(0,S.jsx)("label",{htmlFor:"chat-input",className:(0,Le.q$)({bs3:"sr-only",bs5:"visually-hidden"}),children:r("your_message_to_collaborators")}),(0,S.jsx)("textarea",{id:"chat-input",placeholder:`${r("your_message_to_collaborators")}`,onKeyDown:function(e){const t=e.nativeEvent.isComposing;if("Enter"===e.key&&!t){e.preventDefault();const t=e.target;n(t.value),window.setTimeout((()=>{t.blur(),t.closest("form")?.reset(),t.focus()}),0)}},onClick:t})]})};var Ut=n(45250),Vt=n.n(Ut);function Ht(e){let{atEnd:t,children:n,className:r="",fetchData:i,itemCount:s,isLoading:o}=e;const l=(0,_.useRef)(null),a=(0,_.useRef)(0);function c(){l.current.scrollTop=l.current.scrollHeight-l.current.clientHeight-a.current}return(0,_.useLayoutEffect)(c,[s]),(0,_.useEffect)((()=>{const e=Vt().debounce(c,400);return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,S.jsx)("div",{ref:l,onScroll:function(e){var n;n=l.current.scrollHeight-l.current.scrollTop-l.current.clientHeight,a.current=n,e.target===e.currentTarget&&function(){const e=l.current.children[0].clientHeight<l.current.clientHeight;return!(t||o||e)&&l.current.scrollTop<30}()&&i()},className:`infinite-scroll ${r}`,children:n})}Ht.propTypes={atEnd:ue().bool,children:ue().element.isRequired,className:ue().string,fetchData:ue().func.isRequired,itemCount:ue().number.isRequired,isLoading:ue().bool};const Gt=Ht;function ChatFallbackError(e){let{reconnect:t}=e;const{t:n}=(0,w.Bd)();return(0,S.jsx)("aside",{className:"chat",children:(0,S.jsxs)("div",{className:"chat-error",children:[(0,S.jsx)(k.A,{type:"error",content:n("chat_error")}),t&&(0,S.jsx)("p",{className:"text-center",children:(0,S.jsx)(E.A,{variant:"secondary",onClick:t,children:n("reconnect")})})]})})}ChatFallbackError.propTypes={reconnect:ue().any};const Kt=ChatFallbackError,Yt=(0,_.lazy)((()=>Promise.all([n.e(4815),n.e(2212)]).then(n.bind(n,12212)))),Wt=_.memo((function(){const{t:e}=(0,w.Bd)(),{chatIsOpen:t}=(0,O.LV)(),n=(0,he.ur)(),{status:r,messages:i,initialMessagesLoaded:s,atEnd:o,loadInitialMessages:l,loadMoreMessages:a,reset:c,sendMessage:d,markMessagesAsRead:u,error:p}=(0,Rt.vd)();(0,_.useEffect)((()=>{t&&!s&&l()}),[t,l,s]);const m="pending"!==r&&0===i.length,h=i.reduce(((e,t)=>{let{contents:n}=t;return e+n.length}),0),[f,g]=(0,_.useState)(t);if((0,_.useEffect)((()=>{t&&g(!0)}),[t]),p){if(p instanceof be.fk)return(0,S.jsx)(Kt,{reconnect:c});throw p}return n&&f?(0,S.jsxs)("aside",{className:"chat",children:[(0,S.jsx)(Gt,{atEnd:o,className:"messages",fetchData:a,isLoading:"pending"===r,itemCount:h,children:(0,S.jsxs)("div",{children:[(0,S.jsx)("h2",{className:(0,Le.q$)({bs3:"sr-only",bs5:"visually-hidden"}),children:e("chat")}),(0,S.jsxs)(_.Suspense,{fallback:(0,S.jsx)(Ce.A,{delay:500}),children:["pending"===r&&(0,S.jsx)(Ce.A,{delay:500}),m&&(0,S.jsx)(Zt,{}),(0,S.jsx)(Yt,{messages:i,userId:n.id,resetUnreadMessages:u})]})]})}),(0,S.jsx)(zt,{resetUnreadMessages:u,sendMessage:d})]}):null}));function Zt(){const{t:e}=(0,w.Bd)();return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{className:"no-messages text-center small",children:e("no_messages")}),(0,S.jsxs)("div",{className:"first-message text-center",children:[e("send_first_message"),(0,S.jsx)("br",{}),(0,S.jsx)(pe.A,{bs3:(0,S.jsx)(ee.A,{type:"arrow-down"}),bs5:(0,S.jsx)(z.A,{type:"arrow_downward"})})]})]})}const Qt=(0,C.A)(Wt,Kt);function Xt(e){let{id:t,isOpen:n,setIsOpen:r,togglerType:i,tooltipWhenOpen:s,tooltipWhenClosed:o}=e;const l=n?s:o;return(0,S.jsx)(Te.A,{id:t,description:l,overlayProps:{placement:"east"===i?"left":"right"},children:(0,S.jsx)("button",{className:I()("custom-toggler",`custom-toggler-${i}`,{"custom-toggler-open":n,"custom-toggler-closed":!n}),"aria-label":l,title:"",onClick:()=>r(!n)})})}function Jt(){return(0,S.jsx)("aside",{id:"history-file-tree",className:"ide-react-editor-sidebar history-file-tree"})}function en(e){const{t}=(0,w.Bd)();return(0,S.jsx)(L.TW,{...e,children:(0,S.jsx)("div",{className:I()("vertical-resize-handle",{"vertical-resize-handle-enabled":!e.disabled}),title:t("resize")})})}var tn=n(98125),nn=n(11787),rn=n(92902),sn=n(88588),on=(n(43375),n(39225),n(13972),n(99209),n(25714),n(17561),n(66197),n(95014)),ln=n(52924),an=n(97484),cn=n(81257),dn=n(3762),un=n(24480),pn=n(45186),mn=n(79550),hn=n(4816);const fn="ENTITY",gn=e=>{let{fileTreeContainer:t,children:n}=e;const r=(0,_.useMemo)((()=>({rootElement:t})),[t]);return(0,S.jsx)(ln.Q,{backend:dn.t2,options:r,children:n})};function xn(e){const{t}=(0,w.Bd)(),{fileTreeData:n,fileTreeReadOnly:r}=(0,je.Q)(),{selectedEntityIds:i,isRootFolderSelected:s}=(0,sn.G1)(),{finishMoving:o}=(0,rn.m)(),[l,a]=(0,_.useState)(!0),[,c,d]=(0,an.i)({type:fn,item(){const r=function(e,t){return e.size>1&&e.has(t)?new Set(e):new Set([t])}(s?new Set:i,e),o=(0,mn.jr)(n,r);return{type:fn,title:bn(o,t),forbiddenFolderIds:yn(o),draggedEntityIds:r}},canDrag:()=>!r&&l,end(e,t){if(t.didDrop()){const n=t.getDropResult();n&&o(n.targetEntityId,e.draggedEntityIds)}}});return(0,_.useEffect)((()=>{d((0,un.n)())}),[d]),{dragRef:c,setIsDraggable:a}}function jn(e){const{setDroppedFiles:t,startUploadingDocOrFile:n}=(0,rn.m)(),[{isOver:r},i]=(0,cn.H)({accept:[fn,pn.FILE],canDrop:(t,n)=>!!n.isOver({shallow:!0})&&!(t.type===fn&&t.forbiddenFolderIds.has(e)),drop(r,i){if(!i.didDrop())return r.type===fn?{targetEntityId:e}:void(0,on.A)(r).then((e=>e.filter((e=>(0,hn.n)(e.name,e.relativePath))))).then((r=>{t({files:r,targetFolderId:e}),n()}))},collect:e=>({isOver:e.canDrop()})});return{dropRef:i,isOver:r}}function bn(e,t){if(1===e.size){return Array.from(e)[0].entity.name}return t("n_items",{count:e.size})}function yn(e){const t=Array.from(e).filter((e=>"folder"===e.type)).map((e=>e.entity)),n=new Set(t);return(0,mn.b_)(n)}const _n=e=>{let{refProviders:t,setRefProviderEnabled:n,setStartedFreeTrial:r,onSelect:i,fileTreeContainer:s,children:o}=e;return(0,S.jsx)(nn.r,{refProviders:t,setRefProviderEnabled:n,setStartedFreeTrial:r,children:(0,S.jsx)(sn.k2,{onSelect:i,children:(0,S.jsx)(rn.g,{children:(0,S.jsx)(gn,{fileTreeContainer:s,children:o})})})})};function vn(e){let{isOver:t,isDragging:n,item:r,clientOffset:i}=e;const s=(0,_.useRef)();return(0,S.jsx)("div",{ref:s,className:I()("dnd-draggable-preview-layer",{"dnd-droppable-hover":t}),children:n&&r?.title&&(0,S.jsx)("div",{style:wn(i,s.current?.getBoundingClientRect()),children:(0,S.jsx)(Cn,{title:r.title})})})}function Cn(e){let{title:t}=e;return(0,S.jsx)("div",{className:"dnd-draggable-preview-item",children:t})}function wn(e,t){if(!t||!e)return{display:"none"};const{x:n,y:r}=t,{x:i,y:s}=e,o=`translate(${i-n-15}px, ${s-r-15}px)`;return{transform:o,WebkitTransform:o}}vn.propTypes={isOver:ue().bool.isRequired,isDragging:ue().bool.isRequired,item:ue().shape({title:ue().string}),clientOffset:ue().shape({x:ue().number,y:ue().number})},Cn.propTypes={title:ue().string.isRequired};const An=vn;var kn=n(88121),En=n(93045);function Sn(e){let{name:t,isSelected:n,setIsDraggable:r}=e;const{isRenaming:i,startRenaming:s,finishRenaming:o,error:l,cancel:a}=(0,rn.m)(),c=i&&n&&!l;return(0,_.useEffect)((()=>{r(!c)}),[r,c]),c?(0,S.jsx)(Rn,{initialValue:t,finishRenaming:o,cancel:a}):(0,S.jsx)(Nn,{name:t,isSelected:n,startRenaming:s})}function Nn(e){let{name:t,isSelected:n,startRenaming:r}=e;const[i,s]=(0,_.useState)(0);return(0,S.jsx)("button",{className:"item-name-button",onClick:function(){s(i+1),n||s(0)},onDoubleClick:function(){i<2||r()},children:(0,S.jsx)("span",{children:t})})}function Rn(e){let{initialValue:t,finishRenaming:n,cancel:r}=e;const[i,s]=(0,_.useState)(t),{autoFocusedRef:o}=(0,En.U)();return(0,S.jsx)("span",{className:"rename-input",children:(0,S.jsx)("input",{type:"text",value:i,onKeyDown:function(e){"Enter"===e.key&&n(i),"Escape"===e.key&&r()},onChange:function(e){s(e.target.value)},onBlur:function(){n(i)},onFocus:function(e){const t=e.target.value.lastIndexOf(".");e.target.setSelectionRange(0,t)},ref:o})})}Sn.propTypes={name:ue().string.isRequired,isSelected:ue().bool.isRequired,setIsDraggable:ue().func.isRequired},Nn.propTypes={name:ue().string.isRequired,startRenaming:ue().func.isRequired,isSelected:ue().bool.isRequired},Rn.propTypes={initialValue:ue().string.isRequired,finishRenaming:ue().func.isRequired,cancel:ue().func.isRequired};const Fn=Sn;function Tn(e){let{id:t,name:n}=e;const{t:r}=(0,w.Bd)(),{contextMenuCoords:i,setContextMenuCoords:s}=(0,nn.e)(),o=(0,_.useRef)(),l=Boolean(i);return(0,S.jsx)("div",{className:"menu-button btn-group",children:(0,S.jsx)("button",{className:"entity-menu-toggle btn btn-sm",id:`menu-button-${t}`,onClick:function(e){if(e.stopPropagation(),i)s(null);else{const e=o.current.getBoundingClientRect();s({top:e.top+e.height/2,left:e.right})}},ref:o,"aria-haspopup":"true","aria-expanded":l,"aria-label":r("open_action_menu",{name:n}),children:(0,S.jsx)(pe.A,{bs3:(0,S.jsx)(ee.A,{type:"ellipsis-v",accessibilityLabel:r("menu")}),bs5:(0,S.jsx)(z.A,{type:"more_vert",accessibilityLabel:r("menu")})})})})}Tn.propTypes={id:ue().string.isRequired,name:ue().string.isRequired};const Pn=Tn;var Ln=n(5658);const Dn=function(e){let{id:t,name:n,type:r,isSelected:i,icons:s}=e;const{fileTreeReadOnly:o}=(0,je.Q)(),{setContextMenuCoords:l}=(0,nn.e)(),{isRenaming:a}=(0,rn.m)(),{selectedEntityIds:c}=(0,sn.G1)(),d=!o&&i&&1===c.size,{dragRef:u,setIsDraggable:p}=xn(t),m=(0,Ln.u)().getMonitor().getItem(),h=(0,_.useRef)(null);return(0,_.useEffect)((()=>{const e=h.current;i&&e&&setTimeout((()=>{e&&(0,kn.A)(e,{scrollMode:"if-needed"})}),100)}),[i,h]),(0,S.jsx)("div",{className:I()("entity",{"file-tree-entity-dragging":m?.draggedEntityIds?.has(t)}),role:"presentation",ref:u,draggable:!a,onContextMenu:function(e){e.preventDefault(),l({top:e.pageY,left:e.pageX})},"data-file-id":t,"data-file-type":r,children:(0,S.jsxs)("div",{className:"entity-name entity-name-react",role:"presentation",ref:h,children:[s,(0,S.jsx)(Fn,{name:n,isSelected:i,setIsDraggable:p}),d?(0,S.jsx)(Pn,{id:t,name:n}):null]})})};var In=n(66285);function Mn(e){let{name:t,id:n,isFile:r,isLinkedFile:i}=e;const s=r?"file":"doc",{isSelected:o,props:l}=(0,sn.hj)(n,s);return(0,S.jsx)("li",{role:"treeitem",...l,"aria-label":t,tabIndex:"0",children:(0,S.jsx)(Dn,{id:n,name:t,type:s,isSelected:o,icons:(0,S.jsx)(On,{isLinkedFile:i,name:t})})})}Mn.propTypes={name:ue().string.isRequired,id:ue().string.isRequired,isFile:ue().bool,isLinkedFile:ue().bool};const On=e=>{let{isLinkedFile:t,name:n}=e;const{t:r}=(0,w.Bd)(),i=I()("file-tree-icon",{"linked-file-icon":t});return(0,S.jsxs)(S.Fragment,{children:["",(0,S.jsx)(pe.A,{bs3:(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(ee.A,{type:(0,In.A)(n),fw:!0,className:i}),t&&(0,S.jsx)(ee.A,{type:"external-link-square",modifier:"rotate-180",className:"linked-file-highlight",accessibilityLabel:r("linked_file")})]}),bs5:(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(z.A,{type:(0,In.A)(n),className:i}),t&&(0,S.jsx)(z.A,{type:"open_in_new",modifier:"rotate-180",className:"linked-file-highlight",accessibilityLabel:r("linked_file")})]})})]})};On.propTypes={name:ue().string.isRequired,isLinkedFile:ue().bool};const Bn=Mn;var qn=n(42093);function $n(e){let{name:t,id:n,folders:r,docs:i,files:s}=e;const{t:o}=(0,w.Bd)(),{isSelected:l,props:a}=(0,sn.hj)(n,"folder"),{selectedEntityParentIds:c}=(0,sn.G1)(n),[d,u]=(0,qn.A)(`folder.${n}.expanded`,!1);function p(){u(!d)}(0,_.useEffect)((()=>{c.has(n)&&u(!0)}),[n,c,u]);const{isOver:m,dropRef:h}=jn(n),{isOver:f,dropRef:g}=jn(n),x=(0,S.jsx)(pe.A,{bs3:(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("button",{onClick:p,"aria-label":o(d?"collapse":"expand"),children:(0,S.jsx)(ee.A,{type:d?"angle-down":"angle-right",fw:!0,className:"file-tree-expand-icon"})}),(0,S.jsx)(ee.A,{type:d?"folder-open":"folder",fw:!0,className:"file-tree-folder-icon"})]}),bs5:(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("button",{onClick:p,"aria-label":o(d?"collapse":"expand"),children:(0,S.jsx)(z.A,{type:d?"expand_more":"chevron_right",className:"file-tree-expand-icon"})}),(0,S.jsx)(z.A,{type:d?"folder_open":"folder",className:"file-tree-folder-icon"})]})});return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("li",{role:"treeitem",...a,"aria-expanded":d,"aria-label":t,tabIndex:"0",ref:h,className:I()(a.className,{"dnd-droppable-hover":m||f}),children:(0,S.jsx)(Dn,{id:n,name:t,type:"folder",isSelected:l,icons:x})}),d?(0,S.jsx)(Gn,{folders:r,docs:i,files:s,dropRef:g}):null]})}$n.propTypes={name:ue().string.isRequired,id:ue().string.isRequired,folders:ue().array.isRequired,docs:ue().array.isRequired,files:ue().array.isRequired};const zn=$n;var Un=n(88091);function Vn(e){let{folders:t,docs:n,files:r,classes:i={},dropRef:s=null,children:o,dataTestId:l}=e;r=r.map((e=>({...e,isFile:!0})));const a=[...n,...r];return(0,S.jsxs)("ul",{className:I()("list-unstyled",i.root),role:"tree",ref:s,"data-testid":l,children:[t.sort(Hn).map((e=>(0,S.jsx)(zn,{name:e.name,id:e._id,folders:e.folders,docs:e.docs,files:e.fileRefs},e._id))),a.sort(Hn).map((e=>(0,S.jsx)(Bn,{name:e.name,id:e._id,isFile:e.isFile,isLinkedFile:e.linkedFileData&&!!e.linkedFileData.provider},e._id))),o]})}function Hn(e,t){return Un.h.compare(e.name,t.name)}Vn.propTypes={folders:ue().array.isRequired,docs:ue().array.isRequired,files:ue().array.isRequired,classes:ue().exact({root:ue().string}),dropRef:ue().func,children:ue().node,dataTestId:ue().string};const Gn=Vn;var Kn=n(98509);function Yn(){const{t:e}=(0,w.Bd)(),{canCreate:t,startCreatingFolder:n,startCreatingDocOrFile:r,startUploadingDocOrFile:i}=(0,rn.m)();return t?(0,S.jsxs)("div",{className:"toolbar-left",children:[(0,S.jsx)(Te.A,{id:"new-file",description:e("new_file"),overlayProps:{placement:"bottom"},children:(0,S.jsx)("button",{className:"btn",onClick:()=>{$._("new-file-click",{location:"toolbar"}),r()},children:(0,S.jsx)(pe.A,{bs5:(0,S.jsx)(z.A,{type:"description",accessibilityLabel:e("new_file")}),bs3:(0,S.jsx)(ee.A,{type:"file",fw:!0,accessibilityLabel:e("new_file")})})})}),(0,S.jsx)(Te.A,{id:"new-folder",description:e("new_folder"),overlayProps:{placement:"bottom"},children:(0,S.jsx)("button",{className:"btn",onClick:n,tabIndex:-1,children:(0,S.jsx)(pe.A,{bs5:(0,S.jsx)(z.A,{type:"folder",accessibilityLabel:e("new_folder")}),bs3:(0,S.jsx)(ee.A,{type:"folder",fw:!0,accessibilityLabel:e("new_folder")})})})}),(0,S.jsx)(Te.A,{id:"upload",description:e("upload"),overlayProps:{placement:"bottom"},children:(0,S.jsx)("button",{className:"btn",onClick:()=>{$._("upload-click",{location:"toolbar"}),i()},tabIndex:-1,children:(0,S.jsx)(pe.A,{bs5:(0,S.jsx)(z.A,{type:"upload",accessibilityLabel:e("upload")}),bs3:(0,S.jsx)(ee.A,{type:"upload",fw:!0,accessibilityLabel:e("upload")})})})})]}):null}function Wn(){const{t:e}=(0,w.Bd)(),{canRename:t,canDelete:n,startRenaming:r,startDeleting:i}=(0,rn.m)();return t||n?(0,S.jsxs)("div",{className:"toolbar-right",children:[t?(0,S.jsx)(Te.A,{id:"rename",description:e("rename"),overlayProps:{placement:"bottom"},children:(0,S.jsx)("button",{className:"btn",onClick:r,tabIndex:-1,children:(0,S.jsx)(pe.A,{bs3:(0,S.jsx)(ee.A,{type:"pencil",fw:!0,accessibilityLabel:e("rename")}),bs5:(0,S.jsx)(z.A,{type:"edit",accessibilityLabel:e("rename")})})})}):null,n?(0,S.jsx)(Te.A,{id:"delete",description:e("delete"),overlayProps:{placement:"bottom"},children:(0,S.jsx)("button",{className:"btn",onClick:i,tabIndex:-1,children:(0,S.jsx)(pe.A,{bs3:(0,S.jsx)(ee.A,{type:"trash-o",fw:!0,accessibilityLabel:e("delete")}),bs5:(0,S.jsx)(z.A,{type:"delete",accessibilityLabel:e("delete")})})})}):null]}):null}const Zn=function(){const{fileTreeReadOnly:e}=(0,je.Q)(),{t}=(0,w.Bd)();return e?null:(0,S.jsxs)(Kn.A,{className:"toolbar toolbar-filetree","aria-label":t("project_files"),children:[(0,S.jsx)(Yn,{}),(0,S.jsx)(Wn,{})]})};const Qn=function(){const{t:e}=(0,w.Bd)(),{isDeleting:t,inFlight:n,finishDeleting:r,actionedEntities:i,cancel:s,error:o}=(0,rn.m)();if(!t)return null;function l(){s()}return(0,S.jsxs)(oe.Ay,{show:!0,onHide:l,children:[(0,S.jsx)(oe.IK,{children:(0,S.jsx)(oe.rA,{children:e("delete")})}),(0,S.jsxs)(oe.$8,{children:[(0,S.jsx)("p",{children:e("sure_you_want_to_delete")}),(0,S.jsx)("ul",{children:i.map((e=>(0,S.jsx)("li",{children:e.name},e._id)))}),o&&(0,S.jsx)(k.A,{type:"error",content:e("generic_something_went_wrong")})]}),(0,S.jsx)(oe.E9,{children:n?(0,S.jsx)(E.A,{variant:"danger",disabled:!0,isLoading:!0,bs3Props:{loading:`${e("deleting")}`}}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(E.A,{className:"secondary",onClick:l,children:e("cancel")}),(0,S.jsx)(E.A,{variant:"danger",onClick:function(){r()},children:e("delete")})]})})]})};var Xn=n(27916),Jn=n(67227);function er(e){let{name:t,setName:n,validName:r,setValidName:i,handleCreateFolder:s}=e;const{autoFocusedRef:o}=(0,En.U)();return(0,S.jsx)("input",{ref:o,className:"form-control",type:"text",value:t,onKeyDown:function(e){"Enter"===e.key&&r&&s()},onChange:function(e){i((0,Jn.tL)(e.target.value.trim())),n(e.target.value)},onFocus:function(e){e.target.setSelectionRange(0,-1)}})}er.propTypes={name:ue().string.isRequired,setName:ue().func.isRequired,validName:ue().bool.isRequired,setValidName:ue().func.isRequired,handleCreateFolder:ue().func.isRequired};const tr=function(){const{t:e}=(0,w.Bd)(),[t,n]=(0,_.useState)(""),[r,i]=(0,_.useState)(!0),{isCreatingFolder:s,inFlight:o,finishCreatingFolder:l,cancel:a,error:c}=(0,rn.m)();if((0,_.useEffect)((()=>{s||n("")}),[s]),!s)return null;function d(){a()}function u(){l(t)}function p(){return c.constructor===Xn.Lc?e("file_already_exists"):e("generic_something_went_wrong")}return(0,S.jsxs)(oe.Ay,{show:!0,onHide:d,children:[(0,S.jsx)(oe.IK,{children:(0,S.jsx)(oe.rA,{children:e("new_folder")})}),(0,S.jsxs)(oe.$8,{children:[(0,S.jsx)(er,{name:t,setName:n,validName:r,setValidName:i,handleCreateFolder:u}),r?null:(0,S.jsx)("div",{role:"alert","aria-label":e("files_cannot_include_invalid_characters"),className:"alert alert-danger file-tree-modal-alert",children:e("files_cannot_include_invalid_characters")}),c?(0,S.jsx)("div",{role:"alert","aria-label":p(),className:"alert alert-danger file-tree-modal-alert",children:p()}):null]}),(0,S.jsx)(oe.E9,{children:o?(0,S.jsx)(E.A,{variant:"primary",disabled:!0,isLoading:o,bs3Props:{loading:`${e("creating")}`}}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(E.A,{variant:"secondary",onClick:d,children:e("cancel")}),(0,S.jsx)(E.A,{variant:"primary",onClick:u,disabled:!r,children:e("create")})]})})]})};const nr=function FileTreeModalError(){const{t:e}=(0,w.Bd)(),{isRenaming:t,isMoving:n,cancel:r,error:i}=(0,rn.m)();if(!i)return null;if(!t&&!n)return null;function s(){r()}function o(){switch(i.constructor){case Xn.Lc:return e("file_already_exists");case Xn.ui:return(0,S.jsx)(w.x6,{i18nKey:"file_already_exists_in_this_location",components:[(0,S.jsx)("strong",{})],values:{fileName:i.entityName},shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}}});case Xn.di:return e("files_cannot_include_invalid_characters");case Xn.yG:return e("blocked_filename");default:return e("generic_something_went_wrong")}}return(0,S.jsxs)(oe.Ay,{show:!0,onHide:s,children:[(0,S.jsx)(oe.IK,{children:(0,S.jsx)(oe.rA,{children:function(){switch(i.constructor){case Xn.Lc:case Xn.ui:return e("duplicate_file");case Xn.di:case Xn.yG:return e("invalid_file_name");default:return e("error")}}()})}),(0,S.jsx)(oe.$8,{children:(0,S.jsx)("div",{role:"alert","aria-label":o(),children:o()})}),(0,S.jsx)(oe.E9,{children:(0,S.jsx)(E.A,{onClick:s,variant:"primary",children:e("ok")})})]})};const rr=function(){const{t:e}=(0,w.Bd)(),{canRename:t,canDelete:n,canCreate:r,startRenaming:i,startDeleting:s,startCreatingFolder:o,startCreatingDocOrFile:l,startUploadingDocOrFile:a,downloadPath:c,selectedFileName:d}=(0,rn.m)(),{owner:u}=(0,xe.O)(),p=(0,_.useCallback)((()=>{d?.endsWith(".bib")&&$._("download-bib-file",{projectOwner:u._id})}),[d,u]),m=(0,_.useCallback)((()=>{$._("new-file-click",{location:"file-menu"}),l()}),[l]),h=(0,_.useCallback)((()=>{$._("upload-click",{location:"file-menu"}),a()}),[a]);return(0,S.jsx)(pe.A,{bs3:(0,S.jsxs)(S.Fragment,{children:[t?(0,S.jsx)(Be.A,{onClick:i,children:e("rename")}):null,c?(0,S.jsx)(Be.A,{href:c,onClick:p,download:d,children:e("download")}):null,n?(0,S.jsx)(Be.A,{onClick:s,children:e("delete")}):null,r?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("li",{role:"none",className:"divider"}),(0,S.jsx)(Be.A,{onClick:m,children:e("new_file")}),(0,S.jsx)(Be.A,{onClick:o,children:e("new_folder")}),(0,S.jsx)(Be.A,{onClick:h,children:e("upload")})]}):null]}),bs5:(0,S.jsxs)(S.Fragment,{children:[t?(0,S.jsx)("li",{role:"none",children:(0,S.jsx)(ze.tJ,{onClick:i,children:e("rename")})}):null,c?(0,S.jsx)("li",{role:"none",children:(0,S.jsx)(ze.tJ,{href:c,onClick:p,download:d,children:e("download")})}):null,n?(0,S.jsx)("li",{role:"none",children:(0,S.jsx)(ze.tJ,{onClick:s,children:e("delete")})}):null,r?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(ze.rx,{role:"none"}),(0,S.jsx)("li",{role:"none",children:(0,S.jsx)(ze.tJ,{onClick:m,children:e("new_file")})}),(0,S.jsx)("li",{role:"none",children:(0,S.jsx)(ze.tJ,{onClick:o,children:e("new_folder")})}),(0,S.jsx)("li",{role:"none",children:(0,S.jsx)(ze.tJ,{onClick:h,children:e("upload")})})]}):null]})})};const ir=_.forwardRef(((e,t)=>{let{bsRole:n}=e;return null}));ir.displayName="FakeDropDownToggle";const sr=function(){const{fileTreeReadOnly:e}=(0,je.Q)(),{contextMenuCoords:t,setContextMenuCoords:n}=(0,nn.e)(),r=(0,_.useRef)(null);if((0,_.useEffect)((()=>{t&&(r.current=document.querySelector(".entity-menu-toggle"),function(){const e=document.querySelector('[aria-labelledby="dropdown-file-tree-context-menu"]');e?.focus()}())}),[t]),!t||e)return null;function i(){n(null),r.current&&r.current.focus()}function s(e){e||i()}function o(e){"Tab"===e.key&&i()}return y.createPortal((0,S.jsx)(pe.A,{bs3:(0,S.jsxs)(qe.A,{onClick:function(){s(!1)},open:!0,id:"dropdown-file-tree-context-menu",onToggle:s,dropup:document.body.offsetHeight/t.top<2&&document.body.offsetHeight-t.top<250,className:"context-menu",style:t,onKeyDown:o,children:[(0,S.jsx)(ir,{bsRole:"toggle"}),(0,S.jsx)(qe.A.Menu,{tabIndex:-1,children:(0,S.jsx)(rr,{})})]}),bs5:(0,S.jsx)("div",{style:t,className:"context-menu",children:(0,S.jsx)(ze.ms,{show:!0,drop:document.body.offsetHeight/t.top<2&&document.body.offsetHeight-t.top<250?"up":"down",focusFirstItemOnShow:!0,onKeyDown:o,onToggle:s,children:(0,S.jsx)(ze.rI,{className:"dropdown-menu-sm-width",id:"dropdown-file-tree-context-menu",children:(0,S.jsx)(rr,{})})})})}),document.body)};var or=n(89753);const lr=function FileTreeError(){const{t:e}=(0,w.Bd)(),{reload:t}=(0,or.z)();return(0,S.jsxs)("div",{className:"file-tree-error",children:[(0,S.jsx)("p",{children:e("generic_something_went_wrong")}),(0,S.jsx)("p",{children:e("please_refresh")}),(0,S.jsx)(E.A,{variant:"primary",onClick:t,children:e("refresh")})]})};const ar=(0,_.createContext)(void 0),cr=()=>{const e=(0,_.useContext)(ar);if(!e)throw new Error("useFileTreeCreateForm is only available inside FileTreeCreateFormProvider");return e},dr=e=>{let{children:t}=e;const[n,r]=(0,_.useState)(!1);return(0,S.jsx)(ar.Provider,{value:{valid:n,setValid:r},children:t})};function ur(e){let{mode:t,icon:n,label:r}=e;const{newFileCreateMode:i,startCreatingFile:s}=(0,rn.m)();return(0,S.jsx)("li",{className:I()({active:i===t}),children:(0,S.jsxs)(E.A,{variant:"link",onClick:()=>{s(t),$._("file-modal-click",{method:t})},className:"modal-new-file-mode",children:[(0,S.jsx)(pe.A,{bs3:(0,S.jsx)(ee.A,{type:n,fw:!0}),bs5:(0,S.jsx)(z.A,{type:n})}),"",r]})})}ur.propTypes={mode:ue().string.isRequired,icon:ue().string.isRequired,label:ue().string.isRequired};const pr=(0,_.createContext)(void 0),mr=()=>{const e=(0,_.useContext)(pr);if(!e)throw new Error("useFileTreeCreateName is only available inside FileTreeCreateNameProvider");return e},hr=e=>{let{children:t,initialName:n=""}=e;const[r,i]=(0,_.useReducer)(((e,t)=>({name:t,touchedName:!0})),{name:n,touchedName:!1}),s=(0,_.useMemo)((()=>(0,Jn.tL)(r.name.trim())),[r]);return(0,S.jsx)(pr.Provider,{value:{...r,setName:i,validName:s},children:t})};var fr=n(18730),gr=n(11456),xr=n(96700);function jr(e){let{label:t,focusName:n=!1,classes:r={},placeholder:i,error:s,inFlight:o}=e;const{t:l}=(0,w.Bd)(),{name:a,setName:c,touchedName:d,validName:u}=mr(),p=(0,_.useRef)(null);return(0,_.useEffect)((()=>{p.current&&n&&window.requestAnimationFrame((()=>{p.current&&(p.current.focus(),p.current.setSelectionRange(0,p.current.value.lastIndexOf(".")))}))}),[n]),(0,S.jsxs)(gr.A,{controlId:"new-doc-name",className:r.formGroup,children:[(0,S.jsx)(xr.A,{children:t||l("file_name")}),(0,S.jsx)(ft.A,{type:"text",placeholder:i||l("file_name"),required:!0,value:a,onChange:e=>c(e.target.value),ref:p,disabled:o}),d&&!u&&(0,S.jsx)(k.A,{type:"error",className:"row-spaced-small",content:l("files_cannot_include_invalid_characters")}),s&&(0,S.jsx)(br,{error:s})]})}function br(e){let{error:t}=e;const{t:n}=(0,w.Bd)();switch(t.constructor){case Xn.Lc:return(0,S.jsx)(k.A,{type:"error",className:"row-spaced-small",content:n("file_already_exists")});case Xn.di:return(0,S.jsx)(k.A,{type:"error",className:"row-spaced-small",content:n("files_cannot_include_invalid_characters")});case Xn.yG:return(0,S.jsx)(k.A,{type:"error",className:"row-spaced-small",content:n("blocked_filename")});default:return null}}jr.propTypes={focusName:ue().bool,label:ue().string,classes:ue().shape({formGroup:ue().string}),placeholder:ue().string,error:ue().oneOfType([ue().object,ue().string]),inFlight:ue().bool.isRequired},br.propTypes={error:ue().oneOfType([ue().object,ue().string]).isRequired};var yr=n(60718),_r=n(80124),vr=n(4607);function Cr(e){let{provider:t,data:n,selectedGroupId:r,setSelectedGroupId:i}=e;const{t:s}=(0,w.Bd)();switch(t){case"mendeley":return(0,S.jsxs)(W.A,{controlId:"group-select",children:[(0,S.jsx)(Z.A,{children:s("select_a_group_optional")}),(0,S.jsxs)(Q.A,{className:"form-control",componentClass:"select",placeholder:s("select_a_group_optional"),value:r||"",onChange:e=>i(e.target.value),children:[(0,S.jsxs)("option",{disabled:!0,value:"",children:["- ",s("select_a_group_optional")]}),n.map((e=>(0,S.jsx)("option",{value:e.id,children:e.name},e.id)))]})]});case"zotero":return(0,S.jsxs)(W.A,{controlId:"group-select",children:[(0,S.jsx)(Z.A,{children:s("library")}),(0,S.jsxs)(Q.A,{className:"form-control",componentClass:"select",value:r||"",onChange:e=>i(e.target.value),children:[(0,S.jsx)("option",{value:"",children:s("my_library")}),(0,S.jsx)("option",{disabled:!0,value:"_",children:s("group_libraries")}),n.map((e=>(0,S.jsx)("option",{value:e.id,children:e.name},e.id)))]})]});default:throw new Error(`Unknown reference provider "${t}"`)}}Cr.propTypes={provider:ue().string.isRequired,data:ue().arrayOf(ue().object).isRequired,selectedGroupId:ue().string,setSelectedGroupId:ue().func.isRequired};var wr=n(13653),Ar=n(17112),kr=n(94012),Er=n(85868);function Sr(e){let{provider:t,providerName:n,supportsGroups:r=!1,supportsFormat:i=!1}=e;const{t:s}=(0,w.Bd)(),{name:o,validName:l}=mr(),{setValid:a}=cr(),{features:c}=(0,he.ur)(),{refProviders:d,setStartedFreeTrial:u,setRefProviderEnabled:p}=(0,nn.e)(),{error:m,finishCreatingLinkedFile:h,inFlight:f}=(0,rn.m)(),{indexAllReferences:g}=(0,kr.B4)(),[x,j]=(0,_.useState)(""),[b,y]=(0,_.useState)("bibtex");(0,wr.Q)((0,_.useCallback)((e=>{e.refProviders&&t in e.refProviders&&(p(t,!1),window.setTimeout((()=>{p(t,e.refProviders[t])})))}),[t,p]));const v=c?.references||c?.[t]||!1,C=v&&d[t],A=(0,_.useCallback)((()=>{$._("link-integration-click",{integration:t,location:"Editor"}),window.open(`/${t}/oauth`,"reference-auth","width=700,height=500")}),[t]),N=(0,fr.J)(t,r&&C);(0,_.useEffect)((()=>{a(l&&C&&!N.error)}),[a,l,C,N.error]);const R=(0,_.useCallback)((e=>{e.preventDefault();const n={};x&&(n.group_id=x),i&&(n.format=b),h({name:o,provider:t,data:n}).then((()=>{g(!0)})),$._("new-file-created",{method:t,extension:o.split(".").length>1?o.split(".").pop():""})}),[o,x,t,h,b,g,i]),F=(0,Ar.u)("paywall-cta");return v?(0,S.jsxs)("div",{className:"referencesImportModal",children:[C?(0,S.jsxs)("div",{children:[N.loading?(0,S.jsx)("div",{children:(0,S.jsx)("h2",{className:"text-center mt-4",children:(0,S.jsxs)("small",{children:[(0,S.jsx)(pe.A,{bs3:(0,S.jsx)(ee.A,{type:"spinner",spin:!0}),bs5:(0,S.jsx)($e.A,{animation:"border","aria-hidden":"true",role:"status",className:"align-bottom"})}),"",s("loading"),""]})})}):(0,S.jsxs)("div",{children:[(0,S.jsx)("p",{children:s("import_a_bibtex_file_from_your_provider_account",{provider:n})}),(0,S.jsxs)("form",{noValidate:!0,id:"create-file",onSubmit:R,children:[N.error&&(0,S.jsx)(Rr,{provider:t,error:N.error,linkAccount:A}),N.data&&N.data.length>0&&(0,S.jsx)("div",{className:"row-spaced-small",children:(0,S.jsx)(Cr,{provider:t,data:N.data,selectedGroupId:x,setSelectedGroupId:j})}),(0,S.jsx)("div",{className:"row-spaced-small",children:(0,S.jsx)(jr,{label:s("file_name_in_this_project"),focusName:!0,error:m,inFlight:f})}),i&&(0,S.jsx)("div",{className:"row-spaced-small",children:(0,S.jsxs)(gr.A,{controlId:"format",children:[(0,S.jsx)(xr.A,{children:s("format")}),(0,S.jsxs)(Er.A,{value:b,onChange:e=>y(e.target.value),children:[(0,S.jsx)("option",{value:"bibtex",children:"BibTeX"}),(0,S.jsx)("option",{value:"biblatex",children:"BibLaTeX"})]})]})})]})]}),f&&(0,S.jsx)("h3",{className:"text-center mt-4",children:(0,S.jsxs)("small",{children:[(0,S.jsx)(pe.A,{bs3:(0,S.jsx)(ee.A,{type:"spinner",spin:!0}),bs5:(0,S.jsx)($e.A,{animation:"border","aria-hidden":"true",role:"status",className:"align-bottom"})}),"",s("importing"),""]})})]}):(0,S.jsxs)("div",{children:[(0,S.jsx)("p",{children:Nr[t].sync_description(s)}),(0,S.jsx)("p",{children:(0,S.jsx)(E.A,{type:"button",onClick:A,children:Nr[t].link_to(s)})})]}),m&&(0,S.jsx)(S.Fragment,{children:"string"==typeof m?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("div",{className:"text-center",children:[(0,S.jsx)("hr",{}),(0,S.jsx)(Rr,{error:m,provider:t,linkAccount:A})]}),(0,S.jsx)(Tr,{error:m,provider:t,linkAccount:A})]}):m.data?.relink?(0,S.jsx)(Fr,{provider:t,linkAccount:A}):(0,S.jsx)(yr.A,{error:m})})]}):(0,S.jsxs)("div",{children:[(0,S.jsx)("p",{className:"small",children:Nr[t].sync_description(s)}),(0,S.jsx)(k.A,{type:"info",content:(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("p",{children:Nr[t].is_premium(s)}),(0,S.jsx)("p",{children:(0,S.jsx)(vr.A,{source:t,handleClick:()=>u(!0),children:F?Nr[t].cta(s):s("start_free_trial")})})]})})]})}const Nr={mendeley:{default:e=>e("mendeley_reference_loading_error"),expired:e=>e("mendeley_reference_loading_error_expired"),forbidden:e=>e("mendeley_reference_loading_error_forbidden"),"refresh-failed":e=>e("mendeley_reference_loading_error_expired"),sync_description:e=>e("mendeley_sync_description"),link_to:e=>e("link_to_mendeley"),is_premium:e=>e("mendeley_is_premium"),loading_groups:e=>e("mendeley_groups_loading_error"),relink:e=>e("mendeley_groups_relink"),cta:e=>e("mendeley_cta")},zotero:{default:e=>e("zotero_reference_loading_error"),expired:e=>e("zotero_reference_loading_error_expired"),forbidden:e=>e("zotero_reference_loading_error_forbidden"),"refresh-failed":e=>e("zotero_reference_loading_error_expired"),sync_description:e=>e("zotero_sync_description"),link_to:e=>e("link_to_zotero"),is_premium:e=>e("zotero_is_premium"),loading_groups:e=>e("zotero_groups_loading_error"),relink:e=>e("zotero_groups_relink"),cta:e=>e("zotero_cta")}};function Rr(e){let{provider:t,error:n,linkAccount:r}=e;const{t:i}=(0,w.Bd)();return"relink"===n?(0,S.jsx)(Fr,{provider:t,linkAccount:r}):n in Nr[t]?(0,S.jsx)(_r.A,{children:Nr[t][n](i)}):(0,S.jsx)(yr.A,{error:n})}function Fr(e){let{provider:t,linkAccount:n}=e;const{t:r}=(0,w.Bd)();return(0,S.jsxs)(_r.A,{children:[(0,S.jsx)("div",{children:Nr[t].relink(r)}),(0,S.jsx)("div",{style:{display:"flex",justifyContent:"center",marginTop:10},children:(0,S.jsx)(E.A,{variant:"danger",type:"button",onClick:n,children:r("relink_your_account")})})]})}function Tr(e){let{error:t,provider:n,linkAccount:r}=e;const{t:i}=(0,w.Bd)();switch(t){case"refresh-failed":return(0,S.jsxs)("div",{children:[(0,S.jsx)("p",{children:Nr[n].sync_description(i)}),(0,S.jsx)("p",{children:(0,S.jsx)(E.A,{type:"button",onClick:r,children:Nr[n].link_to(i)})})]});case"default":case"expired":case"forbidden":return(0,S.jsxs)("div",{children:[(0,S.jsxs)("div",{children:[i("reference_error_relink_hint")," "]}),(0,S.jsx)("div",{children:(0,S.jsx)("a",{href:"/user/settings",target:"_blank",rel:"noopener",style:{fontWeight:"bold"},children:i("account_settings")})})]});default:return null}}function Pr(){const{t:e}=(0,w.Bd)();return(0,S.jsx)(ur,{mode:"mendeley",icon:(0,Le.q$)({bs5:"menu_book",bs3:"book"}),label:e("from_provider",{provider:"Mendeley"})})}function Lr(){const{newFileCreateMode:e}=(0,rn.m)();return"mendeley"!==e?null:(0,S.jsx)(hr,{initialName:"references.bib",children:(0,S.jsx)(Sr,{provider:"mendeley",providerName:"Mendeley",supportsGroups:!0})})}function Dr(){const{t:e}=(0,w.Bd)();return(0,S.jsx)(ur,{mode:"zotero",icon:(0,Le.q$)({bs5:"menu_book",bs3:"book"}),label:e("from_provider",{provider:"Zotero"})})}function Ir(){const{newFileCreateMode:e}=(0,rn.m)();return"zotero"!==e?null:(0,S.jsx)(hr,{initialName:"references.bib",children:(0,S.jsx)(Sr,{provider:"zotero",providerName:"Zotero",supportsGroups:!0,supportsFormat:!0})})}var Mr=n(35447),Or=n(29139),Br=n(79953);const qr=e=>{let{onDismiss:t,handleLearnMore:n,handleFreeTrialClick:r}=e;const{t:i}=(0,w.Bd)(),s=(0,S.jsxs)("div",{children:[(0,S.jsx)(vr.A,{source:"create-bib-file-upgrade-prompt",handleClick:r,children:i("upgrade")}),(0,S.jsx)(Or.A,{bsStyle:null,className:"btn-bg-ghost",href:"/learn/how-to/How_to_link_your_Overleaf_account_to_Mendeley_and_Zotero",target:"blank",onClick:n,children:i("learn_more")})]}),o=(0,S.jsx)("div",{children:i("easily_import_and_sync_your_references")}),l=(0,S.jsx)("img",{src:"/img/third-party-references/book-illlustration.svg","aria-hidden":"true",alt:"better bibliographies",width:64,height:64});return(0,S.jsx)("div",{className:"tpr-file-promo-container tpr-bib-file-prompt hidden-sm",children:(0,S.jsx)(Br.A,{type:"offer",action:s,isDismissible:!0,isActionBelowContent:!0,customIcon:l,title:i("adding_a_bibliography"),content:o,onDismiss:t})})},$r="bib-file-tpr-prompt",zr={location:"create-bib-file-upgrade-prompt",name:$r},Ur=()=>{const{splitTestVariants:e}=(0,Ar.d1)(),{allowedFreeTrial:t,features:n}=(0,he.ur)(),{inactiveTutorials:r}=(0,me.mi)(),{completeTutorial:i,dismissTutorial:s,tryShowingPopup:o,showPopup:l,clearAndShow:a}=(0,Mr.s)($r,zr);(0,_.useEffect)((()=>{const i="new-bib-file"===e["bib-file-tpr-prompt"],s=r.includes($r);if(i&&(t&&!(n?.mendeley||n?.zotero))&&!s){o("reference-manager-prompt-view")||a("reference-manager-prompt-view")}}),[a,o,t,n,r,e]);const c=(0,_.useCallback)((()=>i({event:"promo-click",action:"complete",button:"Upgrade"})),[i]),d=(0,_.useCallback)((()=>$._("promo-click",{...zr,button:"Learn more"})),[]);return l?(0,S.jsx)(qr,{handleFreeTrialClick:c,handleLearnMore:d,onDismiss:s}):null},Vr=(0,_.memo)(Ur),Hr=[{import:a,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/promotions/new-bib-file-prompt"}];function Gr(){const{name:e,validName:t}=mr(),{setValid:n}=cr(),{error:r,finishCreatingDoc:i,inFlight:s}=(0,rn.m)();(0,_.useEffect)((()=>{n(t)}),[n,t]);const o=(0,_.useCallback)((t=>{t.preventDefault(),i({name:e}),$._("new-file-created",{method:"doc",extension:e.split(".").length>1?e.split(".").pop():""})}),[i,e]);return(0,S.jsxs)("form",{noValidate:!0,id:"create-file",onSubmit:o,children:[(0,S.jsx)(jr,{focusName:!0,error:r,inFlight:s}),r&&(0,S.jsx)(yr.A,{error:r}),Hr.map((e=>{let{import:{default:t},path:n}=e;return(0,S.jsx)(t,{},n)}))]})}function Kr(){const{t:e}=(0,w.Bd)(),{name:t,setName:n,validName:r}=mr(),{setValid:i}=cr(),{finishCreatingLinkedFile:s,error:o,inFlight:l}=(0,rn.m)(),[a,c]=(0,_.useState)(""),d=(0,_.useCallback)((e=>{c(e.target.value)}),[]);(0,_.useEffect)((()=>{if(a){const e=a.match(/^\s*https?:\/\/.+\/([^/]+\.(\w+))\s*$/);n(e?e[1]:"")}}),[n,a]),(0,_.useEffect)((()=>{i(r&&!!a)}),[i,r,a]);return(0,S.jsxs)("form",{className:"form-controls",id:"create-file",noValidate:!0,onSubmit:e=>{e.preventDefault(),$._("new-file-created",{method:"url",extension:t.split(".").length>1?t.split(".").pop():""}),s({name:t,provider:"url",data:{url:a.trim()}})},children:[(0,S.jsxs)(gr.A,{controlId:"import-from-url",children:[(0,S.jsx)(xr.A,{children:e("url_to_fetch_the_file_from")}),(0,S.jsx)(ft.A,{type:"url",placeholder:"https://example.com/my-file.png",required:!0,value:a,onChange:d})]}),(0,S.jsx)(jr,{label:e("file_name_in_this_project"),placeholder:"my_file",error:o,inFlight:l}),o&&(0,S.jsx)(yr.A,{error:o})]})}var Yr=n(45524),Wr=n(4941),Zr=n(87833),Qr=n(1705);function Xr(){const{t:e}=(0,w.Bd)(),{hasLinkedProjectFileFeature:t,hasLinkedProjectOutputFileFeature:n}=(0,h.A)("ol-ExposedSettings"),r=t&&n,{name:i,setName:s,validName:o}=mr(),{setValid:l}=cr(),{error:a,finishCreatingLinkedFile:c,inFlight:d}=(0,rn.m)(),[u,p]=(0,_.useState)(),[m,f]=(0,_.useState)(),[g,x]=(0,_.useState)(),[j,b]=(0,_.useState)(!t),y=(0,_.useCallback)((e=>{const t=e.split("/").pop();t&&s(t)}),[s]);(0,_.useEffect)((()=>{g&&("output.pdf"===g.path&&u.name?s(`${u.name}.pdf`):y(g.path))}),[u,g,s,y]),(0,_.useEffect)((()=>{m&&y(m.path)}),[m,y]),(0,_.useEffect)((()=>{const e=Boolean(j?g:m);l(o&&e)}),[l,o,j,m,g]);return(0,S.jsxs)(Qr.A,{id:"create-file",onSubmit:e=>{e.preventDefault(),$._("new-file-created",{method:"project",extension:i.split(".").length>1?i.split(".").pop():""}),c(j?{name:i,provider:"project_output_file",data:{source_project_id:u._id,source_output_file_path:g.path,build_id:g.build,clsiServerId:g.clsiServerId}}:{name:i,provider:"project_file",data:{source_project_id:u._id,source_entity_path:m.path}})},children:[(0,S.jsx)(Jr,{selectedProject:u,setSelectedProject:p}),j?(0,S.jsx)(ei,{selectedProjectId:u?._id,selectedProjectOutputFile:g,setSelectedProjectOutputFile:x}):(0,S.jsx)(ti,{selectedProjectId:u?._id,selectedProjectEntity:m,setSelectedProjectEntity:f}),r&&(0,S.jsxs)("div",{className:"toggle-file-type-button",children:["or",(0,S.jsx)(E.A,{variant:"link",type:"button",onClick:()=>b((e=>!e)),children:(0,S.jsx)("span",{children:e(j?"select_from_source_files":"select_from_output_files")})})]}),(0,S.jsx)(jr,{label:e("file_name_in_this_project"),classes:{formGroup:"form-controls row-spaced-small"},placeholder:"example.tex",error:a,inFlight:d}),a&&(0,S.jsx)(yr.A,{error:a})]})}function Jr(e){let{selectedProject:t,setSelectedProject:n}=e;const{t:r}=(0,w.Bd)(),{_id:i}=(0,xe.O)(),{data:s,error:o,loading:l}=(0,Yr.r)(),a=(0,_.useMemo)((()=>s?s.filter((e=>e._id!==i)):null),[s,i]);return o?(0,S.jsx)(yr.A,{error:o}):(0,S.jsxs)(gr.A,{controlId:"project-select",children:[(0,S.jsx)(xr.A,{children:r("select_a_project")}),l&&(0,S.jsxs)("span",{children:["",(0,S.jsx)(pe.A,{bs3:(0,S.jsx)(ee.A,{type:"spinner",spin:!0}),bs5:(0,S.jsx)($e.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"})})]}),(0,S.jsxs)(Er.A,{disabled:!s,value:t?t._id:"",onChange:e=>{const t=e.target.value,r=s.find((e=>e._id===t));n(r)},children:[(0,S.jsxs)("option",{disabled:!0,value:"",children:["- ",r("please_select_a_project")]}),a&&a.map((e=>(0,S.jsx)("option",{value:e._id,children:e.name},e._id)))]}),a&&!a.length&&(0,S.jsx)("small",{children:r("no_other_projects_found")})]})}function ei(e){let{selectedProjectId:t,selectedProjectOutputFile:n,setSelectedProjectOutputFile:r}=e;const{t:i}=(0,w.Bd)(),{data:s,error:o,loading:l}=(0,Zr.z)(t);return o?(0,S.jsx)(yr.A,{error:o}):(0,S.jsxs)(gr.A,{className:"row-spaced-small",controlId:"project-output-file-select",children:[(0,S.jsx)(xr.A,{children:i("select_an_output_file")}),l&&(0,S.jsxs)("span",{children:["",(0,S.jsx)(pe.A,{bs3:(0,S.jsx)(ee.A,{type:"spinner",spin:!0}),bs5:(0,S.jsx)($e.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"})})]}),(0,S.jsxs)(Er.A,{disabled:!s,value:n?.path||"",onChange:e=>{const t=e.target.value,n=s?.find((e=>e.path===t));r(n)},children:[(0,S.jsxs)("option",{disabled:!0,value:"",children:["- ",i("please_select_an_output_file")]}),s&&s.map((e=>(0,S.jsx)("option",{value:e.path,children:e.path},e.path)))]})]})}function ti(e){let{selectedProjectId:t,selectedProjectEntity:n,setSelectedProjectEntity:r}=e;const{t:i}=(0,w.Bd)(),{data:s,error:o,loading:l}=(0,Wr.i)(t);return o?(0,S.jsx)(yr.A,{error:o}):(0,S.jsxs)(gr.A,{className:"row-spaced-small",controlId:"project-entity-select",children:[(0,S.jsx)(xr.A,{children:i("select_a_file")}),l&&(0,S.jsxs)("span",{children:["",(0,S.jsx)(pe.A,{bs3:(0,S.jsx)(ee.A,{type:"spinner",spin:!0}),bs5:(0,S.jsx)($e.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"})})]}),(0,S.jsxs)(Er.A,{disabled:!s,value:n?.path||"",onChange:e=>{const t=e.target.value,n=s.find((e=>e.path===t));r(n)},children:[(0,S.jsxs)("option",{disabled:!0,value:"",children:["- ",i("please_select_a_file")]}),s&&s.map((e=>(0,S.jsx)("option",{value:e.path,children:e.path.slice(1)},e.path)))]})]})}const ni=[{import:o,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/create-file-mode-mendeley"},{import:l,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/create-file-mode-zotero"}],ri=(0,_.lazy)((()=>Promise.all([n.e(2335),n.e(3880),n.e(5380)]).then(n.bind(n,22159))));function ii(){const{t:e}=(0,w.Bd)(),{newFileCreateMode:t}=(0,rn.m)(),{fileCount:n}=(0,je.Q)(),{hasLinkedProjectFileFeature:r,hasLinkedProjectOutputFileFeature:i,hasLinkUrlFeature:s}=(0,h.A)("ol-ExposedSettings");return n&&"error"!==n.status?(0,S.jsx)("table",{children:(0,S.jsx)("tbody",{children:(0,S.jsxs)("tr",{children:[(0,S.jsx)("td",{className:"modal-new-file-list",children:(0,S.jsxs)("ul",{className:"list-unstyled",children:[(0,S.jsx)(ur,{mode:"doc",icon:(0,Le.q$)({bs5:"description",bs3:"file"}),label:e("new_file")}),(0,S.jsx)(ur,{mode:"upload",icon:"upload",label:e("upload")}),(r||i)&&(0,S.jsx)(ur,{mode:"project",icon:(0,Le.q$)({bs5:"folder_open",bs3:"folder-open"}),label:e("from_another_project")}),s&&(0,S.jsx)(ur,{mode:"url",icon:"globe",label:e("from_external_url")}),ni.map((e=>{let{import:{CreateFileMode:t},path:n}=e;return(0,S.jsx)(t,{},n)}))]})}),(0,S.jsxs)("td",{className:`modal-new-file-body modal-new-file-body-${t}`,children:["doc"===t&&(0,S.jsx)(hr,{initialName:"name.tex",children:(0,S.jsx)(Gr,{})}),"url"===t&&(0,S.jsx)(hr,{children:(0,S.jsx)(Kr,{})}),"project"===t&&(0,S.jsx)(hr,{children:(0,S.jsx)(Xr,{})}),"upload"===t&&(0,S.jsx)(_.Suspense,{fallback:(0,S.jsx)(Ce.e,{delay:500}),children:(0,S.jsx)(ri,{})}),ni.map((e=>{let{import:{CreateFilePane:t},path:n}=e;return(0,S.jsx)(t,{},n)}))]})]})})}):null}function si(){const{valid:e}=cr(),{newFileCreateMode:t,inFlight:n,cancel:r}=(0,rn.m)(),{fileCount:i}=(0,je.Q)();return(0,S.jsx)(oi,{valid:e,cancel:r,newFileCreateMode:t,inFlight:n,fileCount:i})}function oi(e){let{valid:t,fileCount:n,inFlight:r,newFileCreateMode:i,cancel:s}=e;const{t:o}=(0,w.Bd)();return(0,S.jsxs)(S.Fragment,{children:["warning"===n.status&&(0,S.jsxs)("div",{className:"modal-footer-left approaching-file-limit",children:[o("project_approaching_file_limit")," (",n.value,"/",n.limit,")"]}),"error"===n.status&&(0,S.jsx)(k.A,{type:"error",className:"at-file-limit",content:o("project_has_too_many_files")}),(0,S.jsx)(E.A,{variant:"secondary",type:"button",disabled:r,onClick:s,children:o("cancel")}),"upload"!==i&&(0,S.jsx)(E.A,{variant:"primary",type:"submit",form:"create-file",disabled:r||!t,isLoading:r,bs3Props:{loading:r?`${o("creating")}`:o("create")},children:o("create")})]})}function li(){const{t:e}=(0,w.Bd)(),{isCreatingFile:t,cancel:n}=(0,rn.m)();return t?(0,S.jsx)(dr,{children:(0,S.jsxs)(oe.Ay,{size:"lg",onHide:n,show:!0,children:[(0,S.jsx)(oe.IK,{closeButton:!0,children:(0,S.jsx)(oe.rA,{children:e("add_files")})}),(0,S.jsx)(oe.$8,{className:"modal-new-file",children:(0,S.jsx)(ii,{})}),(0,S.jsx)(oe.E9,{children:(0,S.jsx)(si,{})})]})}):null}oi.propTypes={cancel:ue().func.isRequired,fileCount:ue().shape({limit:ue().number.isRequired,status:ue().string.isRequired,value:ue().number.isRequired}).isRequired,inFlight:ue().bool.isRequired,newFileCreateMode:ue().string,valid:ue().bool.isRequired};const ai=e=>{let{children:t}=e;const{setIsRootFolderSelected:n,selectedEntityIds:r,select:i}=(0,sn.G1)(),s=(0,_.useCallback)((()=>{n(!0),r.size>1&&i([])}),[i,r.size,n]);return(0,S.jsx)("div",{className:"file-tree-inner",onClick:s,"data-testid":"file-tree-inner",children:t})};var ci=n(15043),di=n(35287);const ui=_.memo((function(e){let{refProviders:t,setRefProviderEnabled:n,setStartedFreeTrial:r,onSelect:i,onInit:s,onDelete:o,isConnected:l}=e;const[a,c]=(0,_.useState)(null),{_id:d}=(0,xe.O)(),{fileTreeData:u}=(0,je.Q)(),p=Boolean(d&&u);return(0,_.useEffect)((()=>{if(a){const e=e=>{if(e.dataTransfer){const{dataset:t}=e.target;if(t.fileId&&t.fileType&&"folder"!==t.fileType){e.dataTransfer.setData("application/x-overleaf-file-id",t.fileId);const n=(0,di.$X)(u,t.fileId);n&&e.dataTransfer.setData("application/x-overleaf-file-path",n)}}};return a.addEventListener("dragstart",e),()=>{a.removeEventListener("dragstart",e)}}}),[a,u]),(0,_.useEffect)((()=>{p&&s()}),[p,s]),p?(0,S.jsx)("div",{className:"file-tree","data-testid":"file-tree",ref:c,children:a&&(0,S.jsxs)(_n,{refProviders:t,setRefProviderEnabled:n,setStartedFreeTrial:r,onSelect:i,fileTreeContainer:a,children:[l?null:(0,S.jsx)("div",{className:"disconnected-overlay"}),(0,S.jsx)(Zn,{}),(0,S.jsx)(sr,{}),(0,S.jsx)(ai,{children:(0,S.jsx)(pi,{onDelete:o})}),(0,S.jsx)(Qn,{}),(0,S.jsx)(li,{}),(0,S.jsx)(tr,{}),(0,S.jsx)(nr,{})]})}):null}));function pi(e){let{onDelete:t}=e;!function(e){const t=(0,he.ur)(),{dispatchRename:n,dispatchDelete:r,dispatchMove:i,dispatchCreateFolder:s,dispatchCreateDoc:o,dispatchCreateFile:l,fileTreeData:a}=(0,je.Q)(),{selectedEntityIds:c,selectedEntityParentIds:d,select:u,unselect:p}=(0,sn.G1)(),{socket:m}=(0,ye.nK)(),{fileTreeFromHistory:h}=(0,U.P4)(),f=(0,_.useCallback)(((e,n,r)=>{r&&t?.id===r&&window.expectingLinkedFileRefreshedSocketFor===n&&(u(e),window.expectingLinkedFileRefreshedSocketFor=null)}),[t,u]);(0,_.useEffect)((()=>{if(!h)return m&&m.on("reciveEntityRename",e),()=>{m&&m.removeListener("reciveEntityRename",e)};function e(e,t){n(e,t)}}),[m,n,h]),(0,_.useEffect)((()=>{if(!h)return m&&m.on("removeEntity",t),()=>{m&&m.removeListener("removeEntity",t)};function t(t){const n=(0,mn.lE)(a,t);if(p(t),d.has(t))for(const e of c)(0,mn.k3)(a,e).path.includes(t)&&p(e);r(t),e&&e(n)}}),[m,p,r,a,c,d,e,h]),(0,_.useEffect)((()=>{if(!h)return m&&m.on("reciveEntityMove",e),()=>{m&&m.removeListener("reciveEntityMove",e)};function e(e,t){i(e,t)}}),[m,i,h]),(0,_.useEffect)((()=>{if(!h)return m&&m.on("reciveNewFolder",e),()=>{m&&m.removeListener("reciveNewFolder",e)};function e(e,t){s(e,t)}}),[m,s,h]),(0,_.useEffect)((()=>{if(!h)return m&&m.on("reciveNewDoc",e),()=>{m&&m.removeListener("reciveNewDoc",e)};function e(e,t,n){o(e,t)}}),[m,o,h]),(0,_.useEffect)((()=>{if(!h)return m&&m.on("reciveNewFile",e),()=>{m&&m.removeListener("reciveNewFile",e)};function e(e,t,n,r,i){l(e,t),r&&f(t._id,t.name,i)}}),[m,l,f,h])}(t);const{fileTreeData:n}=(0,je.Q)(),{isOver:r,dropRef:i}=jn(n._id),s=(0,ci.V)((e=>({isDragging:e.isDragging(),item:e.getItem(),clientOffset:e.getClientOffset()})));return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(An,{isOver:r,...s}),(0,S.jsx)(Gn,{folders:n.folders,docs:n.docs,files:n.fileRefs,classes:{root:I()("file-tree-list",{"file-tree-dragging":s.isDragging})},dropRef:i,dataTestId:"file-tree-list-root"})]})}const mi=(0,C.A)(ui,lr);var hi=n(99115);const fi=(0,_.memo)((function(){const e=(0,he.ur)(),{setStartedFreeTrial:t}=(0,tn.yn)(),{isConnected:n,connectionState:r}=(0,R.FX)(),{handleFileTreeInit:i,handleFileTreeSelect:s,handleFileTreeDelete:o}=(0,hi.r)(),[l,a]=(0,_.useState)((()=>e.refProviders||{})),c=(0,_.useCallback)((function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];a((n=>({...n,[e]:t})))}),[]);return(0,S.jsx)(mi,{refProviders:l,setRefProviderEnabled:c,setStartedFreeTrial:t,isConnected:n||null!==r.reconnectAt,onInit:i,onSelect:s,onDelete:o})})),gi=(0,_.memo)((e=>{let{expanded:t,setExpanded:n}=e;const{t:r}=(0,w.Bd)();return(0,S.jsx)("button",{className:"outline-item-expand-collapse-btn",onClick:()=>n((e=>!e)),"aria-label":r(t?"collapse":"expand"),children:(0,S.jsx)(z.A,{type:t?"keyboard_arrow_down":"keyboard_arrow_right",className:"outline-caret-icon"})})}));gi.displayName="OutlineItemToggleButton";const xi=(0,_.memo)((function(e){let{outlineItem:t,jumpToLine:n,highlightedLine:r,matchesHighlightedLine:i,containsHighlightedLine:s}=e;const[o,l]=(0,_.useState)(!0),a=(0,_.useRef)(),c=(0,_.useRef)(!1),d=I()("outline-item",{"outline-item-no-children":!t.children}),u=i||!o&&s,p=I()("outline-item-link",{"outline-item-link-highlight":u});(0,_.useEffect)((()=>{const e=c.current;c.current=u,!e&&u&&(0,kn.A)(a.current,{scrollMode:"if-needed",block:"center"})}),[u,a,c]);const m=t.children?o:void 0;return(0,S.jsxs)("li",{className:d,"aria-expanded":m,role:"treeitem","aria-current":u,"aria-label":t.title,children:[(0,S.jsxs)("div",{className:"outline-item-row",children:[!!t.children&&(0,S.jsx)(gi,{expanded:o,setExpanded:l}),(0,S.jsx)("button",{className:p,onClick:function(e){const r=2===e.detail;n(t.line,r)},ref:a,children:t.title})]}),o&&t.children?(0,S.jsx)(_i,{outline:t.children,jumpToLine:n,isRoot:!1,highlightedLine:s?r:null,containsHighlightedLine:s}):null]})}));xi.propTypes={outlineItem:ue().exact({line:ue().number.isRequired,title:ue().string.isRequired,level:ue().number,children:ue().array,from:ue().number,to:ue().number}).isRequired,jumpToLine:ue().func.isRequired,highlightedLine:ue().number,matchesHighlightedLine:ue().bool,containsHighlightedLine:ue().bool};const ji=xi;function bi(e){return(e||[]).map((e=>bi(e.children).concat(e.line))).flat()}const yi=(0,_.memo)((function(e){let{outline:t,jumpToLine:n,isRoot:r,highlightedLine:i,containsHighlightedLine:s}=e;const o=I()("outline-item-list",{"outline-item-list-root":r});return(0,S.jsx)("ul",{className:o,role:r?"tree":"group",children:t.map(((e,t)=>{const r=s&&i===e.line,o=s&&bi(e.children).includes(i);return(0,S.jsx)(ji,{outlineItem:e,jumpToLine:n,highlightedLine:r||o?i:null,matchesHighlightedLine:r,containsHighlightedLine:o},`${e.level}-${t}`)}))})}));yi.propTypes={outline:ue().array.isRequired,jumpToLine:ue().func.isRequired,isRoot:ue().bool,highlightedLine:ue().number,containsHighlightedLine:ue().bool};const _i=yi;function vi(e){let{outline:t,jumpToLine:n,highlightedLine:r}=e;const{t:i}=(0,w.Bd)();return(0,S.jsx)("div",{children:t.length?(0,S.jsx)(_i,{outline:t,jumpToLine:n,isRoot:!0,highlightedLine:r,containsHighlightedLine:!0}):(0,S.jsxs)("div",{className:"outline-body-no-elements",children:[i("we_cant_find_any_sections_or_subsections_in_this_file"),"."," ",(0,S.jsx)("a",{href:"/learn/how-to/Using_the_File_Outline_feature",className:"outline-body-link",target:"_blank",rel:"noopener noreferrer",children:i("find_out_more_about_the_file_outline")})]})})}vi.propTypes={outline:ue().array.isRequired,jumpToLine:ue().func.isRequired,highlightedLine:ue().number};const Ci=vi,wi=(0,_.memo)((e=>{let{isTexFile:t,toggleExpanded:n,expanded:r,isOpen:i,isPartial:s}=e;const{t:o}=(0,w.Bd)();return(0,S.jsxs)("button",{className:"outline-header-expand-collapse-btn",disabled:!t,onClick:n,"aria-label":o(r?"hide_outline":"show_outline"),children:[(0,S.jsx)(z.A,{type:i?"keyboard_arrow_down":"keyboard_arrow_right",className:"outline-caret-icon"}),(0,S.jsx)("h4",{className:"outline-header-name",children:o("file_outline")}),s&&(0,S.jsx)(Te.A,{id:"partial-outline",description:o("partial_outline_warning"),overlayProps:{placement:"top"},children:(0,S.jsx)("span",{role:"status",style:{display:"flex"},children:(0,S.jsx)(z.A,{type:"warning",accessibilityLabel:o("partial_outline_warning")})})})]})}));wi.displayName="OutlineToggleButton";const Ai=_.memo((function(e){let{isTexFile:t,outline:n,jumpToLine:r,onToggle:i,highlightedLine:s,isPartial:o=!1,expanded:l,toggleExpanded:a}=e;const c=Boolean(t&&l);(0,_.useEffect)((()=>{i(c)}),[c,i]);const d=I()("outline-pane",{"outline-pane-disabled":!t});return(0,S.jsxs)("div",{className:d,children:[(0,S.jsx)("header",{className:"outline-header",children:(0,S.jsx)(wi,{toggleExpanded:a,expanded:l,isOpen:c,isPartial:o,isTexFile:t})}),c&&(0,S.jsx)("div",{className:"outline-body",children:(0,S.jsx)(Ci,{outline:n,jumpToLine:r,highlightedLine:s})})]})})),ki=(0,C.A)(Ai);var Ei=n(54830),Si=n(60347),Ni=n(37766);const Ri=(0,_.memo)((()=>{const{flatOutline:e,highlightedLine:t,canShowOutline:n,jumpToLine:r,outlineExpanded:i,toggleOutlineExpanded:s}=(0,Ei.X)(),o=(0,Ni.A)("outline-toggled"),[l,a]=(0,_.useState)((()=>({items:[],partial:!1}))),c=(0,_.useRef)(void 0);return(0,_.useEffect)((()=>{const t=c.current;c.current=e,e?Fi(t?.items,e.items)&&(g.$.log("Rebuilding changed outline"),a({items:(0,Si.z_)(e.items),partial:e.partial})):a({items:[],partial:!1})}),[e]),(0,S.jsx)("div",{className:"outline-container",children:(0,S.jsx)(ki,{outline:l.items,onToggle:o,isTexFile:n,jumpToLine:r,highlightedLine:t,isPartial:l.partial,expanded:i,toggleExpanded:s})})}));Ri.displayName="OutlineContainer";const Fi=(e,t)=>{if(!e)return!0;if(e.length!==t.length)return!0;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];if(r.level!==i.level||r.line!==i.line||r.title!==i.title)return!0}return!1};function Ti(e,t){(0,_.useEffect)((()=>{const n=t.current;n&&(e?n.expand():n.collapse())}),[e,t])}function Pi(){const{view:e}=(0,O.LV)(),{outlineEnabled:t,outlinePanelRef:n}=(()=>{const{canShowOutline:e,outlineExpanded:t}=(0,Ei.X)(),n=(0,_.useRef)(null),r=e&&t;return Ti(r,n),{outlineEnabled:r,outlinePanelRef:n}})();return(0,S.jsx)("aside",{className:I()("ide-react-editor-sidebar",{hidden:"history"===e}),children:(0,S.jsxs)(L.YZ,{autoSaveId:"ide-editor-sidebar-layout",direction:"vertical",children:[(0,S.jsx)(L.Zk,{defaultSize:50,minSize:25,className:"ide-react-file-tree-panel",id:"panel-file-tree",order:1,children:(0,S.jsx)(fi,{})}),(0,S.jsx)(en,{disabled:!t}),(0,S.jsx)(L.Zk,{defaultSize:50,maxSize:75,id:"panel-outline",order:2,collapsible:!0,ref:n,style:{minHeight:32},children:(0,S.jsx)(Ri,{})})]})})}function Li(){const{t:e}=(0,w.Bd)();return(0,S.jsx)("div",{className:"no-file-selection",children:(0,S.jsx)("div",{className:"no-file-selection-message",children:(0,S.jsx)("h3",{children:e("no_selection_select_file")})})})}const Di=(e,t)=>e.linkedFileData?.provider===t;function Ii(e){let{file:t}=e;const{t:n}=(0,w.Bd)(),{id:r}=(0,he.ur)();if(!(Di(t,"mendeley")||Di(t,"zotero")))return null;return t.linkedFileData.importer_id===r?null:(0,S.jsx)("div",{className:"row",children:(0,S.jsx)("div",{className:I()("p-3 mb-4",(0,Le.q$)({bs3:"alert"})),children:n("only_importer_can_refresh",{provider:(0,Ut.capitalize)(t.linkedFileData.provider)})})})}var Mi=n(52553);const Oi=e=>(0,S.jsx)(pe.A,{bs3:(0,S.jsx)(ee.A,{type:"external-link-square",modifier:"rotate-180",className:"linked-file-icon",...e}),bs5:(0,S.jsx)(z.A,{type:"open_in_new",modifier:"rotate-180",className:"align-middle linked-file-icon",...e})});function Bi(e){let{file:t}=e;const{t:n}=(0,w.Bd)();if("mendeley"!==t.linkedFileData.provider&&"zotero"!==t.linkedFileData.provider)return null;const r={formattedDate:(0,Mi.fU)(t.created),relativeDate:(0,Mi.Pp)(t.created)};return(0,S.jsxs)("p",{children:[(0,S.jsx)(Oi,{fw:!0})," ","mendeley"===t.linkedFileData.provider?n("imported_from_mendeley_at_date",r):n("imported_from_zotero_at_date",r)]})}Bi.propTypes={file:ue().shape({created:ue().string,linkedFileData:ue().shape({provider:ue().string})})};const qi=(e,t)=>e.linkedFileData?.provider===t;function $i(e){let{file:t,refreshing:n,refreshFile:r}=e;const{t:i}=(0,w.Bd)(),{id:s}=(0,he.ur)(),o=Di(t,"mendeley")||Di(t,"zotero");let l;o&&(l=t.linkedFileData.importer_id===s);const a=!o||l;return(0,S.jsx)(E.A,{className:I()("btn",{"btn-primary":a,"btn-secondary":!a}),onClick:()=>r(o),disabled:n||!a,bs3Props:{loading:(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(ee.A,{type:"refresh",spin:n,fw:!0})," ",(0,S.jsx)("span",{children:n?`${i("refreshing")}`:i("refresh")})]})},isLoading:n,children:i("refresh")})}var zi=n(52155);const Ui=[{import:u,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/file-view/tpr-file-view-refresh-button"}];function Vi(e){let{setRefreshError:t,file:n}=e;const{_id:r}=(0,xe.O)(),{signal:i}=(0,zi.A)(),[s,o]=(0,_.useState)(!1),l=(0,_.useCallback)((e=>{o(!0),window.expectingLinkedFileRefreshedSocketFor=n.name;const s={shouldReindexReferences:e||/\.bib$/.test(n.name)};(0,be.TB)(`/project/${r}/linked_file/${n.id}/refresh`,{signal:i,body:s}).then((()=>{o(!1)})).catch((e=>{o(!1),t(e.data?.message||e.message)}))}),[n,r,i,t]);return Ui.length>0?Ui.map((e=>{let{import:{TPRFileViewRefreshButton:t},path:r}=e;return(0,S.jsx)(t,{file:n,refreshFile:l,refreshing:s},r)}))[0]:(0,S.jsx)(Hi,{refreshFile:l,refreshing:s})}function Hi(e){let{refreshFile:t,refreshing:n}=e;const{t:r}=(0,w.Bd)();return(0,S.jsx)(E.A,{variant:"primary",onClick:()=>t(null),disabled:n,isLoading:n,bs3Props:{loading:(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(ee.A,{type:"refresh",spin:n,fw:!0})," ",(0,S.jsx)("span",{children:n?`${r("refreshing")}`:r("refresh")})]})},children:r("refresh")})}function TPRFileViewRefreshError(e){let{file:t,refreshError:n}=e;const r=Di(t,"mendeley")||Di(t,"zotero");return(0,S.jsx)("div",{className:"file-view-error",children:r?(0,S.jsx)(FileViewMendeleyOrZoteroRefreshError,{file:t}):(0,S.jsx)(FileViewDefaultRefreshError,{refreshError:n})})}function FileViewMendeleyOrZoteroRefreshError(e){let{file:t}=e;const{t:n}=(0,w.Bd)();return(0,S.jsx)(k.A,{type:"error",bs3Props:{className:"tpr-refresh-error"},content:(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("div",{children:[n("something_not_right"),"!",(0,S.jsx)("span",{children:t.linkedFileData&&n("try_relinking_provider",{provider:(0,Ut.capitalize)(t.linkedFileData.provider)})})]}),(0,S.jsx)(E.A,{variant:"secondary",size:"sm",className:"mt-2",href:"/user/settings",target:"_blank",children:n("go_to_settings")})]})})}function FileViewDefaultRefreshError(e){let{refreshError:t}=e;const{t:n}=(0,w.Bd)();return(0,S.jsx)(k.A,{type:"error",content:`${n("access_denied")}: ${t}`})}const Gi=[{import:p,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/file-view/tpr-file-view-refresh-error"}];function FileViewRefreshError(e){let{file:t,refreshError:n}=e;const{t:r}=(0,w.Bd)();return Gi.length>0?Gi.map((e=>{let{import:{TPRFileViewRefreshError:r},path:i}=e;return(0,S.jsx)(r,{file:t,refreshError:n},i)}))[0]:(0,S.jsx)("div",{className:"file-view-error",children:(0,S.jsx)(k.A,{type:"error",content:(0,S.jsxs)("span",{children:[r("access_denied"),": ",n]})})})}const Ki=[{import:d,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/file-view/tpr-file-view-info"}],Yi=[{import:c,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/file-view/tpr-file-view-not-original-importer"}],Wi=60,Zi=35,Qi="...",Xi=Wi-Zi-Qi.length;function Ji(e){if(e){if(e.length>Wi){const t=e.slice(0,Zi),n=e.slice(e.length-Xi);return t+Qi+n}return e}}function es(e){let{file:t}=e;const{_id:n}=(0,xe.O)(),{fileTreeReadOnly:r}=(0,je.Q)(),{fileTreeFromHistory:i}=(0,U.P4)(),{t:s}=(0,w.Bd)(),[o,l]=(0,_.useState)(null);let a;return t.linkedFileData&&(qi(t,"url")?a=(0,S.jsx)(ts,{file:t}):qi(t,"project_file")?a=(0,S.jsx)(ns,{file:t}):qi(t,"project_output_file")&&(a=(0,S.jsx)(rs,{file:t}))),(0,S.jsxs)(S.Fragment,{children:[t.linkedFileData&&a,t.linkedFileData&&Ki.map((e=>{let{import:{TPRFileViewInfo:n},path:r}=e;return(0,S.jsx)(n,{file:t},r)})),(0,S.jsxs)("div",{className:"file-view-buttons",children:[t.linkedFileData&&!r&&(0,S.jsx)(Vi,{file:t,setRefreshError:l}),(0,S.jsxs)(E.A,{variant:"secondary",download:t.name,href:i?`/project/${n}/blob/${t.hash}`:`/project/${n}/file/${t.id}`,children:[(0,S.jsx)(pe.A,{bs3:(0,S.jsx)(ee.A,{type:"download",fw:!0}),bs5:(0,S.jsx)(z.A,{type:"download",className:"align-middle"})})," ",(0,S.jsx)("span",{children:s("download")})]})]}),t.linkedFileData&&Yi.map((e=>{let{import:{TPRFileViewNotOriginalImporter:n},path:r}=e;return(0,S.jsx)(n,{file:t},r)}))[0],o&&(0,S.jsx)(FileViewRefreshError,{file:t,refreshError:o})]})}function ts(e){let{file:t}=e;return(0,S.jsxs)("p",{children:[(0,S.jsx)(Oi,{}),"",(0,S.jsx)(w.x6,{i18nKey:"imported_from_external_provider_at_date",components:[(0,S.jsx)("a",{href:t.linkedFileData.url})],values:{shortenedUrl:Ji(t.linkedFileData.url),formattedDate:(0,Mi.fU)(t.created),relativeDate:(0,Mi.Pp)(t.created)},shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}}})]})}function ns(e){let{file:t}=e;return(0,S.jsxs)("p",{children:[(0,S.jsx)(Oi,{})," ",(0,S.jsx)(w.x6,{i18nKey:"imported_from_another_project_at_date",components:t.linkedFileData.v1_source_doc_id?[(0,S.jsx)("span",{})]:[(0,S.jsx)("a",{href:`/project/${t.linkedFileData.source_project_id}`,target:"_blank",rel:"noopener"})],values:{sourceEntityPath:t.linkedFileData.source_entity_path.slice(1),formattedDate:(0,Mi.fU)(t.created),relativeDate:(0,Mi.Pp)(t.created)},shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}}})]})}function rs(e){let{file:t}=e;return(0,S.jsxs)("p",{children:[(0,S.jsx)(Oi,{}),"",(0,S.jsx)(w.x6,{i18nKey:"imported_from_the_output_of_another_project_at_date",components:t.linkedFileData.v1_source_doc_id?[(0,S.jsx)("span",{})]:[(0,S.jsx)("a",{href:`/project/${t.linkedFileData.source_project_id}`,target:"_blank",rel:"noopener"})],values:{sourceOutputFilePath:t.linkedFileData.source_output_file_path,formattedDate:(0,Mi.fU)(t.created),relativeDate:(0,Mi.Pp)(t.created)},shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}}})]})}function is(e){let{file:t,onLoad:n,onError:r}=e;const{_id:i}=(0,xe.O)(),{fileTreeFromHistory:s}=(0,U.P4)();return(0,S.jsx)("img",{src:s?`/project/${i}/blob/${t.hash}`:`/project/${i}/file/${t.id}`,onLoad:n,onError:r,alt:t.name})}var ss=n(89997);const os=e=>{let{fileId:t,onLoad:r,onError:i}=e;const s=(0,ge.A)(),{previewByPath:o,pathInFolder:l}=(0,ss.m8)(),a=(0,_.useCallback)((async e=>{if(e){const{loadPdfDocumentFromUrl:a}=await Promise.all([n.e(2335),n.e(2768),n.e(2404)]).then(n.bind(n,62404));if(!s.current)return;const c=l(t),d=c?o(c):null;if(!d)return void i();const u=await a(d.url).promise;if(!s.current)return;e.textContent="";const p=window.devicePixelRatio||1;for(let t=1;t<=u.numPages;t++){const n=await u.getPage(t);if(!s.current)return;const r=n.getViewport({scale:p}),i=document.createElement("canvas");i.classList.add("pdf-page"),i.width=r.width,i.height=r.height,i.style.width=r.width/p+"px",i.style.height=r.height/p+"px",e.append(i),n.render({canvasContext:i.getContext("2d"),viewport:r})}r()}}),[s,l,t,o,r,i]);return(0,S.jsx)("div",{className:"file-view-pdf",ref:a})};n(25440);const ls=2097152;function as(e){let{file:t,onLoad:n,onError:r}=e;const{_id:i}=(0,xe.O)(),{fileTreeFromHistory:s}=(0,U.P4)(),[o,l]=(0,_.useState)(""),[a,c]=(0,_.useState)(!1),[d,u]=(0,_.useState)(!1),p=(0,zi.A)(),m=(0,zi.A)();return(0,_.useEffect)((()=>{if(d)return;let e=s?`/project/${i}/blob/${t.hash}`:`/project/${i}/file/${t.id}`;const o=setTimeout((()=>p.abort()),1e4);let a;fetch(e,{method:"HEAD",signal:p.signal}).then((e=>{if(!e.ok)throw new Error("HTTP Error Code: "+e.status);return e.headers.get("Content-Length")})).then((t=>{let r=!1,i=null;return t&&Number(t)>ls&&(r=!0,i=ls),null!=i&&(e+=`?range=0-${i}`),a=window.setTimeout((()=>m.abort()),6e4),fetch(e,{signal:m.signal}).then((e=>e.text().then((e=>{r&&(e=e.replace(/\n.*$/,"")),l(e),n(),c(r)}))))})).catch((e=>{g.$.error("Error fetching file contents",e),r()})).finally((()=>{u(!1),clearTimeout(o),clearTimeout(a)}))}),[s,i,t.id,t.hash,r,n,d,p,m]),Boolean(o)&&(0,S.jsx)("div",{className:"text-preview",children:(0,S.jsxs)("div",{className:"scroll-container",children:[(0,S.jsx)("p",{children:o}),a&&(0,S.jsx)("p",{children:"..."})]})})}const cs=["png","jpg","jpeg","gif"];function ds(e){let{file:t}=e;const[n,r]=(0,_.useState)(!0),[i,s]=(0,_.useState)(!1),{t:o}=(0,w.Bd)(),{textExtensions:l,editableFilenames:a}=(0,h.A)("ol-ExposedSettings"),c=t.name.split(".").pop().toLowerCase(),d=l.includes(c)||a.includes(t.name.toLowerCase()),u=cs.includes(c),p="pdf"===c,m=!d&&!u&&!p,f=(0,_.useCallback)((()=>{r(!1)}),[]),g=(0,_.useCallback)((()=>{i||(r(!1),s(!0))}),[i]),x=(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(es,{file:t}),u&&(0,S.jsx)(is,{file:t,onLoad:f,onError:g}),d&&(0,S.jsx)(as,{file:t,onLoad:f,onError:g}),p&&(0,S.jsx)(os,{fileId:t.id,onLoad:f,onError:g})]});return(0,S.jsxs)("div",{className:"file-view full-size",children:[!i&&x,!m&&n&&(0,S.jsx)(us,{}),(m||i)&&(0,S.jsx)("p",{className:"no-preview",children:o("no_preview_available")})]})}function us(){return(0,S.jsx)("div",{className:"loading-panel loading-panel-file-view","data-testid":"loading-panel-file-view",children:(0,S.jsx)(Ce.A,{})})}function ps(e){let{selectedEntityCount:t}=e;const{t:n}=(0,w.Bd)();return(0,S.jsx)("div",{className:"multi-selection-ongoing",children:(0,S.jsx)("div",{className:"multi-selection-message",children:(0,S.jsx)("h4",{children:`${t} ${n("files_selected")}`})})})}ds.propTypes={file:ue().shape({id:ue().string,name:ue().string,hash:ue().string}).isRequired};var ms=n(40802),hs=n(76966);var fs=n(39891);const gs=e=>{let{onDismiss:t,handleLearnMore:n,handleFreeTrialClick:r}=e;const{t:i}=(0,w.Bd)(),s=(0,S.jsxs)("div",{children:[(0,S.jsx)(vr.A,{source:"open-bib-file-upgrade-prompt",buttonProps:{variant:"secondary"},handleClick:r,children:i("upgrade")}),(0,S.jsx)(Or.A,{bsStyle:null,className:"btn-bg-ghost",href:"/learn/how-to/How_to_link_your_Overleaf_account_to_Mendeley_and_Zotero",target:"blank",onClick:n,children:i("learn_more")})]}),o=(0,S.jsx)("div",{children:i("easily_import_and_sync_your_references")}),l=(0,S.jsx)("img",{src:"/img/third-party-references/book-illlustration.svg","aria-hidden":"true",alt:"better bibliographies",width:64,height:64});return(0,S.jsx)("div",{className:"tpr-editor-prompt-container tpr-bib-file-prompt hidden-xs-container fade-slide-in",children:(0,S.jsx)(Br.A,{type:"offer",action:s,isDismissible:!0,isActionBelowContent:!0,customIcon:l,title:i("better_bibliographies"),content:o,onDismiss:t})})},xs="bib-file-tpr-prompt",js={location:"open-bib-file-upgrade-prompt",name:xs},bs=()=>{const{splitTestVariants:e}=(0,Ar.d1)(),{allowedFreeTrial:t,features:n}=(0,he.ur)(),{inactiveTutorials:r}=(0,me.mi)(),[i]=(0,F.A)("editor"),{completeTutorial:s,dismissTutorial:o,tryShowingPopup:l,showPopup:a,clearPopup:c}=(0,Mr.s)(xs,js);(0,_.useEffect)((()=>{const s="edit-bib-file"===e["bib-file-tpr-prompt"],o=r.includes(xs),a=t&&!(n?.mendeley||n?.zotero),d=i?.open_doc_name,u=d&&d?.endsWith(".bib");s&&a&&u&&!o?l("reference-manager-prompt-view"):s&&c()}),[t,n,i,r,l,o,e,c]);const d=(0,_.useCallback)((()=>s({event:"promo-click",action:"complete",button:"Upgrade"})),[s]),u=(0,_.useCallback)((()=>$._("promo-click",{...js,button:"Learn more"})),[]);return a?(0,S.jsx)(gs,{handleFreeTrialClick:d,handleLearnMore:u,onDismiss:o}):null},ys=(0,_.memo)(bs);var _s=n(45330);const vs=[{import:m,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/promotions/edit-bib-file-prompt"}],Cs=(0,_.lazy)((()=>Promise.all([n.e(4695),n.e(5982),n.e(3027),n.e(5479),n.e(188),n.e(1290),n.e(9880),n.e(4372),n.e(7565)]).then(n.bind(n,90103))));function ws(){return(0,S.jsxs)(_.Suspense,{fallback:(0,S.jsx)(Ce.e,{delay:500}),children:[vs.map((e=>{let{import:{default:t},path:n}=e;return(0,S.jsx)(t,{},n)})),(0,S.jsx)(Cs,{})]})}const As=(0,C.A)((0,_.memo)(ws),_s.j),ks=()=>{const{t:e}=(0,w.Bd)();return(0,S.jsx)("div",{className:"loading-panel",children:(0,S.jsxs)("span",{children:[(0,S.jsx)("i",{className:"fa fa-spin fa-refresh"}),"",e("loading"),""]})})},Es=(0,_.lazy)((()=>n.e(744).then(n.bind(n,50744)))),Ss=()=>{const[e]=(0,F.A)("editor"),{selectedEntityCount:t,openEntity:n}=(0,hi.r)(),{currentDocumentId:r}=(0,q.TS)();if(!r)return null;const i=Boolean((!e.sharejs_doc||e.opening)&&!e.error_state&&e.open_doc_id);return(0,S.jsx)("div",{className:I()("ide-react-editor-content","full-size",{hidden:"doc"!==n?.type||1!==t}),children:(0,S.jsxs)(L.YZ,{autoSaveId:"ide-editor-layout",direction:"vertical",children:[(0,S.jsxs)(L.Zk,{id:"panel-source-editor",order:1,className:"ide-react-editor-panel",children:[(0,S.jsx)(As,{}),i&&(0,S.jsx)(ks,{})]}),e.showSymbolPalette&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(en,{id:"editor-symbol-palette"}),(0,S.jsx)(L.Zk,{id:"panel-symbol-palette",order:2,defaultSize:25,minSize:10,maxSize:50,children:(0,S.jsx)(_.Suspense,{fallback:(0,S.jsx)(Ce.e,{delay:500}),children:(0,S.jsx)(Es,{})})})]})]})})},Ns=()=>{const[e,t]=(0,_.useState)(!1),{t:n}=(0,w.Bd)(),{togglePdfPane:r,handlePdfPaneExpand:i,handlePdfPaneCollapse:s,setPdfIsOpen:o,pdfIsOpen:l,pdfPanelRef:a}=(()=>{const{view:e,pdfLayout:t,changeLayout:n,detachRole:r,reattach:i}=(0,O.LV)(),s=(0,_.useRef)(null),o="sideBySide"===t||"pdf"===e;Ti(o,s);const l=(0,_.useCallback)((()=>{o?n("flat","editor"):n("sideBySide")}),[n,o]),a=(0,_.useCallback)((e=>{e?("detacher"===r&&i(),n("sideBySide")):n("flat","editor")}),[n,r,i]);return{togglePdfPane:l,handlePdfPaneExpand:(0,_.useCallback)((()=>{"flat"===t&&"editor"===e&&n("sideBySide","editor")}),[n,t,e]),handlePdfPaneCollapse:(0,_.useCallback)((()=>{"sideBySide"===t&&n("flat","editor")}),[n,t]),setPdfIsOpen:a,pdfIsOpen:o,pdfPanelRef:s}})(),{view:c,pdfLayout:d}=(0,O.LV)(),{selectedEntityCount:u,openEntity:p}=(0,hi.r)(),m="editor"===c||"file"===c||"sideBySide"===d;return(0,S.jsxs)(L.YZ,{autoSaveId:"ide-editor-pdf-layout",direction:"horizontal",className:I()({"ide-panel-group-resizing":e,hidden:"history"===c}),children:[(0,S.jsxs)(L.Zk,{id:"panel-ide",order:1,defaultSize:50,minSize:5,className:I()("ide-react-panel",{"ide-panel-group-resizing":e,hidden:!m}),children:[0===u&&(0,S.jsx)(Li,{}),1===u&&"fileRef"===p?.type&&(0,S.jsx)(ds,{file:(0,fs.g)(p.entity)}),u>1&&(0,S.jsx)(ps,{selectedEntityCount:u}),(0,S.jsx)(Ss,{})]}),(0,S.jsxs)(M,{resizable:"sideBySide"===d,onDoubleClick:r,onDragging:t,className:I()({hidden:!m}),hitAreaMargins:{coarse:0,fine:0},children:[(0,S.jsx)(Xt,{id:"editor-pdf",togglerType:"east",isOpen:l,setIsOpen:o,tooltipWhenOpen:n("tooltip_hide_pdf"),tooltipWhenClosed:n("tooltip_show_pdf")}),"sideBySide"===d&&(0,S.jsx)("div",{className:"synctex-controls",children:(0,S.jsx)(ms.Xq,{})})]}),(0,S.jsxs)(L.Zk,{ref:a,id:"panel-pdf",order:2,defaultSize:50,minSize:5,collapsible:!0,onCollapse:s,onExpand:i,className:"ide-react-panel",children:[l&&(0,S.jsx)(hs.A,{}),"flat"===d&&"pdf"===c&&(0,S.jsx)("div",{className:"synctex-controls",hidden:!0,children:(0,S.jsx)(ms.Xq,{})})]})]})},Rs=(0,_.lazy)((()=>Promise.all([n.e(4695),n.e(3027),n.e(188),n.e(1290),n.e(9880),n.e(8892)]).then(n.bind(n,33578))));const Fs=(0,C.A)((function(){const{view:e}=(0,O.LV)();return"history"!==e?null:(0,S.jsx)(_.Suspense,{fallback:(0,S.jsx)(Ce.e,{delay:500}),children:(0,S.jsx)(Rs,{})})}),_s.j),Ts=()=>{const{view:e}=(0,O.LV)(),{isOpen:t,setIsOpen:n,panelRef:r,togglePane:i,handlePaneExpand:s,handlePaneCollapse:o,resizing:l,setResizing:a}=(()=>{const[e,t]=(0,_.useState)(!0),[n,r]=(0,_.useState)(!1),i=(0,_.useRef)(null);Ti(e,i);const s=(0,_.useCallback)((()=>{t((e=>!e))}),[]),o=(0,_.useCallback)((()=>{t(!0)}),[]),l=(0,_.useCallback)((()=>{t(!1)}),[]);return{isOpen:e,setIsOpen:t,panelRef:i,togglePane:s,handlePaneExpand:o,handlePaneCollapse:l,resizing:n,setResizing:r}})(),{isOpen:c,panelRef:d,togglePane:u,resizing:p,setResizing:m,handlePaneCollapse:f,handlePaneExpand:g}=(()=>{const{chatIsOpen:e,setChatIsOpen:t}=(0,O.LV)(),[n,r]=(0,_.useState)(!1),i=(0,_.useRef)(null);return Ti(e,i),{isOpen:e,panelRef:i,resizing:n,setResizing:r,togglePane:(0,_.useCallback)((()=>{t((e=>!e))}),[t]),handlePaneExpand:(0,_.useCallback)((()=>{t(!0)}),[t]),handlePaneCollapse:(0,_.useCallback)((()=>{t(!1)}),[t])}})(),x=(0,h.A)("ol-chatEnabled"),{t:j}=(0,w.Bd)();return(0,S.jsxs)("div",{className:"ide-react-main",children:[(0,S.jsx)($t,{}),(0,S.jsx)("div",{className:"ide-react-body",children:(0,S.jsxs)(L.YZ,{autoSaveId:"ide-outer-layout",direction:"horizontal",className:I()({"ide-panel-group-resizing":l||p}),children:[(0,S.jsxs)(L.Zk,{ref:r,id:"panel-sidebar",order:1,defaultSize:15,minSize:5,maxSize:80,collapsible:!0,onCollapse:o,onExpand:s,children:[(0,S.jsx)(Pi,{}),"history"===e&&(0,S.jsx)(Jt,{})]}),(0,S.jsx)(M,{onDoubleClick:i,resizable:t,onDragging:a,hitAreaMargins:{coarse:0,fine:0},children:(0,S.jsx)(Xt,{id:"panel-sidebar",togglerType:"west",isOpen:t,setIsOpen:n,tooltipWhenOpen:j("tooltip_hide_filetree"),tooltipWhenClosed:j("tooltip_show_filetree")})}),(0,S.jsx)(L.Zk,{id:"panel-outer-main",order:2,children:(0,S.jsxs)(L.YZ,{autoSaveId:"ide-inner-layout",direction:"horizontal",children:[(0,S.jsxs)(L.Zk,{className:"ide-react-panel",id:"panel-main",order:1,children:[(0,S.jsx)(Fs,{}),(0,S.jsx)(Ns,{})]}),x&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(M,{onDoubleClick:u,resizable:c,onDragging:m,hitAreaMargins:{coarse:0,fine:0}}),(0,S.jsx)(L.Zk,{ref:d,id:"panel-chat",order:2,defaultSize:20,minSize:5,maxSize:30,collapsible:!0,onCollapse:f,onExpand:g,children:(0,S.jsx)(Qt,{})})]})]})})]})})]})};var Ps=n(66020);const Ls=(0,_.memo)((function(){const{setLeftMenuShown:e}=(0,O.LV)(),{userSettings:t}=(0,Ps.dk)(),{editorTheme:n,overallTheme:r}=t,[i]=(0,_.useState)({editorTheme:n,overallTheme:r}),s=(0,_.useRef)(null);return(0,_.useEffect)((()=>{s.current&&(n===i.editorTheme&&r===i.overallTheme||(s.current.style.opacity="0"))}),[n,r,i]),(0,S.jsx)("div",{id:"left-menu-mask",ref:s,onClick:()=>e(!1)})}));var Ds=n(58278),Is=n(1251),Ms=n(52423),Os=n(7725);const Bs=(0,_.lazy)((()=>Promise.all([n.e(4686),n.e(96),n.e(1817)]).then(n.bind(n,54128))));function qs(){const{leftMenuShown:e,setLeftMenuShown:t}=(0,O.LV)(),n=()=>{t(!1)};return(0,S.jsx)(pe.A,{bs3:(0,S.jsxs)(Os.xx,{children:[(0,S.jsx)(Ds.A,{backdropClassName:"left-menu-modal-backdrop",keyboard:!0,onHide:n,id:"left-menu-modal",show:e,children:(0,S.jsx)(Is.A.Body,{className:I()("full-size",{shown:e}),id:"left-menu",children:(0,S.jsx)(_.Suspense,{fallback:(0,S.jsx)(Ce.e,{delay:500}),children:(0,S.jsx)(Bs,{})})})}),e&&(0,S.jsx)(Ls,{})]}),bs5:(0,S.jsxs)(Os.xx,{children:[(0,S.jsx)(Ms.A,{show:e,onHide:n,backdropClassName:"left-menu-modal-backdrop",id:"left-menu-offcanvas",children:(0,S.jsx)(Ms.A.Body,{className:I()("full-size","left-menu",{shown:e}),id:"left-menu",children:(0,S.jsx)(_.Suspense,{fallback:(0,S.jsx)(Ce.e,{delay:500}),children:(0,S.jsx)(Bs,{})})})}),e&&(0,S.jsx)(Ls,{})]})})}const $s=(0,_.memo)(qs);var zs=n(6599),Us=n(31622),Vs=n(67603);const Hs=function(){const{t:e}=(0,w.Bd)(),{socket:t}=(0,R.FX)(),{projectId:n}=(0,tn.yn)(),{showGenericMessageModal:r}=(0,Vs.T)(),[,i]=(0,F.A)("project.publicAccesLevel"),[,s]=(0,F.A)("project.members"),[,o]=(0,F.A)("project.invites"),l=(0,or.z)();(0,zs.A)(t,"project:access:revoked",(0,_.useCallback)((()=>{r(e("removed_from_project"),e("you_have_been_removed_from_this_project_and_will_be_redirected_to_project_dashboard"));const t=window.setTimeout((()=>{l.assign("/project")}),5e3);return()=>{window.clearTimeout(t)}}),[r,e,l])),(0,zs.A)(t,"project:publicAccessLevel:changed",(0,_.useCallback)((e=>{e.newAccessLevel&&i(e.newAccessLevel)}),[i])),(0,zs.A)(t,"project:collaboratorAccessLevel:changed",(0,_.useCallback)((()=>{(0,Us.hu)(n).then((e=>{let{members:t}=e;t&&s(t)})).catch((e=>{g.$.error("Error fetching members for project",e)}))}),[n,s])),(0,zs.A)(t,"project:membership:changed",(0,_.useCallback)((e=>{e.members&&(0,Us.hu)(n).then((e=>{let{members:t}=e;t&&s(t)})).catch((e=>{g.$.error("Error fetching members for project",e)})),e.invites&&(0,Us.kn)(n).then((e=>{let{invites:t}=e;t&&o(t)})).catch((e=>{g.$.error("Error fetching invites for project",e)}))}),[n,o,s]))};var Gs=n(95898),Ks=n(99420),Ys=n.n(Ks);function Ws(e,t,n){(0,_.useEffect)((()=>(e.addEventListener(t,n),()=>{e.removeEventListener(t,n)})),[e,t,n])}function Zs(){const{projectId:e}=(0,tn.yn)(),{getEditorType:t}=(0,q.TS)(),[n,r]=(0,_.useState)(0),[i,s]=(0,_.useState)((()=>new Date)),o=(0,_.useCallback)((()=>{g.$.log("[Event] heartbeat trigger");const o=t();if(null===o)return;if(i>new Date)return;const l=function(e){const t={editorType:e},n=(0,Gs.T)();if(n.numberOfEntries>0)for(const[e,r]of Object.entries(n)){const n="cm6Perf"+e.charAt(0).toUpperCase()+e.slice(1);null!==r&&(t[n]=r)}return t}(o);g.$.log("[Event] send heartbeat request",l),function(e,t){(0,be.mI)(`/editingSession/${e}`,{body:{segmentation:t}}).catch(g.$.error)}(e,l),r((e=>e+1));const a=n<=2?30:n<=6?60*(n-2):300;s(Ys()().add(a,"seconds").toDate())}),[t,n,i,e]);(0,Ge.A)("cursor:editor:update",o),(0,Ge.A)("scroll:editor:update",o),Ws(document,"click",o)}var Qs=n(71110);function Xs(){const{connectionState:e}=(0,R.FX)(),{t}=(0,w.Bd)(),[n,r]=(0,_.useState)(0),[i,s]=(0,_.useState)(!1);return(0,_.useEffect)((()=>{e.forceDisconnected&&s(!0)}),[e.forceDisconnected]),(0,_.useEffect)((()=>{e.forceDisconnected&&r(e.forcedDisconnectDelay)}),[e.forceDisconnected,e.forcedDisconnectDelay]),(0,_.useEffect)((()=>{if(i){const e=window.setInterval((()=>{r((e=>Math.max(0,e-1)))}),1e3);return()=>{window.clearInterval(e)}}}),[i]),i?(0,S.jsxs)(oe.Ay,{show:!0,onHide:()=>{},className:"lock-editor-modal",backdrop:!1,keyboard:!1,children:[(0,S.jsx)(oe.IK,{children:(0,S.jsx)(oe.rA,{children:t("please_wait")})}),(0,S.jsx)(oe.$8,{children:t("were_performing_maintenance",{seconds:n})})]}):null}const Js=(0,_.memo)(Xs),eo=()=>{const{t:e}=(0,w.Bd)();return(0,S.jsxs)(oe.Ay,{show:!0,onHide:()=>{},className:"lock-editor-modal",backdrop:!1,keyboard:!1,children:[(0,S.jsx)(oe.IK,{children:(0,S.jsx)(oe.rA,{children:e("connection_lost")})}),(0,S.jsx)(oe.$8,{children:e("sorry_the_connection_to_the_server_is_down")})]})},to=e=>{let{unsavedDocs:t}=e;return(0,S.jsx)(S.Fragment,{children:[...t.entries()].map((e=>{let[t,n]=e;return n>8&&(0,S.jsx)(no,{docId:t,seconds:n},t)}))})},no=e=>{let{docId:t,seconds:n}=e;const{pathInFolder:r,findEntityByPath:i}=(0,ss.m8)(),{t:s}=(0,w.Bd)(),o=(0,_.useMemo)((()=>{const e=r(t);return e?i(e):null}),[t,i,r]);return o?(0,S.jsx)(k.A,{type:"warning",content:s("saving_notification_with_seconds",{docname:o.entity.name,seconds:n})}):null},ro=()=>{const{openDocs:e,debugTimers:t}=(0,q.TS)(),{permissionsLevel:n,setPermissionsLevel:r}=(0,me.mi)(),[i,s]=(0,_.useState)(!1),[o,l]=(0,_.useState)(new Map),a=(0,T.J)(),c=(0,_.useRef)(o);(0,_.useEffect)((()=>{c.current=o}),[o]);const d=(0,_.useRef)(n);(0,_.useEffect)((()=>{d.current=n}),[n]),(0,Ge.A)("beforeunload",(0,_.useCallback)((t=>{e.hasUnsavedChanges()&&t.preventDefault()}),[e])),(0,_.useEffect)((()=>{const n=window.setInterval((()=>{t.current.CheckUnsavedDocs=Date.now();const n=new Map,r=e.unsavedDocIds();for(const e of r){const t=(c.current.get(e)??0)+1;n.set(e,t)}(n.size>0||c.current.size>0)&&(c.current=n,l(n))}),1e3);return()=>{window.clearInterval(n)}}),[e,t]);const u=Math.max(0,...o.values());(0,_.useEffect)((()=>{s(u>15)}),[u]);const p=(0,_.useRef)(null);return(0,_.useEffect)((()=>{i?(p.current=d.current,r("readOnly"),s(!0)):p.current&&r(p.current)}),[i,r]),(0,_.useEffect)((()=>{0===o.size&&"readOnly"===d.current&&s(!1)}),[o]),(0,S.jsxs)(S.Fragment,{children:[i&&(0,S.jsx)(eo,{}),o.size>0&&a&&(0,y.createPortal)((0,S.jsx)(to,{unsavedDocs:o}),a)]})};var io=n(37318);const so=(0,_.memo)((()=>(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(Js,{}),(0,S.jsx)(ro,{}),(0,S.jsx)(io.A,{})]})));function oo(){return function(){const{view:e,leftMenuShown:t,chatIsOpen:n}=(0,O.LV)();(0,_.useEffect)((()=>{e&&"editor"!==e&&"pdf"!==e&&(0,$.JY)(`ide-open-view-${e}-once`)}),[e]),(0,_.useEffect)((()=>{t&&(0,$.JY)("ide-open-left-menu-once")}),[t]),(0,_.useEffect)((()=>{n&&(0,$.JY)("ide-open-chat-once")}),[n])}(),Hs(),Zs(),function(){const{registerUserActivity:e}=(0,R.FX)();(0,Ge.A)("cursor:editor:update",e),Ws(document.body,"click",e)}(),function useHasLintingError(){const{setHasLintingError:e}=(0,Qs.tB)();(0,Ge.A)("editor:lint",(t=>{e(t.detail.hasLintingError)}))}(),function(){const e=(0,ye.nK)(),{fileTreeData:t}=(0,je.Q)(),n=(0,_.useCallback)((e=>{const n=(0,mn.lE)(t,e);"fileRef"===n?.type&&window.dispatchEvent(new CustomEvent("editor.openDoc",{detail:e}))}),[t]);e.binaryFilesManager={openFileWithId:n}}(),(0,S.jsxs)(T.a,{children:[(0,S.jsx)(P,{}),(0,S.jsx)(so,{}),(0,S.jsx)($s,{}),(0,S.jsx)(Ts,{})]})}so.displayName="Modals";var lo=n(10228),ao=n(80997),co=n(27602);const uo={"io-not-loaded":"ol-translationIoNotLoaded","unable-to-join":"ol-translationUnableToJoin","i18n-error":"ol-translationLoadErrorMessage"},LoadingError=e=>{let{errorCode:t}=e;return t in uo?(0,S.jsx)("p",{className:"loading-screen-error",children:(0,h.A)(uo[t])}):null},po=new Set(["initial"]),mo=new Set(["initial","render","connection","translations","project"]),ho=e=>{let{setLoaded:t}=e;const[n,r]=(0,_.useState)(po),i=n.size/mo.size*100;(0,_.useEffect)((()=>{t(100===i)}),[i,t]);const{connectionState:s,isConnected:o}=(0,R.FX)(),l=(0,co.A)(),{projectJoined:a}=(0,tn.yn)();(0,_.useEffect)((()=>{r((e=>new Set(e).add("render")))}),[]),(0,_.useEffect)((()=>{o&&r((e=>new Set(e).add("connection")))}),[o]),(0,_.useEffect)((()=>{l.isReady&&r((e=>new Set(e).add("translations")))}),[l.isReady]),(0,_.useEffect)((()=>{a&&r((e=>new Set(e).add("project")))}),[a]);const c=(0,h.A)("ol-loadingText"),d=s.error??(l.error?"i18n-error":"");return(0,S.jsx)(fo,{progress:i,label:c,errorCode:d})},fo=e=>{let{progress:t,label:n,errorCode:r}=e;return(0,S.jsxs)("div",{className:"loading-screen",children:[(0,S.jsx)(ao.A,{loadProgress:t,label:n,hasError:Boolean(r)}),Boolean(r)&&(0,S.jsx)(LoadingError,{errorCode:r})]})},go=()=>{const[e,t]=(0,_.useState)(!1);return(0,S.jsx)(lo.F,{children:e?(0,S.jsx)(oo,{}):(0,S.jsx)(ho,{setLoaded:t})})},xo=(0,C.A)((0,_.memo)(go),v.s);y.render((0,S.jsx)(xo,{}),document.getElementById("ide-root"));try{if(document.body.parentElement&&document.body.parentElement?.clientHeight<document.body.clientHeight){const e=document.querySelector("#ide-root");e&&(e.style.height="100vh")}}catch{}},57732:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(14041),i=n(57232),s=n(31085);const o=function(e){let{onClick:t,onMouseDown:n,offset:o=50,...l}=e;const a=(0,r.useRef)(!1),c=(0,r.useRef)(),d=l;return(0,r.useEffect)((()=>{const e=e=>{if(a.current){if(a.current=!1,!c.current)return;const n=c.current.width/2,r=c.current.height/2,i=c.current.x+n,s=c.current.y+r,l=Math.abs(e.clientX-i),d=Math.abs(e.clientY-s);l<n+o&&d<r+o&&t()}};return document.addEventListener("mouseup",e),()=>{document.removeEventListener("mouseup",e)}}),[t,o]),(0,s.jsx)(i.A,{onMouseDown:e=>{a.current=!0,c.current=e.target.getBoundingClientRect(),n?.(e)},...d})}},75962:(e,t,n)=>{n.d(t,{A:()=>l});var r=n(97434),i=n(96713),s=n(67993),o=n(31085);const l=function(e){let{onDismiss:t,variant:n="light"}=e;const{t:l}=(0,r.Bd)();return(0,o.jsxs)("button",{type:"button",className:`close pull-right ${n}`,onClick:t,children:[(0,o.jsx)(s.A,{bs3:(0,o.jsx)("span",{"aria-hidden":"true",children:""}),bs5:(0,o.jsx)(i.A,{type:"close",className:"align-text-bottom",accessibilityLabel:l("close")})}),(0,o.jsx)("span",{className:"sr-only",children:l("close")})]})}},36266:(e,t,n)=>{n.d(t,{s:()=>u});var r=n(97434),i=n(89135),s=n(89753),o=n(29295),l=n(67993),a=n(96713),c=n(71627),d=n(31085);const u=e=>{let{children:t}=e;const{t:n}=(0,r.Bd)(),{reload:u}=(0,s.z)();return(0,d.jsxs)("div",{className:"error-boundary-container",children:[(0,d.jsx)(l.A,{bs3:(0,d.jsx)(i.A,{accessibilityLabel:`${n("generic_something_went_wrong")} ${n("please_refresh")}`,type:"exclamation-triangle fa-2x",fw:!0}),bs5:(0,d.jsx)(a.A,{accessibilityLabel:`${n("generic_something_went_wrong")} ${n("please_refresh")}`,type:"warning",size:"2x"})}),t||(0,d.jsx)("div",{className:"error-message",children:(0,d.jsx)(o.f,{className:"small",style:{fontWeight:"bold"}})}),(0,d.jsx)(c.A,{variant:"primary",onClick:u,children:n("refresh")})]})}},80997:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(31085);function i(e){let{loadProgress:t,label:n,hasError:i=!1}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"loading-screen-brand-container",children:(0,r.jsx)("div",{className:"loading-screen-brand",style:{height:`${t}%`}})}),!i&&(0,r.jsxs)("div",{className:"h3 loading-screen-label","aria-live":"polite",children:[n,(0,r.jsx)("span",{className:"loading-screen-ellip","aria-hidden":"true",children:"."}),(0,r.jsx)("span",{className:"loading-screen-ellip","aria-hidden":"true",children:"."}),(0,r.jsx)("span",{className:"loading-screen-ellip","aria-hidden":"true",children:"."})]})]})}},57232:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(31085);const i=function(e){let{as:t,...n}=e;const i=t||"div";return(0,r.jsx)(i,{...n})}},37318:(e,t,n)=>{n.d(t,{A:()=>h});var r=n(14041),i=n(75962),s=n(42093),o=n(31085);const l=function(e){let{id:t,children:n}=e;const[r,l]=(0,s.A)(`systemMessage.hide.${t}`,!1);return r?null:(0,o.jsxs)("li",{className:"system-message",children:["protected"!==t?(0,o.jsx)(i.A,{onDismiss:()=>l(!0),variant:"dark"}):null,n]})};var a=n(97434),c=n(64932);const d=function(){const{t:e}=(0,a.Bd)(),[t,n]=(0,s.A)("hide-i18n-notification",!1),r=(0,c.A)("ol-suggestedLanguage"),l=(0,c.A)("ol-currentUrl");return t?null:(0,o.jsxs)("li",{className:"system-message",children:[(0,o.jsx)(i.A,{onDismiss:()=>n(!0)}),(0,o.jsx)("div",{className:"text-center",children:(0,o.jsxs)("a",{href:r.url+l,children:[(0,o.jsx)(a.x6,{i18nKey:"click_here_to_view_sl_in_lng",components:[(0,o.jsx)("strong",{})],values:{lngName:r.lngName},shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}}}),(0,o.jsx)("img",{className:"ms-1",src:r.imgUrl,alt:e("country_flag",{country:r.lngName}),"aria-hidden":!0})]})})]})};var u=n(37e3),p=n(37858),m=n(60961);const h=function(){const{data:e,runAsync:t}=(0,u.A)(),n=(0,c.A)("ol-suggestedLanguage");return(0,r.useEffect)((()=>{const e=()=>{!document.hidden&&navigator.onLine&&t((0,p.hm)("/system/messages")).catch(m.$.error)};e();const n=setInterval(e,9e5);return()=>{clearInterval(n)}}),[t]),e?.length||n?(0,o.jsxs)("ul",{className:"system-messages",children:[e?.map(((e,t)=>(0,o.jsx)(l,{id:e._id,children:e.content},t))),n?(0,o.jsx)(d,{}):null]}):null}},35447:(e,t,n)=>{n.d(t,{A:()=>c,s:()=>a});var r=n(14041),i=n(5964),s=n(37858),o=n(60961),l=n(10646);const a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const[n,a]=(0,r.useState)(!1),{deactivateTutorial:c,currentPopup:d,setCurrentPopup:u}=(0,l.mi)(),p=(0,r.useCallback)((async n=>{let{event:r="promo-click",action:l="complete",...d}=n;i._(r,{...t,...d});try{await(0,s.TB)(`/tutorial/${e}/${l}`)}catch(e){o.$.error(e)}a(!1),c(e)}),[c,t,e]),m=(0,r.useCallback)((async()=>{await p({event:"promo-dismiss",action:"complete"})}),[p]),h=(0,r.useCallback)((async()=>{await p({event:"promo-click",action:"postpone",button:"maybe-later"})}),[p]),f=(0,r.useCallback)((function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"promo-prompt";return null===d&&(u(e),a(!0),i._(n,t),!0)}),[d,u,e,t]),g=(0,r.useCallback)((()=>{d===e&&(u(null),a(!1))}),[u,a,d,e]),x=(0,r.useCallback)((function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"promo-prompt";u(e),a(!0),i._(n,t)}),[u,a,e,t]),j=(0,r.useCallback)((()=>{g(),c(e)}),[g,c,e]);return{completeTutorial:p,dismissTutorial:m,maybeLater:h,tryShowingPopup:f,clearPopup:g,clearAndShow:x,showPopup:n,hideUntilReload:j}},c=a},37e3:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(14041),i=n(90274);const s={status:"idle",data:null,error:null};const o=function(e){const t=r.useRef({...s,...e}),[{status:n,data:o,error:l},a]=r.useReducer(((e,t)=>({...e,...t})),t.current),c=(0,i.A)(a),d=r.useCallback((e=>c({data:e,status:"resolved"})),[c]),u=r.useCallback((e=>c({error:e,status:"rejected"})),[c]),p=r.useCallback((()=>c(t.current)),[c]),m=r.useCallback((e=>(c({status:"pending"}),e.then((e=>(d(e),e)),(e=>(u(e),Promise.reject(e)))))),[c,d,u]);return{isIdle:"idle"===n,isLoading:"pending"===n,isError:"rejected"===n,isSuccess:"resolved"===n,setData:d,setError:u,error:l,status:n,data:o,runAsync:m,reset:p}}},309:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(14041);function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const[n,i]=(0,r.useState)(e);return(0,r.useEffect)((()=>{const n=window.setTimeout((()=>{i(e)}),t);return()=>{window.clearTimeout(n)}}),[e,t]),n}},93045:(e,t,n)=>{n.d(t,{U:()=>i});var r=n(14041);function i(){const e=(0,r.useRef)(null),[t,n]=(0,r.useState)(!1),i=(0,r.useCallback)((()=>n(!1)),[]);return(0,r.useEffect)((()=>{if(t)return;let r=null;return e.current&&(r=window.requestAnimationFrame((()=>{e.current&&(e.current.focus(),n(!0),r=null)}))),()=>{null!==r&&window.cancelAnimationFrame(r)}})),{autoFocusedRef:e,resetAutoFocus:i}}},90274:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(14041),i=n(69475);const s=function(e){const t=(0,i.A)();return r.useCallback((n=>{t.current&&e(n)}),[e,t])}},13653:(e,t,n)=>{n.d(t,{Q:()=>s});var r=n(14041),i=n(49791);const s=e=>{const t=(0,i.M)();(0,r.useEffect)((()=>{const n=new AbortController;return t?.addEventListener("message",(t=>{let{data:n}=t;return e(n)}),{signal:n.signal}),()=>n.abort()}),[t,e])}},49791:(e,t,n)=>{n.d(t,{M:()=>i});var r=n(14041);const i=()=>{const e=(0,r.useRef)(null);return null===e.current&&"BroadcastChannel"in window&&(e.current=new BroadcastChannel("user")),(0,r.useEffect)((()=>()=>e.current?.close()),[]),e.current}},37365:(e,t,n)=>{n.d(t,{O:()=>a});var r=n(35573);const i=100,s=200,o=20,l=360;function a(e,t){if(null==e||"anonymous-user"===e)return i;if(t===e)return s;let n=function(e){const t=(0,r.K)(e),n=parseInt(t.toString().slice(0,8),16)%(l-2*o);return n}(e);return n>s-o&&n<s+o&&(n-=s,n=n+l-o),n}},37235:(e,t,n)=>{function r(){return!!document.querySelector("grammarly-desktop-integration")}n.d(t,{A:()=>r})},86954:(e,t,n)=>{n.d(t,{F:()=>o,Y:()=>s});var r=n(99420),i=n.n(r);function s(e,t){return e?(null==t&&(t="Do MMM YYYY, h:mm a"),i()(e).format(t)):"N/A"}function o(e){return i()(e).fromNow()}},18730:(e,t,n)=>{n.d(t,{J:()=>o});var r=n(14041),i=n(37858),s=n(52155);function o(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const[n,o]=(0,r.useState)(!1),[l,a]=(0,r.useState)(null),[c,d]=(0,r.useState)(null),{signal:u}=(0,s.A)();return(0,r.useEffect)((()=>{t&&(o(!0),d(null),a(null),(0,i.hm)(`/${e}/groups`,{signal:u}).then((e=>{a(e.groups)})).catch((e=>{400===e.response.status?e.data.relink&&d("relink"):d("loading_groups")})).finally((()=>{o(!1)})))}),[t,e,u]),{loading:n,data:l,error:c}}}},e=>(e.O(0,[9957,2846,2070,6210,5250,6879,5845,7693,986,2709,7599,8732,5821,7379,3642,9420,4631,4075,8496,3173,826,9440,3165,8012,2098,4628,4244,9608],(()=>{return t=68910,e(e.s=t);var t})),e.O())])));